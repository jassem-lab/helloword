{"ast":null,"code":"/*!\n * FilePond 4.19.2\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : (global = global || self, factory(global.FilePond = {}));\n})(this, function (exports) {\n  'use strict';\n\n  var isNode = function isNode(value) {\n    return value instanceof HTMLElement;\n  };\n\n  var createStore = function createStore(initialState) {\n    var queries = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var actions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : []; // internal state\n\n    var state = Object.assign({}, initialState); // contains all actions for next frame, is clear when actions are requested\n\n    var actionQueue = [];\n    var dispatchQueue = []; // returns a duplicate of the current state\n\n    var getState = function getState() {\n      return Object.assign({}, state);\n    }; // returns a duplicate of the actions array and clears the actions array\n\n\n    var processActionQueue = function processActionQueue() {\n      // create copy of actions queue\n      var queue = [].concat(actionQueue); // clear actions queue (we don't want no double actions)\n\n      actionQueue.length = 0;\n      return queue;\n    }; // processes actions that might block the main UI thread\n\n\n    var processDispatchQueue = function processDispatchQueue() {\n      // create copy of actions queue\n      var queue = [].concat(dispatchQueue); // clear actions queue (we don't want no double actions)\n\n      dispatchQueue.length = 0; // now dispatch these actions\n\n      queue.forEach(function (_ref) {\n        var type = _ref.type,\n            data = _ref.data;\n        dispatch(type, data);\n      });\n    }; // adds a new action, calls its handler and\n\n\n    var dispatch = function dispatch(type, data, isBlocking) {\n      // is blocking action (should never block if document is hidden)\n      if (isBlocking && !document.hidden) {\n        dispatchQueue.push({\n          type: type,\n          data: data\n        });\n        return;\n      } // if this action has a handler, handle the action\n\n\n      if (actionHandlers[type]) {\n        actionHandlers[type](data);\n      } // now add action\n\n\n      actionQueue.push({\n        type: type,\n        data: data\n      });\n    };\n\n    var query = function query(str) {\n      var _queryHandles;\n\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n\n      return queryHandles[str] ? (_queryHandles = queryHandles)[str].apply(_queryHandles, args) : null;\n    };\n\n    var api = {\n      getState: getState,\n      processActionQueue: processActionQueue,\n      processDispatchQueue: processDispatchQueue,\n      dispatch: dispatch,\n      query: query\n    };\n    var queryHandles = {};\n    queries.forEach(function (query) {\n      queryHandles = Object.assign({}, query(state), {}, queryHandles);\n    });\n    var actionHandlers = {};\n    actions.forEach(function (action) {\n      actionHandlers = Object.assign({}, action(dispatch, query, state), {}, actionHandlers);\n    });\n    return api;\n  };\n\n  var defineProperty = function defineProperty(obj, property, definition) {\n    if (typeof definition === 'function') {\n      obj[property] = definition;\n      return;\n    }\n\n    Object.defineProperty(obj, property, Object.assign({}, definition));\n  };\n\n  var forin = function forin(obj, cb) {\n    for (var key in obj) {\n      if (!obj.hasOwnProperty(key)) {\n        continue;\n      }\n\n      cb(key, obj[key]);\n    }\n  };\n\n  var createObject = function createObject(definition) {\n    var obj = {};\n    forin(definition, function (property) {\n      defineProperty(obj, property, definition[property]);\n    });\n    return obj;\n  };\n\n  var attr = function attr(node, name) {\n    var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n    if (value === null) {\n      return node.getAttribute(name) || node.hasAttribute(name);\n    }\n\n    node.setAttribute(name, value);\n  };\n\n  var ns = 'http://www.w3.org/2000/svg';\n  var svgElements = ['svg', 'path']; // only svg elements used\n\n  var isSVGElement = function isSVGElement(tag) {\n    return svgElements.includes(tag);\n  };\n\n  var createElement = function createElement(tag, className) {\n    var attributes = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (typeof className === 'object') {\n      attributes = className;\n      className = null;\n    }\n\n    var element = isSVGElement(tag) ? document.createElementNS(ns, tag) : document.createElement(tag);\n\n    if (className) {\n      if (isSVGElement(tag)) {\n        attr(element, 'class', className);\n      } else {\n        element.className = className;\n      }\n    }\n\n    forin(attributes, function (name, value) {\n      attr(element, name, value);\n    });\n    return element;\n  };\n\n  var appendChild = function appendChild(parent) {\n    return function (child, index) {\n      if (typeof index !== 'undefined' && parent.children[index]) {\n        parent.insertBefore(child, parent.children[index]);\n      } else {\n        parent.appendChild(child);\n      }\n    };\n  };\n\n  var appendChildView = function appendChildView(parent, childViews) {\n    return function (view, index) {\n      if (typeof index !== 'undefined') {\n        childViews.splice(index, 0, view);\n      } else {\n        childViews.push(view);\n      }\n\n      return view;\n    };\n  };\n\n  var removeChildView = function removeChildView(parent, childViews) {\n    return function (view) {\n      // remove from child views\n      childViews.splice(childViews.indexOf(view), 1); // remove the element\n\n      if (view.element.parentNode) {\n        parent.removeChild(view.element);\n      }\n\n      return view;\n    };\n  };\n\n  var IS_BROWSER = function () {\n    return typeof window !== 'undefined' && typeof window.document !== 'undefined';\n  }();\n\n  var isBrowser = function isBrowser() {\n    return IS_BROWSER;\n  };\n\n  var testElement = isBrowser() ? createElement('svg') : {};\n  var getChildCount = 'children' in testElement ? function (el) {\n    return el.children.length;\n  } : function (el) {\n    return el.childNodes.length;\n  };\n\n  var getViewRect = function getViewRect(elementRect, childViews, offset, scale) {\n    var left = offset[0] || elementRect.left;\n    var top = offset[1] || elementRect.top;\n    var right = left + elementRect.width;\n    var bottom = top + elementRect.height * (scale[1] || 1);\n    var rect = {\n      // the rectangle of the element itself\n      element: Object.assign({}, elementRect),\n      // the rectangle of the element expanded to contain its children, does not include any margins\n      inner: {\n        left: elementRect.left,\n        top: elementRect.top,\n        right: elementRect.right,\n        bottom: elementRect.bottom\n      },\n      // the rectangle of the element expanded to contain its children including own margin and child margins\n      // margins will be added after we've recalculated the size\n      outer: {\n        left: left,\n        top: top,\n        right: right,\n        bottom: bottom\n      }\n    }; // expand rect to fit all child rectangles\n\n    childViews.filter(function (childView) {\n      return !childView.isRectIgnored();\n    }).map(function (childView) {\n      return childView.rect;\n    }).forEach(function (childViewRect) {\n      expandRect(rect.inner, Object.assign({}, childViewRect.inner));\n      expandRect(rect.outer, Object.assign({}, childViewRect.outer));\n    }); // calculate inner width and height\n\n    calculateRectSize(rect.inner); // append additional margin (top and left margins are included in top and left automatically)\n\n    rect.outer.bottom += rect.element.marginBottom;\n    rect.outer.right += rect.element.marginRight; // calculate outer width and height\n\n    calculateRectSize(rect.outer);\n    return rect;\n  };\n\n  var expandRect = function expandRect(parent, child) {\n    // adjust for parent offset\n    child.top += parent.top;\n    child.right += parent.left;\n    child.bottom += parent.top;\n    child.left += parent.left;\n\n    if (child.bottom > parent.bottom) {\n      parent.bottom = child.bottom;\n    }\n\n    if (child.right > parent.right) {\n      parent.right = child.right;\n    }\n  };\n\n  var calculateRectSize = function calculateRectSize(rect) {\n    rect.width = rect.right - rect.left;\n    rect.height = rect.bottom - rect.top;\n  };\n\n  var isNumber = function isNumber(value) {\n    return typeof value === 'number';\n  };\n  /**\n   * Determines if position is at destination\n   * @param position\n   * @param destination\n   * @param velocity\n   * @param errorMargin\n   * @returns {boolean}\n   */\n\n\n  var thereYet = function thereYet(position, destination, velocity) {\n    var errorMargin = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0.001;\n    return Math.abs(position - destination) < errorMargin && Math.abs(velocity) < errorMargin;\n  };\n  /**\n   * Spring animation\n   */\n\n\n  var spring = // default options\n  function spring() // method definition\n  {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$stiffness = _ref.stiffness,\n        stiffness = _ref$stiffness === void 0 ? 0.5 : _ref$stiffness,\n        _ref$damping = _ref.damping,\n        damping = _ref$damping === void 0 ? 0.75 : _ref$damping,\n        _ref$mass = _ref.mass,\n        mass = _ref$mass === void 0 ? 10 : _ref$mass;\n\n    var target = null;\n    var position = null;\n    var velocity = 0;\n    var resting = false; // updates spring state\n\n    var interpolate = function interpolate(ts, skipToEndState) {\n      // in rest, don't animate\n      if (resting) return; // need at least a target or position to do springy things\n\n      if (!(isNumber(target) && isNumber(position))) {\n        resting = true;\n        velocity = 0;\n        return;\n      } // calculate spring force\n\n\n      var f = -(position - target) * stiffness; // update velocity by adding force based on mass\n\n      velocity += f / mass; // update position by adding velocity\n\n      position += velocity; // slow down based on amount of damping\n\n      velocity *= damping; // we've arrived if we're near target and our velocity is near zero\n\n      if (thereYet(position, target, velocity) || skipToEndState) {\n        position = target;\n        velocity = 0;\n        resting = true; // we done\n\n        api.onupdate(position);\n        api.oncomplete(position);\n      } else {\n        // progress update\n        api.onupdate(position);\n      }\n    };\n    /**\n     * Set new target value\n     * @param value\n     */\n\n\n    var setTarget = function setTarget(value) {\n      // if currently has no position, set target and position to this value\n      if (isNumber(value) && !isNumber(position)) {\n        position = value;\n      } // next target value will not be animated to\n\n\n      if (target === null) {\n        target = value;\n        position = value;\n      } // let start moving to target\n\n\n      target = value; // already at target\n\n      if (position === target || typeof target === 'undefined') {\n        // now resting as target is current position, stop moving\n        resting = true;\n        velocity = 0; // done!\n\n        api.onupdate(position);\n        api.oncomplete(position);\n        return;\n      }\n\n      resting = false;\n    }; // need 'api' to call onupdate callback\n\n\n    var api = createObject({\n      interpolate: interpolate,\n      target: {\n        set: setTarget,\n        get: function get() {\n          return target;\n        }\n      },\n      resting: {\n        get: function get() {\n          return resting;\n        }\n      },\n      onupdate: function onupdate(value) {},\n      oncomplete: function oncomplete(value) {}\n    });\n    return api;\n  };\n\n  var easeLinear = function easeLinear(t) {\n    return t;\n  };\n\n  var easeInOutQuad = function easeInOutQuad(t) {\n    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n  };\n\n  var tween = // default values\n  function tween() // method definition\n  {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$duration = _ref.duration,\n        duration = _ref$duration === void 0 ? 500 : _ref$duration,\n        _ref$easing = _ref.easing,\n        easing = _ref$easing === void 0 ? easeInOutQuad : _ref$easing,\n        _ref$delay = _ref.delay,\n        delay = _ref$delay === void 0 ? 0 : _ref$delay;\n\n    var start = null;\n    var t;\n    var p;\n    var resting = true;\n    var reverse = false;\n    var target = null;\n\n    var interpolate = function interpolate(ts, skipToEndState) {\n      if (resting || target === null) return;\n\n      if (start === null) {\n        start = ts;\n      }\n\n      if (ts - start < delay) return;\n      t = ts - start - delay;\n\n      if (t >= duration || skipToEndState) {\n        t = 1;\n        p = reverse ? 0 : 1;\n        api.onupdate(p * target);\n        api.oncomplete(p * target);\n        resting = true;\n      } else {\n        p = t / duration;\n        api.onupdate((t >= 0 ? easing(reverse ? 1 - p : p) : 0) * target);\n      }\n    }; // need 'api' to call onupdate callback\n\n\n    var api = createObject({\n      interpolate: interpolate,\n      target: {\n        get: function get() {\n          return reverse ? 0 : target;\n        },\n        set: function set(value) {\n          // is initial value\n          if (target === null) {\n            target = value;\n            api.onupdate(value);\n            api.oncomplete(value);\n            return;\n          } // want to tween to a smaller value and have a current value\n\n\n          if (value < target) {\n            target = 1;\n            reverse = true;\n          } else {\n            // not tweening to a smaller value\n            reverse = false;\n            target = value;\n          } // let's go!\n\n\n          resting = false;\n          start = null;\n        }\n      },\n      resting: {\n        get: function get() {\n          return resting;\n        }\n      },\n      onupdate: function onupdate(value) {},\n      oncomplete: function oncomplete(value) {}\n    });\n    return api;\n  };\n\n  var animator = {\n    spring: spring,\n    tween: tween\n  };\n  /*\n                       { type: 'spring', stiffness: .5, damping: .75, mass: 10 };\n                       { translation: { type: 'spring', ... }, ... }\n                       { translation: { x: { type: 'spring', ... } } }\n                      */\n\n  var createAnimator = function createAnimator(definition, category, property) {\n    // default is single definition\n    // we check if transform is set, if so, we check if property is set\n    var def = definition[category] && typeof definition[category][property] === 'object' ? definition[category][property] : definition[category] || definition;\n    var type = typeof def === 'string' ? def : def.type;\n    var props = typeof def === 'object' ? Object.assign({}, def) : {};\n    return animator[type] ? animator[type](props) : null;\n  };\n\n  var addGetSet = function addGetSet(keys, obj, props) {\n    var overwrite = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n    obj = Array.isArray(obj) ? obj : [obj];\n    obj.forEach(function (o) {\n      keys.forEach(function (key) {\n        var name = key;\n\n        var getter = function getter() {\n          return props[key];\n        };\n\n        var setter = function setter(value) {\n          return props[key] = value;\n        };\n\n        if (typeof key === 'object') {\n          name = key.key;\n          getter = key.getter || getter;\n          setter = key.setter || setter;\n        }\n\n        if (o[name] && !overwrite) {\n          return;\n        }\n\n        o[name] = {\n          get: getter,\n          set: setter\n        };\n      });\n    });\n  }; // add to state,\n  // add getters and setters to internal and external api (if not set)\n  // setup animators\n\n\n  var animations = function animations(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n        viewProps = _ref.viewProps,\n        viewInternalAPI = _ref.viewInternalAPI,\n        viewExternalAPI = _ref.viewExternalAPI; // initial properties\n\n    var initialProps = Object.assign({}, viewProps); // list of all active animations\n\n    var animations = []; // setup animators\n\n    forin(mixinConfig, function (property, animation) {\n      var animator = createAnimator(animation);\n\n      if (!animator) {\n        return;\n      } // when the animator updates, update the view state value\n\n\n      animator.onupdate = function (value) {\n        viewProps[property] = value;\n      }; // set animator target\n\n\n      animator.target = initialProps[property]; // when value is set, set the animator target value\n\n      var prop = {\n        key: property,\n        setter: function setter(value) {\n          // if already at target, we done!\n          if (animator.target === value) {\n            return;\n          }\n\n          animator.target = value;\n        },\n        getter: function getter() {\n          return viewProps[property];\n        }\n      }; // add getters and setters\n\n      addGetSet([prop], [viewInternalAPI, viewExternalAPI], viewProps, true); // add it to the list for easy updating from the _write method\n\n      animations.push(animator);\n    }); // expose internal write api\n\n    return {\n      write: function write(ts) {\n        var skipToEndState = document.hidden;\n        var resting = true;\n        animations.forEach(function (animation) {\n          if (!animation.resting) resting = false;\n          animation.interpolate(ts, skipToEndState);\n        });\n        return resting;\n      },\n      destroy: function destroy() {}\n    };\n  };\n\n  var addEvent = function addEvent(element) {\n    return function (type, fn) {\n      element.addEventListener(type, fn);\n    };\n  };\n\n  var removeEvent = function removeEvent(element) {\n    return function (type, fn) {\n      element.removeEventListener(type, fn);\n    };\n  }; // mixin\n\n\n  var listeners = function listeners(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n        viewProps = _ref.viewProps,\n        viewInternalAPI = _ref.viewInternalAPI,\n        viewExternalAPI = _ref.viewExternalAPI,\n        viewState = _ref.viewState,\n        view = _ref.view;\n    var events = [];\n    var add = addEvent(view.element);\n    var remove = removeEvent(view.element);\n\n    viewExternalAPI.on = function (type, fn) {\n      events.push({\n        type: type,\n        fn: fn\n      });\n      add(type, fn);\n    };\n\n    viewExternalAPI.off = function (type, fn) {\n      events.splice(events.findIndex(function (event) {\n        return event.type === type && event.fn === fn;\n      }), 1);\n      remove(type, fn);\n    };\n\n    return {\n      write: function write() {\n        // not busy\n        return true;\n      },\n      destroy: function destroy() {\n        events.forEach(function (event) {\n          remove(event.type, event.fn);\n        });\n      }\n    };\n  }; // add to external api and link to props\n\n\n  var apis = function apis(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n        viewProps = _ref.viewProps,\n        viewExternalAPI = _ref.viewExternalAPI;\n    addGetSet(mixinConfig, viewExternalAPI, viewProps);\n  };\n\n  var isDefined = function isDefined(value) {\n    return value != null;\n  }; // add to state,\n  // add getters and setters to internal and external api (if not set)\n  // set initial state based on props in viewProps\n  // apply as transforms each frame\n\n\n  var defaults = {\n    opacity: 1,\n    scaleX: 1,\n    scaleY: 1,\n    translateX: 0,\n    translateY: 0,\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n    originX: 0,\n    originY: 0\n  };\n\n  var styles = function styles(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n        viewProps = _ref.viewProps,\n        viewInternalAPI = _ref.viewInternalAPI,\n        viewExternalAPI = _ref.viewExternalAPI,\n        view = _ref.view; // initial props\n\n    var initialProps = Object.assign({}, viewProps); // current props\n\n    var currentProps = {}; // we will add those properties to the external API and link them to the viewState\n\n    addGetSet(mixinConfig, [viewInternalAPI, viewExternalAPI], viewProps); // override rect on internal and external rect getter so it takes in account transforms\n\n    var getOffset = function getOffset() {\n      return [viewProps['translateX'] || 0, viewProps['translateY'] || 0];\n    };\n\n    var getScale = function getScale() {\n      return [viewProps['scaleX'] || 0, viewProps['scaleY'] || 0];\n    };\n\n    var getRect = function getRect() {\n      return view.rect ? getViewRect(view.rect, view.childViews, getOffset(), getScale()) : null;\n    };\n\n    viewInternalAPI.rect = {\n      get: getRect\n    };\n    viewExternalAPI.rect = {\n      get: getRect\n    }; // apply view props\n\n    mixinConfig.forEach(function (key) {\n      viewProps[key] = typeof initialProps[key] === 'undefined' ? defaults[key] : initialProps[key];\n    }); // expose api\n\n    return {\n      write: function write() {\n        // see if props have changed\n        if (!propsHaveChanged(currentProps, viewProps)) {\n          return;\n        } // moves element to correct position on screen\n\n\n        applyStyles(view.element, viewProps); // store new transforms\n\n        Object.assign(currentProps, Object.assign({}, viewProps)); // no longer busy\n\n        return true;\n      },\n      destroy: function destroy() {}\n    };\n  };\n\n  var propsHaveChanged = function propsHaveChanged(currentProps, newProps) {\n    // different amount of keys\n    if (Object.keys(currentProps).length !== Object.keys(newProps).length) {\n      return true;\n    } // lets analyze the individual props\n\n\n    for (var prop in newProps) {\n      if (newProps[prop] !== currentProps[prop]) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var applyStyles = function applyStyles(element, _ref2) {\n    var opacity = _ref2.opacity,\n        perspective = _ref2.perspective,\n        translateX = _ref2.translateX,\n        translateY = _ref2.translateY,\n        scaleX = _ref2.scaleX,\n        scaleY = _ref2.scaleY,\n        rotateX = _ref2.rotateX,\n        rotateY = _ref2.rotateY,\n        rotateZ = _ref2.rotateZ,\n        originX = _ref2.originX,\n        originY = _ref2.originY,\n        width = _ref2.width,\n        height = _ref2.height;\n    var transforms = '';\n    var styles = ''; // handle transform origin\n\n    if (isDefined(originX) || isDefined(originY)) {\n      styles += 'transform-origin: ' + (originX || 0) + 'px ' + (originY || 0) + 'px;';\n    } // transform order is relevant\n    // 0. perspective\n\n\n    if (isDefined(perspective)) {\n      transforms += 'perspective(' + perspective + 'px) ';\n    } // 1. translate\n\n\n    if (isDefined(translateX) || isDefined(translateY)) {\n      transforms += 'translate3d(' + (translateX || 0) + 'px, ' + (translateY || 0) + 'px, 0) ';\n    } // 2. scale\n\n\n    if (isDefined(scaleX) || isDefined(scaleY)) {\n      transforms += 'scale3d(' + (isDefined(scaleX) ? scaleX : 1) + ', ' + (isDefined(scaleY) ? scaleY : 1) + ', 1) ';\n    } // 3. rotate\n\n\n    if (isDefined(rotateZ)) {\n      transforms += 'rotateZ(' + rotateZ + 'rad) ';\n    }\n\n    if (isDefined(rotateX)) {\n      transforms += 'rotateX(' + rotateX + 'rad) ';\n    }\n\n    if (isDefined(rotateY)) {\n      transforms += 'rotateY(' + rotateY + 'rad) ';\n    } // add transforms\n\n\n    if (transforms.length) {\n      styles += 'transform:' + transforms + ';';\n    } // add opacity\n\n\n    if (isDefined(opacity)) {\n      styles += 'opacity:' + opacity + ';'; // if we reach zero, we make the element inaccessible\n\n      if (opacity === 0) {\n        styles += 'visibility:hidden;';\n      } // if we're below 100% opacity this element can't be clicked\n\n\n      if (opacity < 1) {\n        styles += 'pointer-events:none;';\n      }\n    } // add height\n\n\n    if (isDefined(height)) {\n      styles += 'height:' + height + 'px;';\n    } // add width\n\n\n    if (isDefined(width)) {\n      styles += 'width:' + width + 'px;';\n    } // apply styles\n\n\n    var elementCurrentStyle = element.elementCurrentStyle || ''; // if new styles does not match current styles, lets update!\n\n    if (styles.length !== elementCurrentStyle.length || styles !== elementCurrentStyle) {\n      element.style.cssText = styles; // store current styles so we can compare them to new styles later on\n      // _not_ getting the style value is faster\n\n      element.elementCurrentStyle = styles;\n    }\n  };\n\n  var Mixins = {\n    styles: styles,\n    listeners: listeners,\n    animations: animations,\n    apis: apis\n  };\n\n  var updateRect = function updateRect() {\n    var rect = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var element = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var style = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (!element.layoutCalculated) {\n      rect.paddingTop = parseInt(style.paddingTop, 10) || 0;\n      rect.marginTop = parseInt(style.marginTop, 10) || 0;\n      rect.marginRight = parseInt(style.marginRight, 10) || 0;\n      rect.marginBottom = parseInt(style.marginBottom, 10) || 0;\n      rect.marginLeft = parseInt(style.marginLeft, 10) || 0;\n      element.layoutCalculated = true;\n    }\n\n    rect.left = element.offsetLeft || 0;\n    rect.top = element.offsetTop || 0;\n    rect.width = element.offsetWidth || 0;\n    rect.height = element.offsetHeight || 0;\n    rect.right = rect.left + rect.width;\n    rect.bottom = rect.top + rect.height;\n    rect.scrollTop = element.scrollTop;\n    rect.hidden = element.offsetParent === null;\n    return rect;\n  };\n\n  var createView = // default view definition\n  function createView() {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$tag = _ref.tag,\n        tag = _ref$tag === void 0 ? 'div' : _ref$tag,\n        _ref$name = _ref.name,\n        name = _ref$name === void 0 ? null : _ref$name,\n        _ref$attributes = _ref.attributes,\n        attributes = _ref$attributes === void 0 ? {} : _ref$attributes,\n        _ref$read = _ref.read,\n        read = _ref$read === void 0 ? function () {} : _ref$read,\n        _ref$write = _ref.write,\n        write = _ref$write === void 0 ? function () {} : _ref$write,\n        _ref$create = _ref.create,\n        create = _ref$create === void 0 ? function () {} : _ref$create,\n        _ref$destroy = _ref.destroy,\n        destroy = _ref$destroy === void 0 ? function () {} : _ref$destroy,\n        _ref$filterFrameActio = _ref.filterFrameActionsForChild,\n        filterFrameActionsForChild = _ref$filterFrameActio === void 0 ? function (child, actions) {\n      return actions;\n    } : _ref$filterFrameActio,\n        _ref$didCreateView = _ref.didCreateView,\n        didCreateView = _ref$didCreateView === void 0 ? function () {} : _ref$didCreateView,\n        _ref$didWriteView = _ref.didWriteView,\n        didWriteView = _ref$didWriteView === void 0 ? function () {} : _ref$didWriteView,\n        _ref$ignoreRect = _ref.ignoreRect,\n        ignoreRect = _ref$ignoreRect === void 0 ? false : _ref$ignoreRect,\n        _ref$ignoreRectUpdate = _ref.ignoreRectUpdate,\n        ignoreRectUpdate = _ref$ignoreRectUpdate === void 0 ? false : _ref$ignoreRectUpdate,\n        _ref$mixins = _ref.mixins,\n        mixins = _ref$mixins === void 0 ? [] : _ref$mixins;\n\n    return function ( // each view requires reference to store\n    store) {\n      var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {}; // root element should not be changed\n\n      var element = createElement(tag, 'filepond--' + name, attributes); // style reference should also not be changed\n\n      var style = window.getComputedStyle(element, null); // element rectangle\n\n      var rect = updateRect();\n      var frameRect = null; // rest state\n\n      var isResting = false; // pretty self explanatory\n\n      var childViews = []; // loaded mixins\n\n      var activeMixins = []; // references to created children\n\n      var ref = {}; // state used for each instance\n\n      var state = {}; // list of writers that will be called to update this view\n\n      var writers = [write // default writer\n      ];\n      var readers = [read // default reader\n      ];\n      var destroyers = [destroy // default destroy\n      ]; // core view methods\n\n      var getElement = function getElement() {\n        return element;\n      };\n\n      var getChildViews = function getChildViews() {\n        return childViews.concat();\n      };\n\n      var getReference = function getReference() {\n        return ref;\n      };\n\n      var createChildView = function createChildView(store) {\n        return function (view, props) {\n          return view(store, props);\n        };\n      };\n\n      var getRect = function getRect() {\n        if (frameRect) {\n          return frameRect;\n        }\n\n        frameRect = getViewRect(rect, childViews, [0, 0], [1, 1]);\n        return frameRect;\n      };\n\n      var getStyle = function getStyle() {\n        return style;\n      };\n      /**\n       * Read data from DOM\n       * @private\n       */\n\n\n      var _read = function _read() {\n        frameRect = null; // read child views\n\n        childViews.forEach(function (child) {\n          return child._read();\n        });\n        var shouldUpdate = !(ignoreRectUpdate && rect.width && rect.height);\n\n        if (shouldUpdate) {\n          updateRect(rect, element, style);\n        } // readers\n\n\n        var api = {\n          root: internalAPI,\n          props: props,\n          rect: rect\n        };\n        readers.forEach(function (reader) {\n          return reader(api);\n        });\n      };\n      /**\n       * Write data to DOM\n       * @private\n       */\n\n\n      var _write = function _write(ts, frameActions, shouldOptimize) {\n        // if no actions, we assume that the view is resting\n        var resting = frameActions.length === 0; // writers\n\n        writers.forEach(function (writer) {\n          var writerResting = writer({\n            props: props,\n            root: internalAPI,\n            actions: frameActions,\n            timestamp: ts,\n            shouldOptimize: shouldOptimize\n          });\n\n          if (writerResting === false) {\n            resting = false;\n          }\n        }); // run mixins\n\n        activeMixins.forEach(function (mixin) {\n          // if one of the mixins is still busy after write operation, we are not resting\n          var mixinResting = mixin.write(ts);\n\n          if (mixinResting === false) {\n            resting = false;\n          }\n        }); // updates child views that are currently attached to the DOM\n\n        childViews.filter(function (child) {\n          return !!child.element.parentNode;\n        }).forEach(function (child) {\n          // if a child view is not resting, we are not resting\n          var childResting = child._write(ts, filterFrameActionsForChild(child, frameActions), shouldOptimize);\n\n          if (!childResting) {\n            resting = false;\n          }\n        }); // append new elements to DOM and update those\n\n        childViews //.filter(child => !child.element.parentNode)\n        .forEach(function (child, index) {\n          // skip\n          if (child.element.parentNode) {\n            return;\n          } // append to DOM\n\n\n          internalAPI.appendChild(child.element, index); // call read (need to know the size of these elements)\n\n          child._read(); // re-call write\n\n\n          child._write(ts, filterFrameActionsForChild(child, frameActions), shouldOptimize); // we just added somthing to the dom, no rest\n\n\n          resting = false;\n        }); // update resting state\n\n        isResting = resting;\n        didWriteView({\n          props: props,\n          root: internalAPI,\n          actions: frameActions,\n          timestamp: ts\n        }); // let parent know if we are resting\n\n        return resting;\n      };\n\n      var _destroy = function _destroy() {\n        activeMixins.forEach(function (mixin) {\n          return mixin.destroy();\n        });\n        destroyers.forEach(function (destroyer) {\n          destroyer({\n            root: internalAPI,\n            props: props\n          });\n        });\n        childViews.forEach(function (child) {\n          return child._destroy();\n        });\n      }; // sharedAPI\n\n\n      var sharedAPIDefinition = {\n        element: {\n          get: getElement\n        },\n        style: {\n          get: getStyle\n        },\n        childViews: {\n          get: getChildViews\n        }\n      }; // private API definition\n\n      var internalAPIDefinition = Object.assign({}, sharedAPIDefinition, {\n        rect: {\n          get: getRect\n        },\n        // access to custom children references\n        ref: {\n          get: getReference\n        },\n        // dom modifiers\n        is: function is(needle) {\n          return name === needle;\n        },\n        appendChild: appendChild(element),\n        createChildView: createChildView(store),\n        linkView: function linkView(view) {\n          childViews.push(view);\n          return view;\n        },\n        unlinkView: function unlinkView(view) {\n          childViews.splice(childViews.indexOf(view), 1);\n        },\n        appendChildView: appendChildView(element, childViews),\n        removeChildView: removeChildView(element, childViews),\n        registerWriter: function registerWriter(writer) {\n          return writers.push(writer);\n        },\n        registerReader: function registerReader(reader) {\n          return readers.push(reader);\n        },\n        registerDestroyer: function registerDestroyer(destroyer) {\n          return destroyers.push(destroyer);\n        },\n        invalidateLayout: function invalidateLayout() {\n          return element.layoutCalculated = false;\n        },\n        // access to data store\n        dispatch: store.dispatch,\n        query: store.query\n      }); // public view API methods\n\n      var externalAPIDefinition = {\n        element: {\n          get: getElement\n        },\n        childViews: {\n          get: getChildViews\n        },\n        rect: {\n          get: getRect\n        },\n        resting: {\n          get: function get() {\n            return isResting;\n          }\n        },\n        isRectIgnored: function isRectIgnored() {\n          return ignoreRect;\n        },\n        _read: _read,\n        _write: _write,\n        _destroy: _destroy\n      }; // mixin API methods\n\n      var mixinAPIDefinition = Object.assign({}, sharedAPIDefinition, {\n        rect: {\n          get: function get() {\n            return rect;\n          }\n        }\n      }); // add mixin functionality\n\n      Object.keys(mixins).sort(function (a, b) {\n        // move styles to the back of the mixin list (so adjustments of other mixins are applied to the props correctly)\n        if (a === 'styles') {\n          return 1;\n        } else if (b === 'styles') {\n          return -1;\n        }\n\n        return 0;\n      }).forEach(function (key) {\n        var mixinAPI = Mixins[key]({\n          mixinConfig: mixins[key],\n          viewProps: props,\n          viewState: state,\n          viewInternalAPI: internalAPIDefinition,\n          viewExternalAPI: externalAPIDefinition,\n          view: createObject(mixinAPIDefinition)\n        });\n\n        if (mixinAPI) {\n          activeMixins.push(mixinAPI);\n        }\n      }); // construct private api\n\n      var internalAPI = createObject(internalAPIDefinition); // create the view\n\n      create({\n        root: internalAPI,\n        props: props\n      }); // append created child views to root node\n\n      var childCount = getChildCount(element); // need to know the current child count so appending happens in correct order\n\n      childViews.forEach(function (child, index) {\n        internalAPI.appendChild(child.element, childCount + index);\n      }); // call did create\n\n      didCreateView(internalAPI); // expose public api\n\n      return createObject(externalAPIDefinition);\n    };\n  };\n\n  var createPainter = function createPainter(read, write) {\n    var fps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 60;\n    var name = '__framePainter'; // set global painter\n\n    if (window[name]) {\n      window[name].readers.push(read);\n      window[name].writers.push(write);\n      return;\n    }\n\n    window[name] = {\n      readers: [read],\n      writers: [write]\n    };\n    var painter = window[name];\n    var interval = 1000 / fps;\n    var last = null;\n    var id = null;\n    var requestTick = null;\n    var cancelTick = null;\n\n    var setTimerType = function setTimerType() {\n      if (document.hidden) {\n        requestTick = function requestTick() {\n          return window.setTimeout(function () {\n            return tick(performance.now());\n          }, interval);\n        };\n\n        cancelTick = function cancelTick() {\n          return window.clearTimeout(id);\n        };\n      } else {\n        requestTick = function requestTick() {\n          return window.requestAnimationFrame(tick);\n        };\n\n        cancelTick = function cancelTick() {\n          return window.cancelAnimationFrame(id);\n        };\n      }\n    };\n\n    document.addEventListener('visibilitychange', function () {\n      if (cancelTick) cancelTick();\n      setTimerType();\n      tick(performance.now());\n    });\n\n    var tick = function tick(ts) {\n      // queue next tick\n      id = requestTick(tick); // limit fps\n\n      if (!last) {\n        last = ts;\n      }\n\n      var delta = ts - last;\n\n      if (delta <= interval) {\n        // skip frame\n        return;\n      } // align next frame\n\n\n      last = ts - delta % interval; // update view\n\n      painter.readers.forEach(function (read) {\n        return read();\n      });\n      painter.writers.forEach(function (write) {\n        return write(ts);\n      });\n    };\n\n    setTimerType();\n    tick(performance.now());\n    return {\n      pause: function pause() {\n        cancelTick(id);\n      }\n    };\n  };\n\n  var createRoute = function createRoute(routes, fn) {\n    return function (_ref) {\n      var root = _ref.root,\n          props = _ref.props,\n          _ref$actions = _ref.actions,\n          actions = _ref$actions === void 0 ? [] : _ref$actions,\n          timestamp = _ref.timestamp,\n          shouldOptimize = _ref.shouldOptimize;\n      actions.filter(function (action) {\n        return routes[action.type];\n      }).forEach(function (action) {\n        return routes[action.type]({\n          root: root,\n          props: props,\n          action: action.data,\n          timestamp: timestamp,\n          shouldOptimize: shouldOptimize\n        });\n      });\n\n      if (fn) {\n        fn({\n          root: root,\n          props: props,\n          actions: actions,\n          timestamp: timestamp,\n          shouldOptimize: shouldOptimize\n        });\n      }\n    };\n  };\n\n  var insertBefore = function insertBefore(newNode, referenceNode) {\n    return referenceNode.parentNode.insertBefore(newNode, referenceNode);\n  };\n\n  var insertAfter = function insertAfter(newNode, referenceNode) {\n    return referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n  };\n\n  var isArray = function isArray(value) {\n    return Array.isArray(value);\n  };\n\n  var isEmpty = function isEmpty(value) {\n    return value == null;\n  };\n\n  var trim = function trim(str) {\n    return str.trim();\n  };\n\n  var toString = function toString(value) {\n    return '' + value;\n  };\n\n  var toArray = function toArray(value) {\n    var splitter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ',';\n\n    if (isEmpty(value)) {\n      return [];\n    }\n\n    if (isArray(value)) {\n      return value;\n    }\n\n    return toString(value).split(splitter).map(trim).filter(function (str) {\n      return str.length;\n    });\n  };\n\n  var isBoolean = function isBoolean(value) {\n    return typeof value === 'boolean';\n  };\n\n  var toBoolean = function toBoolean(value) {\n    return isBoolean(value) ? value : value === 'true';\n  };\n\n  var isString = function isString(value) {\n    return typeof value === 'string';\n  };\n\n  var toNumber = function toNumber(value) {\n    return isNumber(value) ? value : isString(value) ? toString(value).replace(/[a-z]+/gi, '') : 0;\n  };\n\n  var toInt = function toInt(value) {\n    return parseInt(toNumber(value), 10);\n  };\n\n  var toFloat = function toFloat(value) {\n    return parseFloat(toNumber(value));\n  };\n\n  var isInt = function isInt(value) {\n    return isNumber(value) && isFinite(value) && Math.floor(value) === value;\n  };\n\n  var toBytes = function toBytes(value) {\n    // is in bytes\n    if (isInt(value)) {\n      return value;\n    } // is natural file size\n\n\n    var naturalFileSize = toString(value).trim(); // if is value in megabytes\n\n    if (/MB$/i.test(naturalFileSize)) {\n      naturalFileSize = naturalFileSize.replace(/MB$i/, '').trim();\n      return toInt(naturalFileSize) * 1000 * 1000;\n    } // if is value in kilobytes\n\n\n    if (/KB/i.test(naturalFileSize)) {\n      naturalFileSize = naturalFileSize.replace(/KB$i/, '').trim();\n      return toInt(naturalFileSize) * 1000;\n    }\n\n    return toInt(naturalFileSize);\n  };\n\n  var isFunction = function isFunction(value) {\n    return typeof value === 'function';\n  };\n\n  var toFunctionReference = function toFunctionReference(string) {\n    var ref = self;\n    var levels = string.split('.');\n    var level = null;\n\n    while (level = levels.shift()) {\n      ref = ref[level];\n\n      if (!ref) {\n        return null;\n      }\n    }\n\n    return ref;\n  };\n\n  var methods = {\n    process: 'POST',\n    patch: 'PATCH',\n    revert: 'DELETE',\n    fetch: 'GET',\n    restore: 'GET',\n    load: 'GET'\n  };\n\n  var createServerAPI = function createServerAPI(outline) {\n    var api = {};\n    api.url = isString(outline) ? outline : outline.url || '';\n    api.timeout = outline.timeout ? parseInt(outline.timeout, 10) : 0;\n    api.headers = outline.headers ? outline.headers : {};\n    forin(methods, function (key) {\n      api[key] = createAction(key, outline[key], methods[key], api.timeout, api.headers);\n    }); // special treatment for remove\n\n    api.remove = outline.remove || null; // remove generic headers from api object\n\n    delete api.headers;\n    return api;\n  };\n\n  var createAction = function createAction(name, outline, method, timeout, headers) {\n    // is explicitely set to null so disable\n    if (outline === null) {\n      return null;\n    } // if is custom function, done! Dev handles everything.\n\n\n    if (typeof outline === 'function') {\n      return outline;\n    } // build action object\n\n\n    var action = {\n      url: method === 'GET' || method === 'PATCH' ? '?' + name + '=' : '',\n      method: method,\n      headers: headers,\n      withCredentials: false,\n      timeout: timeout,\n      onload: null,\n      ondata: null,\n      onerror: null\n    }; // is a single url\n\n    if (isString(outline)) {\n      action.url = outline;\n      return action;\n    } // overwrite\n\n\n    Object.assign(action, outline); // see if should reformat headers;\n\n    if (isString(action.headers)) {\n      var parts = action.headers.split(/:(.+)/);\n      action.headers = {\n        header: parts[0],\n        value: parts[1]\n      };\n    } // if is bool withCredentials\n\n\n    action.withCredentials = toBoolean(action.withCredentials);\n    return action;\n  };\n\n  var toServerAPI = function toServerAPI(value) {\n    return createServerAPI(value);\n  };\n\n  var isNull = function isNull(value) {\n    return value === null;\n  };\n\n  var isObject = function isObject(value) {\n    return typeof value === 'object' && value !== null;\n  };\n\n  var isAPI = function isAPI(value) {\n    return isObject(value) && isString(value.url) && isObject(value.process) && isObject(value.revert) && isObject(value.restore) && isObject(value.fetch);\n  };\n\n  var getType = function getType(value) {\n    if (isArray(value)) {\n      return 'array';\n    }\n\n    if (isNull(value)) {\n      return 'null';\n    }\n\n    if (isInt(value)) {\n      return 'int';\n    }\n\n    if (/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(value)) {\n      return 'bytes';\n    }\n\n    if (isAPI(value)) {\n      return 'api';\n    }\n\n    return typeof value;\n  };\n\n  var replaceSingleQuotes = function replaceSingleQuotes(str) {\n    return str.replace(/{\\s*'/g, '{\"').replace(/'\\s*}/g, '\"}').replace(/'\\s*:/g, '\":').replace(/:\\s*'/g, ':\"').replace(/,\\s*'/g, ',\"').replace(/'\\s*,/g, '\",');\n  };\n\n  var conversionTable = {\n    array: toArray,\n    boolean: toBoolean,\n    int: function int(value) {\n      return getType(value) === 'bytes' ? toBytes(value) : toInt(value);\n    },\n    number: toFloat,\n    float: toFloat,\n    bytes: toBytes,\n    string: function string(value) {\n      return isFunction(value) ? value : toString(value);\n    },\n    function: function _function(value) {\n      return toFunctionReference(value);\n    },\n    serverapi: toServerAPI,\n    object: function object(value) {\n      try {\n        return JSON.parse(replaceSingleQuotes(value));\n      } catch (e) {\n        return null;\n      }\n    }\n  };\n\n  var convertTo = function convertTo(value, type) {\n    return conversionTable[type](value);\n  };\n\n  var getValueByType = function getValueByType(newValue, defaultValue, valueType) {\n    // can always assign default value\n    if (newValue === defaultValue) {\n      return newValue;\n    } // get the type of the new value\n\n\n    var newValueType = getType(newValue); // is valid type?\n\n    if (newValueType !== valueType) {\n      // is string input, let's attempt to convert\n      var convertedValue = convertTo(newValue, valueType); // what is the type now\n\n      newValueType = getType(convertedValue); // no valid conversions found\n\n      if (convertedValue === null) {\n        throw 'Trying to assign value with incorrect type to \"' + option + '\", allowed type: \"' + valueType + '\"';\n      } else {\n        newValue = convertedValue;\n      }\n    } // assign new value\n\n\n    return newValue;\n  };\n\n  var createOption = function createOption(defaultValue, valueType) {\n    var currentValue = defaultValue;\n    return {\n      enumerable: true,\n      get: function get() {\n        return currentValue;\n      },\n      set: function set(newValue) {\n        currentValue = getValueByType(newValue, defaultValue, valueType);\n      }\n    };\n  };\n\n  var createOptions = function createOptions(options) {\n    var obj = {};\n    forin(options, function (prop) {\n      var optionDefinition = options[prop];\n      obj[prop] = createOption(optionDefinition[0], optionDefinition[1]);\n    });\n    return createObject(obj);\n  };\n\n  var createInitialState = function createInitialState(options) {\n    return {\n      // model\n      items: [],\n      // timeout used for calling update items\n      listUpdateTimeout: null,\n      // timeout used for stacking metadata updates\n      itemUpdateTimeout: null,\n      // queue of items waiting to be processed\n      processingQueue: [],\n      // options\n      options: createOptions(options)\n    };\n  };\n\n  var fromCamels = function fromCamels(string) {\n    var separator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';\n    return string.split(/(?=[A-Z])/).map(function (part) {\n      return part.toLowerCase();\n    }).join(separator);\n  };\n\n  var createOptionAPI = function createOptionAPI(store, options) {\n    var obj = {};\n    forin(options, function (key) {\n      obj[key] = {\n        get: function get() {\n          return store.getState().options[key];\n        },\n        set: function set(value) {\n          store.dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {\n            value: value\n          });\n        }\n      };\n    });\n    return obj;\n  };\n\n  var createOptionActions = function createOptionActions(options) {\n    return function (dispatch, query, state) {\n      var obj = {};\n      forin(options, function (key) {\n        var name = fromCamels(key, '_').toUpperCase();\n\n        obj['SET_' + name] = function (action) {\n          try {\n            state.options[key] = action.value;\n          } catch (e) {} // nope, failed\n          // we successfully set the value of this option\n\n\n          dispatch('DID_SET_' + name, {\n            value: state.options[key]\n          });\n        };\n      });\n      return obj;\n    };\n  };\n\n  var createOptionQueries = function createOptionQueries(options) {\n    return function (state) {\n      var obj = {};\n      forin(options, function (key) {\n        obj['GET_' + fromCamels(key, '_').toUpperCase()] = function (action) {\n          return state.options[key];\n        };\n      });\n      return obj;\n    };\n  };\n\n  var InteractionMethod = {\n    API: 1,\n    DROP: 2,\n    BROWSE: 3,\n    PASTE: 4,\n    NONE: 5\n  };\n\n  var getUniqueId = function getUniqueId() {\n    return Math.random().toString(36).substr(2, 9);\n  };\n\n  function _typeof(obj) {\n    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n      _typeof = function (obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function (obj) {\n        return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  var REACT_ELEMENT_TYPE;\n\n  function _jsx(type, props, key, children) {\n    if (!REACT_ELEMENT_TYPE) {\n      REACT_ELEMENT_TYPE = typeof Symbol === 'function' && Symbol['for'] && Symbol['for']('react.element') || 0xeac7;\n    }\n\n    var defaultProps = type && type.defaultProps;\n    var childrenLength = arguments.length - 3;\n\n    if (!props && childrenLength !== 0) {\n      props = {\n        children: void 0\n      };\n    }\n\n    if (props && defaultProps) {\n      for (var propName in defaultProps) {\n        if (props[propName] === void 0) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    } else if (!props) {\n      props = defaultProps || {};\n    }\n\n    if (childrenLength === 1) {\n      props.children = children;\n    } else if (childrenLength > 1) {\n      var childArray = new Array(childrenLength);\n\n      for (var i = 0; i < childrenLength; i++) {\n        childArray[i] = arguments[i + 3];\n      }\n\n      props.children = childArray;\n    }\n\n    return {\n      $$typeof: REACT_ELEMENT_TYPE,\n      type: type,\n      key: key === undefined ? null : '' + key,\n      ref: null,\n      props: props,\n      _owner: null\n    };\n  }\n\n  function _asyncIterator(iterable) {\n    var method;\n\n    if (typeof Symbol !== 'undefined') {\n      if (Symbol.asyncIterator) {\n        method = iterable[Symbol.asyncIterator];\n        if (method != null) return method.call(iterable);\n      }\n\n      if (Symbol.iterator) {\n        method = iterable[Symbol.iterator];\n        if (method != null) return method.call(iterable);\n      }\n    }\n\n    throw new TypeError('Object is not async iterable');\n  }\n\n  function _AwaitValue(value) {\n    this.wrapped = value;\n  }\n\n  function _AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function (resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n        var wrappedAwait = value instanceof _AwaitValue;\n        Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n          if (wrappedAwait) {\n            resume('next', arg);\n            return;\n          }\n\n          settle(result.done ? 'return' : 'normal', arg);\n        }, function (err) {\n          resume('throw', err);\n        });\n      } catch (err) {\n        settle('throw', err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case 'return':\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case 'throw':\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== 'function') {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n    _AsyncGenerator.prototype[Symbol.asyncIterator] = function () {\n      return this;\n    };\n  }\n\n  _AsyncGenerator.prototype.next = function (arg) {\n    return this._invoke('next', arg);\n  };\n\n  _AsyncGenerator.prototype.throw = function (arg) {\n    return this._invoke('throw', arg);\n  };\n\n  _AsyncGenerator.prototype.return = function (arg) {\n    return this._invoke('return', arg);\n  };\n\n  function _wrapAsyncGenerator(fn) {\n    return function () {\n      return new _AsyncGenerator(fn.apply(this, arguments));\n    };\n  }\n\n  function _awaitAsyncGenerator(value) {\n    return new _AwaitValue(value);\n  }\n\n  function _asyncGeneratorDelegate(inner, awaitWrap) {\n    var iter = {},\n        waiting = false;\n\n    function pump(key, value) {\n      waiting = true;\n      value = new Promise(function (resolve) {\n        resolve(inner[key](value));\n      });\n      return {\n        done: false,\n        value: awaitWrap(value)\n      };\n    }\n\n    if (typeof Symbol === 'function' && Symbol.iterator) {\n      iter[Symbol.iterator] = function () {\n        return this;\n      };\n    }\n\n    iter.next = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump('next', value);\n    };\n\n    if (typeof inner.throw === 'function') {\n      iter.throw = function (value) {\n        if (waiting) {\n          waiting = false;\n          throw value;\n        }\n\n        return pump('throw', value);\n      };\n    }\n\n    if (typeof inner.return === 'function') {\n      iter.return = function (value) {\n        return pump('return', value);\n      };\n    }\n\n    return iter;\n  }\n\n  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n      var info = gen[key](arg);\n      var value = info.value;\n    } catch (error) {\n      reject(error);\n      return;\n    }\n\n    if (info.done) {\n      resolve(value);\n    } else {\n      Promise.resolve(value).then(_next, _throw);\n    }\n  }\n\n  function _asyncToGenerator(fn) {\n    return function () {\n      var self = this,\n          args = arguments;\n      return new Promise(function (resolve, reject) {\n        var gen = fn.apply(self, args);\n\n        function _next(value) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'next', value);\n        }\n\n        function _throw(err) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n        }\n\n        _next(undefined);\n      });\n    };\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if ('value' in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineEnumerableProperties(obj, descs) {\n    for (var key in descs) {\n      var desc = descs[key];\n      desc.configurable = desc.enumerable = true;\n      if ('value' in desc) desc.writable = true;\n      Object.defineProperty(obj, key, desc);\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n      for (var i = 0; i < objectSymbols.length; i++) {\n        var sym = objectSymbols[i];\n        var desc = descs[sym];\n        desc.configurable = desc.enumerable = true;\n        if ('value' in desc) desc.writable = true;\n        Object.defineProperty(obj, sym, desc);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defaults(obj, defaults) {\n    var keys = Object.getOwnPropertyNames(defaults);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n      if (value && value.configurable && obj[key] === undefined) {\n        Object.defineProperty(obj, key, value);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function _extends() {\n    _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n        var source = arguments[i];\n\n        for (var key in source) {\n          if (Object.prototype.hasOwnProperty.call(source, key)) {\n            target[key] = source[key];\n          }\n        }\n      }\n\n      return target;\n    };\n\n    return _extends.apply(this, arguments);\n  }\n\n  function _objectSpread(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n      var ownKeys = Object.keys(source);\n\n      if (typeof Object.getOwnPropertySymbols === 'function') {\n        ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n          return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n      }\n\n      ownKeys.forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    }\n\n    return target;\n  }\n\n  function ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n\n    if (Object.getOwnPropertySymbols) {\n      var symbols = Object.getOwnPropertySymbols(object);\n      if (enumerableOnly) symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n      keys.push.apply(keys, symbols);\n    }\n\n    return keys;\n  }\n\n  function _objectSpread2(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n\n      if (i % 2) {\n        ownKeys(source, true).forEach(function (key) {\n          _defineProperty(target, key, source[key]);\n        });\n      } else if (Object.getOwnPropertyDescriptors) {\n        Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n      } else {\n        ownKeys(source).forEach(function (key) {\n          Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n        });\n      }\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function');\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _inheritsLoose(subClass, superClass) {\n    subClass.prototype = Object.create(superClass.prototype);\n    subClass.prototype.constructor = subClass;\n    subClass.__proto__ = superClass;\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n      return o.__proto__ || Object.getPrototypeOf(o);\n    };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n      o.__proto__ = p;\n      return o;\n    };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === 'function') return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf('[native code]') !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== 'function') {\n        throw new TypeError('Super expression must either be null or a function');\n      }\n\n      if (typeof _cache !== 'undefined') {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _instanceof(left, right) {\n    if (right != null && typeof Symbol !== 'undefined' && right[Symbol.hasInstance]) {\n      return !!right[Symbol.hasInstance](left);\n    } else {\n      return left instanceof right;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      default: obj\n    };\n  }\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n\n            if (desc.get || desc.set) {\n              Object.defineProperty(newObj, key, desc);\n            } else {\n              newObj[key] = obj[key];\n            }\n          }\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _newArrowCheck(innerThis, boundThis) {\n    if (innerThis !== boundThis) {\n      throw new TypeError('Cannot instantiate an arrow function');\n    }\n  }\n\n  function _objectDestructuringEmpty(obj) {\n    if (obj == null) throw new TypeError('Cannot destructure undefined');\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === 'object' || typeof call === 'function')) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _superPropBase(object, property) {\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\n      object = _getPrototypeOf(object);\n      if (object === null) break;\n    }\n\n    return object;\n  }\n\n  function _get(target, property, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.get) {\n      _get = Reflect.get;\n    } else {\n      _get = function _get(target, property, receiver) {\n        var base = _superPropBase(target, property);\n\n        if (!base) return;\n        var desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.get) {\n          return desc.get.call(receiver);\n        }\n\n        return desc.value;\n      };\n    }\n\n    return _get(target, property, receiver || target);\n  }\n\n  function set(target, property, value, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.set) {\n      set = Reflect.set;\n    } else {\n      set = function set(target, property, value, receiver) {\n        var base = _superPropBase(target, property);\n\n        var desc;\n\n        if (base) {\n          desc = Object.getOwnPropertyDescriptor(base, property);\n\n          if (desc.set) {\n            desc.set.call(receiver, value);\n            return true;\n          } else if (!desc.writable) {\n            return false;\n          }\n        }\n\n        desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n        if (desc) {\n          if (!desc.writable) {\n            return false;\n          }\n\n          desc.value = value;\n          Object.defineProperty(receiver, property, desc);\n        } else {\n          _defineProperty(receiver, property, value);\n        }\n\n        return true;\n      };\n    }\n\n    return set(target, property, value, receiver);\n  }\n\n  function _set(target, property, value, receiver, isStrict) {\n    var s = set(target, property, value, receiver || target);\n\n    if (!s && isStrict) {\n      throw new Error('failed to set property');\n    }\n\n    return value;\n  }\n\n  function _taggedTemplateLiteral(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    return Object.freeze(Object.defineProperties(strings, {\n      raw: {\n        value: Object.freeze(raw)\n      }\n    }));\n  }\n\n  function _taggedTemplateLiteralLoose(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    strings.raw = raw;\n    return strings;\n  }\n\n  function _temporalRef(val, name) {\n    if (val === _temporalUndefined) {\n      throw new ReferenceError(name + ' is not defined - temporal dead zone');\n    } else {\n      return val;\n    }\n  }\n\n  function _readOnlyError(name) {\n    throw new Error('\"' + name + '\" is read-only');\n  }\n\n  function _classNameTDZError(name) {\n    throw new Error('Class \"' + name + '\" cannot be referenced in computed property keys.');\n  }\n\n  var _temporalUndefined = {};\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n  }\n\n  function _slicedToArrayLoose(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _nonIterableRest();\n  }\n\n  function _toArray(arr) {\n    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n  }\n\n  function _toConsumableArray(arr) {\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n      return arr2;\n    }\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArray(iter) {\n    if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === '[object Arguments]') return Array.from(iter);\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i['return'] != null) _i['return']();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _iterableToArrayLimitLoose(arr, i) {\n    var _arr = [];\n\n    for (var _iterator = arr[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {\n      _arr.push(_step.value);\n\n      if (i && _arr.length === i) break;\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError('Invalid attempt to spread non-iterable instance');\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError('Invalid attempt to destructure non-iterable instance');\n  }\n\n  function _skipFirstGeneratorNext(fn) {\n    return function () {\n      var it = fn.apply(this, arguments);\n      it.next();\n      return it;\n    };\n  }\n\n  function _toPrimitive(input, hint) {\n    if (typeof input !== 'object' || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || 'default');\n      if (typeof res !== 'object') return res;\n      throw new TypeError('@@toPrimitive must return a primitive value.');\n    }\n\n    return (hint === 'string' ? String : Number)(input);\n  }\n\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, 'string');\n\n    return typeof key === 'symbol' ? key : String(key);\n  }\n\n  function _initializerWarningHelper(descriptor, context) {\n    throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and set to use loose mode. ' + 'To use proposal-class-properties in spec mode with decorators, wait for ' + 'the next major version of decorators in stage 2.');\n  }\n\n  function _initializerDefineProperty(target, property, descriptor, context) {\n    if (!descriptor) return;\n    Object.defineProperty(target, property, {\n      enumerable: descriptor.enumerable,\n      configurable: descriptor.configurable,\n      writable: descriptor.writable,\n      value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n    });\n  }\n\n  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n    var desc = {};\n    Object.keys(descriptor).forEach(function (key) {\n      desc[key] = descriptor[key];\n    });\n    desc.enumerable = !!desc.enumerable;\n    desc.configurable = !!desc.configurable;\n\n    if ('value' in desc || desc.initializer) {\n      desc.writable = true;\n    }\n\n    desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n      return decorator(target, property, desc) || desc;\n    }, desc);\n\n    if (context && desc.initializer !== void 0) {\n      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n      desc.initializer = undefined;\n    }\n\n    if (desc.initializer === void 0) {\n      Object.defineProperty(target, property, desc);\n      desc = null;\n    }\n\n    return desc;\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return '__private_' + id++ + '_' + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError('attempted to use private field on non-instance');\n    }\n\n    return receiver;\n  }\n\n  function _classPrivateFieldGet(receiver, privateMap) {\n    var descriptor = privateMap.get(receiver);\n\n    if (!descriptor) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    if (descriptor.get) {\n      return descriptor.get.call(receiver);\n    }\n\n    return descriptor.value;\n  }\n\n  function _classPrivateFieldSet(receiver, privateMap, value) {\n    var descriptor = privateMap.get(receiver);\n\n    if (!descriptor) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    if (descriptor.set) {\n      descriptor.set.call(receiver, value);\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      descriptor.value = value;\n    }\n\n    return value;\n  }\n\n  function _classPrivateFieldDestructureSet(receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.set) {\n      if (!('__destrObj' in descriptor)) {\n        descriptor.__destrObj = {\n          set value(v) {\n            descriptor.set.call(receiver, v);\n          }\n\n        };\n      }\n\n      return descriptor.__destrObj;\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      return descriptor;\n    }\n  }\n\n  function _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return descriptor.value;\n  }\n\n  function _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    if (!descriptor.writable) {\n      throw new TypeError('attempted to set read only private field');\n    }\n\n    descriptor.value = value;\n    return value;\n  }\n\n  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return method;\n  }\n\n  function _classStaticPrivateMethodSet() {\n    throw new TypeError('attempted to set read only static private field');\n  }\n\n  function _decorate(decorators, factory, superClass, mixins) {\n    var api = _getDecoratorsApi();\n\n    if (mixins) {\n      for (var i = 0; i < mixins.length; i++) {\n        api = mixins[i](api);\n      }\n    }\n\n    var r = factory(function initialize(O) {\n      api.initializeInstanceElements(O, decorated.elements);\n    }, superClass);\n    var decorated = api.decorateClass(_coalesceClassElements(r.d.map(_createElementDescriptor)), decorators);\n    api.initializeClassElements(r.F, decorated.elements);\n    return api.runClassFinishers(r.F, decorated.finishers);\n  }\n\n  function _getDecoratorsApi() {\n    _getDecoratorsApi = function () {\n      return api;\n    };\n\n    var api = {\n      elementsDefinitionOrder: [['method'], ['field']],\n      initializeInstanceElements: function (O, elements) {\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            if (element.kind === kind && element.placement === 'own') {\n              this.defineClassElement(O, element);\n            }\n          }, this);\n        }, this);\n      },\n      initializeClassElements: function (F, elements) {\n        var proto = F.prototype;\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            var placement = element.placement;\n\n            if (element.kind === kind && (placement === 'static' || placement === 'prototype')) {\n              var receiver = placement === 'static' ? F : proto;\n              this.defineClassElement(receiver, element);\n            }\n          }, this);\n        }, this);\n      },\n      defineClassElement: function (receiver, element) {\n        var descriptor = element.descriptor;\n\n        if (element.kind === 'field') {\n          var initializer = element.initializer;\n          descriptor = {\n            enumerable: descriptor.enumerable,\n            writable: descriptor.writable,\n            configurable: descriptor.configurable,\n            value: initializer === void 0 ? void 0 : initializer.call(receiver)\n          };\n        }\n\n        Object.defineProperty(receiver, element.key, descriptor);\n      },\n      decorateClass: function (elements, decorators) {\n        var newElements = [];\n        var finishers = [];\n        var placements = {\n          static: [],\n          prototype: [],\n          own: []\n        };\n        elements.forEach(function (element) {\n          this.addElementPlacement(element, placements);\n        }, this);\n        elements.forEach(function (element) {\n          if (!_hasDecorators(element)) return newElements.push(element);\n          var elementFinishersExtras = this.decorateElement(element, placements);\n          newElements.push(elementFinishersExtras.element);\n          newElements.push.apply(newElements, elementFinishersExtras.extras);\n          finishers.push.apply(finishers, elementFinishersExtras.finishers);\n        }, this);\n\n        if (!decorators) {\n          return {\n            elements: newElements,\n            finishers: finishers\n          };\n        }\n\n        var result = this.decorateConstructor(newElements, decorators);\n        finishers.push.apply(finishers, result.finishers);\n        result.finishers = finishers;\n        return result;\n      },\n      addElementPlacement: function (element, placements, silent) {\n        var keys = placements[element.placement];\n\n        if (!silent && keys.indexOf(element.key) !== -1) {\n          throw new TypeError('Duplicated element (' + element.key + ')');\n        }\n\n        keys.push(element.key);\n      },\n      decorateElement: function (element, placements) {\n        var extras = [];\n        var finishers = [];\n\n        for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n          var keys = placements[element.placement];\n          keys.splice(keys.indexOf(element.key), 1);\n          var elementObject = this.fromElementDescriptor(element);\n          var elementFinisherExtras = this.toElementFinisherExtras((0, decorators[i])(elementObject) || elementObject);\n          element = elementFinisherExtras.element;\n          this.addElementPlacement(element, placements);\n\n          if (elementFinisherExtras.finisher) {\n            finishers.push(elementFinisherExtras.finisher);\n          }\n\n          var newExtras = elementFinisherExtras.extras;\n\n          if (newExtras) {\n            for (var j = 0; j < newExtras.length; j++) {\n              this.addElementPlacement(newExtras[j], placements);\n            }\n\n            extras.push.apply(extras, newExtras);\n          }\n        }\n\n        return {\n          element: element,\n          finishers: finishers,\n          extras: extras\n        };\n      },\n      decorateConstructor: function (elements, decorators) {\n        var finishers = [];\n\n        for (var i = decorators.length - 1; i >= 0; i--) {\n          var obj = this.fromClassDescriptor(elements);\n          var elementsAndFinisher = this.toClassDescriptor((0, decorators[i])(obj) || obj);\n\n          if (elementsAndFinisher.finisher !== undefined) {\n            finishers.push(elementsAndFinisher.finisher);\n          }\n\n          if (elementsAndFinisher.elements !== undefined) {\n            elements = elementsAndFinisher.elements;\n\n            for (var j = 0; j < elements.length - 1; j++) {\n              for (var k = j + 1; k < elements.length; k++) {\n                if (elements[j].key === elements[k].key && elements[j].placement === elements[k].placement) {\n                  throw new TypeError('Duplicated element (' + elements[j].key + ')');\n                }\n              }\n            }\n          }\n        }\n\n        return {\n          elements: elements,\n          finishers: finishers\n        };\n      },\n      fromElementDescriptor: function (element) {\n        var obj = {\n          kind: element.kind,\n          key: element.key,\n          placement: element.placement,\n          descriptor: element.descriptor\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        if (element.kind === 'field') obj.initializer = element.initializer;\n        return obj;\n      },\n      toElementDescriptors: function (elementObjects) {\n        if (elementObjects === undefined) return;\n        return _toArray(elementObjects).map(function (elementObject) {\n          var element = this.toElementDescriptor(elementObject);\n          this.disallowProperty(elementObject, 'finisher', 'An element descriptor');\n          this.disallowProperty(elementObject, 'extras', 'An element descriptor');\n          return element;\n        }, this);\n      },\n      toElementDescriptor: function (elementObject) {\n        var kind = String(elementObject.kind);\n\n        if (kind !== 'method' && kind !== 'field') {\n          throw new TypeError('An element descriptor\\'s .kind property must be either \"method\" or' + ' \"field\", but a decorator created an element descriptor with' + ' .kind \"' + kind + '\"');\n        }\n\n        var key = _toPropertyKey(elementObject.key);\n\n        var placement = String(elementObject.placement);\n\n        if (placement !== 'static' && placement !== 'prototype' && placement !== 'own') {\n          throw new TypeError('An element descriptor\\'s .placement property must be one of \"static\",' + ' \"prototype\" or \"own\", but a decorator created an element descriptor' + ' with .placement \"' + placement + '\"');\n        }\n\n        var descriptor = elementObject.descriptor;\n        this.disallowProperty(elementObject, 'elements', 'An element descriptor');\n        var element = {\n          kind: kind,\n          key: key,\n          placement: placement,\n          descriptor: Object.assign({}, descriptor)\n        };\n\n        if (kind !== 'field') {\n          this.disallowProperty(elementObject, 'initializer', 'A method descriptor');\n        } else {\n          this.disallowProperty(descriptor, 'get', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'set', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'value', 'The property descriptor of a field descriptor');\n          element.initializer = elementObject.initializer;\n        }\n\n        return element;\n      },\n      toElementFinisherExtras: function (elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n\n        var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n        var extras = this.toElementDescriptors(elementObject.extras);\n        return {\n          element: element,\n          finisher: finisher,\n          extras: extras\n        };\n      },\n      fromClassDescriptor: function (elements) {\n        var obj = {\n          kind: 'class',\n          elements: elements.map(this.fromElementDescriptor, this)\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        return obj;\n      },\n      toClassDescriptor: function (obj) {\n        var kind = String(obj.kind);\n\n        if (kind !== 'class') {\n          throw new TypeError('A class descriptor\\'s .kind property must be \"class\", but a decorator' + ' created a class descriptor with .kind \"' + kind + '\"');\n        }\n\n        this.disallowProperty(obj, 'key', 'A class descriptor');\n        this.disallowProperty(obj, 'placement', 'A class descriptor');\n        this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n        this.disallowProperty(obj, 'initializer', 'A class descriptor');\n        this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n        var finisher = _optionalCallableProperty(obj, 'finisher');\n\n        var elements = this.toElementDescriptors(obj.elements);\n        return {\n          elements: elements,\n          finisher: finisher\n        };\n      },\n      runClassFinishers: function (constructor, finishers) {\n        for (var i = 0; i < finishers.length; i++) {\n          var newConstructor = (0, finishers[i])(constructor);\n\n          if (newConstructor !== undefined) {\n            if (typeof newConstructor !== 'function') {\n              throw new TypeError('Finishers must return a constructor.');\n            }\n\n            constructor = newConstructor;\n          }\n        }\n\n        return constructor;\n      },\n      disallowProperty: function (obj, name, objectType) {\n        if (obj[name] !== undefined) {\n          throw new TypeError(objectType + \" can't have a .\" + name + ' property.');\n        }\n      }\n    };\n    return api;\n  }\n\n  function _createElementDescriptor(def) {\n    var key = _toPropertyKey(def.key);\n\n    var descriptor;\n\n    if (def.kind === 'method') {\n      descriptor = {\n        value: def.value,\n        writable: true,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'get') {\n      descriptor = {\n        get: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'set') {\n      descriptor = {\n        set: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'field') {\n      descriptor = {\n        configurable: true,\n        writable: true,\n        enumerable: true\n      };\n    }\n\n    var element = {\n      kind: def.kind === 'field' ? 'field' : 'method',\n      key: key,\n      placement: def.static ? 'static' : def.kind === 'field' ? 'own' : 'prototype',\n      descriptor: descriptor\n    };\n    if (def.decorators) element.decorators = def.decorators;\n    if (def.kind === 'field') element.initializer = def.value;\n    return element;\n  }\n\n  function _coalesceGetterSetter(element, other) {\n    if (element.descriptor.get !== undefined) {\n      other.descriptor.get = element.descriptor.get;\n    } else {\n      other.descriptor.set = element.descriptor.set;\n    }\n  }\n\n  function _coalesceClassElements(elements) {\n    var newElements = [];\n\n    var isSameElement = function (other) {\n      return other.kind === 'method' && other.key === element.key && other.placement === element.placement;\n    };\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n      var other;\n\n      if (element.kind === 'method' && (other = newElements.find(isSameElement))) {\n        if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n          if (_hasDecorators(element) || _hasDecorators(other)) {\n            throw new ReferenceError('Duplicated methods (' + element.key + \") can't be decorated.\");\n          }\n\n          other.descriptor = element.descriptor;\n        } else {\n          if (_hasDecorators(element)) {\n            if (_hasDecorators(other)) {\n              throw new ReferenceError(\"Decorators can't be placed on different accessors with for \" + 'the same property (' + element.key + ').');\n            }\n\n            other.decorators = element.decorators;\n          }\n\n          _coalesceGetterSetter(element, other);\n        }\n      } else {\n        newElements.push(element);\n      }\n    }\n\n    return newElements;\n  }\n\n  function _hasDecorators(element) {\n    return element.decorators && element.decorators.length;\n  }\n\n  function _isDataDescriptor(desc) {\n    return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n  }\n\n  function _optionalCallableProperty(obj, name) {\n    var value = obj[name];\n\n    if (value !== undefined && typeof value !== 'function') {\n      throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n    }\n\n    return value;\n  }\n\n  function _classPrivateMethodGet(receiver, privateSet, fn) {\n    if (!privateSet.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    return fn;\n  }\n\n  function _classPrivateMethodSet() {\n    throw new TypeError('attempted to reassign private method');\n  }\n\n  function _wrapRegExp(re, groups) {\n    _wrapRegExp = function (re, groups) {\n      return new BabelRegExp(re, groups);\n    };\n\n    var _RegExp = _wrapNativeSuper(RegExp);\n\n    var _super = RegExp.prototype;\n\n    var _groups = new WeakMap();\n\n    function BabelRegExp(re, groups) {\n      var _this = _RegExp.call(this, re);\n\n      _groups.set(_this, groups);\n\n      return _this;\n    }\n\n    _inherits(BabelRegExp, _RegExp);\n\n    BabelRegExp.prototype.exec = function (str) {\n      var result = _super.exec.call(this, str);\n\n      if (result) result.groups = buildGroups(result, this);\n      return result;\n    };\n\n    BabelRegExp.prototype[Symbol.replace] = function (str, substitution) {\n      if (typeof substitution === 'string') {\n        var groups = _groups.get(this);\n\n        return _super[Symbol.replace].call(this, str, substitution.replace(/\\$<([^>]+)>/g, function (_, name) {\n          return '$' + groups[name];\n        }));\n      } else if (typeof substitution === 'function') {\n        var _this = this;\n\n        return _super[Symbol.replace].call(this, str, function () {\n          var args = [];\n          args.push.apply(args, arguments);\n\n          if (typeof args[args.length - 1] !== 'object') {\n            args.push(buildGroups(args, _this));\n          }\n\n          return substitution.apply(this, args);\n        });\n      } else {\n        return _super[Symbol.replace].call(this, str, substitution);\n      }\n    };\n\n    function buildGroups(result, re) {\n      var g = _groups.get(re);\n\n      return Object.keys(g).reduce(function (groups, name) {\n        groups[name] = result[g[name]];\n        return groups;\n      }, Object.create(null));\n    }\n\n    return _wrapRegExp.apply(this, arguments);\n  }\n\n  var arrayRemove = function arrayRemove(arr, index) {\n    return arr.splice(index, 1);\n  };\n\n  var run = function run(cb, sync) {\n    if (sync) {\n      cb();\n    } else if (document.hidden) {\n      Promise.resolve(1).then(cb);\n    } else {\n      setTimeout(cb, 0);\n    }\n  };\n\n  var on = function on() {\n    var listeners = [];\n\n    var off = function off(event, cb) {\n      arrayRemove(listeners, listeners.findIndex(function (listener) {\n        return listener.event === event && (listener.cb === cb || !cb);\n      }));\n    };\n\n    var _fire = function fire(event, args, sync) {\n      listeners.filter(function (listener) {\n        return listener.event === event;\n      }).map(function (listener) {\n        return listener.cb;\n      }).forEach(function (cb) {\n        return run(function () {\n          return cb.apply(void 0, _toConsumableArray(args));\n        }, sync);\n      });\n    };\n\n    return {\n      fireSync: function fireSync(event) {\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        _fire(event, args, true);\n      },\n      fire: function fire(event) {\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n\n        _fire(event, args, false);\n      },\n      on: function on(event, cb) {\n        listeners.push({\n          event: event,\n          cb: cb\n        });\n      },\n      onOnce: function onOnce(event, _cb) {\n        listeners.push({\n          event: event,\n          cb: function cb() {\n            off(event, _cb);\n\n            _cb.apply(void 0, arguments);\n          }\n        });\n      },\n      off: off\n    };\n  };\n\n  var copyObjectPropertiesToObject = function copyObjectPropertiesToObject(src, target, excluded) {\n    Object.getOwnPropertyNames(src).filter(function (property) {\n      return !excluded.includes(property);\n    }).forEach(function (key) {\n      return Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(src, key));\n    });\n  };\n\n  var PRIVATE = ['fire', 'process', 'revert', 'load', 'on', 'off', 'onOnce', 'retryLoad', 'extend', 'archive', 'archived', 'release', 'released', 'requestProcessing', 'freeze'];\n\n  var createItemAPI = function createItemAPI(item) {\n    var api = {};\n    copyObjectPropertiesToObject(item, api, PRIVATE);\n    return api;\n  };\n\n  var removeReleasedItems = function removeReleasedItems(items) {\n    items.forEach(function (item, index) {\n      if (item.released) {\n        arrayRemove(items, index);\n      }\n    });\n  };\n\n  var ItemStatus = {\n    INIT: 1,\n    IDLE: 2,\n    PROCESSING_QUEUED: 9,\n    PROCESSING: 3,\n    PROCESSING_COMPLETE: 5,\n    PROCESSING_ERROR: 6,\n    PROCESSING_REVERT_ERROR: 10,\n    LOADING: 7,\n    LOAD_ERROR: 8\n  };\n  var FileOrigin = {\n    INPUT: 1,\n    LIMBO: 2,\n    LOCAL: 3\n  };\n\n  var getNonNumeric = function getNonNumeric(str) {\n    return /[^0-9]+/.exec(str);\n  };\n\n  var getDecimalSeparator = function getDecimalSeparator() {\n    return getNonNumeric(1.1.toLocaleString())[0];\n  };\n\n  var getThousandsSeparator = function getThousandsSeparator() {\n    // Added for browsers that do not return the thousands separator (happend on native browser Android 4.4.4)\n    // We check against the normal toString output and if they're the same return a comma when decimal separator is a dot\n    var decimalSeparator = getDecimalSeparator();\n    var thousandsStringWithSeparator = 1000.0.toLocaleString();\n    var thousandsStringWithoutSeparator = 1000.0.toString();\n\n    if (thousandsStringWithSeparator !== thousandsStringWithoutSeparator) {\n      return getNonNumeric(thousandsStringWithSeparator)[0];\n    }\n\n    return decimalSeparator === '.' ? ',' : '.';\n  };\n\n  var Type = {\n    BOOLEAN: 'boolean',\n    INT: 'int',\n    NUMBER: 'number',\n    STRING: 'string',\n    ARRAY: 'array',\n    OBJECT: 'object',\n    FUNCTION: 'function',\n    ACTION: 'action',\n    SERVER_API: 'serverapi',\n    REGEX: 'regex'\n  }; // all registered filters\n\n  var filters = []; // loops over matching filters and passes options to each filter, returning the mapped results\n\n  var applyFilterChain = function applyFilterChain(key, value, utils) {\n    return new Promise(function (resolve, reject) {\n      // find matching filters for this key\n      var matchingFilters = filters.filter(function (f) {\n        return f.key === key;\n      }).map(function (f) {\n        return f.cb;\n      }); // resolve now\n\n      if (matchingFilters.length === 0) {\n        resolve(value);\n        return;\n      } // first filter to kick things of\n\n\n      var initialFilter = matchingFilters.shift(); // chain filters\n\n      matchingFilters.reduce( // loop over promises passing value to next promise\n      function (current, next) {\n        return current.then(function (value) {\n          return next(value, utils);\n        });\n      }, // call initial filter, will return a promise\n      initialFilter(value, utils) // all executed\n      ).then(function (value) {\n        return resolve(value);\n      }).catch(function (error) {\n        return reject(error);\n      });\n    });\n  };\n\n  var applyFilters = function applyFilters(key, value, utils) {\n    return filters.filter(function (f) {\n      return f.key === key;\n    }).map(function (f) {\n      return f.cb(value, utils);\n    });\n  }; // adds a new filter to the list\n\n\n  var addFilter = function addFilter(key, cb) {\n    return filters.push({\n      key: key,\n      cb: cb\n    });\n  };\n\n  var extendDefaultOptions = function extendDefaultOptions(additionalOptions) {\n    return Object.assign(defaultOptions, additionalOptions);\n  };\n\n  var getOptions = function getOptions() {\n    return Object.assign({}, defaultOptions);\n  };\n\n  var setOptions = function setOptions(opts) {\n    forin(opts, function (key, value) {\n      // key does not exist, so this option cannot be set\n      if (!defaultOptions[key]) {\n        return;\n      }\n\n      defaultOptions[key][0] = getValueByType(value, defaultOptions[key][0], defaultOptions[key][1]);\n    });\n  }; // default options on app\n\n\n  var defaultOptions = {\n    // the id to add to the root element\n    id: [null, Type.STRING],\n    // input field name to use\n    name: ['filepond', Type.STRING],\n    // disable the field\n    disabled: [false, Type.BOOLEAN],\n    // classname to put on wrapper\n    className: [null, Type.STRING],\n    // is the field required\n    required: [false, Type.BOOLEAN],\n    // Allow media capture when value is set\n    captureMethod: [null, Type.STRING],\n    // - \"camera\", \"microphone\" or \"camcorder\",\n    // - Does not work with multiple on apple devices\n    // - If set, acceptedFileTypes must be made to match with media wildcard \"image/*\", \"audio/*\" or \"video/*\"\n    // sync `acceptedFileTypes` property with `accept` attribute\n    allowSyncAcceptAttribute: [true, Type.BOOLEAN],\n    // Feature toggles\n    allowDrop: [true, Type.BOOLEAN],\n    // Allow dropping of files\n    allowBrowse: [true, Type.BOOLEAN],\n    // Allow browsing the file system\n    allowPaste: [true, Type.BOOLEAN],\n    // Allow pasting files\n    allowMultiple: [false, Type.BOOLEAN],\n    // Allow multiple files (disabled by default, as multiple attribute is also required on input to allow multiple)\n    allowReplace: [true, Type.BOOLEAN],\n    // Allow dropping a file on other file to replace it (only works when multiple is set to false)\n    allowRevert: [true, Type.BOOLEAN],\n    // Allows user to revert file upload\n    allowProcess: [true, Type.BOOLEAN],\n    // Allows user to process a file, when set to false, this removes the file upload button\n    allowReorder: [false, Type.BOOLEAN],\n    // Allow reordering of files\n    allowDirectoriesOnly: [false, Type.BOOLEAN],\n    // Allow only selecting directories with browse (no support for filtering dnd at this point)\n    // Revert mode\n    forceRevert: [false, Type.BOOLEAN],\n    // Set to 'force' to require the file to be reverted before removal\n    // Input requirements\n    maxFiles: [null, Type.INT],\n    // Max number of files\n    checkValidity: [false, Type.BOOLEAN],\n    // Enables custom validity messages\n    // Where to put file\n    itemInsertLocationFreedom: [true, Type.BOOLEAN],\n    // Set to false to always add items to begin or end of list\n    itemInsertLocation: ['before', Type.STRING],\n    // Default index in list to add items that have been dropped at the top of the list\n    itemInsertInterval: [75, Type.INT],\n    // Drag 'n Drop related\n    dropOnPage: [false, Type.BOOLEAN],\n    // Allow dropping of files anywhere on page (prevents browser from opening file if dropped outside of Up)\n    dropOnElement: [true, Type.BOOLEAN],\n    // Drop needs to happen on element (set to false to also load drops outside of Up)\n    dropValidation: [false, Type.BOOLEAN],\n    // Enable or disable validating files on drop\n    ignoredFiles: [['.ds_store', 'thumbs.db', 'desktop.ini'], Type.ARRAY],\n    // Upload related\n    instantUpload: [true, Type.BOOLEAN],\n    // Should upload files immidiately on drop\n    maxParallelUploads: [2, Type.INT],\n    // Maximum files to upload in parallel\n    // Chunks\n    chunkUploads: [false, Type.BOOLEAN],\n    // Enable chunked uploads\n    chunkForce: [false, Type.BOOLEAN],\n    // Force use of chunk uploads even for files smaller than chunk size\n    chunkSize: [5000000, Type.INT],\n    // Size of chunks (5MB default)\n    chunkRetryDelays: [[500, 1000, 3000], Type.Array],\n    // Amount of times to retry upload of a chunk when it fails\n    // The server api end points to use for uploading (see docs)\n    server: [null, Type.SERVER_API],\n    // Labels and status messages\n    labelDecimalSeparator: [getDecimalSeparator(), Type.STRING],\n    // Default is locale separator\n    labelThousandsSeparator: [getThousandsSeparator(), Type.STRING],\n    // Default is locale separator\n    labelIdle: ['Drag & Drop your files or <span class=\"filepond--label-action\">Browse</span>', Type.STRING],\n    labelInvalidField: ['Field contains invalid files', Type.STRING],\n    labelFileWaitingForSize: ['Waiting for size', Type.STRING],\n    labelFileSizeNotAvailable: ['Size not available', Type.STRING],\n    labelFileCountSingular: ['file in list', Type.STRING],\n    labelFileCountPlural: ['files in list', Type.STRING],\n    labelFileLoading: ['Loading', Type.STRING],\n    labelFileAdded: ['Added', Type.STRING],\n    // assistive only\n    labelFileLoadError: ['Error during load', Type.STRING],\n    labelFileRemoved: ['Removed', Type.STRING],\n    // assistive only\n    labelFileRemoveError: ['Error during remove', Type.STRING],\n    labelFileProcessing: ['Uploading', Type.STRING],\n    labelFileProcessingComplete: ['Upload complete', Type.STRING],\n    labelFileProcessingAborted: ['Upload cancelled', Type.STRING],\n    labelFileProcessingError: ['Error during upload', Type.STRING],\n    labelFileProcessingRevertError: ['Error during revert', Type.STRING],\n    labelTapToCancel: ['tap to cancel', Type.STRING],\n    labelTapToRetry: ['tap to retry', Type.STRING],\n    labelTapToUndo: ['tap to undo', Type.STRING],\n    labelButtonRemoveItem: ['Remove', Type.STRING],\n    labelButtonAbortItemLoad: ['Abort', Type.STRING],\n    labelButtonRetryItemLoad: ['Retry', Type.STRING],\n    labelButtonAbortItemProcessing: ['Cancel', Type.STRING],\n    labelButtonUndoItemProcessing: ['Undo', Type.STRING],\n    labelButtonRetryItemProcessing: ['Retry', Type.STRING],\n    labelButtonProcessItem: ['Upload', Type.STRING],\n    // make sure width and height plus viewpox are even numbers so icons are nicely centered\n    iconRemove: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M11.586 13l-2.293 2.293a1 1 0 0 0 1.414 1.414L13 14.414l2.293 2.293a1 1 0 0 0 1.414-1.414L14.414 13l2.293-2.293a1 1 0 0 0-1.414-1.414L13 11.586l-2.293-2.293a1 1 0 0 0-1.414 1.414L11.586 13z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>', Type.STRING],\n    iconProcess: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 10.414v3.585a1 1 0 0 1-2 0v-3.585l-1.293 1.293a1 1 0 0 1-1.414-1.415l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.415L14 10.414zM9 18a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2H9z\" fill=\"currentColor\" fill-rule=\"evenodd\"/></svg>', Type.STRING],\n    iconRetry: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10.81 9.185l-.038.02A4.997 4.997 0 0 0 8 13.683a5 5 0 0 0 5 5 5 5 0 0 0 5-5 1 1 0 0 1 2 0A7 7 0 1 1 9.722 7.496l-.842-.21a.999.999 0 1 1 .484-1.94l3.23.806c.535.133.86.675.73 1.21l-.804 3.233a.997.997 0 0 1-1.21.73.997.997 0 0 1-.73-1.21l.23-.928v-.002z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>', Type.STRING],\n    iconUndo: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M9.185 10.81l.02-.038A4.997 4.997 0 0 1 13.683 8a5 5 0 0 1 5 5 5 5 0 0 1-5 5 1 1 0 0 0 0 2A7 7 0 1 0 7.496 9.722l-.21-.842a.999.999 0 1 0-1.94.484l.806 3.23c.133.535.675.86 1.21.73l3.233-.803a.997.997 0 0 0 .73-1.21.997.997 0 0 0-1.21-.73l-.928.23-.002-.001z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>', Type.STRING],\n    iconDone: ['<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M18.293 9.293a1 1 0 0 1 1.414 1.414l-7.002 7a1 1 0 0 1-1.414 0l-3.998-4a1 1 0 1 1 1.414-1.414L12 15.586l6.294-6.293z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>', Type.STRING],\n    // event handlers\n    oninit: [null, Type.FUNCTION],\n    onwarning: [null, Type.FUNCTION],\n    onerror: [null, Type.FUNCTION],\n    onactivatefile: [null, Type.FUNCTION],\n    oninitfile: [null, Type.FUNCTION],\n    onaddfilestart: [null, Type.FUNCTION],\n    onaddfileprogress: [null, Type.FUNCTION],\n    onaddfile: [null, Type.FUNCTION],\n    onprocessfilestart: [null, Type.FUNCTION],\n    onprocessfileprogress: [null, Type.FUNCTION],\n    onprocessfileabort: [null, Type.FUNCTION],\n    onprocessfilerevert: [null, Type.FUNCTION],\n    onprocessfile: [null, Type.FUNCTION],\n    onprocessfiles: [null, Type.FUNCTION],\n    onremovefile: [null, Type.FUNCTION],\n    onpreparefile: [null, Type.FUNCTION],\n    onupdatefiles: [null, Type.FUNCTION],\n    onreorderfiles: [null, Type.FUNCTION],\n    // hooks\n    beforeDropFile: [null, Type.FUNCTION],\n    beforeAddFile: [null, Type.FUNCTION],\n    beforeRemoveFile: [null, Type.FUNCTION],\n    // styles\n    stylePanelLayout: [null, Type.STRING],\n    // null 'integrated', 'compact', 'circle'\n    stylePanelAspectRatio: [null, Type.STRING],\n    // null or '3:2' or 1\n    styleItemPanelAspectRatio: [null, Type.STRING],\n    styleButtonRemoveItemPosition: ['left', Type.STRING],\n    styleButtonProcessItemPosition: ['right', Type.STRING],\n    styleLoadIndicatorPosition: ['right', Type.STRING],\n    styleProgressIndicatorPosition: ['right', Type.STRING],\n    styleButtonRemoveItemAlign: [false, Type.BOOLEAN],\n    // custom initial files array\n    files: [[], Type.ARRAY]\n  };\n\n  var getItemByQuery = function getItemByQuery(items, query) {\n    // just return first index\n    if (isEmpty(query)) {\n      return items[0] || null;\n    } // query is index\n\n\n    if (isInt(query)) {\n      return items[query] || null;\n    } // if query is item, get the id\n\n\n    if (typeof query === 'object') {\n      query = query.id;\n    } // assume query is a string and return item by id\n\n\n    return items.find(function (item) {\n      return item.id === query;\n    }) || null;\n  };\n\n  var getNumericAspectRatioFromString = function getNumericAspectRatioFromString(aspectRatio) {\n    if (isEmpty(aspectRatio)) {\n      return aspectRatio;\n    }\n\n    if (/:/.test(aspectRatio)) {\n      var parts = aspectRatio.split(':');\n      return parts[1] / parts[0];\n    }\n\n    return parseFloat(aspectRatio);\n  };\n\n  var getActiveItems = function getActiveItems(items) {\n    return items.filter(function (item) {\n      return !item.archived;\n    });\n  };\n\n  var Status = {\n    EMPTY: 0,\n    IDLE: 1,\n    // waiting\n    ERROR: 2,\n    // a file is in error state\n    BUSY: 3,\n    // busy processing or loading\n    READY: 4 // all files uploaded\n\n  };\n  var ITEM_ERROR = [ItemStatus.LOAD_ERROR, ItemStatus.PROCESSING_ERROR, ItemStatus.PROCESSING_REVERT_ERROR];\n  var ITEM_BUSY = [ItemStatus.LOADING, ItemStatus.PROCESSING, ItemStatus.PROCESSING_QUEUED, ItemStatus.INIT];\n  var ITEM_READY = [ItemStatus.PROCESSING_COMPLETE];\n\n  var isItemInErrorState = function isItemInErrorState(item) {\n    return ITEM_ERROR.includes(item.status);\n  };\n\n  var isItemInBusyState = function isItemInBusyState(item) {\n    return ITEM_BUSY.includes(item.status);\n  };\n\n  var isItemInReadyState = function isItemInReadyState(item) {\n    return ITEM_READY.includes(item.status);\n  };\n\n  var queries = function queries(state) {\n    return {\n      GET_STATUS: function GET_STATUS() {\n        var items = getActiveItems(state.items);\n        var EMPTY = Status.EMPTY,\n            ERROR = Status.ERROR,\n            BUSY = Status.BUSY,\n            IDLE = Status.IDLE,\n            READY = Status.READY;\n        if (items.length === 0) return EMPTY;\n        if (items.some(isItemInErrorState)) return ERROR;\n        if (items.some(isItemInBusyState)) return BUSY;\n        if (items.some(isItemInReadyState)) return READY;\n        return IDLE;\n      },\n      GET_ITEM: function GET_ITEM(query) {\n        return getItemByQuery(state.items, query);\n      },\n      GET_ACTIVE_ITEM: function GET_ACTIVE_ITEM(query) {\n        return getItemByQuery(getActiveItems(state.items), query);\n      },\n      GET_ACTIVE_ITEMS: function GET_ACTIVE_ITEMS() {\n        return getActiveItems(state.items);\n      },\n      GET_ITEMS: function GET_ITEMS() {\n        return state.items;\n      },\n      GET_ITEM_NAME: function GET_ITEM_NAME(query) {\n        var item = getItemByQuery(state.items, query);\n        return item ? item.filename : null;\n      },\n      GET_ITEM_SIZE: function GET_ITEM_SIZE(query) {\n        var item = getItemByQuery(state.items, query);\n        return item ? item.fileSize : null;\n      },\n      GET_STYLES: function GET_STYLES() {\n        return Object.keys(state.options).filter(function (key) {\n          return /^style/.test(key);\n        }).map(function (option) {\n          return {\n            name: option,\n            value: state.options[option]\n          };\n        });\n      },\n      GET_PANEL_ASPECT_RATIO: function GET_PANEL_ASPECT_RATIO() {\n        var isShapeCircle = /circle/.test(state.options.stylePanelLayout);\n        var aspectRatio = isShapeCircle ? 1 : getNumericAspectRatioFromString(state.options.stylePanelAspectRatio);\n        return aspectRatio;\n      },\n      GET_ITEM_PANEL_ASPECT_RATIO: function GET_ITEM_PANEL_ASPECT_RATIO() {\n        return state.options.styleItemPanelAspectRatio;\n      },\n      GET_ITEMS_BY_STATUS: function GET_ITEMS_BY_STATUS(status) {\n        return getActiveItems(state.items).filter(function (item) {\n          return item.status === status;\n        });\n      },\n      GET_TOTAL_ITEMS: function GET_TOTAL_ITEMS() {\n        return getActiveItems(state.items).length;\n      },\n      IS_ASYNC: function IS_ASYNC() {\n        return isObject(state.options.server) && (isObject(state.options.server.process) || isFunction(state.options.server.process));\n      }\n    };\n  };\n\n  var hasRoomForItem = function hasRoomForItem(state) {\n    var count = getActiveItems(state.items).length; // if cannot have multiple items, to add one item it should currently not contain items\n\n    if (!state.options.allowMultiple) {\n      return count === 0;\n    } // if allows multiple items, we check if a max item count has been set, if not, there's no limit\n\n\n    var maxFileCount = state.options.maxFiles;\n\n    if (maxFileCount === null) {\n      return true;\n    } // we check if the current count is smaller than the max count, if so, another file can still be added\n\n\n    if (count < maxFileCount) {\n      return true;\n    } // no more room for another file\n\n\n    return false;\n  };\n\n  var limit = function limit(value, min, max) {\n    return Math.max(Math.min(max, value), min);\n  };\n\n  var arrayInsert = function arrayInsert(arr, index, item) {\n    return arr.splice(index, 0, item);\n  };\n\n  var insertItem = function insertItem(items, item, index) {\n    if (isEmpty(item)) {\n      return null;\n    } // if index is undefined, append\n\n\n    if (typeof index === 'undefined') {\n      items.push(item);\n      return item;\n    } // limit the index to the size of the items array\n\n\n    index = limit(index, 0, items.length); // add item to array\n\n    arrayInsert(items, index, item); // expose\n\n    return item;\n  };\n\n  var isBase64DataURI = function isBase64DataURI(str) {\n    return /^\\s*data:([a-z]+\\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\\-._~:@\\/?%\\s]*)\\s*$/i.test(str);\n  };\n\n  var getFilenameFromURL = function getFilenameFromURL(url) {\n    return url.split('/').pop().split('?').shift();\n  };\n\n  var getExtensionFromFilename = function getExtensionFromFilename(name) {\n    return name.split('.').pop();\n  };\n\n  var guesstimateExtension = function guesstimateExtension(type) {\n    // if no extension supplied, exit here\n    if (typeof type !== 'string') {\n      return '';\n    } // get subtype\n\n\n    var subtype = type.split('/').pop(); // is svg subtype\n\n    if (/svg/.test(subtype)) {\n      return 'svg';\n    }\n\n    if (/zip|compressed/.test(subtype)) {\n      return 'zip';\n    }\n\n    if (/plain/.test(subtype)) {\n      return 'txt';\n    }\n\n    if (/msword/.test(subtype)) {\n      return 'doc';\n    } // if is valid subtype\n\n\n    if (/[a-z]+/.test(subtype)) {\n      // always use jpg extension\n      if (subtype === 'jpeg') {\n        return 'jpg';\n      } // return subtype\n\n\n      return subtype;\n    }\n\n    return '';\n  };\n\n  var leftPad = function leftPad(value) {\n    var padding = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    return (padding + value).slice(-padding.length);\n  };\n\n  var getDateString = function getDateString() {\n    var date = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Date();\n    return date.getFullYear() + '-' + leftPad(date.getMonth() + 1, '00') + '-' + leftPad(date.getDate(), '00') + '_' + leftPad(date.getHours(), '00') + '-' + leftPad(date.getMinutes(), '00') + '-' + leftPad(date.getSeconds(), '00');\n  };\n\n  var getFileFromBlob = function getFileFromBlob(blob, filename) {\n    var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    var extension = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n    var file = typeof type === 'string' ? blob.slice(0, blob.size, type) : blob.slice(0, blob.size, blob.type);\n    file.lastModifiedDate = new Date(); // copy relative path\n\n    if (blob._relativePath) file._relativePath = blob._relativePath; // if blob has name property, use as filename if no filename supplied\n\n    if (!isString(filename)) {\n      filename = getDateString();\n    } // if filename supplied but no extension and filename has extension\n\n\n    if (filename && extension === null && getExtensionFromFilename(filename)) {\n      file.name = filename;\n    } else {\n      extension = extension || guesstimateExtension(file.type);\n      file.name = filename + (extension ? '.' + extension : '');\n    }\n\n    return file;\n  };\n\n  var getBlobBuilder = function getBlobBuilder() {\n    return window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\n  };\n\n  var createBlob = function createBlob(arrayBuffer, mimeType) {\n    var BB = getBlobBuilder();\n\n    if (BB) {\n      var bb = new BB();\n      bb.append(arrayBuffer);\n      return bb.getBlob(mimeType);\n    }\n\n    return new Blob([arrayBuffer], {\n      type: mimeType\n    });\n  };\n\n  var getBlobFromByteStringWithMimeType = function getBlobFromByteStringWithMimeType(byteString, mimeType) {\n    var ab = new ArrayBuffer(byteString.length);\n    var ia = new Uint8Array(ab);\n\n    for (var i = 0; i < byteString.length; i++) {\n      ia[i] = byteString.charCodeAt(i);\n    }\n\n    return createBlob(ab, mimeType);\n  };\n\n  var getMimeTypeFromBase64DataURI = function getMimeTypeFromBase64DataURI(dataURI) {\n    return (/^data:(.+);/.exec(dataURI) || [])[1] || null;\n  };\n\n  var getBase64DataFromBase64DataURI = function getBase64DataFromBase64DataURI(dataURI) {\n    // get data part of string (remove data:image/jpeg...,)\n    var data = dataURI.split(',')[1]; // remove any whitespace as that causes InvalidCharacterError in IE\n\n    return data.replace(/\\s/g, '');\n  };\n\n  var getByteStringFromBase64DataURI = function getByteStringFromBase64DataURI(dataURI) {\n    return atob(getBase64DataFromBase64DataURI(dataURI));\n  };\n\n  var getBlobFromBase64DataURI = function getBlobFromBase64DataURI(dataURI) {\n    var mimeType = getMimeTypeFromBase64DataURI(dataURI);\n    var byteString = getByteStringFromBase64DataURI(dataURI);\n    return getBlobFromByteStringWithMimeType(byteString, mimeType);\n  };\n\n  var getFileFromBase64DataURI = function getFileFromBase64DataURI(dataURI, filename, extension) {\n    return getFileFromBlob(getBlobFromBase64DataURI(dataURI), filename, null, extension);\n  };\n\n  var getFileNameFromHeader = function getFileNameFromHeader(header) {\n    // test if is content disposition header, if not exit\n    if (!/^content-disposition:/i.test(header)) return null; // get filename parts\n\n    var matches = header.split(/filename=|filename\\*=.+''/).splice(1).map(function (name) {\n      return name.trim().replace(/^[\"']|[;\"']{0,2}$/g, '');\n    }).filter(function (name) {\n      return name.length;\n    });\n    return matches.length ? decodeURI(matches[matches.length - 1]) : null;\n  };\n\n  var getFileSizeFromHeader = function getFileSizeFromHeader(header) {\n    if (/content-length:/i.test(header)) {\n      var size = header.match(/[0-9]+/)[0];\n      return size ? parseInt(size, 10) : null;\n    }\n\n    return null;\n  };\n\n  var getTranfserIdFromHeader = function getTranfserIdFromHeader(header) {\n    if (/x-content-transfer-id:/i.test(header)) {\n      var id = (header.split(':')[1] || '').trim();\n      return id || null;\n    }\n\n    return null;\n  };\n\n  var getFileInfoFromHeaders = function getFileInfoFromHeaders(headers) {\n    var info = {\n      source: null,\n      name: null,\n      size: null\n    };\n    var rows = headers.split('\\n');\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n      for (var _iterator = rows[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n        var header = _step.value;\n        var name = getFileNameFromHeader(header);\n\n        if (name) {\n          info.name = name;\n          continue;\n        }\n\n        var size = getFileSizeFromHeader(header);\n\n        if (size) {\n          info.size = size;\n          continue;\n        }\n\n        var source = getTranfserIdFromHeader(header);\n\n        if (source) {\n          info.source = source;\n          continue;\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator.return != null) {\n          _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n\n    return info;\n  };\n\n  var createFileLoader = function createFileLoader(fetchFn) {\n    var state = {\n      source: null,\n      complete: false,\n      progress: 0,\n      size: null,\n      timestamp: null,\n      duration: 0,\n      request: null\n    };\n\n    var getProgress = function getProgress() {\n      return state.progress;\n    };\n\n    var abort = function abort() {\n      if (state.request && state.request.abort) {\n        state.request.abort();\n      }\n    }; // load source\n\n\n    var load = function load() {\n      // get quick reference\n      var source = state.source;\n      api.fire('init', source); // Load Files\n\n      if (source instanceof File) {\n        api.fire('load', source);\n      } else if (source instanceof Blob) {\n        // Load blobs, set default name to current date\n        api.fire('load', getFileFromBlob(source, source.name));\n      } else if (isBase64DataURI(source)) {\n        // Load base 64, set default name to current date\n        api.fire('load', getFileFromBase64DataURI(source));\n      } else {\n        // Deal as if is external URL, let's load it!\n        loadURL(source);\n      }\n    }; // loads a url\n\n\n    var loadURL = function loadURL(url) {\n      // is remote url and no fetch method supplied\n      if (!fetchFn) {\n        api.fire('error', {\n          type: 'error',\n          body: \"Can't load URL\",\n          code: 400\n        });\n        return;\n      } // set request start\n\n\n      state.timestamp = Date.now(); // load file\n\n      state.request = fetchFn(url, function (response) {\n        // update duration\n        state.duration = Date.now() - state.timestamp; // done!\n\n        state.complete = true; // turn blob response into a file\n\n        if (response instanceof Blob) {\n          response = getFileFromBlob(response, response.name || getFilenameFromURL(url));\n        }\n\n        api.fire('load', // if has received blob, we go with blob, if no response, we return null\n        response instanceof Blob ? response : response ? response.body : null);\n      }, function (error) {\n        api.fire('error', typeof error === 'string' ? {\n          type: 'error',\n          code: 0,\n          body: error\n        } : error);\n      }, function (computable, current, total) {\n        // collected some meta data already\n        if (total) {\n          state.size = total;\n        } // update duration\n\n\n        state.duration = Date.now() - state.timestamp; // if we can't compute progress, we're not going to fire progress events\n\n        if (!computable) {\n          state.progress = null;\n          return;\n        } // update progress percentage\n\n\n        state.progress = current / total; // expose\n\n        api.fire('progress', state.progress);\n      }, function () {\n        api.fire('abort');\n      }, function (response) {\n        var fileinfo = getFileInfoFromHeaders(typeof response === 'string' ? response : response.headers);\n        api.fire('meta', {\n          size: state.size || fileinfo.size,\n          filename: fileinfo.name,\n          source: fileinfo.source\n        });\n      });\n    };\n\n    var api = Object.assign({}, on(), {\n      setSource: function setSource(source) {\n        return state.source = source;\n      },\n      getProgress: getProgress,\n      // file load progress\n      abort: abort,\n      // abort file load\n      load: load // start load\n\n    });\n    return api;\n  };\n\n  var isGet = function isGet(method) {\n    return /GET|HEAD/.test(method);\n  };\n\n  var sendRequest = function sendRequest(data, url, options) {\n    var api = {\n      onheaders: function onheaders() {},\n      onprogress: function onprogress() {},\n      onload: function onload() {},\n      ontimeout: function ontimeout() {},\n      onerror: function onerror() {},\n      onabort: function onabort() {},\n      abort: function abort() {\n        aborted = true;\n        xhr.abort();\n      }\n    }; // timeout identifier, only used when timeout is defined\n\n    var aborted = false;\n    var headersReceived = false; // set default options\n\n    options = Object.assign({\n      method: 'POST',\n      headers: {},\n      withCredentials: false\n    }, options); // encode url\n\n    url = encodeURI(url); // if method is GET, add any received data to url\n\n    if (isGet(options.method) && data) {\n      url = '' + url + encodeURIComponent(typeof data === 'string' ? data : JSON.stringify(data));\n    } // create request\n\n\n    var xhr = new XMLHttpRequest(); // progress of load\n\n    var process = isGet(options.method) ? xhr : xhr.upload;\n\n    process.onprogress = function (e) {\n      // no progress event when aborted ( onprogress is called once after abort() )\n      if (aborted) {\n        return;\n      }\n\n      api.onprogress(e.lengthComputable, e.loaded, e.total);\n    }; // tries to get header info to the app as fast as possible\n\n\n    xhr.onreadystatechange = function () {\n      // not interesting in these states ('unsent' and 'openend' as they don't give us any additional info)\n      if (xhr.readyState < 2) {\n        return;\n      } // no server response\n\n\n      if (xhr.readyState === 4 && xhr.status === 0) {\n        return;\n      }\n\n      if (headersReceived) {\n        return;\n      }\n\n      headersReceived = true; // we've probably received some useful data in response headers\n\n      api.onheaders(xhr);\n    }; // load successful\n\n\n    xhr.onload = function () {\n      // is classified as valid response\n      if (xhr.status >= 200 && xhr.status < 300) {\n        api.onload(xhr);\n      } else {\n        api.onerror(xhr);\n      }\n    }; // error during load\n\n\n    xhr.onerror = function () {\n      return api.onerror(xhr);\n    }; // request aborted\n\n\n    xhr.onabort = function () {\n      aborted = true;\n      api.onabort();\n    }; // request timeout\n\n\n    xhr.ontimeout = function () {\n      return api.ontimeout(xhr);\n    }; // open up open up!\n\n\n    xhr.open(options.method, url, true); // set timeout if defined (do it after open so IE11 plays ball)\n\n    if (isInt(options.timeout)) {\n      xhr.timeout = options.timeout;\n    } // add headers\n\n\n    Object.keys(options.headers).forEach(function (key) {\n      var value = unescape(encodeURIComponent(options.headers[key]));\n      xhr.setRequestHeader(key, value);\n    }); // set type of response\n\n    if (options.responseType) {\n      xhr.responseType = options.responseType;\n    } // set credentials\n\n\n    if (options.withCredentials) {\n      xhr.withCredentials = true;\n    } // let's send our data\n\n\n    xhr.send(data);\n    return api;\n  };\n\n  var createResponse = function createResponse(type, code, body, headers) {\n    return {\n      type: type,\n      code: code,\n      body: body,\n      headers: headers\n    };\n  };\n\n  var createTimeoutResponse = function createTimeoutResponse(cb) {\n    return function (xhr) {\n      cb(createResponse('error', 0, 'Timeout', xhr.getAllResponseHeaders()));\n    };\n  };\n\n  var hasQS = function hasQS(str) {\n    return /\\?/.test(str);\n  };\n\n  var buildURL = function buildURL() {\n    var url = '';\n\n    for (var _len = arguments.length, parts = new Array(_len), _key = 0; _key < _len; _key++) {\n      parts[_key] = arguments[_key];\n    }\n\n    parts.forEach(function (part) {\n      url += hasQS(url) && hasQS(part) ? part.replace(/\\?/, '&') : part;\n    });\n    return url;\n  };\n\n  var createFetchFunction = function createFetchFunction() {\n    var apiUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined; // custom handler (should also handle file, load, error, progress and abort)\n\n    if (typeof action === 'function') {\n      return action;\n    } // no action supplied\n\n\n    if (!action || !isString(action.url)) {\n      return null;\n    } // set onload hanlder\n\n\n    var onload = action.onload || function (res) {\n      return res;\n    };\n\n    var onerror = action.onerror || function (res) {\n      return null;\n    }; // internal handler\n\n\n    return function (url, load, error, progress, abort, headers) {\n      // do local or remote request based on if the url is external\n      var request = sendRequest(url, buildURL(apiUrl, action.url), Object.assign({}, action, {\n        responseType: 'blob'\n      }));\n\n      request.onload = function (xhr) {\n        // get headers\n        var headers = xhr.getAllResponseHeaders(); // get filename\n\n        var filename = getFileInfoFromHeaders(headers).name || getFilenameFromURL(url); // create response\n\n        load(createResponse('load', xhr.status, action.method === 'HEAD' ? null : getFileFromBlob(onload(xhr.response), filename), headers));\n      };\n\n      request.onerror = function (xhr) {\n        error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.onheaders = function (xhr) {\n        headers(createResponse('headers', xhr.status, null, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      request.onprogress = progress;\n      request.onabort = abort; // should return request\n\n      return request;\n    };\n  };\n\n  var ChunkStatus = {\n    QUEUED: 0,\n    COMPLETE: 1,\n    PROCESSING: 2,\n    ERROR: 3,\n    WAITING: 4\n  };\n  /*\n                                                       function signature:\n                                                         (file, metadata, load, error, progress, abort, transfer, options) => {\n                                                           return {\n                                                           abort:() => {}\n                                                         }\n                                                       }\n                                                       */\n  // apiUrl, action, name, file, metadata, load, error, progress, abort, transfer, options\n\n  var processFileChunked = function processFileChunked(apiUrl, action, name, file, metadata, load, error, progress, abort, transfer, options) {\n    // all chunks\n    var chunks = [];\n    var chunkTransferId = options.chunkTransferId,\n        chunkServer = options.chunkServer,\n        chunkSize = options.chunkSize,\n        chunkRetryDelays = options.chunkRetryDelays; // default state\n\n    var state = {\n      serverId: chunkTransferId,\n      aborted: false\n    }; // set onload handlers\n\n    var ondata = action.ondata || function (fd) {\n      return fd;\n    };\n\n    var onload = action.onload || function (xhr, method) {\n      return method === 'HEAD' ? xhr.getResponseHeader('Upload-Offset') : xhr.response;\n    };\n\n    var onerror = action.onerror || function (res) {\n      return null;\n    }; // create server hook\n\n\n    var requestTransferId = function requestTransferId(cb) {\n      var formData = new FormData(); // add metadata under same name\n\n      if (isObject(metadata)) formData.append(name, JSON.stringify(metadata));\n      var headers = typeof action.headers === 'function' ? action.headers(file, metadata) : Object.assign({}, action.headers, {\n        'Upload-Length': file.size\n      });\n      var requestParams = Object.assign({}, action, {\n        headers: headers\n      }); // send request object\n\n      var request = sendRequest(ondata(formData), buildURL(apiUrl, action.url), requestParams);\n\n      request.onload = function (xhr) {\n        return cb(onload(xhr, requestParams.method));\n      };\n\n      request.onerror = function (xhr) {\n        return error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n    };\n\n    var requestTransferOffset = function requestTransferOffset(cb) {\n      var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);\n      var headers = typeof action.headers === 'function' ? action.headers(state.serverId) : Object.assign({}, action.headers);\n      var requestParams = {\n        headers: headers,\n        method: 'HEAD'\n      };\n      var request = sendRequest(null, requestUrl, requestParams);\n\n      request.onload = function (xhr) {\n        return cb(onload(xhr, requestParams.method));\n      };\n\n      request.onerror = function (xhr) {\n        return error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n    }; // create chunks\n\n\n    var lastChunkIndex = Math.floor(file.size / chunkSize);\n\n    for (var i = 0; i <= lastChunkIndex; i++) {\n      var offset = i * chunkSize;\n      var data = file.slice(offset, offset + chunkSize, 'application/offset+octet-stream');\n      chunks[i] = {\n        index: i,\n        size: data.size,\n        offset: offset,\n        data: data,\n        file: file,\n        progress: 0,\n        retries: _toConsumableArray(chunkRetryDelays),\n        status: ChunkStatus.QUEUED,\n        error: null,\n        request: null,\n        timeout: null\n      };\n    }\n\n    var completeProcessingChunks = function completeProcessingChunks() {\n      return load(state.serverId);\n    };\n\n    var canProcessChunk = function canProcessChunk(chunk) {\n      return chunk.status === ChunkStatus.QUEUED || chunk.status === ChunkStatus.ERROR;\n    };\n\n    var processChunk = function processChunk(chunk) {\n      // processing is paused, wait here\n      if (state.aborted) return; // get next chunk to process\n\n      chunk = chunk || chunks.find(canProcessChunk); // no more chunks to process\n\n      if (!chunk) {\n        // all done?\n        if (chunks.every(function (chunk) {\n          return chunk.status === ChunkStatus.COMPLETE;\n        })) {\n          completeProcessingChunks();\n        } // no chunk to handle\n\n\n        return;\n      } // now processing this chunk\n\n\n      chunk.status = ChunkStatus.PROCESSING;\n      chunk.progress = null; // allow parsing of formdata\n\n      var ondata = chunkServer.ondata || function (fd) {\n        return fd;\n      };\n\n      var onerror = chunkServer.onerror || function (res) {\n        return null;\n      }; // send request object\n\n\n      var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);\n      var headers = typeof chunkServer.headers === 'function' ? chunkServer.headers(chunk) : Object.assign({}, chunkServer.headers, {\n        'Content-Type': 'application/offset+octet-stream',\n        'Upload-Offset': chunk.offset,\n        'Upload-Length': file.size,\n        'Upload-Name': file.name\n      });\n      var request = chunk.request = sendRequest(ondata(chunk.data), requestUrl, Object.assign({}, chunkServer, {\n        headers: headers\n      }));\n\n      request.onload = function () {\n        // done!\n        chunk.status = ChunkStatus.COMPLETE; // remove request reference\n\n        chunk.request = null; // start processing more chunks\n\n        processChunks();\n      };\n\n      request.onprogress = function (lengthComputable, loaded, total) {\n        chunk.progress = lengthComputable ? loaded : null;\n        updateTotalProgress();\n      };\n\n      request.onerror = function (xhr) {\n        chunk.status = ChunkStatus.ERROR;\n        chunk.request = null;\n        chunk.error = onerror(xhr.response) || xhr.statusText;\n\n        if (!retryProcessChunk(chunk)) {\n          error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n        }\n      };\n\n      request.ontimeout = function (xhr) {\n        chunk.status = ChunkStatus.ERROR;\n        chunk.request = null;\n\n        if (!retryProcessChunk(chunk)) {\n          createTimeoutResponse(error)(xhr);\n        }\n      };\n\n      request.onabort = function () {\n        chunk.status = ChunkStatus.QUEUED;\n        chunk.request = null;\n        abort();\n      };\n    };\n\n    var retryProcessChunk = function retryProcessChunk(chunk) {\n      // no more retries left\n      if (chunk.retries.length === 0) return false; // new retry\n\n      chunk.status = ChunkStatus.WAITING;\n      clearTimeout(chunk.timeout);\n      chunk.timeout = setTimeout(function () {\n        processChunk(chunk);\n      }, chunk.retries.shift()); // we're going to retry\n\n      return true;\n    };\n\n    var updateTotalProgress = function updateTotalProgress() {\n      // calculate total progress fraction\n      var totalBytesTransfered = chunks.reduce(function (p, chunk) {\n        if (p === null || chunk.progress === null) return null;\n        return p + chunk.progress;\n      }, 0); // can't compute progress\n\n      if (totalBytesTransfered === null) return progress(false, 0, 0); // calculate progress values\n\n      var totalSize = chunks.reduce(function (total, chunk) {\n        return total + chunk.size;\n      }, 0); // can update progress indicator\n\n      progress(true, totalBytesTransfered, totalSize);\n    }; // process new chunks\n\n\n    var processChunks = function processChunks() {\n      var totalProcessing = chunks.filter(function (chunk) {\n        return chunk.status === ChunkStatus.PROCESSING;\n      }).length;\n      if (totalProcessing >= 1) return;\n      processChunk();\n    };\n\n    var abortChunks = function abortChunks() {\n      chunks.forEach(function (chunk) {\n        clearTimeout(chunk.timeout);\n\n        if (chunk.request) {\n          chunk.request.abort();\n        }\n      });\n    }; // let's go!\n\n\n    if (!state.serverId) {\n      requestTransferId(function (serverId) {\n        // stop here if aborted, might have happened in between request and callback\n        if (state.aborted) return; // pass back to item so we can use it if something goes wrong\n\n        transfer(serverId); // store internally\n\n        state.serverId = serverId;\n        processChunks();\n      });\n    } else {\n      requestTransferOffset(function (offset) {\n        // stop here if aborted, might have happened in between request and callback\n        if (state.aborted) return; // mark chunks with lower offset as complete\n\n        chunks.filter(function (chunk) {\n          return chunk.offset < offset;\n        }).forEach(function (chunk) {\n          chunk.status = ChunkStatus.COMPLETE;\n          chunk.progress = chunk.size;\n        }); // continue processing\n\n        processChunks();\n      });\n    }\n\n    return {\n      abort: function abort() {\n        state.aborted = true;\n        abortChunks();\n      }\n    };\n  };\n  /*\n                                                               function signature:\n                                                                 (file, metadata, load, error, progress, abort) => {\n                                                                   return {\n                                                                   abort:() => {}\n                                                                 }\n                                                               }\n                                                               */\n\n\n  var createFileProcessorFunction = function createFileProcessorFunction(apiUrl, action, name, options) {\n    return function (file, metadata, load, error, progress, abort, transfer) {\n      // no file received\n      if (!file) return; // if was passed a file, and we can chunk it, exit here\n\n      var canChunkUpload = options.chunkUploads;\n      var shouldChunkUpload = canChunkUpload && file.size > options.chunkSize;\n      var willChunkUpload = canChunkUpload && (shouldChunkUpload || options.chunkForce);\n      if (file instanceof Blob && willChunkUpload) return processFileChunked(apiUrl, action, name, file, metadata, load, error, progress, abort, transfer, options); // set handlers\n\n      var ondata = action.ondata || function (fd) {\n        return fd;\n      };\n\n      var onload = action.onload || function (res) {\n        return res;\n      };\n\n      var onerror = action.onerror || function (res) {\n        return null;\n      }; // create formdata object\n\n\n      var formData = new FormData(); // add metadata under same name\n\n      if (isObject(metadata)) {\n        formData.append(name, JSON.stringify(metadata));\n      } // Turn into an array of objects so no matter what the input, we can handle it the same way\n\n\n      (file instanceof Blob ? [{\n        name: null,\n        file: file\n      }] : file).forEach(function (item) {\n        formData.append(name, item.file, item.name === null ? item.file.name : '' + item.name + item.file.name);\n      }); // send request object\n\n      var request = sendRequest(ondata(formData), buildURL(apiUrl, action.url), action);\n\n      request.onload = function (xhr) {\n        load(createResponse('load', xhr.status, onload(xhr.response), xhr.getAllResponseHeaders()));\n      };\n\n      request.onerror = function (xhr) {\n        error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      request.onprogress = progress;\n      request.onabort = abort; // should return request\n\n      return request;\n    };\n  };\n\n  var createProcessorFunction = function createProcessorFunction() {\n    var apiUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n    var name = arguments.length > 2 ? arguments[2] : undefined;\n    var options = arguments.length > 3 ? arguments[3] : undefined; // custom handler (should also handle file, load, error, progress and abort)\n\n    if (typeof action === 'function') return function () {\n      for (var _len = arguments.length, params = new Array(_len), _key = 0; _key < _len; _key++) {\n        params[_key] = arguments[_key];\n      }\n\n      return action.apply(void 0, [name].concat(params, [options]));\n    }; // no action supplied\n\n    if (!action || !isString(action.url)) return null; // internal handler\n\n    return createFileProcessorFunction(apiUrl, action, name, options);\n  };\n  /*\n                                                      function signature:\n                                                      (uniqueFileId, load, error) => { }\n                                                      */\n\n\n  var createRevertFunction = function createRevertFunction() {\n    var apiUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined; // is custom implementation\n\n    if (typeof action === 'function') {\n      return action;\n    } // no action supplied, return stub function, interface will work, but file won't be removed\n\n\n    if (!action || !isString(action.url)) {\n      return function (uniqueFileId, load) {\n        return load();\n      };\n    } // set onload hanlder\n\n\n    var onload = action.onload || function (res) {\n      return res;\n    };\n\n    var onerror = action.onerror || function (res) {\n      return null;\n    }; // internal implementation\n\n\n    return function (uniqueFileId, load, error) {\n      var request = sendRequest(uniqueFileId, apiUrl + action.url, action // contains method, headers and withCredentials properties\n      );\n\n      request.onload = function (xhr) {\n        load(createResponse('load', xhr.status, onload(xhr.response), xhr.getAllResponseHeaders()));\n      };\n\n      request.onerror = function (xhr) {\n        error(createResponse('error', xhr.status, onerror(xhr.response) || xhr.statusText, xhr.getAllResponseHeaders()));\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      return request;\n    };\n  };\n\n  var getRandomNumber = function getRandomNumber() {\n    var min = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var max = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return min + Math.random() * (max - min);\n  };\n\n  var createPerceivedPerformanceUpdater = function createPerceivedPerformanceUpdater(cb) {\n    var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1000;\n    var offset = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var tickMin = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 25;\n    var tickMax = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 250;\n    var timeout = null;\n    var start = Date.now();\n\n    var tick = function tick() {\n      var runtime = Date.now() - start;\n      var delay = getRandomNumber(tickMin, tickMax);\n\n      if (runtime + delay > duration) {\n        delay = runtime + delay - duration;\n      }\n\n      var progress = runtime / duration;\n\n      if (progress >= 1 || document.hidden) {\n        cb(1);\n        return;\n      }\n\n      cb(progress);\n      timeout = setTimeout(tick, delay);\n    };\n\n    tick();\n    return {\n      clear: function clear() {\n        clearTimeout(timeout);\n      }\n    };\n  };\n\n  var createFileProcessor = function createFileProcessor(processFn) {\n    var state = {\n      complete: false,\n      perceivedProgress: 0,\n      perceivedPerformanceUpdater: null,\n      progress: null,\n      timestamp: null,\n      perceivedDuration: 0,\n      duration: 0,\n      request: null,\n      response: null\n    };\n\n    var process = function process(file, metadata) {\n      var progressFn = function progressFn() {\n        // we've not yet started the real download, stop here\n        // the request might not go through, for instance, there might be some server trouble\n        // if state.progress is null, the server does not allow computing progress and we show the spinner instead\n        if (state.duration === 0 || state.progress === null) return; // as we're now processing, fire the progress event\n\n        api.fire('progress', api.getProgress());\n      };\n\n      var completeFn = function completeFn() {\n        state.complete = true;\n        api.fire('load-perceived', state.response.body);\n      }; // let's start processing\n\n\n      api.fire('start'); // set request start\n\n      state.timestamp = Date.now(); // create perceived performance progress indicator\n\n      state.perceivedPerformanceUpdater = createPerceivedPerformanceUpdater(function (progress) {\n        state.perceivedProgress = progress;\n        state.perceivedDuration = Date.now() - state.timestamp;\n        progressFn(); // if fake progress is done, and a response has been received,\n        // and we've not yet called the complete method\n\n        if (state.response && state.perceivedProgress === 1 && !state.complete) {\n          // we done!\n          completeFn();\n        }\n      }, // random delay as in a list of files you start noticing\n      // files uploading at the exact same speed\n      getRandomNumber(750, 1500)); // remember request so we can abort it later\n\n      state.request = processFn( // the file to process\n      file, // the metadata to send along\n      metadata, // callbacks (load, error, progress, abort, transfer)\n      // load expects the body to be a server id if\n      // you want to make use of revert\n      function (response) {\n        // we put the response in state so we can access\n        // it outside of this method\n        state.response = isObject(response) ? response : {\n          type: 'load',\n          code: 200,\n          body: '' + response,\n          headers: {}\n        }; // update duration\n\n        state.duration = Date.now() - state.timestamp; // force progress to 1 as we're now done\n\n        state.progress = 1; // actual load is done let's share results\n\n        api.fire('load', state.response.body); // we are really done\n        // if perceived progress is 1 ( wait for perceived progress to complete )\n        // or if server does not support progress ( null )\n\n        if (state.perceivedProgress === 1) {\n          completeFn();\n        }\n      }, // error is expected to be an object with type, code, body\n      function (error) {\n        // cancel updater\n        state.perceivedPerformanceUpdater.clear(); // update others about this error\n\n        api.fire('error', isObject(error) ? error : {\n          type: 'error',\n          code: 0,\n          body: '' + error\n        });\n      }, // actual processing progress\n      function (computable, current, total) {\n        // update actual duration\n        state.duration = Date.now() - state.timestamp; // update actual progress\n\n        state.progress = computable ? current / total : null;\n        progressFn();\n      }, // abort does not expect a value\n      function () {\n        // stop updater\n        state.perceivedPerformanceUpdater.clear(); // fire the abort event so we can switch visuals\n\n        api.fire('abort', state.response ? state.response.body : null);\n      }, // register the id for this transfer\n      function (transferId) {\n        api.fire('transfer', transferId);\n      });\n    };\n\n    var abort = function abort() {\n      // no request running, can't abort\n      if (!state.request) return; // stop updater\n\n      state.perceivedPerformanceUpdater.clear(); // abort actual request\n\n      if (state.request.abort) state.request.abort(); // if has response object, we've completed the request\n\n      state.complete = true;\n    };\n\n    var reset = function reset() {\n      abort();\n      state.complete = false;\n      state.perceivedProgress = 0;\n      state.progress = 0;\n      state.timestamp = null;\n      state.perceivedDuration = 0;\n      state.duration = 0;\n      state.request = null;\n      state.response = null;\n    };\n\n    var getProgress = function getProgress() {\n      return state.progress ? Math.min(state.progress, state.perceivedProgress) : null;\n    };\n\n    var getDuration = function getDuration() {\n      return Math.min(state.duration, state.perceivedDuration);\n    };\n\n    var api = Object.assign({}, on(), {\n      process: process,\n      // start processing file\n      abort: abort,\n      // abort active process request\n      getProgress: getProgress,\n      getDuration: getDuration,\n      reset: reset\n    });\n    return api;\n  };\n\n  var getFilenameWithoutExtension = function getFilenameWithoutExtension(name) {\n    return name.substr(0, name.lastIndexOf('.')) || name;\n  };\n\n  var createFileStub = function createFileStub(source) {\n    var data = [source.name, source.size, source.type]; // is blob or base64, then we need to set the name\n\n    if (source instanceof Blob || isBase64DataURI(source)) {\n      data[0] = source.name || getDateString();\n    } else if (isBase64DataURI(source)) {\n      // if is base64 data uri we need to determine the average size and type\n      data[1] = source.length;\n      data[2] = getMimeTypeFromBase64DataURI(source);\n    } else if (isString(source)) {\n      // url\n      data[0] = getFilenameFromURL(source);\n      data[1] = 0;\n      data[2] = 'application/octet-stream';\n    }\n\n    return {\n      name: data[0],\n      size: data[1],\n      type: data[2]\n    };\n  };\n\n  var isFile = function isFile(value) {\n    return !!(value instanceof File || value instanceof Blob && value.name);\n  };\n\n  var deepCloneObject = function deepCloneObject(src) {\n    if (!isObject(src)) return src;\n    var target = isArray(src) ? [] : {};\n\n    for (var key in src) {\n      if (!src.hasOwnProperty(key)) continue;\n      var v = src[key];\n      target[key] = v && isObject(v) ? deepCloneObject(v) : v;\n    }\n\n    return target;\n  };\n\n  var createItem = function createItem() {\n    var origin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    var serverFileReference = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    var file = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null; // unique id for this item, is used to identify the item across views\n\n    var id = getUniqueId();\n    /**\n     * Internal item state\n     */\n\n    var state = {\n      // is archived\n      archived: false,\n      // if is frozen, no longer fires events\n      frozen: false,\n      // removed from view\n      released: false,\n      // original source\n      source: null,\n      // file model reference\n      file: file,\n      // id of file on server\n      serverFileReference: serverFileReference,\n      // id of file transfer on server\n      transferId: null,\n      // is aborted\n      processingAborted: false,\n      // current item status\n      status: serverFileReference ? ItemStatus.PROCESSING_COMPLETE : ItemStatus.INIT,\n      // active processes\n      activeLoader: null,\n      activeProcessor: null\n    }; // callback used when abort processing is called to link back to the resolve method\n\n    var abortProcessingRequestComplete = null;\n    /**\n     * Externally added item metadata\n     */\n\n    var metadata = {}; // item data\n\n    var setStatus = function setStatus(status) {\n      return state.status = status;\n    }; // fire event unless the item has been archived\n\n\n    var fire = function fire(event) {\n      if (state.released || state.frozen) return;\n\n      for (var _len = arguments.length, params = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        params[_key - 1] = arguments[_key];\n      }\n\n      api.fire.apply(api, [event].concat(params));\n    }; // file data\n\n\n    var getFileExtension = function getFileExtension() {\n      return getExtensionFromFilename(state.file.name);\n    };\n\n    var getFileType = function getFileType() {\n      return state.file.type;\n    };\n\n    var getFileSize = function getFileSize() {\n      return state.file.size;\n    };\n\n    var getFile = function getFile() {\n      return state.file;\n    }; //\n    // logic to load a file\n    //\n\n\n    var load = function load(source, loader, onload) {\n      // remember the original item source\n      state.source = source; // source is known\n\n      api.fireSync('init'); // file stub is already there\n\n      if (state.file) {\n        api.fireSync('load-skip');\n        return;\n      } // set a stub file object while loading the actual data\n\n\n      state.file = createFileStub(source); // starts loading\n\n      loader.on('init', function () {\n        fire('load-init');\n      }); // we'eve received a size indication, let's update the stub\n\n      loader.on('meta', function (meta) {\n        // set size of file stub\n        state.file.size = meta.size; // set name of file stub\n\n        state.file.filename = meta.filename; // if has received source, we done\n\n        if (meta.source) {\n          origin = FileOrigin.LIMBO;\n          state.serverFileReference = meta.source;\n          state.status = ItemStatus.PROCESSING_COMPLETE;\n        } // size has been updated\n\n\n        fire('load-meta');\n      }); // the file is now loading we need to update the progress indicators\n\n      loader.on('progress', function (progress) {\n        setStatus(ItemStatus.LOADING);\n        fire('load-progress', progress);\n      }); // an error was thrown while loading the file, we need to switch to error state\n\n      loader.on('error', function (error) {\n        setStatus(ItemStatus.LOAD_ERROR);\n        fire('load-request-error', error);\n      }); // user or another process aborted the file load (cannot retry)\n\n      loader.on('abort', function () {\n        setStatus(ItemStatus.INIT);\n        fire('load-abort');\n      }); // done loading\n\n      loader.on('load', function (file) {\n        // as we've now loaded the file the loader is no longer required\n        state.activeLoader = null; // called when file has loaded succesfully\n\n        var success = function success(result) {\n          // set (possibly) transformed file\n          state.file = isFile(result) ? result : state.file; // file received\n\n          if (origin === FileOrigin.LIMBO && state.serverFileReference) {\n            setStatus(ItemStatus.PROCESSING_COMPLETE);\n          } else {\n            setStatus(ItemStatus.IDLE);\n          }\n\n          fire('load');\n        };\n\n        var error = function error(result) {\n          // set original file\n          state.file = file;\n          fire('load-meta');\n          setStatus(ItemStatus.LOAD_ERROR);\n          fire('load-file-error', result);\n        }; // if we already have a server file reference, we don't need to call the onload method\n\n\n        if (state.serverFileReference) {\n          success(file);\n          return;\n        } // no server id, let's give this file the full treatment\n\n\n        onload(file, success, error);\n      }); // set loader source data\n\n      loader.setSource(source); // set as active loader\n\n      state.activeLoader = loader; // load the source data\n\n      loader.load();\n    };\n\n    var retryLoad = function retryLoad() {\n      if (!state.activeLoader) {\n        return;\n      }\n\n      state.activeLoader.load();\n    };\n\n    var abortLoad = function abortLoad() {\n      if (state.activeLoader) {\n        state.activeLoader.abort();\n        return;\n      }\n\n      setStatus(ItemStatus.INIT);\n      fire('load-abort');\n    }; //\n    // logic to process a file\n    //\n\n\n    var process = function process(processor, onprocess) {\n      // processing was aborted\n      if (state.processingAborted) {\n        state.processingAborted = false;\n        return;\n      } // now processing\n\n\n      setStatus(ItemStatus.PROCESSING); // reset abort callback\n\n      abortProcessingRequestComplete = null; // if no file loaded we'll wait for the load event\n\n      if (!(state.file instanceof Blob)) {\n        api.on('load', function () {\n          process(processor, onprocess);\n        });\n        return;\n      } // setup processor\n\n\n      processor.on('load', function (serverFileReference) {\n        // need this id to be able to revert the upload\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n      }); // register transfer id\n\n      processor.on('transfer', function (transferId) {\n        // need this id to be able to revert the upload\n        state.transferId = transferId;\n      });\n      processor.on('load-perceived', function (serverFileReference) {\n        // no longer required\n        state.activeProcessor = null; // need this id to be able to rever the upload\n\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n        setStatus(ItemStatus.PROCESSING_COMPLETE);\n        fire('process-complete', serverFileReference);\n      });\n      processor.on('start', function () {\n        fire('process-start');\n      });\n      processor.on('error', function (error) {\n        state.activeProcessor = null;\n        setStatus(ItemStatus.PROCESSING_ERROR);\n        fire('process-error', error);\n      });\n      processor.on('abort', function (serverFileReference) {\n        state.activeProcessor = null; // if file was uploaded but processing was cancelled during perceived processor time store file reference\n\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n        setStatus(ItemStatus.IDLE);\n        fire('process-abort'); // has timeout so doesn't interfere with remove action\n\n        if (abortProcessingRequestComplete) {\n          abortProcessingRequestComplete();\n        }\n      });\n      processor.on('progress', function (progress) {\n        fire('process-progress', progress);\n      }); // when successfully transformed\n\n      var success = function success(file) {\n        // if was archived in the mean time, don't process\n        if (state.archived) return; // process file!\n\n        processor.process(file, Object.assign({}, metadata));\n      }; // something went wrong during transform phase\n\n\n      var error = console.error; // start processing the file\n\n      onprocess(state.file, success, error); // set as active processor\n\n      state.activeProcessor = processor;\n    };\n\n    var requestProcessing = function requestProcessing() {\n      state.processingAborted = false;\n      setStatus(ItemStatus.PROCESSING_QUEUED);\n    };\n\n    var abortProcessing = function abortProcessing() {\n      return new Promise(function (resolve) {\n        if (!state.activeProcessor) {\n          state.processingAborted = true;\n          setStatus(ItemStatus.IDLE);\n          fire('process-abort');\n          resolve();\n          return;\n        }\n\n        abortProcessingRequestComplete = function abortProcessingRequestComplete() {\n          resolve();\n        };\n\n        state.activeProcessor.abort();\n      });\n    }; //\n    // logic to revert a processed file\n    //\n\n\n    var revert = function revert(revertFileUpload, forceRevert) {\n      return new Promise(function (resolve, reject) {\n        // cannot revert without a server id for this process\n        if (state.serverFileReference === null) {\n          resolve();\n          return;\n        } // revert the upload (fire and forget)\n\n\n        revertFileUpload(state.serverFileReference, function () {\n          // reset file server id as now it's no available on the server\n          state.serverFileReference = null;\n          resolve();\n        }, function (error) {\n          // don't set error state when reverting is optional, it will always resolve\n          if (!forceRevert) {\n            resolve();\n            return;\n          } // oh no errors\n\n\n          setStatus(ItemStatus.PROCESSING_REVERT_ERROR);\n          fire('process-revert-error');\n          reject(error);\n        }); // fire event\n\n        setStatus(ItemStatus.IDLE);\n        fire('process-revert');\n      });\n    }; // exposed methods\n\n\n    var _setMetadata = function setMetadata(key, value, silent) {\n      var keys = key.split('.');\n      var root = keys[0];\n      var last = keys.pop();\n      var data = metadata;\n      keys.forEach(function (key) {\n        return data = data[key];\n      }); // compare old value against new value, if they're the same, we're not updating\n\n      if (JSON.stringify(data[last]) === JSON.stringify(value)) return; // update value\n\n      data[last] = value; // don't fire update\n\n      if (silent) return; // fire update\n\n      fire('metadata-update', {\n        key: root,\n        value: metadata[root]\n      });\n    };\n\n    var getMetadata = function getMetadata(key) {\n      return deepCloneObject(key ? metadata[key] : metadata);\n    };\n\n    var api = Object.assign({\n      id: {\n        get: function get() {\n          return id;\n        }\n      },\n      origin: {\n        get: function get() {\n          return origin;\n        }\n      },\n      serverId: {\n        get: function get() {\n          return state.serverFileReference;\n        }\n      },\n      transferId: {\n        get: function get() {\n          return state.transferId;\n        }\n      },\n      status: {\n        get: function get() {\n          return state.status;\n        }\n      },\n      filename: {\n        get: function get() {\n          return state.file.name;\n        }\n      },\n      filenameWithoutExtension: {\n        get: function get() {\n          return getFilenameWithoutExtension(state.file.name);\n        }\n      },\n      fileExtension: {\n        get: getFileExtension\n      },\n      fileType: {\n        get: getFileType\n      },\n      fileSize: {\n        get: getFileSize\n      },\n      file: {\n        get: getFile\n      },\n      relativePath: {\n        get: function get() {\n          return state.file._relativePath;\n        }\n      },\n      source: {\n        get: function get() {\n          return state.source;\n        }\n      },\n      getMetadata: getMetadata,\n      setMetadata: function setMetadata(key, value, silent) {\n        if (isObject(key)) {\n          var data = key;\n          Object.keys(data).forEach(function (key) {\n            _setMetadata(key, data[key], value);\n          });\n          return key;\n        }\n\n        _setMetadata(key, value, silent);\n\n        return value;\n      },\n      extend: function extend(name, handler) {\n        return itemAPI[name] = handler;\n      },\n      abortLoad: abortLoad,\n      retryLoad: retryLoad,\n      requestProcessing: requestProcessing,\n      abortProcessing: abortProcessing,\n      load: load,\n      process: process,\n      revert: revert\n    }, on(), {\n      freeze: function freeze() {\n        return state.frozen = true;\n      },\n      release: function release() {\n        return state.released = true;\n      },\n      released: {\n        get: function get() {\n          return state.released;\n        }\n      },\n      archive: function archive() {\n        return state.archived = true;\n      },\n      archived: {\n        get: function get() {\n          return state.archived;\n        }\n      }\n    }); // create it here instead of returning it instantly so we can extend it later\n\n    var itemAPI = createObject(api);\n    return itemAPI;\n  };\n\n  var getItemIndexByQuery = function getItemIndexByQuery(items, query) {\n    // just return first index\n    if (isEmpty(query)) {\n      return 0;\n    } // invalid queries\n\n\n    if (!isString(query)) {\n      return -1;\n    } // return item by id (or -1 if not found)\n\n\n    return items.findIndex(function (item) {\n      return item.id === query;\n    });\n  };\n\n  var getItemById = function getItemById(items, itemId) {\n    var index = getItemIndexByQuery(items, itemId);\n\n    if (index < 0) {\n      return;\n    }\n\n    return items[index] || null;\n  };\n\n  var fetchBlob = function fetchBlob(url, load, error, progress, abort, headers) {\n    var request = sendRequest(null, url, {\n      method: 'GET',\n      responseType: 'blob'\n    });\n\n    request.onload = function (xhr) {\n      // get headers\n      var headers = xhr.getAllResponseHeaders(); // get filename\n\n      var filename = getFileInfoFromHeaders(headers).name || getFilenameFromURL(url); // create response\n\n      load(createResponse('load', xhr.status, getFileFromBlob(xhr.response, filename), headers));\n    };\n\n    request.onerror = function (xhr) {\n      error(createResponse('error', xhr.status, xhr.statusText, xhr.getAllResponseHeaders()));\n    };\n\n    request.onheaders = function (xhr) {\n      headers(createResponse('headers', xhr.status, null, xhr.getAllResponseHeaders()));\n    };\n\n    request.ontimeout = createTimeoutResponse(error);\n    request.onprogress = progress;\n    request.onabort = abort; // should return request\n\n    return request;\n  };\n\n  var getDomainFromURL = function getDomainFromURL(url) {\n    if (url.indexOf('//') === 0) {\n      url = location.protocol + url;\n    }\n\n    return url.toLowerCase().replace('blob:', '').replace(/([a-z])?:\\/\\//, '$1').split('/')[0];\n  };\n\n  var isExternalURL = function isExternalURL(url) {\n    return (url.indexOf(':') > -1 || url.indexOf('//') > -1) && getDomainFromURL(location.href) !== getDomainFromURL(url);\n  };\n\n  var dynamicLabel = function dynamicLabel(label) {\n    return function () {\n      return isFunction(label) ? label.apply(void 0, arguments) : label;\n    };\n  };\n\n  var isMockItem = function isMockItem(item) {\n    return !isFile(item.file);\n  };\n\n  var listUpdated = function listUpdated(dispatch, state) {\n    clearTimeout(state.listUpdateTimeout);\n    state.listUpdateTimeout = setTimeout(function () {\n      dispatch('DID_UPDATE_ITEMS', {\n        items: getActiveItems(state.items)\n      });\n    }, 0);\n  };\n\n  var optionalPromise = function optionalPromise(fn) {\n    for (var _len = arguments.length, params = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      params[_key - 1] = arguments[_key];\n    }\n\n    return new Promise(function (resolve) {\n      if (!fn) {\n        return resolve(true);\n      }\n\n      var result = fn.apply(void 0, params);\n\n      if (result == null) {\n        return resolve(true);\n      }\n\n      if (typeof result === 'boolean') {\n        return resolve(result);\n      }\n\n      if (typeof result.then === 'function') {\n        result.then(resolve);\n      }\n    });\n  };\n\n  var sortItems = function sortItems(state, compare) {\n    state.items.sort(function (a, b) {\n      return compare(createItemAPI(a), createItemAPI(b));\n    });\n  }; // returns item based on state\n\n\n  var getItemByQueryFromState = function getItemByQueryFromState(state, itemHandler) {\n    return function () {\n      var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      var query = _ref.query,\n          _ref$success = _ref.success,\n          success = _ref$success === void 0 ? function () {} : _ref$success,\n          _ref$failure = _ref.failure,\n          failure = _ref$failure === void 0 ? function () {} : _ref$failure,\n          options = _objectWithoutProperties(_ref, ['query', 'success', 'failure']);\n\n      var item = getItemByQuery(state.items, query);\n\n      if (!item) {\n        failure({\n          error: createResponse('error', 0, 'Item not found'),\n          file: null\n        });\n        return;\n      }\n\n      itemHandler(item, success, failure, options || {});\n    };\n  };\n\n  var actions = function actions(dispatch, query, state) {\n    return {\n      /**\n       * Aborts all ongoing processes\n       */\n      ABORT_ALL: function ABORT_ALL() {\n        getActiveItems(state.items).forEach(function (item) {\n          item.freeze();\n          item.abortLoad();\n          item.abortProcessing();\n        });\n      },\n\n      /**\n       * Sets initial files\n       */\n      DID_SET_FILES: function DID_SET_FILES(_ref2) {\n        var _ref2$value = _ref2.value,\n            value = _ref2$value === void 0 ? [] : _ref2$value; // map values to file objects\n\n        var files = value.map(function (file) {\n          return {\n            source: file.source ? file.source : file,\n            options: file.options\n          };\n        }); // loop over files, if file is in list, leave it be, if not, remove\n        // test if items should be moved\n\n        var activeItems = getActiveItems(state.items);\n        activeItems.forEach(function (item) {\n          // if item not is in new value, remove\n          if (!files.find(function (file) {\n            return file.source === item.source || file.source === item.file;\n          })) {\n            dispatch('REMOVE_ITEM', {\n              query: item,\n              remove: false\n            });\n          }\n        }); // add new files\n\n        activeItems = getActiveItems(state.items);\n        files.forEach(function (file, index) {\n          // if file is already in list\n          if (activeItems.find(function (item) {\n            return item.source === file.source || item.file === file.source;\n          })) return; // not in list, add\n\n          dispatch('ADD_ITEM', Object.assign({}, file, {\n            interactionMethod: InteractionMethod.NONE,\n            index: index\n          }));\n        });\n      },\n      DID_UPDATE_ITEM_METADATA: function DID_UPDATE_ITEM_METADATA(_ref3) {\n        var id = _ref3.id; // if is called multiple times in close succession we combined all calls together to save resources\n\n        clearTimeout(state.itemUpdateTimeout);\n        state.itemUpdateTimeout = setTimeout(function () {\n          var item = getItemById(state.items, id); // only revert and attempt to upload when we're uploading to a server\n\n          if (!query('IS_ASYNC')) {\n            // should we update the output data\n            applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {\n              item: item,\n              query: query\n            }).then(function (shouldPrepareOutput) {\n              if (!shouldPrepareOutput) {\n                return;\n              }\n\n              dispatch('REQUEST_PREPARE_OUTPUT', {\n                query: id,\n                item: item,\n                success: function success(file) {\n                  dispatch('DID_PREPARE_OUTPUT', {\n                    id: id,\n                    file: file\n                  });\n                }\n              }, true);\n            });\n            return;\n          } // for async scenarios\n\n\n          var upload = function upload() {\n            // we push this forward a bit so the interface is updated correctly\n            setTimeout(function () {\n              dispatch('REQUEST_ITEM_PROCESSING', {\n                query: id\n              });\n            }, 32);\n          };\n\n          var revert = function revert(doUpload) {\n            item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), query('GET_FORCE_REVERT')).then(doUpload ? upload : function () {}).catch(function () {});\n          };\n\n          var abort = function abort(doUpload) {\n            item.abortProcessing().then(doUpload ? upload : function () {});\n          }; // if we should re-upload the file immidiately\n\n\n          if (item.status === ItemStatus.PROCESSING_COMPLETE) {\n            return revert(state.options.instantUpload);\n          } // if currently uploading, cancel upload\n\n\n          if (item.status === ItemStatus.PROCESSING) {\n            return abort(state.options.instantUpload);\n          }\n\n          if (state.options.instantUpload) {\n            upload();\n          }\n        }, 0);\n      },\n      MOVE_ITEM: function MOVE_ITEM(_ref4) {\n        var query = _ref4.query,\n            index = _ref4.index;\n        var item = getItemByQuery(state.items, query);\n        if (!item) return;\n        var currentIndex = state.items.indexOf(item);\n        index = limit(index, 0, state.items.length - 1);\n        if (currentIndex === index) return;\n        state.items.splice(index, 0, state.items.splice(currentIndex, 1)[0]);\n      },\n      SORT: function SORT(_ref5) {\n        var compare = _ref5.compare;\n        sortItems(state, compare);\n        dispatch('DID_SORT_ITEMS', {\n          items: query('GET_ACTIVE_ITEMS')\n        });\n      },\n      ADD_ITEMS: function ADD_ITEMS(_ref6) {\n        var items = _ref6.items,\n            index = _ref6.index,\n            interactionMethod = _ref6.interactionMethod,\n            _ref6$success = _ref6.success,\n            success = _ref6$success === void 0 ? function () {} : _ref6$success,\n            _ref6$failure = _ref6.failure,\n            failure = _ref6$failure === void 0 ? function () {} : _ref6$failure;\n        var currentIndex = index;\n\n        if (index === -1 || typeof index === 'undefined') {\n          var insertLocation = query('GET_ITEM_INSERT_LOCATION');\n          var totalItems = query('GET_TOTAL_ITEMS');\n          currentIndex = insertLocation === 'before' ? 0 : totalItems;\n        }\n\n        var ignoredFiles = query('GET_IGNORED_FILES');\n\n        var isValidFile = function isValidFile(source) {\n          return isFile(source) ? !ignoredFiles.includes(source.name.toLowerCase()) : !isEmpty(source);\n        };\n\n        var validItems = items.filter(isValidFile);\n        var promises = validItems.map(function (source) {\n          return new Promise(function (resolve, reject) {\n            dispatch('ADD_ITEM', {\n              interactionMethod: interactionMethod,\n              source: source.source || source,\n              success: resolve,\n              failure: reject,\n              index: currentIndex++,\n              options: source.options || {}\n            });\n          });\n        });\n        Promise.all(promises).then(success).catch(failure);\n      },\n\n      /**\n       * @param source\n       * @param index\n       * @param interactionMethod\n       */\n      ADD_ITEM: function ADD_ITEM(_ref7) {\n        var source = _ref7.source,\n            _ref7$index = _ref7.index,\n            index = _ref7$index === void 0 ? -1 : _ref7$index,\n            interactionMethod = _ref7.interactionMethod,\n            _ref7$success = _ref7.success,\n            success = _ref7$success === void 0 ? function () {} : _ref7$success,\n            _ref7$failure = _ref7.failure,\n            failure = _ref7$failure === void 0 ? function () {} : _ref7$failure,\n            _ref7$options = _ref7.options,\n            options = _ref7$options === void 0 ? {} : _ref7$options; // if no source supplied\n\n        if (isEmpty(source)) {\n          failure({\n            error: createResponse('error', 0, 'No source'),\n            file: null\n          });\n          return;\n        } // filter out invalid file items, used to filter dropped directory contents\n\n\n        if (isFile(source) && state.options.ignoredFiles.includes(source.name.toLowerCase())) {\n          // fail silently\n          return;\n        } // test if there's still room in the list of files\n\n\n        if (!hasRoomForItem(state)) {\n          // if multiple allowed, we can't replace\n          // or if only a single item is allowed but we're not allowed to replace it we exit\n          if (state.options.allowMultiple || !state.options.allowMultiple && !state.options.allowReplace) {\n            var error = createResponse('warning', 0, 'Max files');\n            dispatch('DID_THROW_MAX_FILES', {\n              source: source,\n              error: error\n            });\n            failure({\n              error: error,\n              file: null\n            });\n            return;\n          } // let's replace the item\n          // id of first item we're about to remove\n\n\n          var _item = getActiveItems(state.items)[0]; // if has been processed remove it from the server as well\n\n          if (_item.status === ItemStatus.PROCESSING_COMPLETE || _item.status === ItemStatus.PROCESSING_REVERT_ERROR) {\n            var forceRevert = query('GET_FORCE_REVERT');\n\n            _item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), forceRevert).then(function () {\n              if (!forceRevert) return; // try to add now\n\n              dispatch('ADD_ITEM', {\n                source: source,\n                index: index,\n                interactionMethod: interactionMethod,\n                success: success,\n                failure: failure,\n                options: options\n              });\n            }).catch(function () {}); // no need to handle this catch state for now\n\n\n            if (forceRevert) return;\n          } // remove first item as it will be replaced by this item\n\n\n          dispatch('REMOVE_ITEM', {\n            query: _item.id\n          });\n        } // where did the file originate\n\n\n        var origin = options.type === 'local' ? FileOrigin.LOCAL : options.type === 'limbo' ? FileOrigin.LIMBO : FileOrigin.INPUT; // create a new blank item\n\n        var item = createItem( // where did this file come from\n        origin, // an input file never has a server file reference\n        origin === FileOrigin.INPUT ? null : source, // file mock data, if defined\n        options.file); // set initial meta data\n\n        Object.keys(options.metadata || {}).forEach(function (key) {\n          item.setMetadata(key, options.metadata[key]);\n        }); // created the item, let plugins add methods\n\n        applyFilters('DID_CREATE_ITEM', item, {\n          query: query,\n          dispatch: dispatch\n        }); // where to insert new items\n\n        var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION'); // adjust index if is not allowed to pick location\n\n        if (!state.options.itemInsertLocationFreedom) {\n          index = itemInsertLocation === 'before' ? -1 : state.items.length;\n        } // add item to list\n\n\n        insertItem(state.items, item, index); // sort items in list\n\n        if (isFunction(itemInsertLocation) && source) {\n          sortItems(state, itemInsertLocation);\n        } // get a quick reference to the item id\n\n\n        var id = item.id; // observe item events\n\n        item.on('init', function () {\n          dispatch('DID_INIT_ITEM', {\n            id: id\n          });\n        });\n        item.on('load-init', function () {\n          dispatch('DID_START_ITEM_LOAD', {\n            id: id\n          });\n        });\n        item.on('load-meta', function () {\n          dispatch('DID_UPDATE_ITEM_META', {\n            id: id\n          });\n        });\n        item.on('load-progress', function (progress) {\n          dispatch('DID_UPDATE_ITEM_LOAD_PROGRESS', {\n            id: id,\n            progress: progress\n          });\n        });\n        item.on('load-request-error', function (error) {\n          var mainStatus = dynamicLabel(state.options.labelFileLoadError)(error); // is client error, no way to recover\n\n          if (error.code >= 400 && error.code < 500) {\n            dispatch('DID_THROW_ITEM_INVALID', {\n              id: id,\n              error: error,\n              status: {\n                main: mainStatus,\n                sub: error.code + ' (' + error.body + ')'\n              }\n            }); // reject the file so can be dealt with through API\n\n            failure({\n              error: error,\n              file: createItemAPI(item)\n            });\n            return;\n          } // is possible server error, so might be possible to retry\n\n\n          dispatch('DID_THROW_ITEM_LOAD_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: mainStatus,\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n        item.on('load-file-error', function (error) {\n          dispatch('DID_THROW_ITEM_INVALID', {\n            id: id,\n            error: error.status,\n            status: error.status\n          });\n          failure({\n            error: error.status,\n            file: createItemAPI(item)\n          });\n        });\n        item.on('load-abort', function () {\n          dispatch('REMOVE_ITEM', {\n            query: id\n          });\n        });\n        item.on('load-skip', function () {\n          dispatch('COMPLETE_LOAD_ITEM', {\n            query: id,\n            item: item,\n            data: {\n              source: source,\n              success: success\n            }\n          });\n        });\n        item.on('load', function () {\n          var handleAdd = function handleAdd(shouldAdd) {\n            // no should not add this file\n            if (!shouldAdd) {\n              dispatch('REMOVE_ITEM', {\n                query: id\n              });\n              return;\n            } // now interested in metadata updates\n\n\n            item.on('metadata-update', function (change) {\n              dispatch('DID_UPDATE_ITEM_METADATA', {\n                id: id,\n                change: change\n              });\n            }); // let plugins decide if the output data should be prepared at this point\n            // means we'll do this and wait for idle state\n\n            applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {\n              item: item,\n              query: query\n            }).then(function (shouldPrepareOutput) {\n              var loadComplete = function loadComplete() {\n                dispatch('COMPLETE_LOAD_ITEM', {\n                  query: id,\n                  item: item,\n                  data: {\n                    source: source,\n                    success: success\n                  }\n                });\n                listUpdated(dispatch, state);\n              }; // exit\n\n\n              if (shouldPrepareOutput) {\n                // wait for idle state and then run PREPARE_OUTPUT\n                dispatch('REQUEST_PREPARE_OUTPUT', {\n                  query: id,\n                  item: item,\n                  success: function success(file) {\n                    dispatch('DID_PREPARE_OUTPUT', {\n                      id: id,\n                      file: file\n                    });\n                    loadComplete();\n                  }\n                }, true);\n                return;\n              }\n\n              loadComplete();\n            });\n          }; // item loaded, allow plugins to\n          // - read data (quickly)\n          // - add metadata\n\n\n          applyFilterChain('DID_LOAD_ITEM', item, {\n            query: query,\n            dispatch: dispatch\n          }).then(function () {\n            optionalPromise(query('GET_BEFORE_ADD_FILE'), createItemAPI(item)).then(handleAdd);\n          }).catch(function () {\n            handleAdd(false);\n          });\n        });\n        item.on('process-start', function () {\n          dispatch('DID_START_ITEM_PROCESSING', {\n            id: id\n          });\n        });\n        item.on('process-progress', function (progress) {\n          dispatch('DID_UPDATE_ITEM_PROCESS_PROGRESS', {\n            id: id,\n            progress: progress\n          });\n        });\n        item.on('process-error', function (error) {\n          dispatch('DID_THROW_ITEM_PROCESSING_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: dynamicLabel(state.options.labelFileProcessingError)(error),\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n        item.on('process-revert-error', function (error) {\n          dispatch('DID_THROW_ITEM_PROCESSING_REVERT_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: dynamicLabel(state.options.labelFileProcessingRevertError)(error),\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n        item.on('process-complete', function (serverFileReference) {\n          dispatch('DID_COMPLETE_ITEM_PROCESSING', {\n            id: id,\n            error: null,\n            serverFileReference: serverFileReference\n          });\n          dispatch('DID_DEFINE_VALUE', {\n            id: id,\n            value: serverFileReference\n          });\n        });\n        item.on('process-abort', function () {\n          dispatch('DID_ABORT_ITEM_PROCESSING', {\n            id: id\n          });\n        });\n        item.on('process-revert', function () {\n          dispatch('DID_REVERT_ITEM_PROCESSING', {\n            id: id\n          });\n          dispatch('DID_DEFINE_VALUE', {\n            id: id,\n            value: null\n          });\n        }); // let view know the item has been inserted\n\n        dispatch('DID_ADD_ITEM', {\n          id: id,\n          index: index,\n          interactionMethod: interactionMethod\n        });\n        listUpdated(dispatch, state); // start loading the source\n\n        var _ref8 = state.options.server || {},\n            url = _ref8.url,\n            load = _ref8.load,\n            restore = _ref8.restore,\n            fetch = _ref8.fetch;\n\n        item.load(source, // this creates a function that loads the file based on the type of file (string, base64, blob, file) and location of file (local, remote, limbo)\n        createFileLoader(origin === FileOrigin.INPUT ? // input, if is remote, see if should use custom fetch, else use default fetchBlob\n        isString(source) && isExternalURL(source) ? fetch ? createFetchFunction(url, fetch) : fetchBlob // remote url\n        : fetchBlob // try to fetch url\n        : // limbo or local\n        origin === FileOrigin.LIMBO ? createFetchFunction(url, restore) // limbo\n        : createFetchFunction(url, load) // local\n        ), // called when the file is loaded so it can be piped through the filters\n        function (file, success, error) {\n          // let's process the file\n          applyFilterChain('LOAD_FILE', file, {\n            query: query\n          }).then(success).catch(error);\n        });\n      },\n      REQUEST_PREPARE_OUTPUT: function REQUEST_PREPARE_OUTPUT(_ref9) {\n        var item = _ref9.item,\n            success = _ref9.success,\n            _ref9$failure = _ref9.failure,\n            failure = _ref9$failure === void 0 ? function () {} : _ref9$failure; // error response if item archived\n\n        var err = {\n          error: createResponse('error', 0, 'Item not found'),\n          file: null\n        }; // don't handle archived items, an item could have been archived (load aborted) while waiting to be prepared\n\n        if (item.archived) return failure(err); // allow plugins to alter the file data\n\n        applyFilterChain('PREPARE_OUTPUT', item.file, {\n          query: query,\n          item: item\n        }).then(function (result) {\n          applyFilterChain('COMPLETE_PREPARE_OUTPUT', result, {\n            query: query,\n            item: item\n          }).then(function (result) {\n            // don't handle archived items, an item could have been archived (load aborted) while being prepared\n            if (item.archived) return failure(err); // we done!\n\n            success(result);\n          });\n        });\n      },\n      COMPLETE_LOAD_ITEM: function COMPLETE_LOAD_ITEM(_ref10) {\n        var item = _ref10.item,\n            data = _ref10.data;\n        var success = data.success,\n            source = data.source; // sort items in list\n\n        var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION');\n\n        if (isFunction(itemInsertLocation) && source) {\n          sortItems(state, itemInsertLocation);\n        } // let interface know the item has loaded\n\n\n        dispatch('DID_LOAD_ITEM', {\n          id: item.id,\n          error: null,\n          serverFileReference: item.origin === FileOrigin.INPUT ? null : source\n        }); // item has been successfully loaded and added to the\n        // list of items so can now be safely returned for use\n\n        success(createItemAPI(item)); // if this is a local server file we need to show a different state\n\n        if (item.origin === FileOrigin.LOCAL) {\n          dispatch('DID_LOAD_LOCAL_ITEM', {\n            id: item.id\n          });\n          return;\n        } // if is a temp server file we prevent async upload call here (as the file is already on the server)\n\n\n        if (item.origin === FileOrigin.LIMBO) {\n          dispatch('DID_COMPLETE_ITEM_PROCESSING', {\n            id: item.id,\n            error: null,\n            serverFileReference: source\n          });\n          dispatch('DID_DEFINE_VALUE', {\n            id: item.id,\n            value: source\n          });\n          return;\n        } // id we are allowed to upload the file immidiately, lets do it\n\n\n        if (query('IS_ASYNC') && state.options.instantUpload) {\n          dispatch('REQUEST_ITEM_PROCESSING', {\n            query: item.id\n          });\n        }\n      },\n      RETRY_ITEM_LOAD: getItemByQueryFromState(state, function (item) {\n        // try loading the source one more time\n        item.retryLoad();\n      }),\n      REQUEST_ITEM_PREPARE: getItemByQueryFromState(state, function (item, _success, failure) {\n        dispatch('REQUEST_PREPARE_OUTPUT', {\n          query: item.id,\n          item: item,\n          success: function success(file) {\n            dispatch('DID_PREPARE_OUTPUT', {\n              id: item.id,\n              file: file\n            });\n\n            _success({\n              file: item,\n              output: file\n            });\n          },\n          failure: failure\n        }, true);\n      }),\n      REQUEST_ITEM_PROCESSING: getItemByQueryFromState(state, function (item, success, failure) {\n        // cannot be queued (or is already queued)\n        var itemCanBeQueuedForProcessing = // waiting for something\n        item.status === ItemStatus.IDLE || // processing went wrong earlier\n        item.status === ItemStatus.PROCESSING_ERROR; // not ready to be processed\n\n        if (!itemCanBeQueuedForProcessing) {\n          var processNow = function processNow() {\n            return dispatch('REQUEST_ITEM_PROCESSING', {\n              query: item,\n              success: success,\n              failure: failure\n            });\n          };\n\n          var process = function process() {\n            return document.hidden ? processNow() : setTimeout(processNow, 32);\n          }; // if already done processing or tried to revert but didn't work, try again\n\n\n          if (item.status === ItemStatus.PROCESSING_COMPLETE || item.status === ItemStatus.PROCESSING_REVERT_ERROR) {\n            item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), query('GET_FORCE_REVERT')).then(process).catch(function () {}); // don't continue with processing if something went wrong\n          } else if (item.status === ItemStatus.PROCESSING) {\n            item.abortProcessing().then(process);\n          }\n\n          return;\n        } // already queued for processing\n\n\n        if (item.status === ItemStatus.PROCESSING_QUEUED) return;\n        item.requestProcessing();\n        dispatch('DID_REQUEST_ITEM_PROCESSING', {\n          id: item.id\n        });\n        dispatch('PROCESS_ITEM', {\n          query: item,\n          success: success,\n          failure: failure\n        }, true);\n      }),\n      PROCESS_ITEM: getItemByQueryFromState(state, function (item, success, failure) {\n        var maxParallelUploads = query('GET_MAX_PARALLEL_UPLOADS');\n        var totalCurrentUploads = query('GET_ITEMS_BY_STATUS', ItemStatus.PROCESSING).length; // queue and wait till queue is freed up\n\n        if (totalCurrentUploads === maxParallelUploads) {\n          // queue for later processing\n          state.processingQueue.push({\n            id: item.id,\n            success: success,\n            failure: failure\n          }); // stop it!\n\n          return;\n        } // if was not queued or is already processing exit here\n\n\n        if (item.status === ItemStatus.PROCESSING) return;\n\n        var processNext = function processNext() {\n          // process queueud items\n          var queueEntry = state.processingQueue.shift(); // no items left\n\n          if (!queueEntry) return; // get item reference\n\n          var id = queueEntry.id,\n              success = queueEntry.success,\n              failure = queueEntry.failure;\n          var itemReference = getItemByQuery(state.items, id); // if item was archived while in queue, jump to next\n\n          if (!itemReference || itemReference.archived) {\n            processNext();\n            return;\n          } // process queued item\n\n\n          dispatch('PROCESS_ITEM', {\n            query: id,\n            success: success,\n            failure: failure\n          }, true);\n        }; // we done function\n\n\n        item.onOnce('process-complete', function () {\n          success(createItemAPI(item));\n          processNext(); // All items processed? No errors?\n\n          var allItemsProcessed = query('GET_ITEMS_BY_STATUS', ItemStatus.PROCESSING_COMPLETE).length === state.items.length;\n\n          if (allItemsProcessed) {\n            dispatch('DID_COMPLETE_ITEM_PROCESSING_ALL');\n          }\n        }); // we error function\n\n        item.onOnce('process-error', function (error) {\n          failure({\n            error: error,\n            file: createItemAPI(item)\n          });\n          processNext();\n        }); // start file processing\n\n        var options = state.options;\n        item.process(createFileProcessor(createProcessorFunction(options.server.url, options.server.process, options.name, {\n          chunkTransferId: item.transferId,\n          chunkServer: options.server.patch,\n          chunkUploads: options.chunkUploads,\n          chunkForce: options.chunkForce,\n          chunkSize: options.chunkSize,\n          chunkRetryDelays: options.chunkRetryDelays\n        })), // called when the file is about to be processed so it can be piped through the transform filters\n        function (file, success, error) {\n          // allow plugins to alter the file data\n          applyFilterChain('PREPARE_OUTPUT', file, {\n            query: query,\n            item: item\n          }).then(function (file) {\n            dispatch('DID_PREPARE_OUTPUT', {\n              id: item.id,\n              file: file\n            });\n            success(file);\n          }).catch(error);\n        });\n      }),\n      RETRY_ITEM_PROCESSING: getItemByQueryFromState(state, function (item) {\n        dispatch('REQUEST_ITEM_PROCESSING', {\n          query: item\n        });\n      }),\n      REQUEST_REMOVE_ITEM: getItemByQueryFromState(state, function (item) {\n        optionalPromise(query('GET_BEFORE_REMOVE_FILE'), createItemAPI(item)).then(function (shouldRemove) {\n          if (!shouldRemove) {\n            return;\n          }\n\n          dispatch('REMOVE_ITEM', {\n            query: item\n          });\n        });\n      }),\n      RELEASE_ITEM: getItemByQueryFromState(state, function (item) {\n        item.release();\n      }),\n      REMOVE_ITEM: getItemByQueryFromState(state, function (item, success, failure, options) {\n        var removeFromView = function removeFromView() {\n          // get id reference\n          var id = item.id; // archive the item, this does not remove it from the list\n\n          getItemById(state.items, id).archive(); // tell the view the item has been removed\n\n          dispatch('DID_REMOVE_ITEM', {\n            error: null,\n            id: id,\n            item: item\n          }); // now the list has been modified\n\n          listUpdated(dispatch, state); // correctly removed\n\n          success(createItemAPI(item));\n        }; // if this is a local file and the server.remove function has been configured, send source there so dev can remove file from server\n\n\n        var server = state.options.server;\n\n        if (item.origin === FileOrigin.LOCAL && server && isFunction(server.remove) && options.remove !== false) {\n          dispatch('DID_START_ITEM_REMOVE', {\n            id: item.id\n          });\n          server.remove(item.source, function () {\n            return removeFromView();\n          }, function (status) {\n            dispatch('DID_THROW_ITEM_REMOVE_ERROR', {\n              id: item.id,\n              error: createResponse('error', 0, status, null),\n              status: {\n                main: dynamicLabel(state.options.labelFileRemoveError)(status),\n                sub: state.options.labelTapToRetry\n              }\n            });\n          });\n        } else {\n          // if is requesting revert and can revert need to call revert handler (not calling request_ because that would also trigger beforeRemoveHook)\n          if (options.revert && item.origin !== FileOrigin.LOCAL && item.serverId !== null) {\n            item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), query('GET_FORCE_REVERT'));\n          } // can now safely remove from view\n\n\n          removeFromView();\n        }\n      }),\n      ABORT_ITEM_LOAD: getItemByQueryFromState(state, function (item) {\n        item.abortLoad();\n      }),\n      ABORT_ITEM_PROCESSING: getItemByQueryFromState(state, function (item) {\n        // test if is already processed\n        if (item.serverId) {\n          dispatch('REVERT_ITEM_PROCESSING', {\n            id: item.id\n          });\n          return;\n        } // abort\n\n\n        item.abortProcessing().then(function () {\n          var shouldRemove = state.options.instantUpload;\n\n          if (shouldRemove) {\n            dispatch('REMOVE_ITEM', {\n              query: item.id\n            });\n          }\n        });\n      }),\n      REQUEST_REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function (item) {\n        // not instant uploading, revert immidiately\n        if (!state.options.instantUpload) {\n          dispatch('REVERT_ITEM_PROCESSING', {\n            query: item\n          });\n          return;\n        } // if we're instant uploading the file will also be removed if we revert,\n        // so if a before remove file hook is defined we need to run it now\n\n\n        var handleRevert = function handleRevert(shouldRevert) {\n          if (!shouldRevert) return;\n          dispatch('REVERT_ITEM_PROCESSING', {\n            query: item\n          });\n        };\n\n        var fn = query('GET_BEFORE_REMOVE_FILE');\n\n        if (!fn) {\n          return handleRevert(true);\n        }\n\n        var requestRemoveResult = fn(createItemAPI(item));\n\n        if (requestRemoveResult == null) {\n          // undefined or null\n          return handleRevert(true);\n        }\n\n        if (typeof requestRemoveResult === 'boolean') {\n          return handleRevert(requestRemoveResult);\n        }\n\n        if (typeof requestRemoveResult.then === 'function') {\n          requestRemoveResult.then(handleRevert);\n        }\n      }),\n      REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function (item) {\n        item.revert(createRevertFunction(state.options.server.url, state.options.server.revert), query('GET_FORCE_REVERT')).then(function () {\n          var shouldRemove = state.options.instantUpload || isMockItem(item);\n\n          if (shouldRemove) {\n            dispatch('REMOVE_ITEM', {\n              query: item.id\n            });\n          }\n        }).catch(function () {});\n      }),\n      SET_OPTIONS: function SET_OPTIONS(_ref11) {\n        var options = _ref11.options;\n        forin(options, function (key, value) {\n          dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {\n            value: value\n          });\n        });\n      }\n    };\n  };\n\n  var formatFilename = function formatFilename(name) {\n    return name;\n  };\n\n  var createElement$1 = function createElement(tagName) {\n    return document.createElement(tagName);\n  };\n\n  var text = function text(node, value) {\n    var textNode = node.childNodes[0];\n\n    if (!textNode) {\n      textNode = document.createTextNode(value);\n      node.appendChild(textNode);\n    } else if (value !== textNode.nodeValue) {\n      textNode.nodeValue = value;\n    }\n  };\n\n  var polarToCartesian = function polarToCartesian(centerX, centerY, radius, angleInDegrees) {\n    var angleInRadians = (angleInDegrees % 360 - 90) * Math.PI / 180.0;\n    return {\n      x: centerX + radius * Math.cos(angleInRadians),\n      y: centerY + radius * Math.sin(angleInRadians)\n    };\n  };\n\n  var describeArc = function describeArc(x, y, radius, startAngle, endAngle, arcSweep) {\n    var start = polarToCartesian(x, y, radius, endAngle);\n    var end = polarToCartesian(x, y, radius, startAngle);\n    return ['M', start.x, start.y, 'A', radius, radius, 0, arcSweep, 0, end.x, end.y].join(' ');\n  };\n\n  var percentageArc = function percentageArc(x, y, radius, from, to) {\n    var arcSweep = 1;\n\n    if (to > from && to - from <= 0.5) {\n      arcSweep = 0;\n    }\n\n    if (from > to && from - to >= 0.5) {\n      arcSweep = 0;\n    }\n\n    return describeArc(x, y, radius, Math.min(0.9999, from) * 360, Math.min(0.9999, to) * 360, arcSweep);\n  };\n\n  var create = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // start at 0\n\n    props.spin = false;\n    props.progress = 0;\n    props.opacity = 0; // svg\n\n    var svg = createElement('svg');\n    root.ref.path = createElement('path', {\n      'stroke-width': 2,\n      'stroke-linecap': 'round'\n    });\n    svg.appendChild(root.ref.path);\n    root.ref.svg = svg;\n    root.appendChild(svg);\n  };\n\n  var write = function write(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props;\n\n    if (props.opacity === 0) {\n      return;\n    }\n\n    if (props.align) {\n      root.element.dataset.align = props.align;\n    } // get width of stroke\n\n\n    var ringStrokeWidth = parseInt(attr(root.ref.path, 'stroke-width'), 10); // calculate size of ring\n\n    var size = root.rect.element.width * 0.5; // ring state\n\n    var ringFrom = 0;\n    var ringTo = 0; // now in busy mode\n\n    if (props.spin) {\n      ringFrom = 0;\n      ringTo = 0.5;\n    } else {\n      ringFrom = 0;\n      ringTo = props.progress;\n    } // get arc path\n\n\n    var coordinates = percentageArc(size, size, size - ringStrokeWidth, ringFrom, ringTo); // update progress bar\n\n    attr(root.ref.path, 'd', coordinates); // hide while contains 0 value\n\n    attr(root.ref.path, 'stroke-opacity', props.spin || props.progress > 0 ? 1 : 0);\n  };\n\n  var progressIndicator = createView({\n    tag: 'div',\n    name: 'progress-indicator',\n    ignoreRectUpdate: true,\n    ignoreRect: true,\n    create: create,\n    write: write,\n    mixins: {\n      apis: ['progress', 'spin', 'align'],\n      styles: ['opacity'],\n      animations: {\n        opacity: {\n          type: 'tween',\n          duration: 500\n        },\n        progress: {\n          type: 'spring',\n          stiffness: 0.95,\n          damping: 0.65,\n          mass: 10\n        }\n      }\n    }\n  });\n\n  var create$1 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props;\n    root.element.innerHTML = (props.icon || '') + ('<span>' + props.label + '</span>');\n    props.isDisabled = false;\n  };\n\n  var write$1 = function write(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props;\n    var isDisabled = props.isDisabled;\n    var shouldDisable = root.query('GET_DISABLED') || props.opacity === 0;\n\n    if (shouldDisable && !isDisabled) {\n      props.isDisabled = true;\n      attr(root.element, 'disabled', 'disabled');\n    } else if (!shouldDisable && isDisabled) {\n      props.isDisabled = false;\n      root.element.removeAttribute('disabled');\n    }\n  };\n\n  var fileActionButton = createView({\n    tag: 'button',\n    attributes: {\n      type: 'button'\n    },\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    name: 'file-action-button',\n    mixins: {\n      apis: ['label'],\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        translateX: 'spring',\n        translateY: 'spring',\n        opacity: {\n          type: 'tween',\n          duration: 250\n        }\n      },\n      listeners: true\n    },\n    create: create$1,\n    write: write$1\n  });\n\n  var toNaturalFileSize = function toNaturalFileSize(bytes) {\n    var decimalSeparator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.'; // nope, no negative byte sizes\n\n    bytes = Math.round(Math.abs(bytes)); // just bytes\n\n    if (bytes < 1000) {\n      return bytes + ' bytes';\n    } // kilobytes\n\n\n    if (bytes < MB) {\n      return Math.floor(bytes / KB) + ' KB';\n    } // megabytes\n\n\n    if (bytes < GB) {\n      return removeDecimalsWhenZero(bytes / MB, 1, decimalSeparator) + ' MB';\n    } // gigabytes\n\n\n    return removeDecimalsWhenZero(bytes / GB, 2, decimalSeparator) + ' GB';\n  };\n\n  var KB = 1000;\n  var MB = 1000000;\n  var GB = 1000000000;\n\n  var removeDecimalsWhenZero = function removeDecimalsWhenZero(value, decimalCount, separator) {\n    return value.toFixed(decimalCount).split('.').filter(function (part) {\n      return part !== '0';\n    }).join(separator);\n  };\n\n  var create$2 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // filename\n\n    var fileName = createElement$1('span');\n    fileName.className = 'filepond--file-info-main'; // hide for screenreaders\n    // the file is contained in a fieldset with legend that contains the filename\n    // no need to read it twice\n\n    attr(fileName, 'aria-hidden', 'true');\n    root.appendChild(fileName);\n    root.ref.fileName = fileName; // filesize\n\n    var fileSize = createElement$1('span');\n    fileSize.className = 'filepond--file-info-sub';\n    root.appendChild(fileSize);\n    root.ref.fileSize = fileSize; // set initial values\n\n    text(fileSize, root.query('GET_LABEL_FILE_WAITING_FOR_SIZE'));\n    text(fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));\n  };\n\n  var updateFile = function updateFile(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props;\n    text(root.ref.fileSize, toNaturalFileSize(root.query('GET_ITEM_SIZE', props.id)));\n    text(root.ref.fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));\n  };\n\n  var updateFileSizeOnError = function updateFileSizeOnError(_ref3) {\n    var root = _ref3.root,\n        props = _ref3.props; // if size is available don't fallback to unknown size message\n\n    if (isInt(root.query('GET_ITEM_SIZE', props.id))) {\n      return;\n    }\n\n    text(root.ref.fileSize, root.query('GET_LABEL_FILE_SIZE_NOT_AVAILABLE'));\n  };\n\n  var fileInfo = createView({\n    name: 'file-info',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: updateFile,\n      DID_UPDATE_ITEM_META: updateFile,\n      DID_THROW_ITEM_LOAD_ERROR: updateFileSizeOnError,\n      DID_THROW_ITEM_INVALID: updateFileSizeOnError\n    }),\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, {\n        view: root\n      }));\n    },\n    create: create$2,\n    mixins: {\n      styles: ['translateX', 'translateY'],\n      animations: {\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var toPercentage = function toPercentage(value) {\n    return Math.round(value * 100);\n  };\n\n  var create$3 = function create(_ref) {\n    var root = _ref.root; // main status\n\n    var main = createElement$1('span');\n    main.className = 'filepond--file-status-main';\n    root.appendChild(main);\n    root.ref.main = main; // sub status\n\n    var sub = createElement$1('span');\n    sub.className = 'filepond--file-status-sub';\n    root.appendChild(sub);\n    root.ref.sub = sub;\n    didSetItemLoadProgress({\n      root: root,\n      action: {\n        progress: null\n      }\n    });\n  };\n\n  var didSetItemLoadProgress = function didSetItemLoadProgress(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n    var title = action.progress === null ? root.query('GET_LABEL_FILE_LOADING') : root.query('GET_LABEL_FILE_LOADING') + ' ' + toPercentage(action.progress) + '%';\n    text(root.ref.main, title);\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didSetItemProcessProgress = function didSetItemProcessProgress(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n    var title = action.progress === null ? root.query('GET_LABEL_FILE_PROCESSING') : root.query('GET_LABEL_FILE_PROCESSING') + ' ' + toPercentage(action.progress) + '%';\n    text(root.ref.main, title);\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didRequestItemProcessing = function didRequestItemProcessing(_ref4) {\n    var root = _ref4.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didAbortItemProcessing = function didAbortItemProcessing(_ref5) {\n    var root = _ref5.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_ABORTED'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_RETRY'));\n  };\n\n  var didCompleteItemProcessing = function didCompleteItemProcessing(_ref6) {\n    var root = _ref6.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_COMPLETE'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_UNDO'));\n  };\n\n  var clear = function clear(_ref7) {\n    var root = _ref7.root;\n    text(root.ref.main, '');\n    text(root.ref.sub, '');\n  };\n\n  var error = function error(_ref8) {\n    var root = _ref8.root,\n        action = _ref8.action;\n    text(root.ref.main, action.status.main);\n    text(root.ref.sub, action.status.sub);\n  };\n\n  var fileStatus = createView({\n    name: 'file-status',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: clear,\n      DID_REVERT_ITEM_PROCESSING: clear,\n      DID_REQUEST_ITEM_PROCESSING: didRequestItemProcessing,\n      DID_ABORT_ITEM_PROCESSING: didAbortItemProcessing,\n      DID_COMPLETE_ITEM_PROCESSING: didCompleteItemProcessing,\n      DID_UPDATE_ITEM_PROCESS_PROGRESS: didSetItemProcessProgress,\n      DID_UPDATE_ITEM_LOAD_PROGRESS: didSetItemLoadProgress,\n      DID_THROW_ITEM_LOAD_ERROR: error,\n      DID_THROW_ITEM_INVALID: error,\n      DID_THROW_ITEM_PROCESSING_ERROR: error,\n      DID_THROW_ITEM_PROCESSING_REVERT_ERROR: error,\n      DID_THROW_ITEM_REMOVE_ERROR: error\n    }),\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, {\n        view: root\n      }));\n    },\n    create: create$3,\n    mixins: {\n      styles: ['translateX', 'translateY', 'opacity'],\n      animations: {\n        opacity: {\n          type: 'tween',\n          duration: 250\n        },\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n  /**\n   * Button definitions for the file view\n   */\n\n  var Buttons = {\n    AbortItemLoad: {\n      label: 'GET_LABEL_BUTTON_ABORT_ITEM_LOAD',\n      action: 'ABORT_ITEM_LOAD',\n      className: 'filepond--action-abort-item-load',\n      align: 'LOAD_INDICATOR_POSITION' // right\n\n    },\n    RetryItemLoad: {\n      label: 'GET_LABEL_BUTTON_RETRY_ITEM_LOAD',\n      action: 'RETRY_ITEM_LOAD',\n      icon: 'GET_ICON_RETRY',\n      className: 'filepond--action-retry-item-load',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    },\n    RemoveItem: {\n      label: 'GET_LABEL_BUTTON_REMOVE_ITEM',\n      action: 'REQUEST_REMOVE_ITEM',\n      icon: 'GET_ICON_REMOVE',\n      className: 'filepond--action-remove-item',\n      align: 'BUTTON_REMOVE_ITEM_POSITION' // left\n\n    },\n    ProcessItem: {\n      label: 'GET_LABEL_BUTTON_PROCESS_ITEM',\n      action: 'REQUEST_ITEM_PROCESSING',\n      icon: 'GET_ICON_PROCESS',\n      className: 'filepond--action-process-item',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    },\n    AbortItemProcessing: {\n      label: 'GET_LABEL_BUTTON_ABORT_ITEM_PROCESSING',\n      action: 'ABORT_ITEM_PROCESSING',\n      className: 'filepond--action-abort-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    },\n    RetryItemProcessing: {\n      label: 'GET_LABEL_BUTTON_RETRY_ITEM_PROCESSING',\n      action: 'RETRY_ITEM_PROCESSING',\n      icon: 'GET_ICON_RETRY',\n      className: 'filepond--action-retry-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    },\n    RevertItemProcessing: {\n      label: 'GET_LABEL_BUTTON_UNDO_ITEM_PROCESSING',\n      action: 'REQUEST_REVERT_ITEM_PROCESSING',\n      icon: 'GET_ICON_UNDO',\n      className: 'filepond--action-revert-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n\n    }\n  }; // make a list of buttons, we can then remove buttons from this list if they're disabled\n\n  var ButtonKeys = [];\n  forin(Buttons, function (key) {\n    ButtonKeys.push(key);\n  });\n\n  var calculateFileInfoOffset = function calculateFileInfoOffset(root) {\n    var buttonRect = root.ref.buttonRemoveItem.rect.element;\n    return buttonRect.hidden ? null : buttonRect.width + buttonRect.left;\n  };\n\n  var calculateButtonWidth = function calculateButtonWidth(root) {\n    var buttonRect = root.ref.buttonAbortItemLoad.rect.element;\n    return buttonRect.width;\n  }; // Force on full pixels so text stays crips\n\n\n  var calculateFileVerticalCenterOffset = function calculateFileVerticalCenterOffset(root) {\n    return Math.floor(root.ref.buttonRemoveItem.rect.element.height / 4);\n  };\n\n  var calculateFileHorizontalCenterOffset = function calculateFileHorizontalCenterOffset(root) {\n    return Math.floor(root.ref.buttonRemoveItem.rect.element.left / 2);\n  };\n\n  var getLoadIndicatorAlignment = function getLoadIndicatorAlignment(root) {\n    return root.query('GET_STYLE_LOAD_INDICATOR_POSITION');\n  };\n\n  var getProcessIndicatorAlignment = function getProcessIndicatorAlignment(root) {\n    return root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION');\n  };\n\n  var getRemoveIndicatorAligment = function getRemoveIndicatorAligment(root) {\n    return root.query('GET_STYLE_BUTTON_REMOVE_ITEM_POSITION');\n  };\n\n  var DefaultStyle = {\n    buttonAbortItemLoad: {\n      opacity: 0\n    },\n    buttonRetryItemLoad: {\n      opacity: 0\n    },\n    buttonRemoveItem: {\n      opacity: 0\n    },\n    buttonProcessItem: {\n      opacity: 0\n    },\n    buttonAbortItemProcessing: {\n      opacity: 0\n    },\n    buttonRetryItemProcessing: {\n      opacity: 0\n    },\n    buttonRevertItemProcessing: {\n      opacity: 0\n    },\n    loadProgressIndicator: {\n      opacity: 0,\n      align: getLoadIndicatorAlignment\n    },\n    processProgressIndicator: {\n      opacity: 0,\n      align: getProcessIndicatorAlignment\n    },\n    processingCompleteIndicator: {\n      opacity: 0,\n      scaleX: 0.75,\n      scaleY: 0.75\n    },\n    info: {\n      translateX: 0,\n      translateY: 0,\n      opacity: 0\n    },\n    status: {\n      translateX: 0,\n      translateY: 0,\n      opacity: 0\n    }\n  };\n  var IdleStyle = {\n    buttonRemoveItem: {\n      opacity: 1\n    },\n    buttonProcessItem: {\n      opacity: 1\n    },\n    info: {\n      translateX: calculateFileInfoOffset\n    },\n    status: {\n      translateX: calculateFileInfoOffset\n    }\n  };\n  var ProcessingStyle = {\n    buttonAbortItemProcessing: {\n      opacity: 1\n    },\n    processProgressIndicator: {\n      opacity: 1\n    },\n    status: {\n      opacity: 1\n    }\n  };\n  var StyleMap = {\n    DID_THROW_ITEM_INVALID: {\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        translateX: calculateFileInfoOffset,\n        opacity: 1\n      }\n    },\n    DID_START_ITEM_LOAD: {\n      buttonAbortItemLoad: {\n        opacity: 1\n      },\n      loadProgressIndicator: {\n        opacity: 1\n      },\n      status: {\n        opacity: 1\n      }\n    },\n    DID_THROW_ITEM_LOAD_ERROR: {\n      buttonRetryItemLoad: {\n        opacity: 1\n      },\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        opacity: 1\n      }\n    },\n    DID_START_ITEM_REMOVE: {\n      processProgressIndicator: {\n        opacity: 1,\n        align: getRemoveIndicatorAligment\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        opacity: 0\n      }\n    },\n    DID_THROW_ITEM_REMOVE_ERROR: {\n      processProgressIndicator: {\n        opacity: 0,\n        align: getRemoveIndicatorAligment\n      },\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        opacity: 1,\n        translateX: calculateFileInfoOffset\n      }\n    },\n    DID_LOAD_ITEM: IdleStyle,\n    DID_LOAD_LOCAL_ITEM: {\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        translateX: calculateFileInfoOffset\n      }\n    },\n    DID_START_ITEM_PROCESSING: ProcessingStyle,\n    DID_REQUEST_ITEM_PROCESSING: ProcessingStyle,\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: ProcessingStyle,\n    DID_COMPLETE_ITEM_PROCESSING: {\n      buttonRevertItemProcessing: {\n        opacity: 1\n      },\n      info: {\n        opacity: 1\n      },\n      status: {\n        opacity: 1\n      }\n    },\n    DID_THROW_ITEM_PROCESSING_ERROR: {\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      buttonRetryItemProcessing: {\n        opacity: 1\n      },\n      status: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      }\n    },\n    DID_THROW_ITEM_PROCESSING_REVERT_ERROR: {\n      buttonRevertItemProcessing: {\n        opacity: 1\n      },\n      status: {\n        opacity: 1\n      },\n      info: {\n        opacity: 1\n      }\n    },\n    DID_ABORT_ITEM_PROCESSING: {\n      buttonRemoveItem: {\n        opacity: 1\n      },\n      buttonProcessItem: {\n        opacity: 1\n      },\n      info: {\n        translateX: calculateFileInfoOffset\n      },\n      status: {\n        opacity: 1\n      }\n    },\n    DID_REVERT_ITEM_PROCESSING: IdleStyle\n  }; // complete indicator view\n\n  var processingCompleteIndicatorView = createView({\n    create: function create(_ref) {\n      var root = _ref.root;\n      root.element.innerHTML = root.query('GET_ICON_DONE');\n    },\n    name: 'processing-complete-indicator',\n    ignoreRect: true,\n    mixins: {\n      styles: ['scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        opacity: {\n          type: 'tween',\n          duration: 250\n        }\n      }\n    }\n  });\n  /**\n   * Creates the file view\n   */\n\n  var create$4 = function create(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props;\n    var id = props.id; // allow reverting upload\n\n    var allowRevert = root.query('GET_ALLOW_REVERT'); // allow processing upload\n\n    var allowProcess = root.query('GET_ALLOW_PROCESS'); // is instant uploading, need this to determine the icon of the undo button\n\n    var instantUpload = root.query('GET_INSTANT_UPLOAD'); // is async set up\n\n    var isAsync = root.query('IS_ASYNC'); // should align remove item buttons\n\n    var alignRemoveItemButton = root.query('GET_STYLE_BUTTON_REMOVE_ITEM_ALIGN'); // enabled buttons array\n\n    var buttonFilter;\n\n    if (isAsync) {\n      if (allowProcess && !allowRevert) {\n        // only remove revert button\n        buttonFilter = function buttonFilter(key) {\n          return !/RevertItemProcessing/.test(key);\n        };\n      } else if (!allowProcess && allowRevert) {\n        // only remove process button\n        buttonFilter = function buttonFilter(key) {\n          return !/ProcessItem|RetryItemProcessing|AbortItemProcessing/.test(key);\n        };\n      } else if (!allowProcess && !allowRevert) {\n        // remove all process buttons\n        buttonFilter = function buttonFilter(key) {\n          return !/Process/.test(key);\n        };\n      }\n    } else {\n      // no process controls available\n      buttonFilter = function buttonFilter(key) {\n        return !/Process/.test(key);\n      };\n    }\n\n    var enabledButtons = buttonFilter ? ButtonKeys.filter(buttonFilter) : ButtonKeys.concat(); // update icon and label for revert button when instant uploading\n\n    if (instantUpload && allowRevert) {\n      Buttons['RevertItemProcessing'].label = 'GET_LABEL_BUTTON_REMOVE_ITEM';\n      Buttons['RevertItemProcessing'].icon = 'GET_ICON_REMOVE';\n    } // remove last button (revert) if not allowed\n\n\n    if (isAsync && !allowRevert) {\n      var map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];\n      map.info.translateX = calculateFileHorizontalCenterOffset;\n      map.info.translateY = calculateFileVerticalCenterOffset;\n      map.status.translateY = calculateFileVerticalCenterOffset;\n      map.processingCompleteIndicator = {\n        opacity: 1,\n        scaleX: 1,\n        scaleY: 1\n      };\n    } // should align center\n\n\n    if (isAsync && !allowProcess) {\n      ['DID_START_ITEM_PROCESSING', 'DID_REQUEST_ITEM_PROCESSING', 'DID_UPDATE_ITEM_PROCESS_PROGRESS', 'DID_THROW_ITEM_PROCESSING_ERROR'].forEach(function (key) {\n        StyleMap[key].status.translateY = calculateFileVerticalCenterOffset;\n      });\n      StyleMap['DID_THROW_ITEM_PROCESSING_ERROR'].status.translateX = calculateButtonWidth;\n    } // move remove button to right\n\n\n    if (alignRemoveItemButton && allowRevert) {\n      Buttons['RevertItemProcessing'].align = 'BUTTON_REMOVE_ITEM_POSITION';\n      var _map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];\n      _map.info.translateX = calculateFileInfoOffset;\n      _map.status.translateY = calculateFileVerticalCenterOffset;\n      _map.processingCompleteIndicator = {\n        opacity: 1,\n        scaleX: 1,\n        scaleY: 1\n      };\n    } // create the button views\n\n\n    forin(Buttons, function (key, definition) {\n      // create button\n      var buttonView = root.createChildView(fileActionButton, {\n        label: root.query(definition.label),\n        icon: root.query(definition.icon),\n        opacity: 0\n      }); // should be appended?\n\n      if (enabledButtons.includes(key)) {\n        root.appendChildView(buttonView);\n      } // add position attribute\n\n\n      buttonView.element.dataset.align = root.query('GET_STYLE_' + definition.align); // add class\n\n      buttonView.element.classList.add(definition.className); // handle interactions\n\n      buttonView.on('click', function (e) {\n        e.stopPropagation();\n        root.dispatch(definition.action, {\n          query: id\n        });\n      }); // set reference\n\n      root.ref['button' + key] = buttonView;\n    }); // checkmark\n\n    root.ref.processingCompleteIndicator = root.appendChildView(root.createChildView(processingCompleteIndicatorView));\n    root.ref.processingCompleteIndicator.element.dataset.align = root.query('GET_STYLE_BUTTON_PROCESS_ITEM_POSITION'); // create file info view\n\n    root.ref.info = root.appendChildView(root.createChildView(fileInfo, {\n      id: id\n    })); // create file status view\n\n    root.ref.status = root.appendChildView(root.createChildView(fileStatus, {\n      id: id\n    })); // add progress indicators\n\n    var loadIndicatorView = root.appendChildView(root.createChildView(progressIndicator, {\n      opacity: 0,\n      align: root.query('GET_STYLE_LOAD_INDICATOR_POSITION')\n    }));\n    loadIndicatorView.element.classList.add('filepond--load-indicator');\n    root.ref.loadProgressIndicator = loadIndicatorView;\n    var progressIndicatorView = root.appendChildView(root.createChildView(progressIndicator, {\n      opacity: 0,\n      align: root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION')\n    }));\n    progressIndicatorView.element.classList.add('filepond--process-indicator');\n    root.ref.processProgressIndicator = progressIndicatorView; // current active styles\n\n    root.ref.activeStyles = [];\n  };\n\n  var write$2 = function write(_ref3) {\n    var root = _ref3.root,\n        actions = _ref3.actions,\n        props = _ref3.props; // route actions\n\n    route({\n      root: root,\n      actions: actions,\n      props: props\n    }); // select last state change action\n\n    var action = actions.concat().filter(function (action) {\n      return /^DID_/.test(action.type);\n    }).reverse().find(function (action) {\n      return StyleMap[action.type];\n    }); // a new action happened, let's get the matching styles\n\n    if (action) {\n      // define new active styles\n      root.ref.activeStyles = [];\n      var stylesToApply = StyleMap[action.type];\n      forin(DefaultStyle, function (name, defaultStyles) {\n        // get reference to control\n        var control = root.ref[name]; // loop over all styles for this control\n\n        forin(defaultStyles, function (key, defaultValue) {\n          var value = stylesToApply[name] && typeof stylesToApply[name][key] !== 'undefined' ? stylesToApply[name][key] : defaultValue;\n          root.ref.activeStyles.push({\n            control: control,\n            key: key,\n            value: value\n          });\n        });\n      });\n    } // apply active styles to element\n\n\n    root.ref.activeStyles.forEach(function (_ref4) {\n      var control = _ref4.control,\n          key = _ref4.key,\n          value = _ref4.value;\n      control[key] = typeof value === 'function' ? value(root) : value;\n    });\n  };\n\n  var route = createRoute({\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING: function DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING(_ref5) {\n      var root = _ref5.root,\n          action = _ref5.action;\n      root.ref.buttonAbortItemProcessing.label = action.value;\n    },\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD: function DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD(_ref6) {\n      var root = _ref6.root,\n          action = _ref6.action;\n      root.ref.buttonAbortItemLoad.label = action.value;\n    },\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL: function DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL(_ref7) {\n      var root = _ref7.root,\n          action = _ref7.action;\n      root.ref.buttonAbortItemRemoval.label = action.value;\n    },\n    DID_REQUEST_ITEM_PROCESSING: function DID_REQUEST_ITEM_PROCESSING(_ref8) {\n      var root = _ref8.root;\n      root.ref.processProgressIndicator.spin = true;\n      root.ref.processProgressIndicator.progress = 0;\n    },\n    DID_START_ITEM_LOAD: function DID_START_ITEM_LOAD(_ref9) {\n      var root = _ref9.root;\n      root.ref.loadProgressIndicator.spin = true;\n      root.ref.loadProgressIndicator.progress = 0;\n    },\n    DID_START_ITEM_REMOVE: function DID_START_ITEM_REMOVE(_ref10) {\n      var root = _ref10.root;\n      root.ref.processProgressIndicator.spin = true;\n      root.ref.processProgressIndicator.progress = 0;\n    },\n    DID_UPDATE_ITEM_LOAD_PROGRESS: function DID_UPDATE_ITEM_LOAD_PROGRESS(_ref11) {\n      var root = _ref11.root,\n          action = _ref11.action;\n      root.ref.loadProgressIndicator.spin = false;\n      root.ref.loadProgressIndicator.progress = action.progress;\n    },\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: function DID_UPDATE_ITEM_PROCESS_PROGRESS(_ref12) {\n      var root = _ref12.root,\n          action = _ref12.action;\n      root.ref.processProgressIndicator.spin = false;\n      root.ref.processProgressIndicator.progress = action.progress;\n    }\n  });\n  var file = createView({\n    create: create$4,\n    write: write$2,\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, {\n        view: root\n      }));\n    },\n    name: 'file'\n  });\n  /**\n   * Creates the file view\n   */\n\n  var create$5 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // filename\n\n    root.ref.fileName = createElement$1('legend');\n    root.appendChild(root.ref.fileName); // file appended\n\n    root.ref.file = root.appendChildView(root.createChildView(file, {\n      id: props.id\n    })); // data has moved to data.js\n\n    root.ref.data = false;\n  };\n  /**\n   * Data storage\n   */\n\n\n  var didLoadItem = function didLoadItem(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props; // updates the legend of the fieldset so screenreaders can better group buttons\n\n    text(root.ref.fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));\n  };\n\n  var fileWrapper = createView({\n    create: create$5,\n    ignoreRect: true,\n    write: createRoute({\n      DID_LOAD_ITEM: didLoadItem\n    }),\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, {\n        view: root\n      }));\n    },\n    tag: 'fieldset',\n    name: 'file-wrapper'\n  });\n  var PANEL_SPRING_PROPS = {\n    type: 'spring',\n    damping: 0.6,\n    mass: 7\n  };\n\n  var create$6 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props;\n    [{\n      name: 'top'\n    }, {\n      name: 'center',\n      props: {\n        translateY: null,\n        scaleY: null\n      },\n      mixins: {\n        animations: {\n          scaleY: PANEL_SPRING_PROPS\n        },\n        styles: ['translateY', 'scaleY']\n      }\n    }, {\n      name: 'bottom',\n      props: {\n        translateY: null\n      },\n      mixins: {\n        animations: {\n          translateY: PANEL_SPRING_PROPS\n        },\n        styles: ['translateY']\n      }\n    }].forEach(function (section) {\n      createSection(root, section, props.name);\n    });\n    root.element.classList.add('filepond--' + props.name);\n    root.ref.scalable = null;\n  };\n\n  var createSection = function createSection(root, section, className) {\n    var viewConstructor = createView({\n      name: 'panel-' + section.name + ' filepond--' + className,\n      mixins: section.mixins,\n      ignoreRectUpdate: true\n    });\n    var view = root.createChildView(viewConstructor, section.props);\n    root.ref[section.name] = root.appendChildView(view);\n  };\n\n  var write$3 = function write(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props; // update scalable state\n\n    if (root.ref.scalable === null || props.scalable !== root.ref.scalable) {\n      root.ref.scalable = isBoolean(props.scalable) ? props.scalable : true;\n      root.element.dataset.scalable = root.ref.scalable;\n    } // no height, can't set\n\n\n    if (!props.height) return; // get child rects\n\n    var topRect = root.ref.top.rect.element;\n    var bottomRect = root.ref.bottom.rect.element; // make sure height never is smaller than bottom and top seciton heights combined (will probably never happen, but who knows)\n\n    var height = Math.max(topRect.height + bottomRect.height, props.height); // offset center part\n\n    root.ref.center.translateY = topRect.height; // scale center part\n    // use math ceil to prevent transparent lines because of rounding errors\n\n    root.ref.center.scaleY = (height - topRect.height - bottomRect.height) / 100; // offset bottom part\n\n    root.ref.bottom.translateY = height - bottomRect.height;\n  };\n\n  var panel = createView({\n    name: 'panel',\n    write: write$3,\n    create: create$6,\n    ignoreRect: true,\n    mixins: {\n      apis: ['height', 'scalable']\n    }\n  });\n\n  var createDragHelper = function createDragHelper(items) {\n    var itemIds = items.map(function (item) {\n      return item.id;\n    });\n    var prevIndex = undefined;\n    return {\n      setIndex: function setIndex(index) {\n        prevIndex = index;\n      },\n      getIndex: function getIndex() {\n        return prevIndex;\n      },\n      getItemIndex: function getItemIndex(item) {\n        return itemIds.indexOf(item.id);\n      }\n    };\n  };\n\n  var ITEM_TRANSLATE_SPRING = {\n    type: 'spring',\n    stiffness: 0.75,\n    damping: 0.45,\n    mass: 10\n  };\n  var ITEM_SCALE_SPRING = 'spring';\n  var StateMap = {\n    DID_START_ITEM_LOAD: 'busy',\n    DID_UPDATE_ITEM_LOAD_PROGRESS: 'loading',\n    DID_THROW_ITEM_INVALID: 'load-invalid',\n    DID_THROW_ITEM_LOAD_ERROR: 'load-error',\n    DID_LOAD_ITEM: 'idle',\n    DID_THROW_ITEM_REMOVE_ERROR: 'remove-error',\n    DID_START_ITEM_REMOVE: 'busy',\n    DID_START_ITEM_PROCESSING: 'busy processing',\n    DID_REQUEST_ITEM_PROCESSING: 'busy processing',\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: 'processing',\n    DID_COMPLETE_ITEM_PROCESSING: 'processing-complete',\n    DID_THROW_ITEM_PROCESSING_ERROR: 'processing-error',\n    DID_THROW_ITEM_PROCESSING_REVERT_ERROR: 'processing-revert-error',\n    DID_ABORT_ITEM_PROCESSING: 'cancelled',\n    DID_REVERT_ITEM_PROCESSING: 'idle'\n  };\n  /**\n   * Creates the file view\n   */\n\n  var create$7 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // select\n\n    root.ref.handleClick = function (e) {\n      return root.dispatch('DID_ACTIVATE_ITEM', {\n        id: props.id\n      });\n    }; // set id\n\n\n    root.element.id = 'filepond--item-' + props.id;\n    root.element.addEventListener('click', root.ref.handleClick); // file view\n\n    root.ref.container = root.appendChildView(root.createChildView(fileWrapper, {\n      id: props.id\n    })); // file panel\n\n    root.ref.panel = root.appendChildView(root.createChildView(panel, {\n      name: 'item-panel'\n    })); // default start height\n\n    root.ref.panel.height = null; // by default not marked for removal\n\n    props.markedForRemoval = false; // if not allowed to reorder file items, exit here\n\n    if (!root.query('GET_ALLOW_REORDER')) return; // set to idle so shows grab cursor\n\n    root.element.dataset.dragState = 'idle';\n\n    var grab = function grab(e) {\n      if (!e.isPrimary) return;\n      var removedActivateListener = false;\n      var origin = {\n        x: e.pageX,\n        y: e.pageY\n      };\n      props.dragOrigin = {\n        x: root.translateX,\n        y: root.translateY\n      };\n      props.dragCenter = {\n        x: e.offsetX,\n        y: e.offsetY\n      };\n      var dragState = createDragHelper(root.query('GET_ACTIVE_ITEMS'));\n      root.dispatch('DID_GRAB_ITEM', {\n        id: props.id,\n        dragState: dragState\n      });\n\n      var drag = function drag(e) {\n        if (!e.isPrimary) return;\n        e.stopPropagation();\n        e.preventDefault();\n        props.dragOffset = {\n          x: e.pageX - origin.x,\n          y: e.pageY - origin.y\n        }; // if dragged stop listening to clicks, will re-add when done dragging\n\n        var dist = props.dragOffset.x * props.dragOffset.x + props.dragOffset.y * props.dragOffset.y;\n\n        if (dist > 16 && !removedActivateListener) {\n          removedActivateListener = true;\n          root.element.removeEventListener('click', root.ref.handleClick);\n        }\n\n        root.dispatch('DID_DRAG_ITEM', {\n          id: props.id,\n          dragState: dragState\n        });\n      };\n\n      var drop = function drop(e) {\n        if (!e.isPrimary) return;\n        document.removeEventListener('pointermove', drag);\n        document.removeEventListener('pointerup', drop);\n        props.dragOffset = {\n          x: e.pageX - origin.x,\n          y: e.pageY - origin.y\n        };\n        root.dispatch('DID_DROP_ITEM', {\n          id: props.id,\n          dragState: dragState\n        }); // start listening to clicks again\n\n        if (removedActivateListener) {\n          setTimeout(function () {\n            return root.element.addEventListener('click', root.ref.handleClick);\n          }, 0);\n        }\n      };\n\n      document.addEventListener('pointermove', drag);\n      document.addEventListener('pointerup', drop);\n    };\n\n    root.element.addEventListener('pointerdown', grab);\n  };\n\n  var route$1 = createRoute({\n    DID_UPDATE_PANEL_HEIGHT: function DID_UPDATE_PANEL_HEIGHT(_ref2) {\n      var root = _ref2.root,\n          action = _ref2.action;\n      root.height = action.height;\n    }\n  });\n  var write$4 = createRoute({\n    DID_GRAB_ITEM: function DID_GRAB_ITEM(_ref3) {\n      var root = _ref3.root,\n          props = _ref3.props;\n      props.dragOrigin = {\n        x: root.translateX,\n        y: root.translateY\n      };\n    },\n    DID_DRAG_ITEM: function DID_DRAG_ITEM(_ref4) {\n      var root = _ref4.root;\n      root.element.dataset.dragState = 'drag';\n    },\n    DID_DROP_ITEM: function DID_DROP_ITEM(_ref5) {\n      var root = _ref5.root,\n          props = _ref5.props;\n      props.dragOffset = null;\n      props.dragOrigin = null;\n      root.element.dataset.dragState = 'drop';\n    }\n  }, function (_ref6) {\n    var root = _ref6.root,\n        actions = _ref6.actions,\n        props = _ref6.props,\n        shouldOptimize = _ref6.shouldOptimize;\n\n    if (root.element.dataset.dragState === 'drop') {\n      if (root.scaleX <= 1) {\n        root.element.dataset.dragState = 'idle';\n      }\n    } // select last state change action\n\n\n    var action = actions.concat().filter(function (action) {\n      return /^DID_/.test(action.type);\n    }).reverse().find(function (action) {\n      return StateMap[action.type];\n    }); // no need to set same state twice\n\n    if (action && action.type !== props.currentState) {\n      // set current state\n      props.currentState = action.type; // set state\n\n      root.element.dataset.filepondItemState = StateMap[props.currentState] || '';\n    } // route actions\n\n\n    var aspectRatio = root.query('GET_ITEM_PANEL_ASPECT_RATIO') || root.query('GET_PANEL_ASPECT_RATIO');\n\n    if (!aspectRatio) {\n      route$1({\n        root: root,\n        actions: actions,\n        props: props\n      });\n\n      if (!root.height && root.ref.container.rect.element.height > 0) {\n        root.height = root.ref.container.rect.element.height;\n      }\n    } else if (!shouldOptimize) {\n      root.height = root.rect.element.width * aspectRatio;\n    } // sync panel height with item height\n\n\n    if (shouldOptimize) {\n      root.ref.panel.height = null;\n    }\n\n    root.ref.panel.height = root.height;\n  });\n  var item = createView({\n    create: create$7,\n    write: write$4,\n    destroy: function destroy(_ref7) {\n      var root = _ref7.root,\n          props = _ref7.props;\n      root.element.removeEventListener('click', root.ref.handleClick);\n      root.dispatch('RELEASE_ITEM', {\n        query: props.id\n      });\n    },\n    tag: 'li',\n    name: 'item',\n    mixins: {\n      apis: ['id', 'interactionMethod', 'markedForRemoval', 'spawnDate', 'dragCenter', 'dragOrigin', 'dragOffset'],\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity', 'height'],\n      animations: {\n        scaleX: ITEM_SCALE_SPRING,\n        scaleY: ITEM_SCALE_SPRING,\n        translateX: ITEM_TRANSLATE_SPRING,\n        translateY: ITEM_TRANSLATE_SPRING,\n        opacity: {\n          type: 'tween',\n          duration: 150\n        }\n      }\n    }\n  });\n\n  var getItemIndexByPosition = function getItemIndexByPosition(view, children, positionInView) {\n    if (!positionInView) return;\n    var horizontalSpace = view.rect.element.width; // const children = view.childViews;\n\n    var l = children.length;\n    var last = null; // -1, don't move items to accomodate (either add to top or bottom)\n\n    if (l === 0 || positionInView.top < children[0].rect.element.top) return -1; // let's get the item width\n\n    var item = children[0];\n    var itemRect = item.rect.element;\n    var itemHorizontalMargin = itemRect.marginLeft + itemRect.marginRight;\n    var itemWidth = itemRect.width + itemHorizontalMargin;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth); // stack\n\n    if (itemsPerRow === 1) {\n      for (var index = 0; index < l; index++) {\n        var child = children[index];\n        var childMid = child.rect.outer.top + child.rect.element.height * 0.5;\n\n        if (positionInView.top < childMid) {\n          return index;\n        }\n      }\n\n      return l;\n    } // grid\n\n\n    var itemVerticalMargin = itemRect.marginTop + itemRect.marginBottom;\n    var itemHeight = itemRect.height + itemVerticalMargin;\n\n    for (var _index = 0; _index < l; _index++) {\n      var indexX = _index % itemsPerRow;\n      var indexY = Math.floor(_index / itemsPerRow);\n      var offsetX = indexX * itemWidth;\n      var offsetY = indexY * itemHeight;\n      var itemTop = offsetY - itemRect.marginTop;\n      var itemRight = offsetX + itemWidth;\n      var itemBottom = offsetY + itemHeight + itemRect.marginBottom;\n\n      if (positionInView.top < itemBottom && positionInView.top > itemTop) {\n        if (positionInView.left < itemRight) {\n          return _index;\n        } else if (_index !== l - 1) {\n          last = _index;\n        } else {\n          last = null;\n        }\n      }\n    }\n\n    if (last !== null) {\n      return last;\n    }\n\n    return l;\n  };\n\n  var dropAreaDimensions = {\n    height: 0,\n    width: 0,\n\n    get getHeight() {\n      return this.height;\n    },\n\n    set setHeight(val) {\n      if (this.height === 0 || val === 0) this.height = val;\n    },\n\n    get getWidth() {\n      return this.width;\n    },\n\n    set setWidth(val) {\n      if (this.width === 0 || val === 0) this.width = val;\n    },\n\n    setDimensions: function setDimensions(height, width) {\n      if (this.height === 0 || height === 0) this.height = height;\n      if (this.width === 0 || width === 0) this.width = width;\n    }\n  };\n\n  var create$8 = function create(_ref) {\n    var root = _ref.root; // need to set role to list as otherwise it won't be read as a list by VoiceOver\n\n    attr(root.element, 'role', 'list');\n    root.ref.lastItemSpanwDate = Date.now();\n  };\n  /**\n   * Inserts a new item\n   * @param root\n   * @param action\n   */\n\n\n  var addItemView = function addItemView(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n    var id = action.id,\n        index = action.index,\n        interactionMethod = action.interactionMethod;\n    root.ref.addIndex = index;\n    var now = Date.now();\n    var spawnDate = now;\n    var opacity = 1;\n\n    if (interactionMethod !== InteractionMethod.NONE) {\n      opacity = 0;\n      var cooldown = root.query('GET_ITEM_INSERT_INTERVAL');\n      var dist = now - root.ref.lastItemSpanwDate;\n      spawnDate = dist < cooldown ? now + (cooldown - dist) : now;\n    }\n\n    root.ref.lastItemSpanwDate = spawnDate;\n    root.appendChildView(root.createChildView( // view type\n    item, // props\n    {\n      spawnDate: spawnDate,\n      id: id,\n      opacity: opacity,\n      interactionMethod: interactionMethod\n    }), index);\n  };\n\n  var moveItem = function moveItem(item, x, y) {\n    var vx = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n    var vy = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1; // set to null to remove animation while dragging\n\n    if (item.dragOffset) {\n      item.translateX = null;\n      item.translateY = null;\n      item.translateX = item.dragOrigin.x + item.dragOffset.x;\n      item.translateY = item.dragOrigin.y + item.dragOffset.y;\n      item.scaleX = 1.025;\n      item.scaleY = 1.025;\n    } else {\n      item.translateX = x;\n      item.translateY = y;\n\n      if (Date.now() > item.spawnDate) {\n        // reveal element\n        if (item.opacity === 0) {\n          introItemView(item, x, y, vx, vy);\n        } // make sure is default scale every frame\n\n\n        item.scaleX = 1;\n        item.scaleY = 1;\n        item.opacity = 1;\n      }\n    }\n  };\n\n  var introItemView = function introItemView(item, x, y, vx, vy) {\n    if (item.interactionMethod === InteractionMethod.NONE) {\n      item.translateX = null;\n      item.translateX = x;\n      item.translateY = null;\n      item.translateY = y;\n    } else if (item.interactionMethod === InteractionMethod.DROP) {\n      item.translateX = null;\n      item.translateX = x - vx * 20;\n      item.translateY = null;\n      item.translateY = y - vy * 10;\n      item.scaleX = 0.8;\n      item.scaleY = 0.8;\n    } else if (item.interactionMethod === InteractionMethod.BROWSE) {\n      item.translateY = null;\n      item.translateY = y - 30;\n    } else if (item.interactionMethod === InteractionMethod.API) {\n      item.translateX = null;\n      item.translateX = x - 30;\n      item.translateY = null;\n    }\n  };\n  /**\n   * Removes an existing item\n   * @param root\n   * @param action\n   */\n\n\n  var removeItemView = function removeItemView(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n    var id = action.id; // get the view matching the given id\n\n    var view = root.childViews.find(function (child) {\n      return child.id === id;\n    }); // if no view found, exit\n\n    if (!view) {\n      return;\n    } // animate view out of view\n\n\n    view.scaleX = 0.9;\n    view.scaleY = 0.9;\n    view.opacity = 0; // mark for removal\n\n    view.markedForRemoval = true;\n  };\n\n  var getItemHeight = function getItemHeight(child) {\n    return child.rect.element.height + child.rect.element.marginBottom * 0.5 + child.rect.element.marginTop * 0.5;\n  };\n\n  var getItemWidth = function getItemWidth(child) {\n    return child.rect.element.width + child.rect.element.marginLeft * 0.5 + child.rect.element.marginRight * 0.5;\n  };\n\n  var dragItem = function dragItem(_ref4) {\n    var root = _ref4.root,\n        action = _ref4.action;\n    var id = action.id,\n        dragState = action.dragState; // reference to item\n\n    var item = root.query('GET_ITEM', {\n      id: id\n    }); // get the view matching the given id\n\n    var view = root.childViews.find(function (child) {\n      return child.id === id;\n    });\n    var numItems = root.childViews.length;\n    var oldIndex = dragState.getItemIndex(item); // if no view found, exit\n\n    if (!view) return;\n    var dragPosition = {\n      x: view.dragOrigin.x + view.dragOffset.x + view.dragCenter.x,\n      y: view.dragOrigin.y + view.dragOffset.y + view.dragCenter.y // get drag area dimensions\n\n    };\n    var dragHeight = getItemHeight(view);\n    var dragWidth = getItemWidth(view); // get rows and columns (There will always be at least one row and one column if a file is present)\n\n    var cols = Math.floor(root.rect.outer.width / dragWidth);\n    if (cols > numItems) cols = numItems; // rows are used to find when we have left the preview area bounding box\n\n    var rows = Math.floor(numItems / cols + 1);\n    dropAreaDimensions.setHeight = dragHeight * rows;\n    dropAreaDimensions.setWidth = dragWidth * cols; // get new index of dragged item\n\n    var location = {\n      y: Math.floor(dragPosition.y / dragHeight),\n      x: Math.floor(dragPosition.x / dragWidth),\n      getGridIndex: function getGridIndex() {\n        if (dragPosition.y > dropAreaDimensions.getHeight || dragPosition.y < 0 || dragPosition.x > dropAreaDimensions.getWidth || dragPosition.x < 0) return oldIndex;\n        return this.y * cols + this.x;\n      },\n      getColIndex: function getColIndex() {\n        var items = root.query('GET_ACTIVE_ITEMS');\n        var visibleChildren = root.childViews.filter(function (child) {\n          return child.rect.element.height;\n        });\n        var children = items.map(function (item) {\n          return visibleChildren.find(function (childView) {\n            return childView.id === item.id;\n          });\n        });\n        var currentIndex = children.findIndex(function (child) {\n          return child === view;\n        });\n        var dragHeight = getItemHeight(view);\n        var l = children.length;\n        var idx = l;\n        var childHeight = 0;\n        var childBottom = 0;\n        var childTop = 0;\n\n        for (var i = 0; i < l; i++) {\n          childHeight = getItemHeight(children[i]);\n          childTop = childBottom;\n          childBottom = childTop + childHeight;\n\n          if (dragPosition.y < childBottom) {\n            if (currentIndex > i) {\n              if (dragPosition.y < childTop + dragHeight) {\n                idx = i;\n                break;\n              }\n\n              continue;\n            }\n\n            idx = i;\n            break;\n          }\n        }\n\n        return idx;\n      } // get new index\n\n    };\n    var index = cols > 1 ? location.getGridIndex() : location.getColIndex();\n    root.dispatch('MOVE_ITEM', {\n      query: view,\n      index: index\n    }); // if the index of the item changed, dispatch reorder action\n\n    var currentIndex = dragState.getIndex();\n\n    if (currentIndex === undefined || currentIndex !== index) {\n      dragState.setIndex(index);\n      if (currentIndex === undefined) return;\n      root.dispatch('DID_REORDER_ITEMS', {\n        items: root.query('GET_ACTIVE_ITEMS'),\n        origin: oldIndex,\n        target: index\n      });\n    }\n  };\n  /**\n   * Setup action routes\n   */\n\n\n  var route$2 = createRoute({\n    DID_ADD_ITEM: addItemView,\n    DID_REMOVE_ITEM: removeItemView,\n    DID_DRAG_ITEM: dragItem\n  });\n  /**\n   * Write to view\n   * @param root\n   * @param actions\n   * @param props\n   */\n\n  var write$5 = function write(_ref5) {\n    var root = _ref5.root,\n        props = _ref5.props,\n        actions = _ref5.actions,\n        shouldOptimize = _ref5.shouldOptimize; // route actions\n\n    route$2({\n      root: root,\n      props: props,\n      actions: actions\n    });\n    var dragCoordinates = props.dragCoordinates; // available space on horizontal axis\n\n    var horizontalSpace = root.rect.element.width; // only draw children that have dimensions\n\n    var visibleChildren = root.childViews.filter(function (child) {\n      return child.rect.element.height;\n    }); // sort based on current active items\n\n    var children = root.query('GET_ACTIVE_ITEMS').map(function (item) {\n      return visibleChildren.find(function (child) {\n        return child.id === item.id;\n      });\n    }).filter(function (item) {\n      return item;\n    }); // get index\n\n    var dragIndex = dragCoordinates ? getItemIndexByPosition(root, children, dragCoordinates) : null; // add index is used to reserve the dropped/added item index till the actual item is rendered\n\n    var addIndex = root.ref.addIndex || null; // add index no longer needed till possibly next draw\n\n    root.ref.addIndex = null;\n    var dragIndexOffset = 0;\n    var removeIndexOffset = 0;\n    var addIndexOffset = 0;\n    if (children.length === 0) return;\n    var childRect = children[0].rect.element;\n    var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;\n    var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;\n    var itemWidth = childRect.width + itemHorizontalMargin;\n    var itemHeight = childRect.height + itemVerticalMargin;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth); // stack\n\n    if (itemsPerRow === 1) {\n      var offsetY = 0;\n      var dragOffset = 0;\n      children.forEach(function (child, index) {\n        if (dragIndex) {\n          var dist = index - dragIndex;\n\n          if (dist === -2) {\n            dragOffset = -itemVerticalMargin * 0.25;\n          } else if (dist === -1) {\n            dragOffset = -itemVerticalMargin * 0.75;\n          } else if (dist === 0) {\n            dragOffset = itemVerticalMargin * 0.75;\n          } else if (dist === 1) {\n            dragOffset = itemVerticalMargin * 0.25;\n          } else {\n            dragOffset = 0;\n          }\n        }\n\n        if (shouldOptimize) {\n          child.translateX = null;\n          child.translateY = null;\n        }\n\n        if (!child.markedForRemoval) {\n          moveItem(child, 0, offsetY + dragOffset);\n        }\n\n        var itemHeight = child.rect.element.height + itemVerticalMargin;\n        var visualHeight = itemHeight * (child.markedForRemoval ? child.opacity : 1);\n        offsetY += visualHeight;\n      });\n    } // grid\n    else {\n        var prevX = 0;\n        var prevY = 0;\n        children.forEach(function (child, index) {\n          if (index === dragIndex) {\n            dragIndexOffset = 1;\n          }\n\n          if (index === addIndex) {\n            addIndexOffset += 1;\n          }\n\n          if (child.markedForRemoval && child.opacity < 0.5) {\n            removeIndexOffset -= 1;\n          }\n\n          var visualIndex = index + addIndexOffset + dragIndexOffset + removeIndexOffset;\n          var indexX = visualIndex % itemsPerRow;\n          var indexY = Math.floor(visualIndex / itemsPerRow);\n          var offsetX = indexX * itemWidth;\n          var offsetY = indexY * itemHeight;\n          var vectorX = Math.sign(offsetX - prevX);\n          var vectorY = Math.sign(offsetY - prevY);\n          prevX = offsetX;\n          prevY = offsetY;\n          if (child.markedForRemoval) return;\n\n          if (shouldOptimize) {\n            child.translateX = null;\n            child.translateY = null;\n          }\n\n          moveItem(child, offsetX, offsetY, vectorX, vectorY);\n        });\n      }\n  };\n  /**\n   * Filters actions that are meant specifically for a certain child of the list\n   * @param child\n   * @param actions\n   */\n\n\n  var filterSetItemActions = function filterSetItemActions(child, actions) {\n    return actions.filter(function (action) {\n      // if action has an id, filter out actions that don't have this child id\n      if (action.data && action.data.id) {\n        return child.id === action.data.id;\n      } // allow all other actions\n\n\n      return true;\n    });\n  };\n\n  var list = createView({\n    create: create$8,\n    write: write$5,\n    tag: 'ul',\n    name: 'list',\n    didWriteView: function didWriteView(_ref6) {\n      var root = _ref6.root;\n      root.childViews.filter(function (view) {\n        return view.markedForRemoval && view.opacity === 0 && view.resting;\n      }).forEach(function (view) {\n        view._destroy();\n\n        root.removeChildView(view);\n      });\n    },\n    filterFrameActionsForChild: filterSetItemActions,\n    mixins: {\n      apis: ['dragCoordinates']\n    }\n  });\n\n  var create$9 = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props;\n    root.ref.list = root.appendChildView(root.createChildView(list));\n    props.dragCoordinates = null;\n    props.overflowing = false;\n  };\n\n  var storeDragCoordinates = function storeDragCoordinates(_ref2) {\n    var root = _ref2.root,\n        props = _ref2.props,\n        action = _ref2.action;\n    if (!root.query('GET_ITEM_INSERT_LOCATION_FREEDOM')) return;\n    props.dragCoordinates = {\n      left: action.position.scopeLeft - root.ref.list.rect.element.left,\n      top: action.position.scopeTop - (root.rect.outer.top + root.rect.element.marginTop + root.rect.element.scrollTop)\n    };\n  };\n\n  var clearDragCoordinates = function clearDragCoordinates(_ref3) {\n    var props = _ref3.props;\n    props.dragCoordinates = null;\n  };\n\n  var route$3 = createRoute({\n    DID_DRAG: storeDragCoordinates,\n    DID_END_DRAG: clearDragCoordinates\n  });\n\n  var write$6 = function write(_ref4) {\n    var root = _ref4.root,\n        props = _ref4.props,\n        actions = _ref4.actions; // route actions\n\n    route$3({\n      root: root,\n      props: props,\n      actions: actions\n    }); // current drag position\n\n    root.ref.list.dragCoordinates = props.dragCoordinates; // if currently overflowing but no longer received overflow\n\n    if (props.overflowing && !props.overflow) {\n      props.overflowing = false; // reset overflow state\n\n      root.element.dataset.state = '';\n      root.height = null;\n    } // if is not overflowing currently but does receive overflow value\n\n\n    if (props.overflow) {\n      var newHeight = Math.round(props.overflow);\n\n      if (newHeight !== root.height) {\n        props.overflowing = true;\n        root.element.dataset.state = 'overflow';\n        root.height = newHeight;\n      }\n    }\n  };\n\n  var listScroller = createView({\n    create: create$9,\n    write: write$6,\n    name: 'list-scroller',\n    mixins: {\n      apis: ['overflow', 'dragCoordinates'],\n      styles: ['height', 'translateY'],\n      animations: {\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var attrToggle = function attrToggle(element, name, state) {\n    var enabledValue = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n\n    if (state) {\n      attr(element, name, enabledValue);\n    } else {\n      element.removeAttribute(name);\n    }\n  };\n\n  var resetFileInput = function resetFileInput(input) {\n    // no value, no need to reset\n    if (!input || input.value === '') {\n      return;\n    }\n\n    try {\n      // for modern browsers\n      input.value = '';\n    } catch (err) {} // for IE10\n\n\n    if (input.value) {\n      // quickly append input to temp form and reset form\n      var form = createElement$1('form');\n      var parentNode = input.parentNode;\n      var ref = input.nextSibling;\n      form.appendChild(input);\n      form.reset(); // re-inject input where it originally was\n\n      if (ref) {\n        parentNode.insertBefore(input, ref);\n      } else {\n        parentNode.appendChild(input);\n      }\n    }\n  };\n\n  var create$a = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // set id so can be referenced from outside labels\n\n    root.element.id = 'filepond--browser-' + props.id; // set name of element (is removed when a value is set)\n\n    attr(root.element, 'name', root.query('GET_NAME')); // we have to link this element to the status element\n\n    attr(root.element, 'aria-controls', 'filepond--assistant-' + props.id); // set label, we use labelled by as otherwise the screenreader does not read the \"browse\" text in the label (as it has tabindex: 0)\n\n    attr(root.element, 'aria-labelledby', 'filepond--drop-label-' + props.id); // set configurable props\n\n    setAcceptedFileTypes({\n      root: root,\n      action: {\n        value: root.query('GET_ACCEPTED_FILE_TYPES')\n      }\n    });\n    toggleAllowMultiple({\n      root: root,\n      action: {\n        value: root.query('GET_ALLOW_MULTIPLE')\n      }\n    });\n    toggleDirectoryFilter({\n      root: root,\n      action: {\n        value: root.query('GET_ALLOW_DIRECTORIES_ONLY')\n      }\n    });\n    toggleDisabled({\n      root: root\n    });\n    toggleRequired({\n      root: root,\n      action: {\n        value: root.query('GET_REQUIRED')\n      }\n    });\n    setCaptureMethod({\n      root: root,\n      action: {\n        value: root.query('GET_CAPTURE_METHOD')\n      }\n    }); // handle changes to the input field\n\n    root.ref.handleChange = function (e) {\n      if (!root.element.value) {\n        return;\n      } // extract files and move value of webkitRelativePath path to _relativePath\n\n\n      var files = Array.from(root.element.files).map(function (file) {\n        file._relativePath = file.webkitRelativePath;\n        return file;\n      }); // we add a little delay so the OS file select window can move out of the way before we add our file\n\n      setTimeout(function () {\n        // load files\n        props.onload(files); // reset input, it's just for exposing a method to drop files, should not retain any state\n\n        resetFileInput(root.element);\n      }, 250);\n    };\n\n    root.element.addEventListener('change', root.ref.handleChange);\n  };\n\n  var setAcceptedFileTypes = function setAcceptedFileTypes(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n    if (!root.query('GET_ALLOW_SYNC_ACCEPT_ATTRIBUTE')) return;\n    attrToggle(root.element, 'accept', !!action.value, action.value ? action.value.join(',') : '');\n  };\n\n  var toggleAllowMultiple = function toggleAllowMultiple(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n    attrToggle(root.element, 'multiple', action.value);\n  };\n\n  var toggleDirectoryFilter = function toggleDirectoryFilter(_ref4) {\n    var root = _ref4.root,\n        action = _ref4.action;\n    attrToggle(root.element, 'webkitdirectory', action.value);\n  };\n\n  var toggleDisabled = function toggleDisabled(_ref5) {\n    var root = _ref5.root;\n    var isDisabled = root.query('GET_DISABLED');\n    var doesAllowBrowse = root.query('GET_ALLOW_BROWSE');\n    var disableField = isDisabled || !doesAllowBrowse;\n    attrToggle(root.element, 'disabled', disableField);\n  };\n\n  var toggleRequired = function toggleRequired(_ref6) {\n    var root = _ref6.root,\n        action = _ref6.action; // want to remove required, always possible\n\n    if (!action.value) {\n      attrToggle(root.element, 'required', false);\n    } // if want to make required, only possible when zero items\n    else if (root.query('GET_TOTAL_ITEMS') === 0) {\n        attrToggle(root.element, 'required', true);\n      }\n  };\n\n  var setCaptureMethod = function setCaptureMethod(_ref7) {\n    var root = _ref7.root,\n        action = _ref7.action;\n    attrToggle(root.element, 'capture', !!action.value, action.value === true ? '' : action.value);\n  };\n\n  var updateRequiredStatus = function updateRequiredStatus(_ref8) {\n    var root = _ref8.root;\n    var element = root.element; // always remove the required attribute when more than zero items\n\n    if (root.query('GET_TOTAL_ITEMS') > 0) {\n      attrToggle(element, 'required', false);\n      attrToggle(element, 'name', false);\n    } else {\n      // add name attribute\n      attrToggle(element, 'name', true, root.query('GET_NAME')); // remove any validation messages\n\n      var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');\n\n      if (shouldCheckValidity) {\n        element.setCustomValidity('');\n      } // we only add required if the field has been deemed required\n\n\n      if (root.query('GET_REQUIRED')) {\n        attrToggle(element, 'required', true);\n      }\n    }\n  };\n\n  var updateFieldValidityStatus = function updateFieldValidityStatus(_ref9) {\n    var root = _ref9.root;\n    var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');\n    if (!shouldCheckValidity) return;\n    root.element.setCustomValidity(root.query('GET_LABEL_INVALID_FIELD'));\n  };\n\n  var browser = createView({\n    tag: 'input',\n    name: 'browser',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    attributes: {\n      type: 'file'\n    },\n    create: create$a,\n    destroy: function destroy(_ref10) {\n      var root = _ref10.root;\n      root.element.removeEventListener('change', root.ref.handleChange);\n    },\n    write: createRoute({\n      DID_LOAD_ITEM: updateRequiredStatus,\n      DID_REMOVE_ITEM: updateRequiredStatus,\n      DID_THROW_ITEM_INVALID: updateFieldValidityStatus,\n      DID_SET_DISABLED: toggleDisabled,\n      DID_SET_ALLOW_BROWSE: toggleDisabled,\n      DID_SET_ALLOW_DIRECTORIES_ONLY: toggleDirectoryFilter,\n      DID_SET_ALLOW_MULTIPLE: toggleAllowMultiple,\n      DID_SET_ACCEPTED_FILE_TYPES: setAcceptedFileTypes,\n      DID_SET_CAPTURE_METHOD: setCaptureMethod,\n      DID_SET_REQUIRED: toggleRequired\n    })\n  });\n  var Key = {\n    ENTER: 13,\n    SPACE: 32\n  };\n\n  var create$b = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // create the label and link it to the file browser\n\n    var label = createElement$1('label');\n    attr(label, 'for', 'filepond--browser-' + props.id); // use for labeling file input (aria-labelledby on file input)\n\n    attr(label, 'id', 'filepond--drop-label-' + props.id); // hide the label for screenreaders, the input element will read the contents of the label when it's focussed. If we don't set aria-hidden the screenreader will also navigate the contents of the label separately from the input.\n\n    attr(label, 'aria-hidden', 'true'); // handle keys\n\n    root.ref.handleKeyDown = function (e) {\n      var isActivationKey = e.keyCode === Key.ENTER || e.keyCode === Key.SPACE;\n      if (!isActivationKey) return; // stops from triggering the element a second time\n\n      e.preventDefault(); // click link (will then in turn activate file input)\n\n      root.ref.label.click();\n    };\n\n    root.ref.handleClick = function (e) {\n      var isLabelClick = e.target === label || label.contains(e.target); // don't want to click twice\n\n      if (isLabelClick) return; // click link (will then in turn activate file input)\n\n      root.ref.label.click();\n    }; // attach events\n\n\n    label.addEventListener('keydown', root.ref.handleKeyDown);\n    root.element.addEventListener('click', root.ref.handleClick); // update\n\n    updateLabelValue(label, props.caption); // add!\n\n    root.appendChild(label);\n    root.ref.label = label;\n  };\n\n  var updateLabelValue = function updateLabelValue(label, value) {\n    label.innerHTML = value;\n    var clickable = label.querySelector('.filepond--label-action');\n\n    if (clickable) {\n      attr(clickable, 'tabindex', '0');\n    }\n\n    return value;\n  };\n\n  var dropLabel = createView({\n    name: 'drop-label',\n    ignoreRect: true,\n    create: create$b,\n    destroy: function destroy(_ref2) {\n      var root = _ref2.root;\n      root.ref.label.addEventListener('keydown', root.ref.handleKeyDown);\n      root.element.removeEventListener('click', root.ref.handleClick);\n    },\n    write: createRoute({\n      DID_SET_LABEL_IDLE: function DID_SET_LABEL_IDLE(_ref3) {\n        var root = _ref3.root,\n            action = _ref3.action;\n        updateLabelValue(root.ref.label, action.value);\n      }\n    }),\n    mixins: {\n      styles: ['opacity', 'translateX', 'translateY'],\n      animations: {\n        opacity: {\n          type: 'tween',\n          duration: 150\n        },\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n  var blob = createView({\n    name: 'drip-blob',\n    ignoreRect: true,\n    mixins: {\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        translateX: 'spring',\n        translateY: 'spring',\n        opacity: {\n          type: 'tween',\n          duration: 250\n        }\n      }\n    }\n  });\n\n  var addBlob = function addBlob(_ref) {\n    var root = _ref.root;\n    var centerX = root.rect.element.width * 0.5;\n    var centerY = root.rect.element.height * 0.5;\n    root.ref.blob = root.appendChildView(root.createChildView(blob, {\n      opacity: 0,\n      scaleX: 2.5,\n      scaleY: 2.5,\n      translateX: centerX,\n      translateY: centerY\n    }));\n  };\n\n  var moveBlob = function moveBlob(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n\n    if (!root.ref.blob) {\n      addBlob({\n        root: root\n      });\n      return;\n    }\n\n    root.ref.blob.translateX = action.position.scopeLeft;\n    root.ref.blob.translateY = action.position.scopeTop;\n    root.ref.blob.scaleX = 1;\n    root.ref.blob.scaleY = 1;\n    root.ref.blob.opacity = 1;\n  };\n\n  var hideBlob = function hideBlob(_ref3) {\n    var root = _ref3.root;\n\n    if (!root.ref.blob) {\n      return;\n    }\n\n    root.ref.blob.opacity = 0;\n  };\n\n  var explodeBlob = function explodeBlob(_ref4) {\n    var root = _ref4.root;\n\n    if (!root.ref.blob) {\n      return;\n    }\n\n    root.ref.blob.scaleX = 2.5;\n    root.ref.blob.scaleY = 2.5;\n    root.ref.blob.opacity = 0;\n  };\n\n  var write$7 = function write(_ref5) {\n    var root = _ref5.root,\n        props = _ref5.props,\n        actions = _ref5.actions;\n    route$4({\n      root: root,\n      props: props,\n      actions: actions\n    });\n    var blob = root.ref.blob;\n\n    if (actions.length === 0 && blob && blob.opacity === 0) {\n      root.removeChildView(blob);\n      root.ref.blob = null;\n    }\n  };\n\n  var route$4 = createRoute({\n    DID_DRAG: moveBlob,\n    DID_DROP: explodeBlob,\n    DID_END_DRAG: hideBlob\n  });\n  var drip = createView({\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    name: 'drip',\n    write: write$7\n  });\n\n  var create$c = function create(_ref) {\n    var root = _ref.root;\n    return root.ref.fields = {};\n  };\n\n  var getField = function getField(root, id) {\n    return root.ref.fields[id];\n  };\n\n  var syncFieldPositionsWithItems = function syncFieldPositionsWithItems(root) {\n    root.query('GET_ACTIVE_ITEMS').forEach(function (item) {\n      if (!root.ref.fields[item.id]) return;\n      root.element.appendChild(root.ref.fields[item.id]);\n    });\n  };\n\n  var didReorderItems = function didReorderItems(_ref2) {\n    var root = _ref2.root;\n    return syncFieldPositionsWithItems(root);\n  };\n\n  var didAddItem = function didAddItem(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n    var dataContainer = createElement$1('input');\n    dataContainer.type = 'hidden';\n    dataContainer.name = root.query('GET_NAME');\n    dataContainer.disabled = root.query('GET_DISABLED');\n    root.ref.fields[action.id] = dataContainer;\n    syncFieldPositionsWithItems(root);\n  };\n\n  var didLoadItem$1 = function didLoadItem(_ref4) {\n    var root = _ref4.root,\n        action = _ref4.action;\n    var field = getField(root, action.id);\n    if (!field || action.serverFileReference === null) return;\n    field.value = action.serverFileReference;\n  };\n\n  var didSetDisabled = function didSetDisabled(_ref5) {\n    var root = _ref5.root;\n    root.element.disabled = root.query('GET_DISABLED');\n  };\n\n  var didRemoveItem = function didRemoveItem(_ref6) {\n    var root = _ref6.root,\n        action = _ref6.action;\n    var field = getField(root, action.id);\n    if (!field) return;\n    field.parentNode.removeChild(field);\n    delete root.ref.fields[action.id];\n  };\n\n  var didDefineValue = function didDefineValue(_ref7) {\n    var root = _ref7.root,\n        action = _ref7.action;\n    var field = getField(root, action.id);\n    if (!field) return;\n\n    if (action.value === null) {\n      field.removeAttribute('value');\n    } else {\n      field.value = action.value;\n    }\n\n    syncFieldPositionsWithItems(root);\n  };\n\n  var write$8 = createRoute({\n    DID_SET_DISABLED: didSetDisabled,\n    DID_ADD_ITEM: didAddItem,\n    DID_LOAD_ITEM: didLoadItem$1,\n    DID_REMOVE_ITEM: didRemoveItem,\n    DID_DEFINE_VALUE: didDefineValue,\n    DID_REORDER_ITEMS: didReorderItems,\n    DID_SORT_ITEMS: didReorderItems\n  });\n  var data = createView({\n    tag: 'fieldset',\n    name: 'data',\n    create: create$c,\n    write: write$8,\n    ignoreRect: true\n  });\n\n  var getRootNode = function getRootNode(element) {\n    return 'getRootNode' in element ? element.getRootNode() : document;\n  };\n\n  var images = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'tiff'];\n  var text$1 = ['css', 'csv', 'html', 'txt'];\n  var map = {\n    zip: 'zip|compressed',\n    epub: 'application/epub+zip'\n  };\n\n  var guesstimateMimeType = function guesstimateMimeType() {\n    var extension = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    extension = extension.toLowerCase();\n\n    if (images.includes(extension)) {\n      return 'image/' + (extension === 'jpg' ? 'jpeg' : extension === 'svg' ? 'svg+xml' : extension);\n    }\n\n    if (text$1.includes(extension)) {\n      return 'text/' + extension;\n    }\n\n    return map[extension] || '';\n  };\n\n  var requestDataTransferItems = function requestDataTransferItems(dataTransfer) {\n    return new Promise(function (resolve, reject) {\n      // try to get links from transfer, if found we'll exit immidiately (unless a file is in the dataTransfer as well, this is because Firefox could represent the file as a URL and a file object at the same time)\n      var links = getLinks(dataTransfer);\n\n      if (links.length && !hasFiles(dataTransfer)) {\n        return resolve(links);\n      } // try to get files from the transfer\n\n\n      getFiles(dataTransfer).then(resolve);\n    });\n  };\n  /**\n   * Test if datatransfer has files\n   */\n\n\n  var hasFiles = function hasFiles(dataTransfer) {\n    if (dataTransfer.files) return dataTransfer.files.length > 0;\n    return false;\n  };\n  /**\n   * Extracts files from a DataTransfer object\n   */\n\n\n  var getFiles = function getFiles(dataTransfer) {\n    return new Promise(function (resolve, reject) {\n      // get the transfer items as promises\n      var promisedFiles = (dataTransfer.items ? Array.from(dataTransfer.items) : []). // only keep file system items (files and directories)\n      filter(function (item) {\n        return isFileSystemItem(item);\n      }) // map each item to promise\n      .map(function (item) {\n        return getFilesFromItem(item);\n      }); // if is empty, see if we can extract some info from the files property as a fallback\n\n      if (!promisedFiles.length) {\n        // TODO: test for directories (should not be allowed)\n        // Use FileReader, problem is that the files property gets lost in the process\n        resolve(dataTransfer.files ? Array.from(dataTransfer.files) : []);\n        return;\n      } // done!\n\n\n      Promise.all(promisedFiles).then(function (returnedFileGroups) {\n        // flatten groups\n        var files = [];\n        returnedFileGroups.forEach(function (group) {\n          files.push.apply(files, group);\n        }); // done (filter out empty files)!\n\n        resolve(files.filter(function (file) {\n          return file;\n        }).map(function (file) {\n          if (!file._relativePath) file._relativePath = file.webkitRelativePath;\n          return file;\n        }));\n      }).catch(console.error);\n    });\n  };\n\n  var isFileSystemItem = function isFileSystemItem(item) {\n    if (isEntry(item)) {\n      var entry = getAsEntry(item);\n\n      if (entry) {\n        return entry.isFile || entry.isDirectory;\n      }\n    }\n\n    return item.kind === 'file';\n  };\n\n  var getFilesFromItem = function getFilesFromItem(item) {\n    return new Promise(function (resolve, reject) {\n      if (isDirectoryEntry(item)) {\n        getFilesInDirectory(getAsEntry(item)).then(resolve).catch(reject);\n        return;\n      }\n\n      resolve([item.getAsFile()]);\n    });\n  };\n\n  var getFilesInDirectory = function getFilesInDirectory(entry) {\n    return new Promise(function (resolve, reject) {\n      var files = []; // the total entries to read\n\n      var dirCounter = 0;\n      var fileCounter = 0;\n\n      var resolveIfDone = function resolveIfDone() {\n        if (fileCounter === 0 && dirCounter === 0) {\n          resolve(files);\n        }\n      }; // the recursive function\n\n\n      var readEntries = function readEntries(dirEntry) {\n        dirCounter++;\n        var directoryReader = dirEntry.createReader(); // directories are returned in batches, we need to process all batches before we're done\n\n        var readBatch = function readBatch() {\n          directoryReader.readEntries(function (entries) {\n            if (entries.length === 0) {\n              dirCounter--;\n              resolveIfDone();\n              return;\n            }\n\n            entries.forEach(function (entry) {\n              // recursively read more directories\n              if (entry.isDirectory) {\n                readEntries(entry);\n              } else {\n                // read as file\n                fileCounter++;\n                entry.file(function (file) {\n                  var correctedFile = correctMissingFileType(file);\n                  if (entry.fullPath) correctedFile._relativePath = entry.fullPath;\n                  files.push(correctedFile);\n                  fileCounter--;\n                  resolveIfDone();\n                });\n              }\n            }); // try to get next batch of files\n\n            readBatch();\n          }, reject);\n        }; // read first batch of files\n\n\n        readBatch();\n      }; // go!\n\n\n      readEntries(entry);\n    });\n  };\n\n  var correctMissingFileType = function correctMissingFileType(file) {\n    if (file.type.length) return file;\n    var date = file.lastModifiedDate;\n    var name = file.name;\n    file = file.slice(0, file.size, guesstimateMimeType(getExtensionFromFilename(file.name)));\n    file.name = name;\n    file.lastModifiedDate = date;\n    return file;\n  };\n\n  var isDirectoryEntry = function isDirectoryEntry(item) {\n    return isEntry(item) && (getAsEntry(item) || {}).isDirectory;\n  };\n\n  var isEntry = function isEntry(item) {\n    return 'webkitGetAsEntry' in item;\n  };\n\n  var getAsEntry = function getAsEntry(item) {\n    return item.webkitGetAsEntry();\n  };\n  /**\n   * Extracts links from a DataTransfer object\n   */\n\n\n  var getLinks = function getLinks(dataTransfer) {\n    var links = [];\n\n    try {\n      // look in meta data property\n      links = getLinksFromTransferMetaData(dataTransfer);\n\n      if (links.length) {\n        return links;\n      }\n\n      links = getLinksFromTransferURLData(dataTransfer);\n    } catch (e) {// nope nope nope (probably IE trouble)\n    }\n\n    return links;\n  };\n\n  var getLinksFromTransferURLData = function getLinksFromTransferURLData(dataTransfer) {\n    var data = dataTransfer.getData('url');\n\n    if (typeof data === 'string' && data.length) {\n      return [data];\n    }\n\n    return [];\n  };\n\n  var getLinksFromTransferMetaData = function getLinksFromTransferMetaData(dataTransfer) {\n    var data = dataTransfer.getData('text/html');\n\n    if (typeof data === 'string' && data.length) {\n      var matches = data.match(/src\\s*=\\s*\"(.+?)\"/);\n\n      if (matches) {\n        return [matches[1]];\n      }\n    }\n\n    return [];\n  };\n\n  var dragNDropObservers = [];\n\n  var eventPosition = function eventPosition(e) {\n    return {\n      pageLeft: e.pageX,\n      pageTop: e.pageY,\n      scopeLeft: e.offsetX || e.layerX,\n      scopeTop: e.offsetY || e.layerY\n    };\n  };\n\n  var createDragNDropClient = function createDragNDropClient(element, scopeToObserve, filterElement) {\n    var observer = getDragNDropObserver(scopeToObserve);\n    var client = {\n      element: element,\n      filterElement: filterElement,\n      state: null,\n      ondrop: function ondrop() {},\n      onenter: function onenter() {},\n      ondrag: function ondrag() {},\n      onexit: function onexit() {},\n      onload: function onload() {},\n      allowdrop: function allowdrop() {}\n    };\n    client.destroy = observer.addListener(client);\n    return client;\n  };\n\n  var getDragNDropObserver = function getDragNDropObserver(element) {\n    // see if already exists, if so, return\n    var observer = dragNDropObservers.find(function (item) {\n      return item.element === element;\n    });\n\n    if (observer) {\n      return observer;\n    } // create new observer, does not yet exist for this element\n\n\n    var newObserver = createDragNDropObserver(element);\n    dragNDropObservers.push(newObserver);\n    return newObserver;\n  };\n\n  var createDragNDropObserver = function createDragNDropObserver(element) {\n    var clients = [];\n    var routes = {\n      dragenter: dragenter,\n      dragover: dragover,\n      dragleave: dragleave,\n      drop: drop\n    };\n    var handlers = {};\n    forin(routes, function (event, createHandler) {\n      handlers[event] = createHandler(element, clients);\n      element.addEventListener(event, handlers[event], false);\n    });\n    var observer = {\n      element: element,\n      addListener: function addListener(client) {\n        // add as client\n        clients.push(client); // return removeListener function\n\n        return function () {\n          // remove client\n          clients.splice(clients.indexOf(client), 1); // if no more clients, clean up observer\n\n          if (clients.length === 0) {\n            dragNDropObservers.splice(dragNDropObservers.indexOf(observer), 1);\n            forin(routes, function (event) {\n              element.removeEventListener(event, handlers[event], false);\n            });\n          }\n        };\n      }\n    };\n    return observer;\n  };\n\n  var elementFromPoint = function elementFromPoint(root, point) {\n    if (!('elementFromPoint' in root)) {\n      root = document;\n    }\n\n    return root.elementFromPoint(point.x, point.y);\n  };\n\n  var isEventTarget = function isEventTarget(e, target) {\n    // get root\n    var root = getRootNode(target); // get element at position\n    // if root is not actual shadow DOM and does not have elementFromPoint method, use the one on document\n\n    var elementAtPosition = elementFromPoint(root, {\n      x: e.pageX - window.pageXOffset,\n      y: e.pageY - window.pageYOffset\n    }); // test if target is the element or if one of its children is\n\n    return elementAtPosition === target || target.contains(elementAtPosition);\n  };\n\n  var initialTarget = null;\n\n  var setDropEffect = function setDropEffect(dataTransfer, effect) {\n    // is in try catch as IE11 will throw error if not\n    try {\n      dataTransfer.dropEffect = effect;\n    } catch (e) {}\n  };\n\n  var dragenter = function dragenter(root, clients) {\n    return function (e) {\n      e.preventDefault();\n      initialTarget = e.target;\n      clients.forEach(function (client) {\n        var element = client.element,\n            onenter = client.onenter;\n\n        if (isEventTarget(e, element)) {\n          client.state = 'enter'; // fire enter event\n\n          onenter(eventPosition(e));\n        }\n      });\n    };\n  };\n\n  var dragover = function dragover(root, clients) {\n    return function (e) {\n      e.preventDefault();\n      var dataTransfer = e.dataTransfer;\n      requestDataTransferItems(dataTransfer).then(function (items) {\n        var overDropTarget = false;\n        clients.some(function (client) {\n          var filterElement = client.filterElement,\n              element = client.element,\n              onenter = client.onenter,\n              onexit = client.onexit,\n              ondrag = client.ondrag,\n              allowdrop = client.allowdrop; // by default we can drop\n\n          setDropEffect(dataTransfer, 'copy'); // allow transfer of these items\n\n          var allowsTransfer = allowdrop(items); // only used when can be dropped on page\n\n          if (!allowsTransfer) {\n            setDropEffect(dataTransfer, 'none');\n            return;\n          } // targetting this client\n\n\n          if (isEventTarget(e, element)) {\n            overDropTarget = true; // had no previous state, means we are entering this client\n\n            if (client.state === null) {\n              client.state = 'enter';\n              onenter(eventPosition(e));\n              return;\n            } // now over element (no matter if it allows the drop or not)\n\n\n            client.state = 'over'; // needs to allow transfer\n\n            if (filterElement && !allowsTransfer) {\n              setDropEffect(dataTransfer, 'none');\n              return;\n            } // dragging\n\n\n            ondrag(eventPosition(e));\n          } else {\n            // should be over an element to drop\n            if (filterElement && !overDropTarget) {\n              setDropEffect(dataTransfer, 'none');\n            } // might have just left this client?\n\n\n            if (client.state) {\n              client.state = null;\n              onexit(eventPosition(e));\n            }\n          }\n        });\n      });\n    };\n  };\n\n  var drop = function drop(root, clients) {\n    return function (e) {\n      e.preventDefault();\n      var dataTransfer = e.dataTransfer;\n      requestDataTransferItems(dataTransfer).then(function (items) {\n        clients.forEach(function (client) {\n          var filterElement = client.filterElement,\n              element = client.element,\n              ondrop = client.ondrop,\n              onexit = client.onexit,\n              allowdrop = client.allowdrop;\n          client.state = null; // if we're filtering on element we need to be over the element to drop\n\n          if (filterElement && !isEventTarget(e, element)) return; // no transfer for this client\n\n          if (!allowdrop(items)) return onexit(eventPosition(e)); // we can drop these items on this client\n\n          ondrop(eventPosition(e), items);\n        });\n      });\n    };\n  };\n\n  var dragleave = function dragleave(root, clients) {\n    return function (e) {\n      if (initialTarget !== e.target) {\n        return;\n      }\n\n      clients.forEach(function (client) {\n        var onexit = client.onexit;\n        client.state = null;\n        onexit(eventPosition(e));\n      });\n    };\n  };\n\n  var createHopper = function createHopper(scope, validateItems, options) {\n    // is now hopper scope\n    scope.classList.add('filepond--hopper'); // shortcuts\n\n    var catchesDropsOnPage = options.catchesDropsOnPage,\n        requiresDropOnElement = options.requiresDropOnElement,\n        _options$filterItems = options.filterItems,\n        filterItems = _options$filterItems === void 0 ? function (items) {\n      return items;\n    } : _options$filterItems; // create a dnd client\n\n    var client = createDragNDropClient(scope, catchesDropsOnPage ? document.documentElement : scope, requiresDropOnElement); // current client state\n\n    var lastState = '';\n    var currentState = ''; // determines if a file may be dropped\n\n    client.allowdrop = function (items) {\n      // TODO: if we can, throw error to indicate the items cannot by dropped\n      return validateItems(filterItems(items));\n    };\n\n    client.ondrop = function (position, items) {\n      var filteredItems = filterItems(items);\n\n      if (!validateItems(filteredItems)) {\n        api.ondragend(position);\n        return;\n      }\n\n      currentState = 'drag-drop';\n      api.onload(filteredItems, position);\n    };\n\n    client.ondrag = function (position) {\n      api.ondrag(position);\n    };\n\n    client.onenter = function (position) {\n      currentState = 'drag-over';\n      api.ondragstart(position);\n    };\n\n    client.onexit = function (position) {\n      currentState = 'drag-exit';\n      api.ondragend(position);\n    };\n\n    var api = {\n      updateHopperState: function updateHopperState() {\n        if (lastState !== currentState) {\n          scope.dataset.hopperState = currentState;\n          lastState = currentState;\n        }\n      },\n      onload: function onload() {},\n      ondragstart: function ondragstart() {},\n      ondrag: function ondrag() {},\n      ondragend: function ondragend() {},\n      destroy: function destroy() {\n        // destroy client\n        client.destroy();\n      }\n    };\n    return api;\n  };\n\n  var listening = false;\n  var listeners$1 = [];\n\n  var handlePaste = function handlePaste(e) {\n    // if is pasting in input or textarea and the target is outside of a filepond scope, ignore\n    var activeEl = document.activeElement;\n\n    if (activeEl && /textarea|input/i.test(activeEl.nodeName)) {\n      // test textarea or input is contained in filepond root\n      var inScope = false;\n      var element = activeEl;\n\n      while (element !== document.body) {\n        if (element.classList.contains('filepond--root')) {\n          inScope = true;\n          break;\n        }\n\n        element = element.parentNode;\n      }\n\n      if (!inScope) return;\n    }\n\n    requestDataTransferItems(e.clipboardData).then(function (files) {\n      // no files received\n      if (!files.length) {\n        return;\n      } // notify listeners of received files\n\n\n      listeners$1.forEach(function (listener) {\n        return listener(files);\n      });\n    });\n  };\n\n  var listen = function listen(cb) {\n    // can't add twice\n    if (listeners$1.includes(cb)) {\n      return;\n    } // add initial listener\n\n\n    listeners$1.push(cb); // setup paste listener for entire page\n\n    if (listening) {\n      return;\n    }\n\n    listening = true;\n    document.addEventListener('paste', handlePaste);\n  };\n\n  var unlisten = function unlisten(listener) {\n    arrayRemove(listeners$1, listeners$1.indexOf(listener)); // clean up\n\n    if (listeners$1.length === 0) {\n      document.removeEventListener('paste', handlePaste);\n      listening = false;\n    }\n  };\n\n  var createPaster = function createPaster() {\n    var cb = function cb(files) {\n      api.onload(files);\n    };\n\n    var api = {\n      destroy: function destroy() {\n        unlisten(cb);\n      },\n      onload: function onload() {}\n    };\n    listen(cb);\n    return api;\n  };\n  /**\n   * Creates the file view\n   */\n\n\n  var create$d = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props;\n    root.element.id = 'filepond--assistant-' + props.id;\n    attr(root.element, 'role', 'status');\n    attr(root.element, 'aria-live', 'polite');\n    attr(root.element, 'aria-relevant', 'additions');\n  };\n\n  var addFilesNotificationTimeout = null;\n  var notificationClearTimeout = null;\n  var filenames = [];\n\n  var assist = function assist(root, message) {\n    root.element.textContent = message;\n  };\n\n  var clear$1 = function clear(root) {\n    root.element.textContent = '';\n  };\n\n  var listModified = function listModified(root, filename, label) {\n    var total = root.query('GET_TOTAL_ITEMS');\n    assist(root, label + ' ' + filename + ', ' + total + ' ' + (total === 1 ? root.query('GET_LABEL_FILE_COUNT_SINGULAR') : root.query('GET_LABEL_FILE_COUNT_PLURAL'))); // clear group after set amount of time so the status is not read twice\n\n    clearTimeout(notificationClearTimeout);\n    notificationClearTimeout = setTimeout(function () {\n      clear$1(root);\n    }, 1500);\n  };\n\n  var isUsingFilePond = function isUsingFilePond(root) {\n    return root.element.parentNode.contains(document.activeElement);\n  };\n\n  var itemAdded = function itemAdded(_ref2) {\n    var root = _ref2.root,\n        action = _ref2.action;\n\n    if (!isUsingFilePond(root)) {\n      return;\n    }\n\n    root.element.textContent = '';\n    var item = root.query('GET_ITEM', action.id);\n    filenames.push(item.filename);\n    clearTimeout(addFilesNotificationTimeout);\n    addFilesNotificationTimeout = setTimeout(function () {\n      listModified(root, filenames.join(', '), root.query('GET_LABEL_FILE_ADDED'));\n      filenames.length = 0;\n    }, 750);\n  };\n\n  var itemRemoved = function itemRemoved(_ref3) {\n    var root = _ref3.root,\n        action = _ref3.action;\n\n    if (!isUsingFilePond(root)) {\n      return;\n    }\n\n    var item = action.item;\n    listModified(root, item.filename, root.query('GET_LABEL_FILE_REMOVED'));\n  };\n\n  var itemProcessed = function itemProcessed(_ref4) {\n    var root = _ref4.root,\n        action = _ref4.action; // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file\n\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n    var label = root.query('GET_LABEL_FILE_PROCESSING_COMPLETE');\n    assist(root, filename + ' ' + label);\n  };\n\n  var itemProcessedUndo = function itemProcessedUndo(_ref5) {\n    var root = _ref5.root,\n        action = _ref5.action;\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n    var label = root.query('GET_LABEL_FILE_PROCESSING_ABORTED');\n    assist(root, filename + ' ' + label);\n  };\n\n  var itemError = function itemError(_ref6) {\n    var root = _ref6.root,\n        action = _ref6.action;\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename; // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file\n\n    assist(root, action.status.main + ' ' + filename + ' ' + action.status.sub);\n  };\n\n  var assistant = createView({\n    create: create$d,\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: itemAdded,\n      DID_REMOVE_ITEM: itemRemoved,\n      DID_COMPLETE_ITEM_PROCESSING: itemProcessed,\n      DID_ABORT_ITEM_PROCESSING: itemProcessedUndo,\n      DID_REVERT_ITEM_PROCESSING: itemProcessedUndo,\n      DID_THROW_ITEM_REMOVE_ERROR: itemError,\n      DID_THROW_ITEM_LOAD_ERROR: itemError,\n      DID_THROW_ITEM_INVALID: itemError,\n      DID_THROW_ITEM_PROCESSING_ERROR: itemError\n    }),\n    tag: 'span',\n    name: 'assistant'\n  });\n\n  var toCamels = function toCamels(string) {\n    var separator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';\n    return string.replace(new RegExp(separator + '.', 'g'), function (sub) {\n      return sub.charAt(1).toUpperCase();\n    });\n  };\n\n  var debounce = function debounce(func) {\n    var interval = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 16;\n    var immidiateOnly = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    var last = Date.now();\n    var timeout = null;\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      clearTimeout(timeout);\n      var dist = Date.now() - last;\n\n      var fn = function fn() {\n        last = Date.now();\n        func.apply(void 0, args);\n      };\n\n      if (dist < interval) {\n        // we need to delay by the difference between interval and dist\n        // for example: if distance is 10 ms and interval is 16 ms,\n        // we need to wait an additional 6ms before calling the function)\n        if (!immidiateOnly) {\n          timeout = setTimeout(fn, interval - dist);\n        }\n      } else {\n        // go!\n        fn();\n      }\n    };\n  };\n\n  var MAX_FILES_LIMIT = 1000000;\n\n  var prevent = function prevent(e) {\n    return e.preventDefault();\n  };\n\n  var create$e = function create(_ref) {\n    var root = _ref.root,\n        props = _ref.props; // Add id\n\n    var id = root.query('GET_ID');\n\n    if (id) {\n      root.element.id = id;\n    } // Add className\n\n\n    var className = root.query('GET_CLASS_NAME');\n\n    if (className) {\n      className.split(' ').filter(function (name) {\n        return name.length;\n      }).forEach(function (name) {\n        root.element.classList.add(name);\n      });\n    } // Field label\n\n\n    root.ref.label = root.appendChildView(root.createChildView(dropLabel, Object.assign({}, props, {\n      translateY: null,\n      caption: root.query('GET_LABEL_IDLE')\n    }))); // List of items\n\n    root.ref.list = root.appendChildView(root.createChildView(listScroller, {\n      translateY: null\n    })); // Background panel\n\n    root.ref.panel = root.appendChildView(root.createChildView(panel, {\n      name: 'panel-root'\n    })); // Assistant notifies assistive tech when content changes\n\n    root.ref.assistant = root.appendChildView(root.createChildView(assistant, Object.assign({}, props))); // Data\n\n    root.ref.data = root.appendChildView(root.createChildView(data, Object.assign({}, props))); // Measure (tests if fixed height was set)\n    // DOCTYPE needs to be set for this to work\n\n    root.ref.measure = createElement$1('div');\n    root.ref.measure.style.height = '100%';\n    root.element.appendChild(root.ref.measure); // information on the root height or fixed height status\n\n    root.ref.bounds = null; // apply initial style properties\n\n    root.query('GET_STYLES').filter(function (style) {\n      return !isEmpty(style.value);\n    }).map(function (_ref2) {\n      var name = _ref2.name,\n          value = _ref2.value;\n      root.element.dataset[name] = value;\n    }); // determine if width changed\n\n    root.ref.widthPrevious = null;\n    root.ref.widthUpdated = debounce(function () {\n      root.ref.updateHistory = [];\n      root.dispatch('DID_RESIZE_ROOT');\n    }, 250); // history of updates\n\n    root.ref.previousAspectRatio = null;\n    root.ref.updateHistory = []; // prevent scrolling and zooming on iOS (only if supports pointer events, for then we can enable reorder)\n\n    var canHover = window.matchMedia('(pointer: fine) and (hover: hover)').matches;\n    var hasPointerEvents = ('PointerEvent' in window);\n\n    if (root.query('GET_ALLOW_REORDER') && hasPointerEvents && !canHover) {\n      root.element.addEventListener('touchmove', prevent, {\n        passive: false\n      });\n      root.element.addEventListener('gesturestart', prevent);\n    }\n  };\n\n  var write$9 = function write(_ref3) {\n    var root = _ref3.root,\n        props = _ref3.props,\n        actions = _ref3.actions; // route actions\n\n    route$5({\n      root: root,\n      props: props,\n      actions: actions\n    }); // apply style properties\n\n    actions.filter(function (action) {\n      return /^DID_SET_STYLE_/.test(action.type);\n    }).filter(function (action) {\n      return !isEmpty(action.data.value);\n    }).map(function (_ref4) {\n      var type = _ref4.type,\n          data = _ref4.data;\n      var name = toCamels(type.substr(8).toLowerCase(), '_');\n      root.element.dataset[name] = data.value;\n      root.invalidateLayout();\n    });\n    if (root.rect.element.hidden) return;\n\n    if (root.rect.element.width !== root.ref.widthPrevious) {\n      root.ref.widthPrevious = root.rect.element.width;\n      root.ref.widthUpdated();\n    } // get box bounds, we do this only once\n\n\n    var bounds = root.ref.bounds;\n\n    if (!bounds) {\n      bounds = root.ref.bounds = calculateRootBoundingBoxHeight(root); // destroy measure element\n\n      root.element.removeChild(root.ref.measure);\n      root.ref.measure = null;\n    } // get quick references to various high level parts of the upload tool\n\n\n    var _root$ref = root.ref,\n        hopper = _root$ref.hopper,\n        label = _root$ref.label,\n        list = _root$ref.list,\n        panel = _root$ref.panel; // sets correct state to hopper scope\n\n    if (hopper) {\n      hopper.updateHopperState();\n    } // bool to indicate if we're full or not\n\n\n    var aspectRatio = root.query('GET_PANEL_ASPECT_RATIO');\n    var isMultiItem = root.query('GET_ALLOW_MULTIPLE');\n    var totalItems = root.query('GET_TOTAL_ITEMS');\n    var maxItems = isMultiItem ? root.query('GET_MAX_FILES') || MAX_FILES_LIMIT : 1;\n    var atMaxCapacity = totalItems === maxItems; // action used to add item\n\n    var addAction = actions.find(function (action) {\n      return action.type === 'DID_ADD_ITEM';\n    }); // if reached max capacity and we've just reached it\n\n    if (atMaxCapacity && addAction) {\n      // get interaction type\n      var interactionMethod = addAction.data.interactionMethod; // hide label\n\n      label.opacity = 0;\n\n      if (isMultiItem) {\n        label.translateY = -40;\n      } else {\n        if (interactionMethod === InteractionMethod.API) {\n          label.translateX = 40;\n        } else if (interactionMethod === InteractionMethod.BROWSE) {\n          label.translateY = 40;\n        } else {\n          label.translateY = 30;\n        }\n      }\n    } else if (!atMaxCapacity) {\n      label.opacity = 1;\n      label.translateX = 0;\n      label.translateY = 0;\n    }\n\n    var listItemMargin = calculateListItemMargin(root);\n    var listHeight = calculateListHeight(root);\n    var labelHeight = label.rect.element.height;\n    var currentLabelHeight = !isMultiItem || atMaxCapacity ? 0 : labelHeight;\n    var listMarginTop = atMaxCapacity ? list.rect.element.marginTop : 0;\n    var listMarginBottom = totalItems === 0 ? 0 : list.rect.element.marginBottom;\n    var visualHeight = currentLabelHeight + listMarginTop + listHeight.visual + listMarginBottom;\n    var boundsHeight = currentLabelHeight + listMarginTop + listHeight.bounds + listMarginBottom; // link list to label bottom position\n\n    list.translateY = Math.max(0, currentLabelHeight - list.rect.element.marginTop) - listItemMargin.top;\n\n    if (aspectRatio) {\n      // fixed aspect ratio\n      // calculate height based on width\n      var width = root.rect.element.width;\n      var height = width * aspectRatio; // clear history if aspect ratio has changed\n\n      if (aspectRatio !== root.ref.previousAspectRatio) {\n        root.ref.previousAspectRatio = aspectRatio;\n        root.ref.updateHistory = [];\n      } // remember this width\n\n\n      var history = root.ref.updateHistory;\n      history.push(width);\n      var MAX_BOUNCES = 2;\n\n      if (history.length > MAX_BOUNCES * 2) {\n        var l = history.length;\n        var bottom = l - 10;\n        var bounces = 0;\n\n        for (var i = l; i >= bottom; i--) {\n          if (history[i] === history[i - 2]) {\n            bounces++;\n          }\n\n          if (bounces >= MAX_BOUNCES) {\n            // dont adjust height\n            return;\n          }\n        }\n      } // fix height of panel so it adheres to aspect ratio\n\n\n      panel.scalable = false;\n      panel.height = height; // available height for list\n\n      var listAvailableHeight = // the height of the panel minus the label height\n      height - currentLabelHeight - ( // the room we leave open between the end of the list and the panel bottom\n      listMarginBottom - listItemMargin.bottom) - ( // if we're full we need to leave some room between the top of the panel and the list\n      atMaxCapacity ? listMarginTop : 0);\n\n      if (listHeight.visual > listAvailableHeight) {\n        list.overflow = listAvailableHeight;\n      } else {\n        list.overflow = null;\n      } // set container bounds (so pushes siblings downwards)\n\n\n      root.height = height;\n    } else if (bounds.fixedHeight) {\n      // fixed height\n      // fix height of panel\n      panel.scalable = false; // available height for list\n\n      var _listAvailableHeight = // the height of the panel minus the label height\n      bounds.fixedHeight - currentLabelHeight - ( // the room we leave open between the end of the list and the panel bottom\n      listMarginBottom - listItemMargin.bottom) - ( // if we're full we need to leave some room between the top of the panel and the list\n      atMaxCapacity ? listMarginTop : 0); // set list height\n\n\n      if (listHeight.visual > _listAvailableHeight) {\n        list.overflow = _listAvailableHeight;\n      } else {\n        list.overflow = null;\n      } // no need to set container bounds as these are handles by CSS fixed height\n\n    } else if (bounds.cappedHeight) {\n      // max-height\n      // not a fixed height panel\n      var isCappedHeight = visualHeight >= bounds.cappedHeight;\n      var panelHeight = Math.min(bounds.cappedHeight, visualHeight);\n      panel.scalable = true;\n      panel.height = isCappedHeight ? panelHeight : panelHeight - listItemMargin.top - listItemMargin.bottom; // available height for list\n\n      var _listAvailableHeight2 = // the height of the panel minus the label height\n      panelHeight - currentLabelHeight - ( // the room we leave open between the end of the list and the panel bottom\n      listMarginBottom - listItemMargin.bottom) - ( // if we're full we need to leave some room between the top of the panel and the list\n      atMaxCapacity ? listMarginTop : 0); // set list height (if is overflowing)\n\n\n      if (visualHeight > bounds.cappedHeight && listHeight.visual > _listAvailableHeight2) {\n        list.overflow = _listAvailableHeight2;\n      } else {\n        list.overflow = null;\n      } // set container bounds (so pushes siblings downwards)\n\n\n      root.height = Math.min(bounds.cappedHeight, boundsHeight - listItemMargin.top - listItemMargin.bottom);\n    } else {\n      // flexible height\n      // not a fixed height panel\n      var itemMargin = totalItems > 0 ? listItemMargin.top + listItemMargin.bottom : 0;\n      panel.scalable = true;\n      panel.height = Math.max(labelHeight, visualHeight - itemMargin); // set container bounds (so pushes siblings downwards)\n\n      root.height = Math.max(labelHeight, boundsHeight - itemMargin);\n    }\n  };\n\n  var calculateListItemMargin = function calculateListItemMargin(root) {\n    var item = root.ref.list.childViews[0].childViews[0];\n    return item ? {\n      top: item.rect.element.marginTop,\n      bottom: item.rect.element.marginBottom\n    } : {\n      top: 0,\n      bottom: 0\n    };\n  };\n\n  var calculateListHeight = function calculateListHeight(root) {\n    var visual = 0;\n    var bounds = 0; // get file list reference\n\n    var scrollList = root.ref.list;\n    var itemList = scrollList.childViews[0];\n    var visibleChildren = itemList.childViews.filter(function (child) {\n      return child.rect.element.height;\n    });\n    var children = root.query('GET_ACTIVE_ITEMS').map(function (item) {\n      return visibleChildren.find(function (child) {\n        return child.id === item.id;\n      });\n    }).filter(function (item) {\n      return item;\n    }); // no children, done!\n\n    if (children.length === 0) return {\n      visual: visual,\n      bounds: bounds\n    };\n    var horizontalSpace = itemList.rect.element.width;\n    var dragIndex = getItemIndexByPosition(itemList, children, scrollList.dragCoordinates);\n    var childRect = children[0].rect.element;\n    var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;\n    var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;\n    var itemWidth = childRect.width + itemHorizontalMargin;\n    var itemHeight = childRect.height + itemVerticalMargin;\n    var newItem = typeof dragIndex !== 'undefined' && dragIndex >= 0 ? 1 : 0;\n    var removedItem = children.find(function (child) {\n      return child.markedForRemoval && child.opacity < 0.45;\n    }) ? -1 : 0;\n    var verticalItemCount = children.length + newItem + removedItem;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth); // stack\n\n    if (itemsPerRow === 1) {\n      children.forEach(function (item) {\n        var height = item.rect.element.height + itemVerticalMargin;\n        bounds += height;\n        visual += height * item.opacity;\n      });\n    } // grid\n    else {\n        bounds = Math.ceil(verticalItemCount / itemsPerRow) * itemHeight;\n        visual = bounds;\n      }\n\n    return {\n      visual: visual,\n      bounds: bounds\n    };\n  };\n\n  var calculateRootBoundingBoxHeight = function calculateRootBoundingBoxHeight(root) {\n    var height = root.ref.measureHeight || null;\n    var cappedHeight = parseInt(root.style.maxHeight, 10) || null;\n    var fixedHeight = height === 0 ? null : height;\n    return {\n      cappedHeight: cappedHeight,\n      fixedHeight: fixedHeight\n    };\n  };\n\n  var exceedsMaxFiles = function exceedsMaxFiles(root, items) {\n    var allowReplace = root.query('GET_ALLOW_REPLACE');\n    var allowMultiple = root.query('GET_ALLOW_MULTIPLE');\n    var totalItems = root.query('GET_TOTAL_ITEMS');\n    var maxItems = root.query('GET_MAX_FILES'); // total amount of items being dragged\n\n    var totalBrowseItems = items.length; // if does not allow multiple items and dragging more than one item\n\n    if (!allowMultiple && totalBrowseItems > 1) {\n      return true;\n    } // limit max items to one if not allowed to drop multiple items\n\n\n    maxItems = allowMultiple ? maxItems : allowReplace ? maxItems : 1; // no more room?\n\n    var hasMaxItems = isInt(maxItems);\n\n    if (hasMaxItems && totalItems + totalBrowseItems > maxItems) {\n      root.dispatch('DID_THROW_MAX_FILES', {\n        source: items,\n        error: createResponse('warning', 0, 'Max files')\n      });\n      return true;\n    }\n\n    return false;\n  };\n\n  var getDragIndex = function getDragIndex(list, children, position) {\n    var itemList = list.childViews[0];\n    return getItemIndexByPosition(itemList, children, {\n      left: position.scopeLeft - itemList.rect.element.left,\n      top: position.scopeTop - (list.rect.outer.top + list.rect.element.marginTop + list.rect.element.scrollTop)\n    });\n  };\n  /**\n   * Enable or disable file drop functionality\n   */\n\n\n  var toggleDrop = function toggleDrop(root) {\n    var isAllowed = root.query('GET_ALLOW_DROP');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n\n    if (enabled && !root.ref.hopper) {\n      var hopper = createHopper(root.element, function (items) {\n        // these files don't fit so stop here\n        if (exceedsMaxFiles(root, items)) return false; // allow quick validation of dropped items\n\n        var beforeDropFile = root.query('GET_BEFORE_DROP_FILE') || function () {\n          return true;\n        }; // all items should be validated by all filters as valid\n\n\n        var dropValidation = root.query('GET_DROP_VALIDATION');\n        return dropValidation ? items.every(function (item) {\n          return applyFilters('ALLOW_HOPPER_ITEM', item, {\n            query: root.query\n          }).every(function (result) {\n            return result === true;\n          }) && beforeDropFile(item);\n        }) : true;\n      }, {\n        filterItems: function filterItems(items) {\n          var ignoredFiles = root.query('GET_IGNORED_FILES');\n          return items.filter(function (item) {\n            if (isFile(item)) {\n              return !ignoredFiles.includes(item.name.toLowerCase());\n            }\n\n            return true;\n          });\n        },\n        catchesDropsOnPage: root.query('GET_DROP_ON_PAGE'),\n        requiresDropOnElement: root.query('GET_DROP_ON_ELEMENT')\n      });\n\n      hopper.onload = function (items, position) {\n        // get item children elements and sort based on list sort\n        var list = root.ref.list.childViews[0];\n        var visibleChildren = list.childViews.filter(function (child) {\n          return child.rect.element.height;\n        });\n        var children = root.query('GET_ACTIVE_ITEMS').map(function (item) {\n          return visibleChildren.find(function (child) {\n            return child.id === item.id;\n          });\n        }).filter(function (item) {\n          return item;\n        }); // go\n\n        root.dispatch('ADD_ITEMS', {\n          items: items,\n          index: getDragIndex(root.ref.list, children, position),\n          interactionMethod: InteractionMethod.DROP\n        });\n        root.dispatch('DID_DROP', {\n          position: position\n        });\n        root.dispatch('DID_END_DRAG', {\n          position: position\n        });\n      };\n\n      hopper.ondragstart = function (position) {\n        root.dispatch('DID_START_DRAG', {\n          position: position\n        });\n      };\n\n      hopper.ondrag = debounce(function (position) {\n        root.dispatch('DID_DRAG', {\n          position: position\n        });\n      });\n\n      hopper.ondragend = function (position) {\n        root.dispatch('DID_END_DRAG', {\n          position: position\n        });\n      };\n\n      root.ref.hopper = hopper;\n      root.ref.drip = root.appendChildView(root.createChildView(drip));\n    } else if (!enabled && root.ref.hopper) {\n      root.ref.hopper.destroy();\n      root.ref.hopper = null;\n      root.removeChildView(root.ref.drip);\n    }\n  };\n  /**\n   * Enable or disable browse functionality\n   */\n\n\n  var toggleBrowse = function toggleBrowse(root, props) {\n    var isAllowed = root.query('GET_ALLOW_BROWSE');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n\n    if (enabled && !root.ref.browser) {\n      root.ref.browser = root.appendChildView(root.createChildView(browser, Object.assign({}, props, {\n        onload: function onload(items) {\n          // these files don't fit so stop here\n          if (exceedsMaxFiles(root, items)) return false; // add items!\n\n          root.dispatch('ADD_ITEMS', {\n            items: items,\n            index: -1,\n            interactionMethod: InteractionMethod.BROWSE\n          });\n        }\n      })), 0);\n    } else if (!enabled && root.ref.browser) {\n      root.removeChildView(root.ref.browser);\n      root.ref.browser = null;\n    }\n  };\n  /**\n   * Enable or disable paste functionality\n   */\n\n\n  var togglePaste = function togglePaste(root) {\n    var isAllowed = root.query('GET_ALLOW_PASTE');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n\n    if (enabled && !root.ref.paster) {\n      root.ref.paster = createPaster();\n\n      root.ref.paster.onload = function (items) {\n        root.dispatch('ADD_ITEMS', {\n          items: items,\n          index: -1,\n          interactionMethod: InteractionMethod.PASTE\n        });\n      };\n    } else if (!enabled && root.ref.paster) {\n      root.ref.paster.destroy();\n      root.ref.paster = null;\n    }\n  };\n  /**\n   * Route actions\n   */\n\n\n  var route$5 = createRoute({\n    DID_SET_ALLOW_BROWSE: function DID_SET_ALLOW_BROWSE(_ref5) {\n      var root = _ref5.root,\n          props = _ref5.props;\n      toggleBrowse(root, props);\n    },\n    DID_SET_ALLOW_DROP: function DID_SET_ALLOW_DROP(_ref6) {\n      var root = _ref6.root;\n      toggleDrop(root);\n    },\n    DID_SET_ALLOW_PASTE: function DID_SET_ALLOW_PASTE(_ref7) {\n      var root = _ref7.root;\n      togglePaste(root);\n    },\n    DID_SET_DISABLED: function DID_SET_DISABLED(_ref8) {\n      var root = _ref8.root,\n          props = _ref8.props;\n      toggleDrop(root);\n      togglePaste(root);\n      toggleBrowse(root, props);\n      var isDisabled = root.query('GET_DISABLED');\n\n      if (isDisabled) {\n        root.element.dataset.disabled = 'disabled';\n      } else {\n        // delete root.element.dataset.disabled; <= this does not work on iOS 10\n        root.element.removeAttribute('data-disabled');\n      }\n    }\n  });\n  var root = createView({\n    name: 'root',\n    read: function read(_ref9) {\n      var root = _ref9.root;\n\n      if (root.ref.measure) {\n        root.ref.measureHeight = root.ref.measure.offsetHeight;\n      }\n    },\n    create: create$e,\n    write: write$9,\n    destroy: function destroy(_ref10) {\n      var root = _ref10.root;\n\n      if (root.ref.paster) {\n        root.ref.paster.destroy();\n      }\n\n      if (root.ref.hopper) {\n        root.ref.hopper.destroy();\n      }\n\n      root.element.removeEventListener('touchmove', prevent);\n      root.element.removeEventListener('gesturestart', prevent);\n    },\n    mixins: {\n      styles: ['height']\n    }\n  }); // creates the app\n\n  var createApp = function createApp() {\n    var initialOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {}; // let element\n\n    var originalElement = null; // get default options\n\n    var defaultOptions = getOptions(); // create the data store, this will contain all our app info\n\n    var store = createStore( // initial state (should be serializable)\n    createInitialState(defaultOptions), // queries\n    [queries, createOptionQueries(defaultOptions)], // action handlers\n    [actions, createOptionActions(defaultOptions)]); // set initial options\n\n    store.dispatch('SET_OPTIONS', {\n      options: initialOptions\n    }); // kick thread if visibility changes\n\n    var visibilityHandler = function visibilityHandler() {\n      if (document.hidden) return;\n      store.dispatch('KICK');\n    };\n\n    document.addEventListener('visibilitychange', visibilityHandler); // re-render on window resize start and finish\n\n    var resizeDoneTimer = null;\n    var isResizing = false;\n    var isResizingHorizontally = false;\n    var initialWindowWidth = null;\n    var currentWindowWidth = null;\n\n    var resizeHandler = function resizeHandler() {\n      if (!isResizing) {\n        isResizing = true;\n      }\n\n      clearTimeout(resizeDoneTimer);\n      resizeDoneTimer = setTimeout(function () {\n        isResizing = false;\n        initialWindowWidth = null;\n        currentWindowWidth = null;\n\n        if (isResizingHorizontally) {\n          isResizingHorizontally = false;\n          store.dispatch('DID_STOP_RESIZE');\n        }\n      }, 500);\n    };\n\n    window.addEventListener('resize', resizeHandler); // render initial view\n\n    var view = root(store, {\n      id: getUniqueId()\n    }); //\n    // PRIVATE API -------------------------------------------------------------------------------------\n    //\n\n    var isResting = false;\n    var isHidden = false;\n    var readWriteApi = {\n      // necessary for update loop\n\n      /**\n       * Reads from dom (never call manually)\n       * @private\n       */\n      _read: function _read() {\n        // test if we're resizing horizontally\n        // TODO: see if we can optimize this by measuring root rect\n        if (isResizing) {\n          currentWindowWidth = window.innerWidth;\n\n          if (!initialWindowWidth) {\n            initialWindowWidth = currentWindowWidth;\n          }\n\n          if (!isResizingHorizontally && currentWindowWidth !== initialWindowWidth) {\n            store.dispatch('DID_START_RESIZE');\n            isResizingHorizontally = true;\n          }\n        }\n\n        if (isHidden && isResting) {\n          // test if is no longer hidden\n          isResting = view.element.offsetParent === null;\n        } // if resting, no need to read as numbers will still all be correct\n\n\n        if (isResting) return; // read view data\n\n        view._read(); // if is hidden we need to know so we exit rest mode when revealed\n\n\n        isHidden = view.rect.element.hidden;\n      },\n\n      /**\n       * Writes to dom (never call manually)\n       * @private\n       */\n      _write: function _write(ts) {\n        // get all actions from store\n        var actions = store.processActionQueue() // filter out set actions (these will automatically trigger DID_SET)\n        .filter(function (action) {\n          return !/^SET_/.test(action.type);\n        }); // if was idling and no actions stop here\n\n        if (isResting && !actions.length) return; // some actions might trigger events\n\n        routeActionsToEvents(actions); // update the view\n\n        isResting = view._write(ts, actions, isResizingHorizontally); // will clean up all archived items\n\n        removeReleasedItems(store.query('GET_ITEMS')); // now idling\n\n        if (isResting) {\n          store.processDispatchQueue();\n        }\n      }\n    }; //\n    // EXPOSE EVENTS -------------------------------------------------------------------------------------\n    //\n\n    var createEvent = function createEvent(name) {\n      return function (data) {\n        // create default event\n        var event = {\n          type: name\n        }; // no data to add\n\n        if (!data) {\n          return event;\n        } // copy relevant props\n\n\n        if (data.hasOwnProperty('error')) {\n          event.error = data.error ? Object.assign({}, data.error) : null;\n        }\n\n        if (data.status) {\n          event.status = Object.assign({}, data.status);\n        }\n\n        if (data.file) {\n          event.output = data.file;\n        } // only source is available, else add item if possible\n\n\n        if (data.source) {\n          event.file = data.source;\n        } else if (data.item || data.id) {\n          var item = data.item ? data.item : store.query('GET_ITEM', data.id);\n          event.file = item ? createItemAPI(item) : null;\n        } // map all items in a possible items array\n\n\n        if (data.items) {\n          event.items = data.items.map(createItemAPI);\n        } // if this is a progress event add the progress amount\n\n\n        if (/progress/.test(name)) {\n          event.progress = data.progress;\n        } // copy relevant props\n\n\n        if (data.hasOwnProperty('origin') && data.hasOwnProperty('target')) {\n          event.origin = data.origin;\n          event.target = data.target;\n        }\n\n        return event;\n      };\n    };\n\n    var eventRoutes = {\n      DID_DESTROY: createEvent('destroy'),\n      DID_INIT: createEvent('init'),\n      DID_THROW_MAX_FILES: createEvent('warning'),\n      DID_INIT_ITEM: createEvent('initfile'),\n      DID_START_ITEM_LOAD: createEvent('addfilestart'),\n      DID_UPDATE_ITEM_LOAD_PROGRESS: createEvent('addfileprogress'),\n      DID_LOAD_ITEM: createEvent('addfile'),\n      DID_THROW_ITEM_INVALID: [createEvent('error'), createEvent('addfile')],\n      DID_THROW_ITEM_LOAD_ERROR: [createEvent('error'), createEvent('addfile')],\n      DID_THROW_ITEM_REMOVE_ERROR: [createEvent('error'), createEvent('removefile')],\n      DID_PREPARE_OUTPUT: createEvent('preparefile'),\n      DID_START_ITEM_PROCESSING: createEvent('processfilestart'),\n      DID_UPDATE_ITEM_PROCESS_PROGRESS: createEvent('processfileprogress'),\n      DID_ABORT_ITEM_PROCESSING: createEvent('processfileabort'),\n      DID_COMPLETE_ITEM_PROCESSING: createEvent('processfile'),\n      DID_COMPLETE_ITEM_PROCESSING_ALL: createEvent('processfiles'),\n      DID_REVERT_ITEM_PROCESSING: createEvent('processfilerevert'),\n      DID_THROW_ITEM_PROCESSING_ERROR: [createEvent('error'), createEvent('processfile')],\n      DID_REMOVE_ITEM: createEvent('removefile'),\n      DID_UPDATE_ITEMS: createEvent('updatefiles'),\n      DID_ACTIVATE_ITEM: createEvent('activatefile'),\n      DID_REORDER_ITEMS: createEvent('reorderfiles')\n    };\n\n    var exposeEvent = function exposeEvent(event) {\n      // create event object to be dispatched\n      var detail = Object.assign({\n        pond: exports\n      }, event);\n      delete detail.type;\n      view.element.dispatchEvent(new CustomEvent('FilePond:' + event.type, {\n        // event info\n        detail: detail,\n        // event behaviour\n        bubbles: true,\n        cancelable: true,\n        composed: true // triggers listeners outside of shadow root\n\n      })); // event object to params used for `on()` event handlers and callbacks `oninit()`\n\n      var params = []; // if is possible error event, make it the first param\n\n      if (event.hasOwnProperty('error')) {\n        params.push(event.error);\n      } // file is always section\n\n\n      if (event.hasOwnProperty('file')) {\n        params.push(event.file);\n      } // append other props\n\n\n      var filtered = ['type', 'error', 'file'];\n      Object.keys(event).filter(function (key) {\n        return !filtered.includes(key);\n      }).forEach(function (key) {\n        return params.push(event[key]);\n      }); // on(type, () => { })\n\n      exports.fire.apply(exports, [event.type].concat(params)); // oninit = () => {}\n\n      var handler = store.query('GET_ON' + event.type.toUpperCase());\n\n      if (handler) {\n        handler.apply(void 0, params);\n      }\n    };\n\n    var routeActionsToEvents = function routeActionsToEvents(actions) {\n      if (!actions.length) return;\n      actions.filter(function (action) {\n        return eventRoutes[action.type];\n      }).forEach(function (action) {\n        var routes = eventRoutes[action.type];\n        (Array.isArray(routes) ? routes : [routes]).forEach(function (route) {\n          // this isn't fantastic, but because of the stacking of settimeouts plugins can handle the did_load before the did_init\n          if (action.type === 'DID_INIT_ITEM') {\n            exposeEvent(route(action.data));\n          } else {\n            setTimeout(function () {\n              exposeEvent(route(action.data));\n            }, 0);\n          }\n        });\n      });\n    }; //\n    // PUBLIC API -------------------------------------------------------------------------------------\n    //\n\n\n    var setOptions = function setOptions(options) {\n      return store.dispatch('SET_OPTIONS', {\n        options: options\n      });\n    };\n\n    var getFile = function getFile(query) {\n      return store.query('GET_ACTIVE_ITEM', query);\n    };\n\n    var prepareFile = function prepareFile(query) {\n      return new Promise(function (resolve, reject) {\n        store.dispatch('REQUEST_ITEM_PREPARE', {\n          query: query,\n          success: function success(item) {\n            resolve(item);\n          },\n          failure: function failure(error) {\n            reject(error);\n          }\n        });\n      });\n    };\n\n    var addFile = function addFile(source) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return new Promise(function (resolve, reject) {\n        addFiles([{\n          source: source,\n          options: options\n        }], {\n          index: options.index\n        }).then(function (items) {\n          return resolve(items && items[0]);\n        }).catch(reject);\n      });\n    };\n\n    var removeFile = function removeFile(query, options) {\n      // if only passed options\n      if (typeof query === 'object' && !options) {\n        options = query;\n        query = undefined;\n      } // request item removal\n\n\n      store.dispatch('REMOVE_ITEM', Object.assign({}, options, {\n        query: query\n      })); // see if item has been removed\n\n      return store.query('GET_ACTIVE_ITEM', query) === null;\n    };\n\n    var addFiles = function addFiles() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return new Promise(function (resolve, reject) {\n        var sources = [];\n        var options = {}; // user passed a sources array\n\n        if (isArray(args[0])) {\n          sources.push.apply(sources, args[0]);\n          Object.assign(options, args[1] || {});\n        } else {\n          // user passed sources as arguments, last one might be options object\n          var lastArgument = args[args.length - 1];\n\n          if (typeof lastArgument === 'object' && !(lastArgument instanceof Blob)) {\n            Object.assign(options, args.pop());\n          } // add rest to sources\n\n\n          sources.push.apply(sources, args);\n        }\n\n        store.dispatch('ADD_ITEMS', {\n          items: sources,\n          index: options.index,\n          interactionMethod: InteractionMethod.API,\n          success: resolve,\n          failure: reject\n        });\n      });\n    };\n\n    var getFiles = function getFiles() {\n      return store.query('GET_ACTIVE_ITEMS');\n    };\n\n    var processFile = function processFile(query) {\n      return new Promise(function (resolve, reject) {\n        store.dispatch('REQUEST_ITEM_PROCESSING', {\n          query: query,\n          success: function success(item) {\n            resolve(item);\n          },\n          failure: function failure(error) {\n            reject(error);\n          }\n        });\n      });\n    };\n\n    var prepareFiles = function prepareFiles() {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n      var items = queries.length ? queries : getFiles();\n      return Promise.all(items.map(prepareFile));\n    };\n\n    var processFiles = function processFiles() {\n      for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        args[_key3] = arguments[_key3];\n      }\n\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n\n      if (!queries.length) {\n        var files = getFiles().filter(function (item) {\n          return !(item.status === ItemStatus.IDLE && item.origin === FileOrigin.LOCAL) && item.status !== ItemStatus.PROCESSING && item.status !== ItemStatus.PROCESSING_COMPLETE && item.status !== ItemStatus.PROCESSING_REVERT_ERROR;\n        });\n        return Promise.all(files.map(processFile));\n      }\n\n      return Promise.all(queries.map(processFile));\n    };\n\n    var removeFiles = function removeFiles() {\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n      var options;\n\n      if (typeof queries[queries.length - 1] === 'object') {\n        options = queries.pop();\n      } else if (Array.isArray(args[0])) {\n        options = args[1];\n      }\n\n      var files = getFiles();\n      if (!queries.length) return Promise.all(files.map(function (file) {\n        return removeFile(file, options);\n      })); // when removing by index the indexes shift after each file removal so we need to convert indexes to ids\n\n      var mappedQueries = queries.map(function (query) {\n        return isNumber(query) ? files[query] ? files[query].id : null : query;\n      }).filter(function (query) {\n        return query;\n      });\n      return mappedQueries.map(function (q) {\n        return removeFile(q, options);\n      });\n    };\n\n    var exports = Object.assign({}, on(), {}, readWriteApi, {}, createOptionAPI(store, defaultOptions), {\n      /**\n       * Override options defined in options object\n       * @param options\n       */\n      setOptions: setOptions,\n\n      /**\n       * Load the given file\n       * @param source - the source of the file (either a File, base64 data uri or url)\n       * @param options - object, { index: 0 }\n       */\n      addFile: addFile,\n\n      /**\n       * Load the given files\n       * @param sources - the sources of the files to load\n       * @param options - object, { index: 0 }\n       */\n      addFiles: addFiles,\n\n      /**\n       * Returns the file objects matching the given query\n       * @param query { string, number, null }\n       */\n      getFile: getFile,\n\n      /**\n       * Upload file with given name\n       * @param query { string, number, null  }\n       */\n      processFile: processFile,\n\n      /**\n       * Request prepare output for file with given name\n       * @param query { string, number, null  }\n       */\n      prepareFile: prepareFile,\n\n      /**\n       * Removes a file by its name\n       * @param query { string, number, null  }\n       */\n      removeFile: removeFile,\n\n      /**\n       * Moves a file to a new location in the files list\n       */\n      moveFile: function moveFile(query, index) {\n        return store.dispatch('MOVE_ITEM', {\n          query: query,\n          index: index\n        });\n      },\n\n      /**\n       * Returns all files (wrapped in public api)\n       */\n      getFiles: getFiles,\n\n      /**\n       * Starts uploading all files\n       */\n      processFiles: processFiles,\n\n      /**\n       * Clears all files from the files list\n       */\n      removeFiles: removeFiles,\n\n      /**\n       * Starts preparing output of all files\n       */\n      prepareFiles: prepareFiles,\n\n      /**\n       * Sort list of files\n       */\n      sort: function sort(compare) {\n        return store.dispatch('SORT', {\n          compare: compare\n        });\n      },\n\n      /**\n       * Browse the file system for a file\n       */\n      browse: function browse() {\n        // needs to be trigger directly as user action needs to be traceable (is not traceable in requestAnimationFrame)\n        var input = view.element.querySelector('input[type=file]');\n\n        if (input) {\n          input.click();\n        }\n      },\n\n      /**\n       * Destroys the app\n       */\n      destroy: function destroy() {\n        // request destruction\n        exports.fire('destroy', view.element); // stop active processes (file uploads, fetches, stuff like that)\n        // loop over items and depending on states call abort for ongoing processes\n\n        store.dispatch('ABORT_ALL'); // destroy view\n\n        view._destroy(); // stop listening to resize\n\n\n        window.removeEventListener('resize', resizeHandler); // stop listening to the visiblitychange event\n\n        document.removeEventListener('visibilitychange', visibilityHandler); // dispatch destroy\n\n        store.dispatch('DID_DESTROY');\n      },\n\n      /**\n       * Inserts the plugin before the target element\n       */\n      insertBefore: function insertBefore$1(element) {\n        return insertBefore(view.element, element);\n      },\n\n      /**\n       * Inserts the plugin after the target element\n       */\n      insertAfter: function insertAfter$1(element) {\n        return insertAfter(view.element, element);\n      },\n\n      /**\n       * Appends the plugin to the target element\n       */\n      appendTo: function appendTo(element) {\n        return element.appendChild(view.element);\n      },\n\n      /**\n       * Replaces an element with the app\n       */\n      replaceElement: function replaceElement(element) {\n        // insert the app before the element\n        insertBefore(view.element, element); // remove the original element\n\n        element.parentNode.removeChild(element); // remember original element\n\n        originalElement = element;\n      },\n\n      /**\n       * Restores the original element\n       */\n      restoreElement: function restoreElement() {\n        if (!originalElement) {\n          return; // no element to restore\n        } // restore original element\n\n\n        insertAfter(originalElement, view.element); // remove our element\n\n        view.element.parentNode.removeChild(view.element); // remove reference\n\n        originalElement = null;\n      },\n\n      /**\n       * Returns true if the app root is attached to given element\n       * @param element\n       */\n      isAttachedTo: function isAttachedTo(element) {\n        return view.element === element || originalElement === element;\n      },\n\n      /**\n       * Returns the root element\n       */\n      element: {\n        get: function get() {\n          return view.element;\n        }\n      },\n\n      /**\n       * Returns the current pond status\n       */\n      status: {\n        get: function get() {\n          return store.query('GET_STATUS');\n        }\n      }\n    }); // Done!\n\n    store.dispatch('DID_INIT'); // create actual api object\n\n    return createObject(exports);\n  };\n\n  var createAppObject = function createAppObject() {\n    var customOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {}; // default options\n\n    var defaultOptions = {};\n    forin(getOptions(), function (key, value) {\n      defaultOptions[key] = value[0];\n    }); // set app options\n\n    var app = createApp(Object.assign({}, defaultOptions, {}, customOptions)); // return the plugin instance\n\n    return app;\n  };\n\n  var lowerCaseFirstLetter = function lowerCaseFirstLetter(string) {\n    return string.charAt(0).toLowerCase() + string.slice(1);\n  };\n\n  var attributeNameToPropertyName = function attributeNameToPropertyName(attributeName) {\n    return toCamels(attributeName.replace(/^data-/, ''));\n  };\n\n  var mapObject = function mapObject(object, propertyMap) {\n    // remove unwanted\n    forin(propertyMap, function (selector, mapping) {\n      forin(object, function (property, value) {\n        // create regexp shortcut\n        var selectorRegExp = new RegExp(selector); // tests if\n\n        var matches = selectorRegExp.test(property); // no match, skip\n\n        if (!matches) {\n          return;\n        } // if there's a mapping, the original property is always removed\n\n\n        delete object[property]; // should only remove, we done!\n\n        if (mapping === false) {\n          return;\n        } // move value to new property\n\n\n        if (isString(mapping)) {\n          object[mapping] = value;\n          return;\n        } // move to group\n\n\n        var group = mapping.group;\n\n        if (isObject(mapping) && !object[group]) {\n          object[group] = {};\n        }\n\n        object[group][lowerCaseFirstLetter(property.replace(selectorRegExp, ''))] = value;\n      }); // do submapping\n\n      if (mapping.mapping) {\n        mapObject(object[mapping.group], mapping.mapping);\n      }\n    });\n  };\n\n  var getAttributesAsObject = function getAttributesAsObject(node) {\n    var attributeMapping = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {}; // turn attributes into object\n\n    var attributes = [];\n    forin(node.attributes, function (index) {\n      attributes.push(node.attributes[index]);\n    });\n    var output = attributes.filter(function (attribute) {\n      return attribute.name;\n    }).reduce(function (obj, attribute) {\n      var value = attr(node, attribute.name);\n      obj[attributeNameToPropertyName(attribute.name)] = value === attribute.name ? true : value;\n      return obj;\n    }, {}); // do mapping of object properties\n\n    mapObject(output, attributeMapping);\n    return output;\n  };\n\n  var createAppAtElement = function createAppAtElement(element) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {}; // how attributes of the input element are mapped to the options for the plugin\n\n    var attributeMapping = {\n      // translate to other name\n      '^class$': 'className',\n      '^multiple$': 'allowMultiple',\n      '^capture$': 'captureMethod',\n      '^webkitdirectory$': 'allowDirectoriesOnly',\n      // group under single property\n      '^server': {\n        group: 'server',\n        mapping: {\n          '^process': {\n            group: 'process'\n          },\n          '^revert': {\n            group: 'revert'\n          },\n          '^fetch': {\n            group: 'fetch'\n          },\n          '^restore': {\n            group: 'restore'\n          },\n          '^load': {\n            group: 'load'\n          }\n        }\n      },\n      // don't include in object\n      '^type$': false,\n      '^files$': false\n    }; // add additional option translators\n\n    applyFilters('SET_ATTRIBUTE_TO_OPTION_MAP', attributeMapping); // create final options object by setting options object and then overriding options supplied on element\n\n    var mergedOptions = Object.assign({}, options);\n    var attributeOptions = getAttributesAsObject(element.nodeName === 'FIELDSET' ? element.querySelector('input[type=file]') : element, attributeMapping); // merge with options object\n\n    Object.keys(attributeOptions).forEach(function (key) {\n      if (isObject(attributeOptions[key])) {\n        if (!isObject(mergedOptions[key])) {\n          mergedOptions[key] = {};\n        }\n\n        Object.assign(mergedOptions[key], attributeOptions[key]);\n      } else {\n        mergedOptions[key] = attributeOptions[key];\n      }\n    }); // if parent is a fieldset, get files from parent by selecting all input fields that are not file upload fields\n    // these will then be automatically set to the initial files\n\n    mergedOptions.files = (options.files || []).concat(Array.from(element.querySelectorAll('input:not([type=file])')).map(function (input) {\n      return {\n        source: input.value,\n        options: {\n          type: input.dataset.type\n        }\n      };\n    })); // build plugin\n\n    var app = createAppObject(mergedOptions); // add already selected files\n\n    if (element.files) {\n      Array.from(element.files).forEach(function (file) {\n        app.addFile(file);\n      });\n    } // replace the target element\n\n\n    app.replaceElement(element); // expose\n\n    return app;\n  }; // if an element is passed, we create the instance at that element, if not, we just create an up object\n\n\n  var createApp$1 = function createApp() {\n    return isNode(arguments.length <= 0 ? undefined : arguments[0]) ? createAppAtElement.apply(void 0, arguments) : createAppObject.apply(void 0, arguments);\n  };\n\n  var PRIVATE_METHODS = ['fire', '_read', '_write'];\n\n  var createAppAPI = function createAppAPI(app) {\n    var api = {};\n    copyObjectPropertiesToObject(app, api, PRIVATE_METHODS);\n    return api;\n  };\n  /**\n   * Replaces placeholders in given string with replacements\n   * @param string - \"Foo {bar}\"\"\n   * @param replacements - { \"bar\": 10 }\n   */\n\n\n  var replaceInString = function replaceInString(string, replacements) {\n    return string.replace(/(?:{([a-zA-Z]+)})/g, function (match, group) {\n      return replacements[group];\n    });\n  };\n\n  var createWorker = function createWorker(fn) {\n    var workerBlob = new Blob(['(', fn.toString(), ')()'], {\n      type: 'application/javascript'\n    });\n    var workerURL = URL.createObjectURL(workerBlob);\n    var worker = new Worker(workerURL);\n    return {\n      transfer: function transfer(message, cb) {},\n      post: function post(message, cb, transferList) {\n        var id = getUniqueId();\n\n        worker.onmessage = function (e) {\n          if (e.data.id === id) {\n            cb(e.data.message);\n          }\n        };\n\n        worker.postMessage({\n          id: id,\n          message: message\n        }, transferList);\n      },\n      terminate: function terminate() {\n        worker.terminate();\n        URL.revokeObjectURL(workerURL);\n      }\n    };\n  };\n\n  var loadImage = function loadImage(url) {\n    return new Promise(function (resolve, reject) {\n      var img = new Image();\n\n      img.onload = function () {\n        resolve(img);\n      };\n\n      img.onerror = function (e) {\n        reject(e);\n      };\n\n      img.src = url;\n    });\n  };\n\n  var renameFile = function renameFile(file, name) {\n    var renamedFile = file.slice(0, file.size, file.type);\n    renamedFile.lastModifiedDate = file.lastModifiedDate;\n    renamedFile.name = name;\n    return renamedFile;\n  };\n\n  var copyFile = function copyFile(file) {\n    return renameFile(file, file.name);\n  }; // already registered plugins (can't register twice)\n\n\n  var registeredPlugins = []; // pass utils to plugin\n\n  var createAppPlugin = function createAppPlugin(plugin) {\n    // already registered\n    if (registeredPlugins.includes(plugin)) {\n      return;\n    } // remember this plugin\n\n\n    registeredPlugins.push(plugin); // setup!\n\n    var pluginOutline = plugin({\n      addFilter: addFilter,\n      utils: {\n        Type: Type,\n        forin: forin,\n        isString: isString,\n        isFile: isFile,\n        toNaturalFileSize: toNaturalFileSize,\n        replaceInString: replaceInString,\n        getExtensionFromFilename: getExtensionFromFilename,\n        getFilenameWithoutExtension: getFilenameWithoutExtension,\n        guesstimateMimeType: guesstimateMimeType,\n        getFileFromBlob: getFileFromBlob,\n        getFilenameFromURL: getFilenameFromURL,\n        createRoute: createRoute,\n        createWorker: createWorker,\n        createView: createView,\n        createItemAPI: createItemAPI,\n        loadImage: loadImage,\n        copyFile: copyFile,\n        renameFile: renameFile,\n        createBlob: createBlob,\n        applyFilterChain: applyFilterChain,\n        text: text,\n        getNumericAspectRatioFromString: getNumericAspectRatioFromString\n      },\n      views: {\n        fileActionButton: fileActionButton\n      }\n    }); // add plugin options to default options\n\n    extendDefaultOptions(pluginOutline.options);\n  }; // feature detection used by supported() method\n\n\n  var isOperaMini = function isOperaMini() {\n    return Object.prototype.toString.call(window.operamini) === '[object OperaMini]';\n  };\n\n  var hasPromises = function hasPromises() {\n    return 'Promise' in window;\n  };\n\n  var hasBlobSlice = function hasBlobSlice() {\n    return 'slice' in Blob.prototype;\n  };\n\n  var hasCreateObjectURL = function hasCreateObjectURL() {\n    return 'URL' in window && 'createObjectURL' in window.URL;\n  };\n\n  var hasVisibility = function hasVisibility() {\n    return 'visibilityState' in document;\n  };\n\n  var hasTiming = function hasTiming() {\n    return 'performance' in window;\n  }; // iOS 8.x\n\n\n  var hasCSSSupports = function hasCSSSupports() {\n    return 'supports' in (window.CSS || {});\n  }; // use to detect Safari 9+\n\n\n  var isIE11 = function isIE11() {\n    return /MSIE|Trident/.test(window.navigator.userAgent);\n  };\n\n  var supported = function () {\n    // Runs immidiately and then remembers result for subsequent calls\n    var isSupported = // Has to be a browser\n    isBrowser() && // Can't run on Opera Mini due to lack of everything\n    !isOperaMini() && // Require these APIs to feature detect a modern browser\n    hasVisibility() && hasPromises() && hasBlobSlice() && hasCreateObjectURL() && hasTiming() && ( // doesn't need CSSSupports but is a good way to detect Safari 9+ (we do want to support IE11 though)\n    hasCSSSupports() || isIE11());\n    return function () {\n      return isSupported;\n    };\n  }();\n  /**\n   * Plugin internal state (over all instances)\n   */\n\n\n  var state = {\n    // active app instances, used to redraw the apps and to find the later\n    apps: []\n  }; // plugin name\n\n  var name = 'filepond';\n  /**\n   * Public Plugin methods\n   */\n\n  var fn = function fn() {};\n\n  exports.Status = {};\n  exports.FileStatus = {};\n  exports.FileOrigin = {};\n  exports.OptionTypes = {};\n  exports.create = fn;\n  exports.destroy = fn;\n  exports.parse = fn;\n  exports.find = fn;\n  exports.registerPlugin = fn;\n  exports.getOptions = fn;\n  exports.setOptions = fn; // if not supported, no API\n\n  if (supported()) {\n    // start painter and fire load event\n    createPainter(function () {\n      state.apps.forEach(function (app) {\n        return app._read();\n      });\n    }, function (ts) {\n      state.apps.forEach(function (app) {\n        return app._write(ts);\n      });\n    }); // fire loaded event so we know when FilePond is available\n\n    var dispatch = function dispatch() {\n      // let others know we have area ready\n      document.dispatchEvent(new CustomEvent('FilePond:loaded', {\n        detail: {\n          supported: supported,\n          create: exports.create,\n          destroy: exports.destroy,\n          parse: exports.parse,\n          find: exports.find,\n          registerPlugin: exports.registerPlugin,\n          setOptions: exports.setOptions\n        }\n      })); // clean up event\n\n      document.removeEventListener('DOMContentLoaded', dispatch);\n    };\n\n    if (document.readyState !== 'loading') {\n      // move to back of execution queue, FilePond should have been exported by then\n      setTimeout(function () {\n        return dispatch();\n      }, 0);\n    } else {\n      document.addEventListener('DOMContentLoaded', dispatch);\n    } // updates the OptionTypes object based on the current options\n\n\n    var updateOptionTypes = function updateOptionTypes() {\n      return forin(getOptions(), function (key, value) {\n        exports.OptionTypes[key] = value[1];\n      });\n    };\n\n    exports.Status = Object.assign({}, Status);\n    exports.FileOrigin = Object.assign({}, FileOrigin);\n    exports.FileStatus = Object.assign({}, ItemStatus);\n    exports.OptionTypes = {};\n    updateOptionTypes(); // create method, creates apps and adds them to the app array\n\n    exports.create = function create() {\n      var app = createApp$1.apply(void 0, arguments);\n      app.on('destroy', exports.destroy);\n      state.apps.push(app);\n      return createAppAPI(app);\n    }; // destroys apps and removes them from the app array\n\n\n    exports.destroy = function destroy(hook) {\n      // returns true if the app was destroyed successfully\n      var indexToRemove = state.apps.findIndex(function (app) {\n        return app.isAttachedTo(hook);\n      });\n\n      if (indexToRemove >= 0) {\n        // remove from apps\n        var app = state.apps.splice(indexToRemove, 1)[0]; // restore original dom element\n\n        app.restoreElement();\n        return true;\n      }\n\n      return false;\n    }; // parses the given context for plugins (does not include the context element itself)\n\n\n    exports.parse = function parse(context) {\n      // get all possible hooks\n      var matchedHooks = Array.from(context.querySelectorAll('.' + name)); // filter out already active hooks\n\n      var newHooks = matchedHooks.filter(function (newHook) {\n        return !state.apps.find(function (app) {\n          return app.isAttachedTo(newHook);\n        });\n      }); // create new instance for each hook\n\n      return newHooks.map(function (hook) {\n        return exports.create(hook);\n      });\n    }; // returns an app based on the given element hook\n\n\n    exports.find = function find(hook) {\n      var app = state.apps.find(function (app) {\n        return app.isAttachedTo(hook);\n      });\n\n      if (!app) {\n        return null;\n      }\n\n      return createAppAPI(app);\n    }; // adds a plugin extension\n\n\n    exports.registerPlugin = function registerPlugin() {\n      for (var _len = arguments.length, plugins = new Array(_len), _key = 0; _key < _len; _key++) {\n        plugins[_key] = arguments[_key];\n      } // register plugins\n\n\n      plugins.forEach(createAppPlugin); // update OptionTypes, each plugin might have extended the default options\n\n      updateOptionTypes();\n    };\n\n    exports.getOptions = function getOptions$1() {\n      var opts = {};\n      forin(getOptions(), function (key, value) {\n        opts[key] = value[0];\n      });\n      return opts;\n    };\n\n    exports.setOptions = function setOptions$1(opts) {\n      if (isObject(opts)) {\n        // update existing plugins\n        state.apps.forEach(function (app) {\n          app.setOptions(opts);\n        }); // override defaults\n\n        setOptions(opts);\n      } // return new options\n\n\n      return exports.getOptions();\n    };\n  }\n\n  exports.supported = supported;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","map":{"version":3,"sources":["C:/Users/jassem/Desktop/my_portfolio/node_modules/filepond/dist/filepond.js"],"names":["global","factory","exports","module","define","amd","self","FilePond","isNode","value","HTMLElement","createStore","initialState","queries","arguments","length","undefined","actions","state","Object","assign","actionQueue","dispatchQueue","getState","processActionQueue","queue","concat","processDispatchQueue","forEach","_ref","type","data","dispatch","isBlocking","document","hidden","push","actionHandlers","query","str","_queryHandles","_len","args","Array","_key","queryHandles","apply","api","action","defineProperty","obj","property","definition","forin","cb","key","hasOwnProperty","createObject","attr","node","name","getAttribute","hasAttribute","setAttribute","ns","svgElements","isSVGElement","tag","includes","createElement","className","attributes","element","createElementNS","appendChild","parent","child","index","children","insertBefore","appendChildView","childViews","view","splice","removeChildView","indexOf","parentNode","removeChild","IS_BROWSER","window","isBrowser","testElement","getChildCount","el","childNodes","getViewRect","elementRect","offset","scale","left","top","right","width","bottom","height","rect","inner","outer","filter","childView","isRectIgnored","map","childViewRect","expandRect","calculateRectSize","marginBottom","marginRight","isNumber","thereYet","position","destination","velocity","errorMargin","Math","abs","spring","_ref$stiffness","stiffness","_ref$damping","damping","_ref$mass","mass","target","resting","interpolate","ts","skipToEndState","f","onupdate","oncomplete","setTarget","set","get","easeLinear","t","easeInOutQuad","tween","_ref$duration","duration","_ref$easing","easing","_ref$delay","delay","start","p","reverse","animator","createAnimator","category","def","props","addGetSet","keys","overwrite","isArray","o","getter","setter","animations","mixinConfig","viewProps","viewInternalAPI","viewExternalAPI","initialProps","animation","prop","write","destroy","addEvent","fn","addEventListener","removeEvent","removeEventListener","listeners","viewState","events","add","remove","on","off","findIndex","event","apis","isDefined","defaults","opacity","scaleX","scaleY","translateX","translateY","rotateX","rotateY","rotateZ","originX","originY","styles","currentProps","getOffset","getScale","getRect","propsHaveChanged","applyStyles","newProps","_ref2","perspective","transforms","elementCurrentStyle","style","cssText","Mixins","updateRect","layoutCalculated","paddingTop","parseInt","marginTop","marginLeft","offsetLeft","offsetTop","offsetWidth","offsetHeight","scrollTop","offsetParent","createView","_ref$tag","_ref$name","_ref$attributes","_ref$read","read","_ref$write","_ref$create","create","_ref$destroy","_ref$filterFrameActio","filterFrameActionsForChild","_ref$didCreateView","didCreateView","_ref$didWriteView","didWriteView","_ref$ignoreRect","ignoreRect","_ref$ignoreRectUpdate","ignoreRectUpdate","_ref$mixins","mixins","store","getComputedStyle","frameRect","isResting","activeMixins","ref","writers","readers","destroyers","getElement","getChildViews","getReference","createChildView","getStyle","_read","shouldUpdate","root","internalAPI","reader","_write","frameActions","shouldOptimize","writer","writerResting","timestamp","mixin","mixinResting","childResting","_destroy","destroyer","sharedAPIDefinition","internalAPIDefinition","is","needle","linkView","unlinkView","registerWriter","registerReader","registerDestroyer","invalidateLayout","externalAPIDefinition","mixinAPIDefinition","sort","a","b","mixinAPI","childCount","createPainter","fps","painter","interval","last","id","requestTick","cancelTick","setTimerType","setTimeout","tick","performance","now","clearTimeout","requestAnimationFrame","cancelAnimationFrame","delta","pause","createRoute","routes","_ref$actions","newNode","referenceNode","insertAfter","nextSibling","isEmpty","trim","toString","toArray","splitter","split","isBoolean","toBoolean","isString","toNumber","replace","toInt","toFloat","parseFloat","isInt","isFinite","floor","toBytes","naturalFileSize","test","isFunction","toFunctionReference","string","levels","level","shift","methods","process","patch","revert","fetch","restore","load","createServerAPI","outline","url","timeout","headers","createAction","method","withCredentials","onload","ondata","onerror","parts","header","toServerAPI","isNull","isObject","isAPI","getType","replaceSingleQuotes","conversionTable","array","boolean","int","number","float","bytes","function","_function","serverapi","object","JSON","parse","e","convertTo","getValueByType","newValue","defaultValue","valueType","newValueType","convertedValue","option","createOption","currentValue","enumerable","createOptions","options","optionDefinition","createInitialState","items","listUpdateTimeout","itemUpdateTimeout","processingQueue","fromCamels","separator","part","toLowerCase","join","createOptionAPI","toUpperCase","createOptionActions","createOptionQueries","InteractionMethod","API","DROP","BROWSE","PASTE","NONE","getUniqueId","random","substr","_typeof","Symbol","iterator","constructor","prototype","REACT_ELEMENT_TYPE","_jsx","defaultProps","childrenLength","propName","childArray","i","$$typeof","_owner","_asyncIterator","iterable","asyncIterator","call","TypeError","_AwaitValue","wrapped","_AsyncGenerator","gen","front","back","send","arg","Promise","resolve","reject","request","next","resume","result","wrappedAwait","then","settle","done","err","_invoke","return","throw","_wrapAsyncGenerator","_awaitAsyncGenerator","_asyncGeneratorDelegate","awaitWrap","iter","waiting","pump","asyncGeneratorStep","_next","_throw","info","error","_asyncToGenerator","_classCallCheck","instance","Constructor","_defineProperties","descriptor","configurable","writable","_createClass","protoProps","staticProps","_defineEnumerableProperties","descs","desc","getOwnPropertySymbols","objectSymbols","sym","_defaults","getOwnPropertyNames","getOwnPropertyDescriptor","_defineProperty","_extends","source","_objectSpread","ownKeys","enumerableOnly","symbols","_objectSpread2","getOwnPropertyDescriptors","defineProperties","_inherits","subClass","superClass","_setPrototypeOf","_inheritsLoose","__proto__","_getPrototypeOf","setPrototypeOf","getPrototypeOf","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","_construct","Parent","Class","Function","bind","_isNativeFunction","_wrapNativeSuper","_cache","Map","has","Wrapper","_instanceof","hasInstance","_interopRequireDefault","__esModule","default","_interopRequireWildcard","newObj","_newArrowCheck","innerThis","boundThis","_objectDestructuringEmpty","_objectWithoutPropertiesLoose","excluded","sourceKeys","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","_superPropBase","_get","receiver","base","_set","isStrict","s","Error","_taggedTemplateLiteral","strings","raw","slice","freeze","_taggedTemplateLiteralLoose","_temporalRef","val","_temporalUndefined","_readOnlyError","_classNameTDZError","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_slicedToArrayLoose","_iterableToArrayLimitLoose","_toArray","_iterableToArray","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","arr2","from","_arr","_n","_d","_e","_i","_s","_iterator","_step","_skipFirstGeneratorNext","it","_toPrimitive","input","hint","prim","toPrimitive","res","String","Number","_toPropertyKey","_initializerWarningHelper","context","_initializerDefineProperty","initializer","_applyDecoratedDescriptor","decorators","reduce","decorator","_classPrivateFieldLooseKey","_classPrivateFieldLooseBase","privateKey","_classPrivateFieldGet","privateMap","_classPrivateFieldSet","_classPrivateFieldDestructureSet","__destrObj","v","_classStaticPrivateFieldSpecGet","classConstructor","_classStaticPrivateFieldSpecSet","_classStaticPrivateMethodGet","_classStaticPrivateMethodSet","_decorate","_getDecoratorsApi","r","initialize","O","initializeInstanceElements","decorated","elements","decorateClass","_coalesceClassElements","d","_createElementDescriptor","initializeClassElements","F","runClassFinishers","finishers","elementsDefinitionOrder","kind","placement","defineClassElement","proto","newElements","placements","static","own","addElementPlacement","_hasDecorators","elementFinishersExtras","decorateElement","extras","decorateConstructor","silent","elementObject","fromElementDescriptor","elementFinisherExtras","toElementFinisherExtras","finisher","newExtras","j","fromClassDescriptor","elementsAndFinisher","toClassDescriptor","k","toStringTag","toElementDescriptors","elementObjects","toElementDescriptor","disallowProperty","_optionalCallableProperty","newConstructor","objectType","_coalesceGetterSetter","other","isSameElement","find","_isDataDescriptor","_classPrivateMethodGet","privateSet","_classPrivateMethodSet","_wrapRegExp","re","groups","BabelRegExp","_RegExp","RegExp","_super","_groups","WeakMap","_this","exec","buildGroups","substitution","_","g","arrayRemove","run","sync","listener","_fire","fire","fireSync","_len2","_key2","onOnce","_cb","copyObjectPropertiesToObject","src","PRIVATE","createItemAPI","item","removeReleasedItems","released","ItemStatus","INIT","IDLE","PROCESSING_QUEUED","PROCESSING","PROCESSING_COMPLETE","PROCESSING_ERROR","PROCESSING_REVERT_ERROR","LOADING","LOAD_ERROR","FileOrigin","INPUT","LIMBO","LOCAL","getNonNumeric","getDecimalSeparator","toLocaleString","getThousandsSeparator","decimalSeparator","thousandsStringWithSeparator","thousandsStringWithoutSeparator","Type","BOOLEAN","INT","NUMBER","STRING","ARRAY","OBJECT","FUNCTION","ACTION","SERVER_API","REGEX","filters","applyFilterChain","utils","matchingFilters","initialFilter","current","catch","applyFilters","addFilter","extendDefaultOptions","additionalOptions","defaultOptions","getOptions","setOptions","opts","disabled","required","captureMethod","allowSyncAcceptAttribute","allowDrop","allowBrowse","allowPaste","allowMultiple","allowReplace","allowRevert","allowProcess","allowReorder","allowDirectoriesOnly","forceRevert","maxFiles","checkValidity","itemInsertLocationFreedom","itemInsertLocation","itemInsertInterval","dropOnPage","dropOnElement","dropValidation","ignoredFiles","instantUpload","maxParallelUploads","chunkUploads","chunkForce","chunkSize","chunkRetryDelays","server","labelDecimalSeparator","labelThousandsSeparator","labelIdle","labelInvalidField","labelFileWaitingForSize","labelFileSizeNotAvailable","labelFileCountSingular","labelFileCountPlural","labelFileLoading","labelFileAdded","labelFileLoadError","labelFileRemoved","labelFileRemoveError","labelFileProcessing","labelFileProcessingComplete","labelFileProcessingAborted","labelFileProcessingError","labelFileProcessingRevertError","labelTapToCancel","labelTapToRetry","labelTapToUndo","labelButtonRemoveItem","labelButtonAbortItemLoad","labelButtonRetryItemLoad","labelButtonAbortItemProcessing","labelButtonUndoItemProcessing","labelButtonRetryItemProcessing","labelButtonProcessItem","iconRemove","iconProcess","iconRetry","iconUndo","iconDone","oninit","onwarning","onactivatefile","oninitfile","onaddfilestart","onaddfileprogress","onaddfile","onprocessfilestart","onprocessfileprogress","onprocessfileabort","onprocessfilerevert","onprocessfile","onprocessfiles","onremovefile","onpreparefile","onupdatefiles","onreorderfiles","beforeDropFile","beforeAddFile","beforeRemoveFile","stylePanelLayout","stylePanelAspectRatio","styleItemPanelAspectRatio","styleButtonRemoveItemPosition","styleButtonProcessItemPosition","styleLoadIndicatorPosition","styleProgressIndicatorPosition","styleButtonRemoveItemAlign","files","getItemByQuery","getNumericAspectRatioFromString","aspectRatio","getActiveItems","archived","Status","EMPTY","ERROR","BUSY","READY","ITEM_ERROR","ITEM_BUSY","ITEM_READY","isItemInErrorState","status","isItemInBusyState","isItemInReadyState","GET_STATUS","some","GET_ITEM","GET_ACTIVE_ITEM","GET_ACTIVE_ITEMS","GET_ITEMS","GET_ITEM_NAME","filename","GET_ITEM_SIZE","fileSize","GET_STYLES","GET_PANEL_ASPECT_RATIO","isShapeCircle","GET_ITEM_PANEL_ASPECT_RATIO","GET_ITEMS_BY_STATUS","GET_TOTAL_ITEMS","IS_ASYNC","hasRoomForItem","count","maxFileCount","limit","min","max","arrayInsert","insertItem","isBase64DataURI","getFilenameFromURL","pop","getExtensionFromFilename","guesstimateExtension","subtype","leftPad","padding","getDateString","date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getFileFromBlob","blob","extension","file","size","lastModifiedDate","_relativePath","getBlobBuilder","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","createBlob","arrayBuffer","mimeType","BB","bb","append","getBlob","Blob","getBlobFromByteStringWithMimeType","byteString","ab","ArrayBuffer","ia","Uint8Array","charCodeAt","getMimeTypeFromBase64DataURI","dataURI","getBase64DataFromBase64DataURI","getByteStringFromBase64DataURI","atob","getBlobFromBase64DataURI","getFileFromBase64DataURI","getFileNameFromHeader","matches","decodeURI","getFileSizeFromHeader","match","getTranfserIdFromHeader","getFileInfoFromHeaders","rows","_iteratorNormalCompletion","_didIteratorError","_iteratorError","createFileLoader","fetchFn","complete","progress","getProgress","abort","File","loadURL","body","code","response","computable","total","fileinfo","setSource","isGet","sendRequest","onheaders","onprogress","ontimeout","onabort","aborted","xhr","headersReceived","encodeURI","encodeURIComponent","stringify","XMLHttpRequest","upload","lengthComputable","loaded","onreadystatechange","readyState","open","unescape","setRequestHeader","responseType","createResponse","createTimeoutResponse","getAllResponseHeaders","hasQS","buildURL","createFetchFunction","apiUrl","statusText","ChunkStatus","QUEUED","COMPLETE","WAITING","processFileChunked","metadata","transfer","chunks","chunkTransferId","chunkServer","serverId","fd","getResponseHeader","requestTransferId","formData","FormData","requestParams","requestTransferOffset","requestUrl","lastChunkIndex","retries","completeProcessingChunks","canProcessChunk","chunk","processChunk","every","processChunks","updateTotalProgress","retryProcessChunk","totalBytesTransfered","totalSize","totalProcessing","abortChunks","createFileProcessorFunction","canChunkUpload","shouldChunkUpload","willChunkUpload","createProcessorFunction","params","createRevertFunction","uniqueFileId","getRandomNumber","createPerceivedPerformanceUpdater","tickMin","tickMax","runtime","clear","createFileProcessor","processFn","perceivedProgress","perceivedPerformanceUpdater","perceivedDuration","progressFn","completeFn","transferId","reset","getDuration","getFilenameWithoutExtension","lastIndexOf","createFileStub","isFile","deepCloneObject","createItem","origin","serverFileReference","frozen","processingAborted","activeLoader","activeProcessor","abortProcessingRequestComplete","setStatus","getFileExtension","getFileType","getFileSize","getFile","loader","meta","success","retryLoad","abortLoad","processor","onprocess","console","requestProcessing","abortProcessing","revertFileUpload","_setMetadata","setMetadata","getMetadata","filenameWithoutExtension","fileExtension","fileType","relativePath","extend","handler","itemAPI","release","archive","getItemIndexByQuery","getItemById","itemId","fetchBlob","getDomainFromURL","location","protocol","isExternalURL","href","dynamicLabel","label","isMockItem","listUpdated","optionalPromise","sortItems","compare","getItemByQueryFromState","itemHandler","_ref$success","_ref$failure","failure","ABORT_ALL","DID_SET_FILES","_ref2$value","activeItems","interactionMethod","DID_UPDATE_ITEM_METADATA","_ref3","shouldPrepareOutput","doUpload","MOVE_ITEM","_ref4","currentIndex","SORT","_ref5","ADD_ITEMS","_ref6","_ref6$success","_ref6$failure","insertLocation","totalItems","isValidFile","validItems","promises","all","ADD_ITEM","_ref7","_ref7$index","_ref7$success","_ref7$failure","_ref7$options","_item","mainStatus","main","sub","handleAdd","shouldAdd","change","loadComplete","_ref8","REQUEST_PREPARE_OUTPUT","_ref9","_ref9$failure","COMPLETE_LOAD_ITEM","_ref10","RETRY_ITEM_LOAD","REQUEST_ITEM_PREPARE","_success","output","REQUEST_ITEM_PROCESSING","itemCanBeQueuedForProcessing","processNow","PROCESS_ITEM","totalCurrentUploads","processNext","queueEntry","itemReference","allItemsProcessed","RETRY_ITEM_PROCESSING","REQUEST_REMOVE_ITEM","shouldRemove","RELEASE_ITEM","REMOVE_ITEM","removeFromView","ABORT_ITEM_LOAD","ABORT_ITEM_PROCESSING","REQUEST_REVERT_ITEM_PROCESSING","handleRevert","shouldRevert","requestRemoveResult","REVERT_ITEM_PROCESSING","SET_OPTIONS","_ref11","formatFilename","createElement$1","tagName","text","textNode","createTextNode","nodeValue","polarToCartesian","centerX","centerY","radius","angleInDegrees","angleInRadians","PI","x","cos","y","sin","describeArc","startAngle","endAngle","arcSweep","end","percentageArc","to","spin","svg","path","align","dataset","ringStrokeWidth","ringFrom","ringTo","coordinates","progressIndicator","create$1","innerHTML","icon","isDisabled","write$1","shouldDisable","removeAttribute","fileActionButton","toNaturalFileSize","round","MB","KB","GB","removeDecimalsWhenZero","decimalCount","toFixed","create$2","fileName","updateFile","updateFileSizeOnError","fileInfo","DID_LOAD_ITEM","DID_UPDATE_ITEM_META","DID_THROW_ITEM_LOAD_ERROR","DID_THROW_ITEM_INVALID","toPercentage","create$3","didSetItemLoadProgress","title","didSetItemProcessProgress","didRequestItemProcessing","didAbortItemProcessing","didCompleteItemProcessing","fileStatus","DID_REVERT_ITEM_PROCESSING","DID_REQUEST_ITEM_PROCESSING","DID_ABORT_ITEM_PROCESSING","DID_COMPLETE_ITEM_PROCESSING","DID_UPDATE_ITEM_PROCESS_PROGRESS","DID_UPDATE_ITEM_LOAD_PROGRESS","DID_THROW_ITEM_PROCESSING_ERROR","DID_THROW_ITEM_PROCESSING_REVERT_ERROR","DID_THROW_ITEM_REMOVE_ERROR","Buttons","AbortItemLoad","RetryItemLoad","RemoveItem","ProcessItem","AbortItemProcessing","RetryItemProcessing","RevertItemProcessing","ButtonKeys","calculateFileInfoOffset","buttonRect","buttonRemoveItem","calculateButtonWidth","buttonAbortItemLoad","calculateFileVerticalCenterOffset","calculateFileHorizontalCenterOffset","getLoadIndicatorAlignment","getProcessIndicatorAlignment","getRemoveIndicatorAligment","DefaultStyle","buttonRetryItemLoad","buttonProcessItem","buttonAbortItemProcessing","buttonRetryItemProcessing","buttonRevertItemProcessing","loadProgressIndicator","processProgressIndicator","processingCompleteIndicator","IdleStyle","ProcessingStyle","StyleMap","DID_START_ITEM_LOAD","DID_START_ITEM_REMOVE","DID_LOAD_LOCAL_ITEM","DID_START_ITEM_PROCESSING","processingCompleteIndicatorView","create$4","isAsync","alignRemoveItemButton","buttonFilter","enabledButtons","_map","buttonView","classList","stopPropagation","loadIndicatorView","progressIndicatorView","activeStyles","write$2","route","stylesToApply","defaultStyles","control","DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING","DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD","DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL","buttonAbortItemRemoval","_ref12","create$5","didLoadItem","fileWrapper","PANEL_SPRING_PROPS","create$6","section","createSection","scalable","viewConstructor","write$3","topRect","bottomRect","center","panel","createDragHelper","itemIds","prevIndex","setIndex","getIndex","getItemIndex","ITEM_TRANSLATE_SPRING","ITEM_SCALE_SPRING","StateMap","create$7","handleClick","container","markedForRemoval","dragState","grab","isPrimary","removedActivateListener","pageX","pageY","dragOrigin","dragCenter","offsetX","offsetY","drag","preventDefault","dragOffset","dist","drop","route$1","DID_UPDATE_PANEL_HEIGHT","write$4","DID_GRAB_ITEM","DID_DRAG_ITEM","DID_DROP_ITEM","currentState","filepondItemState","getItemIndexByPosition","positionInView","horizontalSpace","l","itemRect","itemHorizontalMargin","itemWidth","itemsPerRow","childMid","itemVerticalMargin","itemHeight","_index","indexX","indexY","itemTop","itemRight","itemBottom","dropAreaDimensions","getHeight","setHeight","getWidth","setWidth","setDimensions","create$8","lastItemSpanwDate","addItemView","addIndex","spawnDate","cooldown","moveItem","vx","vy","introItemView","removeItemView","getItemHeight","getItemWidth","dragItem","numItems","oldIndex","dragPosition","dragHeight","dragWidth","cols","getGridIndex","getColIndex","visibleChildren","idx","childHeight","childBottom","childTop","route$2","DID_ADD_ITEM","DID_REMOVE_ITEM","write$5","dragCoordinates","dragIndex","dragIndexOffset","removeIndexOffset","addIndexOffset","childRect","visualHeight","prevX","prevY","visualIndex","vectorX","sign","vectorY","filterSetItemActions","list","create$9","overflowing","storeDragCoordinates","scopeLeft","scopeTop","clearDragCoordinates","route$3","DID_DRAG","DID_END_DRAG","write$6","overflow","newHeight","listScroller","attrToggle","enabledValue","resetFileInput","form","create$a","setAcceptedFileTypes","toggleAllowMultiple","toggleDirectoryFilter","toggleDisabled","toggleRequired","setCaptureMethod","handleChange","webkitRelativePath","doesAllowBrowse","disableField","updateRequiredStatus","shouldCheckValidity","setCustomValidity","updateFieldValidityStatus","browser","DID_SET_DISABLED","DID_SET_ALLOW_BROWSE","DID_SET_ALLOW_DIRECTORIES_ONLY","DID_SET_ALLOW_MULTIPLE","DID_SET_ACCEPTED_FILE_TYPES","DID_SET_CAPTURE_METHOD","DID_SET_REQUIRED","Key","ENTER","SPACE","create$b","handleKeyDown","isActivationKey","keyCode","click","isLabelClick","contains","updateLabelValue","caption","clickable","querySelector","dropLabel","DID_SET_LABEL_IDLE","addBlob","moveBlob","hideBlob","explodeBlob","write$7","route$4","DID_DROP","drip","create$c","fields","getField","syncFieldPositionsWithItems","didReorderItems","didAddItem","dataContainer","didLoadItem$1","field","didSetDisabled","didRemoveItem","didDefineValue","write$8","DID_DEFINE_VALUE","DID_REORDER_ITEMS","DID_SORT_ITEMS","getRootNode","images","text$1","zip","epub","guesstimateMimeType","requestDataTransferItems","dataTransfer","links","getLinks","hasFiles","getFiles","promisedFiles","isFileSystemItem","getFilesFromItem","returnedFileGroups","group","isEntry","entry","getAsEntry","isDirectory","isDirectoryEntry","getFilesInDirectory","getAsFile","dirCounter","fileCounter","resolveIfDone","readEntries","dirEntry","directoryReader","createReader","readBatch","entries","correctedFile","correctMissingFileType","fullPath","webkitGetAsEntry","getLinksFromTransferMetaData","getLinksFromTransferURLData","getData","dragNDropObservers","eventPosition","pageLeft","pageTop","layerX","layerY","createDragNDropClient","scopeToObserve","filterElement","observer","getDragNDropObserver","client","ondrop","onenter","ondrag","onexit","allowdrop","addListener","newObserver","createDragNDropObserver","clients","dragenter","dragover","dragleave","handlers","createHandler","elementFromPoint","point","isEventTarget","elementAtPosition","pageXOffset","pageYOffset","initialTarget","setDropEffect","effect","dropEffect","overDropTarget","allowsTransfer","createHopper","scope","validateItems","catchesDropsOnPage","requiresDropOnElement","_options$filterItems","filterItems","documentElement","lastState","filteredItems","ondragend","ondragstart","updateHopperState","hopperState","listening","listeners$1","handlePaste","activeEl","activeElement","nodeName","inScope","clipboardData","listen","unlisten","createPaster","create$d","addFilesNotificationTimeout","notificationClearTimeout","filenames","assist","message","textContent","clear$1","listModified","isUsingFilePond","itemAdded","itemRemoved","itemProcessed","itemProcessedUndo","itemError","assistant","toCamels","charAt","debounce","func","immidiateOnly","MAX_FILES_LIMIT","prevent","create$e","measure","bounds","widthPrevious","widthUpdated","updateHistory","previousAspectRatio","canHover","matchMedia","hasPointerEvents","passive","write$9","route$5","calculateRootBoundingBoxHeight","_root$ref","hopper","isMultiItem","maxItems","atMaxCapacity","addAction","listItemMargin","calculateListItemMargin","listHeight","calculateListHeight","labelHeight","currentLabelHeight","listMarginTop","listMarginBottom","visual","boundsHeight","history","MAX_BOUNCES","bounces","listAvailableHeight","fixedHeight","_listAvailableHeight","cappedHeight","isCappedHeight","panelHeight","_listAvailableHeight2","itemMargin","scrollList","itemList","newItem","removedItem","verticalItemCount","ceil","measureHeight","maxHeight","exceedsMaxFiles","totalBrowseItems","hasMaxItems","getDragIndex","toggleDrop","isAllowed","enabled","toggleBrowse","togglePaste","paster","DID_SET_ALLOW_DROP","DID_SET_ALLOW_PASTE","createApp","initialOptions","originalElement","visibilityHandler","resizeDoneTimer","isResizing","isResizingHorizontally","initialWindowWidth","currentWindowWidth","resizeHandler","isHidden","readWriteApi","innerWidth","routeActionsToEvents","createEvent","eventRoutes","DID_DESTROY","DID_INIT","DID_THROW_MAX_FILES","DID_INIT_ITEM","DID_PREPARE_OUTPUT","DID_COMPLETE_ITEM_PROCESSING_ALL","DID_UPDATE_ITEMS","DID_ACTIVATE_ITEM","exposeEvent","detail","pond","dispatchEvent","CustomEvent","bubbles","cancelable","composed","filtered","prepareFile","addFile","addFiles","removeFile","sources","lastArgument","processFile","prepareFiles","processFiles","_len3","_key3","removeFiles","_len4","_key4","mappedQueries","q","moveFile","browse","insertBefore$1","insertAfter$1","appendTo","replaceElement","restoreElement","isAttachedTo","createAppObject","customOptions","app","lowerCaseFirstLetter","attributeNameToPropertyName","attributeName","mapObject","propertyMap","selector","mapping","selectorRegExp","getAttributesAsObject","attributeMapping","attribute","createAppAtElement","mergedOptions","attributeOptions","querySelectorAll","createApp$1","PRIVATE_METHODS","createAppAPI","replaceInString","replacements","createWorker","workerBlob","workerURL","URL","createObjectURL","worker","Worker","post","transferList","onmessage","postMessage","terminate","revokeObjectURL","loadImage","img","Image","renameFile","renamedFile","copyFile","registeredPlugins","createAppPlugin","plugin","pluginOutline","views","isOperaMini","operamini","hasPromises","hasBlobSlice","hasCreateObjectURL","hasVisibility","hasTiming","hasCSSSupports","CSS","isIE11","navigator","userAgent","supported","isSupported","apps","FileStatus","OptionTypes","registerPlugin","updateOptionTypes","hook","indexToRemove","matchedHooks","newHooks","newHook","plugins","getOptions$1","setOptions$1"],"mappings":"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","sourcesContent":["/*!\n * FilePond 4.19.2\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n\n(function(global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined'\n    ? factory(exports)\n    : typeof define === 'function' && define.amd\n    ? define(['exports'], factory)\n    : ((global = global || self), factory((global.FilePond = {})));\n})(this, function(exports) {\n  'use strict';\n\n  var isNode = function isNode(value) {\n    return value instanceof HTMLElement;\n  };\n\n  var createStore = function createStore(initialState) {\n    var queries =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var actions =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n    // internal state\n    var state = Object.assign({}, initialState);\n\n    // contains all actions for next frame, is clear when actions are requested\n    var actionQueue = [];\n    var dispatchQueue = [];\n\n    // returns a duplicate of the current state\n    var getState = function getState() {\n      return Object.assign({}, state);\n    };\n\n    // returns a duplicate of the actions array and clears the actions array\n    var processActionQueue = function processActionQueue() {\n      // create copy of actions queue\n      var queue = [].concat(actionQueue);\n\n      // clear actions queue (we don't want no double actions)\n      actionQueue.length = 0;\n\n      return queue;\n    };\n\n    // processes actions that might block the main UI thread\n    var processDispatchQueue = function processDispatchQueue() {\n      // create copy of actions queue\n      var queue = [].concat(dispatchQueue);\n\n      // clear actions queue (we don't want no double actions)\n      dispatchQueue.length = 0;\n\n      // now dispatch these actions\n      queue.forEach(function(_ref) {\n        var type = _ref.type,\n          data = _ref.data;\n        dispatch(type, data);\n      });\n    };\n\n    // adds a new action, calls its handler and\n    var dispatch = function dispatch(type, data, isBlocking) {\n      // is blocking action (should never block if document is hidden)\n      if (isBlocking && !document.hidden) {\n        dispatchQueue.push({ type: type, data: data });\n        return;\n      }\n\n      // if this action has a handler, handle the action\n      if (actionHandlers[type]) {\n        actionHandlers[type](data);\n      }\n\n      // now add action\n      actionQueue.push({\n        type: type,\n        data: data\n      });\n    };\n\n    var query = function query(str) {\n      var _queryHandles;\n      for (\n        var _len = arguments.length,\n          args = new Array(_len > 1 ? _len - 1 : 0),\n          _key = 1;\n        _key < _len;\n        _key++\n      ) {\n        args[_key - 1] = arguments[_key];\n      }\n      return queryHandles[str]\n        ? (_queryHandles = queryHandles)[str].apply(_queryHandles, args)\n        : null;\n    };\n\n    var api = {\n      getState: getState,\n      processActionQueue: processActionQueue,\n      processDispatchQueue: processDispatchQueue,\n      dispatch: dispatch,\n      query: query\n    };\n\n    var queryHandles = {};\n    queries.forEach(function(query) {\n      queryHandles = Object.assign({}, query(state), {}, queryHandles);\n    });\n\n    var actionHandlers = {};\n    actions.forEach(function(action) {\n      actionHandlers = Object.assign(\n        {},\n        action(dispatch, query, state),\n        {},\n        actionHandlers\n      );\n    });\n\n    return api;\n  };\n\n  var defineProperty = function defineProperty(obj, property, definition) {\n    if (typeof definition === 'function') {\n      obj[property] = definition;\n      return;\n    }\n    Object.defineProperty(obj, property, Object.assign({}, definition));\n  };\n\n  var forin = function forin(obj, cb) {\n    for (var key in obj) {\n      if (!obj.hasOwnProperty(key)) {\n        continue;\n      }\n\n      cb(key, obj[key]);\n    }\n  };\n\n  var createObject = function createObject(definition) {\n    var obj = {};\n    forin(definition, function(property) {\n      defineProperty(obj, property, definition[property]);\n    });\n    return obj;\n  };\n\n  var attr = function attr(node, name) {\n    var value =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    if (value === null) {\n      return node.getAttribute(name) || node.hasAttribute(name);\n    }\n    node.setAttribute(name, value);\n  };\n\n  var ns = 'http://www.w3.org/2000/svg';\n  var svgElements = ['svg', 'path']; // only svg elements used\n\n  var isSVGElement = function isSVGElement(tag) {\n    return svgElements.includes(tag);\n  };\n\n  var createElement = function createElement(tag, className) {\n    var attributes =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    if (typeof className === 'object') {\n      attributes = className;\n      className = null;\n    }\n    var element = isSVGElement(tag)\n      ? document.createElementNS(ns, tag)\n      : document.createElement(tag);\n    if (className) {\n      if (isSVGElement(tag)) {\n        attr(element, 'class', className);\n      } else {\n        element.className = className;\n      }\n    }\n    forin(attributes, function(name, value) {\n      attr(element, name, value);\n    });\n    return element;\n  };\n\n  var appendChild = function appendChild(parent) {\n    return function(child, index) {\n      if (typeof index !== 'undefined' && parent.children[index]) {\n        parent.insertBefore(child, parent.children[index]);\n      } else {\n        parent.appendChild(child);\n      }\n    };\n  };\n\n  var appendChildView = function appendChildView(parent, childViews) {\n    return function(view, index) {\n      if (typeof index !== 'undefined') {\n        childViews.splice(index, 0, view);\n      } else {\n        childViews.push(view);\n      }\n\n      return view;\n    };\n  };\n\n  var removeChildView = function removeChildView(parent, childViews) {\n    return function(view) {\n      // remove from child views\n      childViews.splice(childViews.indexOf(view), 1);\n\n      // remove the element\n      if (view.element.parentNode) {\n        parent.removeChild(view.element);\n      }\n\n      return view;\n    };\n  };\n\n  var IS_BROWSER = (function() {\n    return (\n      typeof window !== 'undefined' && typeof window.document !== 'undefined'\n    );\n  })();\n  var isBrowser = function isBrowser() {\n    return IS_BROWSER;\n  };\n\n  var testElement = isBrowser() ? createElement('svg') : {};\n  var getChildCount =\n    'children' in testElement\n      ? function(el) {\n          return el.children.length;\n        }\n      : function(el) {\n          return el.childNodes.length;\n        };\n\n  var getViewRect = function getViewRect(\n    elementRect,\n    childViews,\n    offset,\n    scale\n  ) {\n    var left = offset[0] || elementRect.left;\n    var top = offset[1] || elementRect.top;\n    var right = left + elementRect.width;\n    var bottom = top + elementRect.height * (scale[1] || 1);\n\n    var rect = {\n      // the rectangle of the element itself\n      element: Object.assign({}, elementRect),\n\n      // the rectangle of the element expanded to contain its children, does not include any margins\n      inner: {\n        left: elementRect.left,\n        top: elementRect.top,\n        right: elementRect.right,\n        bottom: elementRect.bottom\n      },\n\n      // the rectangle of the element expanded to contain its children including own margin and child margins\n      // margins will be added after we've recalculated the size\n      outer: {\n        left: left,\n        top: top,\n        right: right,\n        bottom: bottom\n      }\n    };\n\n    // expand rect to fit all child rectangles\n    childViews\n      .filter(function(childView) {\n        return !childView.isRectIgnored();\n      })\n      .map(function(childView) {\n        return childView.rect;\n      })\n      .forEach(function(childViewRect) {\n        expandRect(rect.inner, Object.assign({}, childViewRect.inner));\n        expandRect(rect.outer, Object.assign({}, childViewRect.outer));\n      });\n\n    // calculate inner width and height\n    calculateRectSize(rect.inner);\n\n    // append additional margin (top and left margins are included in top and left automatically)\n    rect.outer.bottom += rect.element.marginBottom;\n    rect.outer.right += rect.element.marginRight;\n\n    // calculate outer width and height\n    calculateRectSize(rect.outer);\n\n    return rect;\n  };\n\n  var expandRect = function expandRect(parent, child) {\n    // adjust for parent offset\n    child.top += parent.top;\n    child.right += parent.left;\n    child.bottom += parent.top;\n    child.left += parent.left;\n\n    if (child.bottom > parent.bottom) {\n      parent.bottom = child.bottom;\n    }\n\n    if (child.right > parent.right) {\n      parent.right = child.right;\n    }\n  };\n\n  var calculateRectSize = function calculateRectSize(rect) {\n    rect.width = rect.right - rect.left;\n    rect.height = rect.bottom - rect.top;\n  };\n\n  var isNumber = function isNumber(value) {\n    return typeof value === 'number';\n  };\n\n  /**\n   * Determines if position is at destination\n   * @param position\n   * @param destination\n   * @param velocity\n   * @param errorMargin\n   * @returns {boolean}\n   */\n  var thereYet = function thereYet(position, destination, velocity) {\n    var errorMargin =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0.001;\n    return (\n      Math.abs(position - destination) < errorMargin &&\n      Math.abs(velocity) < errorMargin\n    );\n  };\n\n  /**\n   * Spring animation\n   */\n  var spring =\n    // default options\n    function spring() // method definition\n    {\n      var _ref =\n          arguments.length > 0 && arguments[0] !== undefined\n            ? arguments[0]\n            : {},\n        _ref$stiffness = _ref.stiffness,\n        stiffness = _ref$stiffness === void 0 ? 0.5 : _ref$stiffness,\n        _ref$damping = _ref.damping,\n        damping = _ref$damping === void 0 ? 0.75 : _ref$damping,\n        _ref$mass = _ref.mass,\n        mass = _ref$mass === void 0 ? 10 : _ref$mass;\n      var target = null;\n      var position = null;\n      var velocity = 0;\n      var resting = false;\n\n      // updates spring state\n      var interpolate = function interpolate(ts, skipToEndState) {\n        // in rest, don't animate\n        if (resting) return;\n\n        // need at least a target or position to do springy things\n        if (!(isNumber(target) && isNumber(position))) {\n          resting = true;\n          velocity = 0;\n          return;\n        }\n\n        // calculate spring force\n        var f = -(position - target) * stiffness;\n\n        // update velocity by adding force based on mass\n        velocity += f / mass;\n\n        // update position by adding velocity\n        position += velocity;\n\n        // slow down based on amount of damping\n        velocity *= damping;\n\n        // we've arrived if we're near target and our velocity is near zero\n        if (thereYet(position, target, velocity) || skipToEndState) {\n          position = target;\n          velocity = 0;\n          resting = true;\n\n          // we done\n          api.onupdate(position);\n          api.oncomplete(position);\n        } else {\n          // progress update\n          api.onupdate(position);\n        }\n      };\n\n      /**\n       * Set new target value\n       * @param value\n       */\n      var setTarget = function setTarget(value) {\n        // if currently has no position, set target and position to this value\n        if (isNumber(value) && !isNumber(position)) {\n          position = value;\n        }\n\n        // next target value will not be animated to\n        if (target === null) {\n          target = value;\n          position = value;\n        }\n\n        // let start moving to target\n        target = value;\n\n        // already at target\n        if (position === target || typeof target === 'undefined') {\n          // now resting as target is current position, stop moving\n          resting = true;\n          velocity = 0;\n\n          // done!\n          api.onupdate(position);\n          api.oncomplete(position);\n\n          return;\n        }\n\n        resting = false;\n      };\n\n      // need 'api' to call onupdate callback\n      var api = createObject({\n        interpolate: interpolate,\n        target: {\n          set: setTarget,\n          get: function get() {\n            return target;\n          }\n        },\n\n        resting: {\n          get: function get() {\n            return resting;\n          }\n        },\n\n        onupdate: function onupdate(value) {},\n        oncomplete: function oncomplete(value) {}\n      });\n\n      return api;\n    };\n\n  var easeLinear = function easeLinear(t) {\n    return t;\n  };\n  var easeInOutQuad = function easeInOutQuad(t) {\n    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n  };\n\n  var tween =\n    // default values\n    function tween() // method definition\n    {\n      var _ref =\n          arguments.length > 0 && arguments[0] !== undefined\n            ? arguments[0]\n            : {},\n        _ref$duration = _ref.duration,\n        duration = _ref$duration === void 0 ? 500 : _ref$duration,\n        _ref$easing = _ref.easing,\n        easing = _ref$easing === void 0 ? easeInOutQuad : _ref$easing,\n        _ref$delay = _ref.delay,\n        delay = _ref$delay === void 0 ? 0 : _ref$delay;\n      var start = null;\n      var t;\n      var p;\n      var resting = true;\n      var reverse = false;\n      var target = null;\n\n      var interpolate = function interpolate(ts, skipToEndState) {\n        if (resting || target === null) return;\n\n        if (start === null) {\n          start = ts;\n        }\n\n        if (ts - start < delay) return;\n\n        t = ts - start - delay;\n\n        if (t >= duration || skipToEndState) {\n          t = 1;\n          p = reverse ? 0 : 1;\n          api.onupdate(p * target);\n          api.oncomplete(p * target);\n          resting = true;\n        } else {\n          p = t / duration;\n          api.onupdate((t >= 0 ? easing(reverse ? 1 - p : p) : 0) * target);\n        }\n      };\n\n      // need 'api' to call onupdate callback\n      var api = createObject({\n        interpolate: interpolate,\n        target: {\n          get: function get() {\n            return reverse ? 0 : target;\n          },\n          set: function set(value) {\n            // is initial value\n            if (target === null) {\n              target = value;\n              api.onupdate(value);\n              api.oncomplete(value);\n              return;\n            }\n\n            // want to tween to a smaller value and have a current value\n            if (value < target) {\n              target = 1;\n              reverse = true;\n            } else {\n              // not tweening to a smaller value\n              reverse = false;\n              target = value;\n            }\n\n            // let's go!\n            resting = false;\n            start = null;\n          }\n        },\n\n        resting: {\n          get: function get() {\n            return resting;\n          }\n        },\n\n        onupdate: function onupdate(value) {},\n        oncomplete: function oncomplete(value) {}\n      });\n\n      return api;\n    };\n\n  var animator = {\n    spring: spring,\n    tween: tween\n  };\n\n  /*\n                       { type: 'spring', stiffness: .5, damping: .75, mass: 10 };\n                       { translation: { type: 'spring', ... }, ... }\n                       { translation: { x: { type: 'spring', ... } } }\n                      */\n  var createAnimator = function createAnimator(definition, category, property) {\n    // default is single definition\n    // we check if transform is set, if so, we check if property is set\n    var def =\n      definition[category] && typeof definition[category][property] === 'object'\n        ? definition[category][property]\n        : definition[category] || definition;\n\n    var type = typeof def === 'string' ? def : def.type;\n    var props = typeof def === 'object' ? Object.assign({}, def) : {};\n\n    return animator[type] ? animator[type](props) : null;\n  };\n\n  var addGetSet = function addGetSet(keys, obj, props) {\n    var overwrite =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n    obj = Array.isArray(obj) ? obj : [obj];\n    obj.forEach(function(o) {\n      keys.forEach(function(key) {\n        var name = key;\n        var getter = function getter() {\n          return props[key];\n        };\n        var setter = function setter(value) {\n          return (props[key] = value);\n        };\n\n        if (typeof key === 'object') {\n          name = key.key;\n          getter = key.getter || getter;\n          setter = key.setter || setter;\n        }\n\n        if (o[name] && !overwrite) {\n          return;\n        }\n\n        o[name] = {\n          get: getter,\n          set: setter\n        };\n      });\n    });\n  };\n\n  // add to state,\n  // add getters and setters to internal and external api (if not set)\n  // setup animators\n\n  var animations = function animations(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n      viewProps = _ref.viewProps,\n      viewInternalAPI = _ref.viewInternalAPI,\n      viewExternalAPI = _ref.viewExternalAPI;\n    // initial properties\n    var initialProps = Object.assign({}, viewProps);\n\n    // list of all active animations\n    var animations = [];\n\n    // setup animators\n    forin(mixinConfig, function(property, animation) {\n      var animator = createAnimator(animation);\n      if (!animator) {\n        return;\n      }\n\n      // when the animator updates, update the view state value\n      animator.onupdate = function(value) {\n        viewProps[property] = value;\n      };\n\n      // set animator target\n      animator.target = initialProps[property];\n\n      // when value is set, set the animator target value\n      var prop = {\n        key: property,\n        setter: function setter(value) {\n          // if already at target, we done!\n          if (animator.target === value) {\n            return;\n          }\n\n          animator.target = value;\n        },\n        getter: function getter() {\n          return viewProps[property];\n        }\n      };\n\n      // add getters and setters\n      addGetSet([prop], [viewInternalAPI, viewExternalAPI], viewProps, true);\n\n      // add it to the list for easy updating from the _write method\n      animations.push(animator);\n    });\n\n    // expose internal write api\n    return {\n      write: function write(ts) {\n        var skipToEndState = document.hidden;\n        var resting = true;\n        animations.forEach(function(animation) {\n          if (!animation.resting) resting = false;\n          animation.interpolate(ts, skipToEndState);\n        });\n        return resting;\n      },\n      destroy: function destroy() {}\n    };\n  };\n\n  var addEvent = function addEvent(element) {\n    return function(type, fn) {\n      element.addEventListener(type, fn);\n    };\n  };\n\n  var removeEvent = function removeEvent(element) {\n    return function(type, fn) {\n      element.removeEventListener(type, fn);\n    };\n  };\n\n  // mixin\n  var listeners = function listeners(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n      viewProps = _ref.viewProps,\n      viewInternalAPI = _ref.viewInternalAPI,\n      viewExternalAPI = _ref.viewExternalAPI,\n      viewState = _ref.viewState,\n      view = _ref.view;\n    var events = [];\n\n    var add = addEvent(view.element);\n    var remove = removeEvent(view.element);\n\n    viewExternalAPI.on = function(type, fn) {\n      events.push({\n        type: type,\n        fn: fn\n      });\n\n      add(type, fn);\n    };\n\n    viewExternalAPI.off = function(type, fn) {\n      events.splice(\n        events.findIndex(function(event) {\n          return event.type === type && event.fn === fn;\n        }),\n        1\n      );\n\n      remove(type, fn);\n    };\n\n    return {\n      write: function write() {\n        // not busy\n        return true;\n      },\n      destroy: function destroy() {\n        events.forEach(function(event) {\n          remove(event.type, event.fn);\n        });\n      }\n    };\n  };\n\n  // add to external api and link to props\n\n  var apis = function apis(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n      viewProps = _ref.viewProps,\n      viewExternalAPI = _ref.viewExternalAPI;\n    addGetSet(mixinConfig, viewExternalAPI, viewProps);\n  };\n\n  var isDefined = function isDefined(value) {\n    return value != null;\n  };\n\n  // add to state,\n  // add getters and setters to internal and external api (if not set)\n  // set initial state based on props in viewProps\n  // apply as transforms each frame\n\n  var defaults = {\n    opacity: 1,\n    scaleX: 1,\n    scaleY: 1,\n    translateX: 0,\n    translateY: 0,\n    rotateX: 0,\n    rotateY: 0,\n    rotateZ: 0,\n    originX: 0,\n    originY: 0\n  };\n\n  var styles = function styles(_ref) {\n    var mixinConfig = _ref.mixinConfig,\n      viewProps = _ref.viewProps,\n      viewInternalAPI = _ref.viewInternalAPI,\n      viewExternalAPI = _ref.viewExternalAPI,\n      view = _ref.view;\n    // initial props\n    var initialProps = Object.assign({}, viewProps);\n\n    // current props\n    var currentProps = {};\n\n    // we will add those properties to the external API and link them to the viewState\n    addGetSet(mixinConfig, [viewInternalAPI, viewExternalAPI], viewProps);\n\n    // override rect on internal and external rect getter so it takes in account transforms\n    var getOffset = function getOffset() {\n      return [viewProps['translateX'] || 0, viewProps['translateY'] || 0];\n    };\n\n    var getScale = function getScale() {\n      return [viewProps['scaleX'] || 0, viewProps['scaleY'] || 0];\n    };\n    var getRect = function getRect() {\n      return view.rect\n        ? getViewRect(view.rect, view.childViews, getOffset(), getScale())\n        : null;\n    };\n    viewInternalAPI.rect = { get: getRect };\n    viewExternalAPI.rect = { get: getRect };\n\n    // apply view props\n    mixinConfig.forEach(function(key) {\n      viewProps[key] =\n        typeof initialProps[key] === 'undefined'\n          ? defaults[key]\n          : initialProps[key];\n    });\n\n    // expose api\n    return {\n      write: function write() {\n        // see if props have changed\n        if (!propsHaveChanged(currentProps, viewProps)) {\n          return;\n        }\n\n        // moves element to correct position on screen\n        applyStyles(view.element, viewProps);\n\n        // store new transforms\n        Object.assign(currentProps, Object.assign({}, viewProps));\n\n        // no longer busy\n        return true;\n      },\n      destroy: function destroy() {}\n    };\n  };\n\n  var propsHaveChanged = function propsHaveChanged(currentProps, newProps) {\n    // different amount of keys\n    if (Object.keys(currentProps).length !== Object.keys(newProps).length) {\n      return true;\n    }\n\n    // lets analyze the individual props\n    for (var prop in newProps) {\n      if (newProps[prop] !== currentProps[prop]) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var applyStyles = function applyStyles(element, _ref2) {\n    var opacity = _ref2.opacity,\n      perspective = _ref2.perspective,\n      translateX = _ref2.translateX,\n      translateY = _ref2.translateY,\n      scaleX = _ref2.scaleX,\n      scaleY = _ref2.scaleY,\n      rotateX = _ref2.rotateX,\n      rotateY = _ref2.rotateY,\n      rotateZ = _ref2.rotateZ,\n      originX = _ref2.originX,\n      originY = _ref2.originY,\n      width = _ref2.width,\n      height = _ref2.height;\n\n    var transforms = '';\n    var styles = '';\n\n    // handle transform origin\n    if (isDefined(originX) || isDefined(originY)) {\n      styles +=\n        'transform-origin: ' + (originX || 0) + 'px ' + (originY || 0) + 'px;';\n    }\n\n    // transform order is relevant\n    // 0. perspective\n    if (isDefined(perspective)) {\n      transforms += 'perspective(' + perspective + 'px) ';\n    }\n\n    // 1. translate\n    if (isDefined(translateX) || isDefined(translateY)) {\n      transforms +=\n        'translate3d(' +\n        (translateX || 0) +\n        'px, ' +\n        (translateY || 0) +\n        'px, 0) ';\n    }\n\n    // 2. scale\n    if (isDefined(scaleX) || isDefined(scaleY)) {\n      transforms +=\n        'scale3d(' +\n        (isDefined(scaleX) ? scaleX : 1) +\n        ', ' +\n        (isDefined(scaleY) ? scaleY : 1) +\n        ', 1) ';\n    }\n\n    // 3. rotate\n    if (isDefined(rotateZ)) {\n      transforms += 'rotateZ(' + rotateZ + 'rad) ';\n    }\n\n    if (isDefined(rotateX)) {\n      transforms += 'rotateX(' + rotateX + 'rad) ';\n    }\n\n    if (isDefined(rotateY)) {\n      transforms += 'rotateY(' + rotateY + 'rad) ';\n    }\n\n    // add transforms\n    if (transforms.length) {\n      styles += 'transform:' + transforms + ';';\n    }\n\n    // add opacity\n    if (isDefined(opacity)) {\n      styles += 'opacity:' + opacity + ';';\n\n      // if we reach zero, we make the element inaccessible\n      if (opacity === 0) {\n        styles += 'visibility:hidden;';\n      }\n\n      // if we're below 100% opacity this element can't be clicked\n      if (opacity < 1) {\n        styles += 'pointer-events:none;';\n      }\n    }\n\n    // add height\n    if (isDefined(height)) {\n      styles += 'height:' + height + 'px;';\n    }\n\n    // add width\n    if (isDefined(width)) {\n      styles += 'width:' + width + 'px;';\n    }\n\n    // apply styles\n    var elementCurrentStyle = element.elementCurrentStyle || '';\n\n    // if new styles does not match current styles, lets update!\n    if (\n      styles.length !== elementCurrentStyle.length ||\n      styles !== elementCurrentStyle\n    ) {\n      element.style.cssText = styles;\n      // store current styles so we can compare them to new styles later on\n      // _not_ getting the style value is faster\n      element.elementCurrentStyle = styles;\n    }\n  };\n\n  var Mixins = {\n    styles: styles,\n    listeners: listeners,\n    animations: animations,\n    apis: apis\n  };\n\n  var updateRect = function updateRect() {\n    var rect =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var element =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var style =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (!element.layoutCalculated) {\n      rect.paddingTop = parseInt(style.paddingTop, 10) || 0;\n      rect.marginTop = parseInt(style.marginTop, 10) || 0;\n      rect.marginRight = parseInt(style.marginRight, 10) || 0;\n      rect.marginBottom = parseInt(style.marginBottom, 10) || 0;\n      rect.marginLeft = parseInt(style.marginLeft, 10) || 0;\n      element.layoutCalculated = true;\n    }\n\n    rect.left = element.offsetLeft || 0;\n    rect.top = element.offsetTop || 0;\n    rect.width = element.offsetWidth || 0;\n    rect.height = element.offsetHeight || 0;\n\n    rect.right = rect.left + rect.width;\n    rect.bottom = rect.top + rect.height;\n\n    rect.scrollTop = element.scrollTop;\n\n    rect.hidden = element.offsetParent === null;\n\n    return rect;\n  };\n\n  var createView =\n    // default view definition\n    function createView() {\n      var _ref =\n          arguments.length > 0 && arguments[0] !== undefined\n            ? arguments[0]\n            : {},\n        _ref$tag = _ref.tag,\n        tag = _ref$tag === void 0 ? 'div' : _ref$tag,\n        _ref$name = _ref.name,\n        name = _ref$name === void 0 ? null : _ref$name,\n        _ref$attributes = _ref.attributes,\n        attributes = _ref$attributes === void 0 ? {} : _ref$attributes,\n        _ref$read = _ref.read,\n        read = _ref$read === void 0 ? function() {} : _ref$read,\n        _ref$write = _ref.write,\n        write = _ref$write === void 0 ? function() {} : _ref$write,\n        _ref$create = _ref.create,\n        create = _ref$create === void 0 ? function() {} : _ref$create,\n        _ref$destroy = _ref.destroy,\n        destroy = _ref$destroy === void 0 ? function() {} : _ref$destroy,\n        _ref$filterFrameActio = _ref.filterFrameActionsForChild,\n        filterFrameActionsForChild =\n          _ref$filterFrameActio === void 0\n            ? function(child, actions) {\n                return actions;\n              }\n            : _ref$filterFrameActio,\n        _ref$didCreateView = _ref.didCreateView,\n        didCreateView =\n          _ref$didCreateView === void 0 ? function() {} : _ref$didCreateView,\n        _ref$didWriteView = _ref.didWriteView,\n        didWriteView =\n          _ref$didWriteView === void 0 ? function() {} : _ref$didWriteView,\n        _ref$ignoreRect = _ref.ignoreRect,\n        ignoreRect = _ref$ignoreRect === void 0 ? false : _ref$ignoreRect,\n        _ref$ignoreRectUpdate = _ref.ignoreRectUpdate,\n        ignoreRectUpdate =\n          _ref$ignoreRectUpdate === void 0 ? false : _ref$ignoreRectUpdate,\n        _ref$mixins = _ref.mixins,\n        mixins = _ref$mixins === void 0 ? [] : _ref$mixins;\n      return function(\n        // each view requires reference to store\n        store\n      ) {\n        var props =\n          arguments.length > 1 && arguments[1] !== undefined\n            ? arguments[1]\n            : {};\n        // root element should not be changed\n        var element = createElement(tag, 'filepond--' + name, attributes);\n\n        // style reference should also not be changed\n        var style = window.getComputedStyle(element, null);\n\n        // element rectangle\n        var rect = updateRect();\n        var frameRect = null;\n\n        // rest state\n        var isResting = false;\n\n        // pretty self explanatory\n        var childViews = [];\n\n        // loaded mixins\n        var activeMixins = [];\n\n        // references to created children\n        var ref = {};\n\n        // state used for each instance\n        var state = {};\n\n        // list of writers that will be called to update this view\n        var writers = [\n          write // default writer\n        ];\n\n        var readers = [\n          read // default reader\n        ];\n\n        var destroyers = [\n          destroy // default destroy\n        ];\n\n        // core view methods\n        var getElement = function getElement() {\n          return element;\n        };\n        var getChildViews = function getChildViews() {\n          return childViews.concat();\n        };\n        var getReference = function getReference() {\n          return ref;\n        };\n        var createChildView = function createChildView(store) {\n          return function(view, props) {\n            return view(store, props);\n          };\n        };\n        var getRect = function getRect() {\n          if (frameRect) {\n            return frameRect;\n          }\n          frameRect = getViewRect(rect, childViews, [0, 0], [1, 1]);\n          return frameRect;\n        };\n        var getStyle = function getStyle() {\n          return style;\n        };\n\n        /**\n         * Read data from DOM\n         * @private\n         */\n        var _read = function _read() {\n          frameRect = null;\n\n          // read child views\n          childViews.forEach(function(child) {\n            return child._read();\n          });\n\n          var shouldUpdate = !(ignoreRectUpdate && rect.width && rect.height);\n          if (shouldUpdate) {\n            updateRect(rect, element, style);\n          }\n\n          // readers\n          var api = { root: internalAPI, props: props, rect: rect };\n          readers.forEach(function(reader) {\n            return reader(api);\n          });\n        };\n\n        /**\n         * Write data to DOM\n         * @private\n         */\n        var _write = function _write(ts, frameActions, shouldOptimize) {\n          // if no actions, we assume that the view is resting\n          var resting = frameActions.length === 0;\n\n          // writers\n          writers.forEach(function(writer) {\n            var writerResting = writer({\n              props: props,\n              root: internalAPI,\n              actions: frameActions,\n              timestamp: ts,\n              shouldOptimize: shouldOptimize\n            });\n\n            if (writerResting === false) {\n              resting = false;\n            }\n          });\n\n          // run mixins\n          activeMixins.forEach(function(mixin) {\n            // if one of the mixins is still busy after write operation, we are not resting\n            var mixinResting = mixin.write(ts);\n            if (mixinResting === false) {\n              resting = false;\n            }\n          });\n\n          // updates child views that are currently attached to the DOM\n          childViews\n            .filter(function(child) {\n              return !!child.element.parentNode;\n            })\n            .forEach(function(child) {\n              // if a child view is not resting, we are not resting\n              var childResting = child._write(\n                ts,\n                filterFrameActionsForChild(child, frameActions),\n                shouldOptimize\n              );\n\n              if (!childResting) {\n                resting = false;\n              }\n            });\n\n          // append new elements to DOM and update those\n          childViews\n            //.filter(child => !child.element.parentNode)\n            .forEach(function(child, index) {\n              // skip\n              if (child.element.parentNode) {\n                return;\n              }\n\n              // append to DOM\n              internalAPI.appendChild(child.element, index);\n\n              // call read (need to know the size of these elements)\n              child._read();\n\n              // re-call write\n              child._write(\n                ts,\n                filterFrameActionsForChild(child, frameActions),\n                shouldOptimize\n              );\n\n              // we just added somthing to the dom, no rest\n              resting = false;\n            });\n\n          // update resting state\n          isResting = resting;\n\n          didWriteView({\n            props: props,\n            root: internalAPI,\n            actions: frameActions,\n            timestamp: ts\n          });\n\n          // let parent know if we are resting\n          return resting;\n        };\n\n        var _destroy = function _destroy() {\n          activeMixins.forEach(function(mixin) {\n            return mixin.destroy();\n          });\n          destroyers.forEach(function(destroyer) {\n            destroyer({ root: internalAPI, props: props });\n          });\n          childViews.forEach(function(child) {\n            return child._destroy();\n          });\n        };\n\n        // sharedAPI\n        var sharedAPIDefinition = {\n          element: {\n            get: getElement\n          },\n\n          style: {\n            get: getStyle\n          },\n\n          childViews: {\n            get: getChildViews\n          }\n        };\n\n        // private API definition\n        var internalAPIDefinition = Object.assign({}, sharedAPIDefinition, {\n          rect: {\n            get: getRect\n          },\n\n          // access to custom children references\n          ref: {\n            get: getReference\n          },\n\n          // dom modifiers\n          is: function is(needle) {\n            return name === needle;\n          },\n          appendChild: appendChild(element),\n          createChildView: createChildView(store),\n          linkView: function linkView(view) {\n            childViews.push(view);\n            return view;\n          },\n          unlinkView: function unlinkView(view) {\n            childViews.splice(childViews.indexOf(view), 1);\n          },\n          appendChildView: appendChildView(element, childViews),\n          removeChildView: removeChildView(element, childViews),\n          registerWriter: function registerWriter(writer) {\n            return writers.push(writer);\n          },\n          registerReader: function registerReader(reader) {\n            return readers.push(reader);\n          },\n          registerDestroyer: function registerDestroyer(destroyer) {\n            return destroyers.push(destroyer);\n          },\n          invalidateLayout: function invalidateLayout() {\n            return (element.layoutCalculated = false);\n          },\n\n          // access to data store\n          dispatch: store.dispatch,\n          query: store.query\n        });\n\n        // public view API methods\n        var externalAPIDefinition = {\n          element: {\n            get: getElement\n          },\n\n          childViews: {\n            get: getChildViews\n          },\n\n          rect: {\n            get: getRect\n          },\n\n          resting: {\n            get: function get() {\n              return isResting;\n            }\n          },\n\n          isRectIgnored: function isRectIgnored() {\n            return ignoreRect;\n          },\n          _read: _read,\n          _write: _write,\n          _destroy: _destroy\n        };\n\n        // mixin API methods\n        var mixinAPIDefinition = Object.assign({}, sharedAPIDefinition, {\n          rect: {\n            get: function get() {\n              return rect;\n            }\n          }\n        });\n\n        // add mixin functionality\n        Object.keys(mixins)\n          .sort(function(a, b) {\n            // move styles to the back of the mixin list (so adjustments of other mixins are applied to the props correctly)\n            if (a === 'styles') {\n              return 1;\n            } else if (b === 'styles') {\n              return -1;\n            }\n            return 0;\n          })\n          .forEach(function(key) {\n            var mixinAPI = Mixins[key]({\n              mixinConfig: mixins[key],\n              viewProps: props,\n              viewState: state,\n              viewInternalAPI: internalAPIDefinition,\n              viewExternalAPI: externalAPIDefinition,\n              view: createObject(mixinAPIDefinition)\n            });\n\n            if (mixinAPI) {\n              activeMixins.push(mixinAPI);\n            }\n          });\n\n        // construct private api\n        var internalAPI = createObject(internalAPIDefinition);\n\n        // create the view\n        create({\n          root: internalAPI,\n          props: props\n        });\n\n        // append created child views to root node\n        var childCount = getChildCount(element); // need to know the current child count so appending happens in correct order\n        childViews.forEach(function(child, index) {\n          internalAPI.appendChild(child.element, childCount + index);\n        });\n\n        // call did create\n        didCreateView(internalAPI);\n\n        // expose public api\n        return createObject(externalAPIDefinition);\n      };\n    };\n\n  var createPainter = function createPainter(read, write) {\n    var fps =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 60;\n\n    var name = '__framePainter';\n\n    // set global painter\n    if (window[name]) {\n      window[name].readers.push(read);\n      window[name].writers.push(write);\n      return;\n    }\n\n    window[name] = {\n      readers: [read],\n      writers: [write]\n    };\n\n    var painter = window[name];\n\n    var interval = 1000 / fps;\n    var last = null;\n    var id = null;\n    var requestTick = null;\n    var cancelTick = null;\n\n    var setTimerType = function setTimerType() {\n      if (document.hidden) {\n        requestTick = function requestTick() {\n          return window.setTimeout(function() {\n            return tick(performance.now());\n          }, interval);\n        };\n        cancelTick = function cancelTick() {\n          return window.clearTimeout(id);\n        };\n      } else {\n        requestTick = function requestTick() {\n          return window.requestAnimationFrame(tick);\n        };\n        cancelTick = function cancelTick() {\n          return window.cancelAnimationFrame(id);\n        };\n      }\n    };\n\n    document.addEventListener('visibilitychange', function() {\n      if (cancelTick) cancelTick();\n      setTimerType();\n      tick(performance.now());\n    });\n\n    var tick = function tick(ts) {\n      // queue next tick\n      id = requestTick(tick);\n\n      // limit fps\n      if (!last) {\n        last = ts;\n      }\n\n      var delta = ts - last;\n\n      if (delta <= interval) {\n        // skip frame\n        return;\n      }\n\n      // align next frame\n      last = ts - (delta % interval);\n\n      // update view\n      painter.readers.forEach(function(read) {\n        return read();\n      });\n      painter.writers.forEach(function(write) {\n        return write(ts);\n      });\n    };\n\n    setTimerType();\n    tick(performance.now());\n\n    return {\n      pause: function pause() {\n        cancelTick(id);\n      }\n    };\n  };\n\n  var createRoute = function createRoute(routes, fn) {\n    return function(_ref) {\n      var root = _ref.root,\n        props = _ref.props,\n        _ref$actions = _ref.actions,\n        actions = _ref$actions === void 0 ? [] : _ref$actions,\n        timestamp = _ref.timestamp,\n        shouldOptimize = _ref.shouldOptimize;\n      actions\n        .filter(function(action) {\n          return routes[action.type];\n        })\n        .forEach(function(action) {\n          return routes[action.type]({\n            root: root,\n            props: props,\n            action: action.data,\n            timestamp: timestamp,\n            shouldOptimize: shouldOptimize\n          });\n        });\n\n      if (fn) {\n        fn({\n          root: root,\n          props: props,\n          actions: actions,\n          timestamp: timestamp,\n          shouldOptimize: shouldOptimize\n        });\n      }\n    };\n  };\n\n  var insertBefore = function insertBefore(newNode, referenceNode) {\n    return referenceNode.parentNode.insertBefore(newNode, referenceNode);\n  };\n\n  var insertAfter = function insertAfter(newNode, referenceNode) {\n    return referenceNode.parentNode.insertBefore(\n      newNode,\n      referenceNode.nextSibling\n    );\n  };\n\n  var isArray = function isArray(value) {\n    return Array.isArray(value);\n  };\n\n  var isEmpty = function isEmpty(value) {\n    return value == null;\n  };\n\n  var trim = function trim(str) {\n    return str.trim();\n  };\n\n  var toString = function toString(value) {\n    return '' + value;\n  };\n\n  var toArray = function toArray(value) {\n    var splitter =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ',';\n    if (isEmpty(value)) {\n      return [];\n    }\n    if (isArray(value)) {\n      return value;\n    }\n    return toString(value)\n      .split(splitter)\n      .map(trim)\n      .filter(function(str) {\n        return str.length;\n      });\n  };\n\n  var isBoolean = function isBoolean(value) {\n    return typeof value === 'boolean';\n  };\n\n  var toBoolean = function toBoolean(value) {\n    return isBoolean(value) ? value : value === 'true';\n  };\n\n  var isString = function isString(value) {\n    return typeof value === 'string';\n  };\n\n  var toNumber = function toNumber(value) {\n    return isNumber(value)\n      ? value\n      : isString(value)\n      ? toString(value).replace(/[a-z]+/gi, '')\n      : 0;\n  };\n\n  var toInt = function toInt(value) {\n    return parseInt(toNumber(value), 10);\n  };\n\n  var toFloat = function toFloat(value) {\n    return parseFloat(toNumber(value));\n  };\n\n  var isInt = function isInt(value) {\n    return isNumber(value) && isFinite(value) && Math.floor(value) === value;\n  };\n\n  var toBytes = function toBytes(value) {\n    // is in bytes\n    if (isInt(value)) {\n      return value;\n    }\n\n    // is natural file size\n    var naturalFileSize = toString(value).trim();\n\n    // if is value in megabytes\n    if (/MB$/i.test(naturalFileSize)) {\n      naturalFileSize = naturalFileSize.replace(/MB$i/, '').trim();\n      return toInt(naturalFileSize) * 1000 * 1000;\n    }\n\n    // if is value in kilobytes\n    if (/KB/i.test(naturalFileSize)) {\n      naturalFileSize = naturalFileSize.replace(/KB$i/, '').trim();\n      return toInt(naturalFileSize) * 1000;\n    }\n\n    return toInt(naturalFileSize);\n  };\n\n  var isFunction = function isFunction(value) {\n    return typeof value === 'function';\n  };\n\n  var toFunctionReference = function toFunctionReference(string) {\n    var ref = self;\n    var levels = string.split('.');\n    var level = null;\n    while ((level = levels.shift())) {\n      ref = ref[level];\n      if (!ref) {\n        return null;\n      }\n    }\n    return ref;\n  };\n\n  var methods = {\n    process: 'POST',\n    patch: 'PATCH',\n    revert: 'DELETE',\n    fetch: 'GET',\n    restore: 'GET',\n    load: 'GET'\n  };\n\n  var createServerAPI = function createServerAPI(outline) {\n    var api = {};\n\n    api.url = isString(outline) ? outline : outline.url || '';\n    api.timeout = outline.timeout ? parseInt(outline.timeout, 10) : 0;\n    api.headers = outline.headers ? outline.headers : {};\n\n    forin(methods, function(key) {\n      api[key] = createAction(\n        key,\n        outline[key],\n        methods[key],\n        api.timeout,\n        api.headers\n      );\n    });\n\n    // special treatment for remove\n    api.remove = outline.remove || null;\n\n    // remove generic headers from api object\n    delete api.headers;\n\n    return api;\n  };\n\n  var createAction = function createAction(\n    name,\n    outline,\n    method,\n    timeout,\n    headers\n  ) {\n    // is explicitely set to null so disable\n    if (outline === null) {\n      return null;\n    }\n\n    // if is custom function, done! Dev handles everything.\n    if (typeof outline === 'function') {\n      return outline;\n    }\n\n    // build action object\n    var action = {\n      url: method === 'GET' || method === 'PATCH' ? '?' + name + '=' : '',\n      method: method,\n      headers: headers,\n      withCredentials: false,\n      timeout: timeout,\n      onload: null,\n      ondata: null,\n      onerror: null\n    };\n\n    // is a single url\n    if (isString(outline)) {\n      action.url = outline;\n      return action;\n    }\n\n    // overwrite\n    Object.assign(action, outline);\n\n    // see if should reformat headers;\n    if (isString(action.headers)) {\n      var parts = action.headers.split(/:(.+)/);\n      action.headers = {\n        header: parts[0],\n        value: parts[1]\n      };\n    }\n\n    // if is bool withCredentials\n    action.withCredentials = toBoolean(action.withCredentials);\n\n    return action;\n  };\n\n  var toServerAPI = function toServerAPI(value) {\n    return createServerAPI(value);\n  };\n\n  var isNull = function isNull(value) {\n    return value === null;\n  };\n\n  var isObject = function isObject(value) {\n    return typeof value === 'object' && value !== null;\n  };\n\n  var isAPI = function isAPI(value) {\n    return (\n      isObject(value) &&\n      isString(value.url) &&\n      isObject(value.process) &&\n      isObject(value.revert) &&\n      isObject(value.restore) &&\n      isObject(value.fetch)\n    );\n  };\n\n  var getType = function getType(value) {\n    if (isArray(value)) {\n      return 'array';\n    }\n\n    if (isNull(value)) {\n      return 'null';\n    }\n\n    if (isInt(value)) {\n      return 'int';\n    }\n\n    if (/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(value)) {\n      return 'bytes';\n    }\n\n    if (isAPI(value)) {\n      return 'api';\n    }\n\n    return typeof value;\n  };\n\n  var replaceSingleQuotes = function replaceSingleQuotes(str) {\n    return str\n      .replace(/{\\s*'/g, '{\"')\n      .replace(/'\\s*}/g, '\"}')\n      .replace(/'\\s*:/g, '\":')\n      .replace(/:\\s*'/g, ':\"')\n      .replace(/,\\s*'/g, ',\"')\n      .replace(/'\\s*,/g, '\",');\n  };\n\n  var conversionTable = {\n    array: toArray,\n    boolean: toBoolean,\n    int: function int(value) {\n      return getType(value) === 'bytes' ? toBytes(value) : toInt(value);\n    },\n    number: toFloat,\n    float: toFloat,\n    bytes: toBytes,\n    string: function string(value) {\n      return isFunction(value) ? value : toString(value);\n    },\n    function: function _function(value) {\n      return toFunctionReference(value);\n    },\n    serverapi: toServerAPI,\n    object: function object(value) {\n      try {\n        return JSON.parse(replaceSingleQuotes(value));\n      } catch (e) {\n        return null;\n      }\n    }\n  };\n\n  var convertTo = function convertTo(value, type) {\n    return conversionTable[type](value);\n  };\n\n  var getValueByType = function getValueByType(\n    newValue,\n    defaultValue,\n    valueType\n  ) {\n    // can always assign default value\n    if (newValue === defaultValue) {\n      return newValue;\n    }\n\n    // get the type of the new value\n    var newValueType = getType(newValue);\n\n    // is valid type?\n    if (newValueType !== valueType) {\n      // is string input, let's attempt to convert\n      var convertedValue = convertTo(newValue, valueType);\n\n      // what is the type now\n      newValueType = getType(convertedValue);\n\n      // no valid conversions found\n      if (convertedValue === null) {\n        throw 'Trying to assign value with incorrect type to \"' +\n          option +\n          '\", allowed type: \"' +\n          valueType +\n          '\"';\n      } else {\n        newValue = convertedValue;\n      }\n    }\n\n    // assign new value\n    return newValue;\n  };\n\n  var createOption = function createOption(defaultValue, valueType) {\n    var currentValue = defaultValue;\n    return {\n      enumerable: true,\n      get: function get() {\n        return currentValue;\n      },\n      set: function set(newValue) {\n        currentValue = getValueByType(newValue, defaultValue, valueType);\n      }\n    };\n  };\n\n  var createOptions = function createOptions(options) {\n    var obj = {};\n    forin(options, function(prop) {\n      var optionDefinition = options[prop];\n      obj[prop] = createOption(optionDefinition[0], optionDefinition[1]);\n    });\n    return createObject(obj);\n  };\n\n  var createInitialState = function createInitialState(options) {\n    return {\n      // model\n      items: [],\n\n      // timeout used for calling update items\n      listUpdateTimeout: null,\n\n      // timeout used for stacking metadata updates\n      itemUpdateTimeout: null,\n\n      // queue of items waiting to be processed\n      processingQueue: [],\n\n      // options\n      options: createOptions(options)\n    };\n  };\n\n  var fromCamels = function fromCamels(string) {\n    var separator =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';\n    return string\n      .split(/(?=[A-Z])/)\n      .map(function(part) {\n        return part.toLowerCase();\n      })\n      .join(separator);\n  };\n\n  var createOptionAPI = function createOptionAPI(store, options) {\n    var obj = {};\n    forin(options, function(key) {\n      obj[key] = {\n        get: function get() {\n          return store.getState().options[key];\n        },\n        set: function set(value) {\n          store.dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {\n            value: value\n          });\n        }\n      };\n    });\n    return obj;\n  };\n\n  var createOptionActions = function createOptionActions(options) {\n    return function(dispatch, query, state) {\n      var obj = {};\n      forin(options, function(key) {\n        var name = fromCamels(key, '_').toUpperCase();\n\n        obj['SET_' + name] = function(action) {\n          try {\n            state.options[key] = action.value;\n          } catch (e) {} // nope, failed\n\n          // we successfully set the value of this option\n          dispatch('DID_SET_' + name, { value: state.options[key] });\n        };\n      });\n      return obj;\n    };\n  };\n\n  var createOptionQueries = function createOptionQueries(options) {\n    return function(state) {\n      var obj = {};\n      forin(options, function(key) {\n        obj['GET_' + fromCamels(key, '_').toUpperCase()] = function(action) {\n          return state.options[key];\n        };\n      });\n      return obj;\n    };\n  };\n\n  var InteractionMethod = {\n    API: 1,\n    DROP: 2,\n    BROWSE: 3,\n    PASTE: 4,\n    NONE: 5\n  };\n\n  var getUniqueId = function getUniqueId() {\n    return Math.random()\n      .toString(36)\n      .substr(2, 9);\n  };\n\n  function _typeof(obj) {\n    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n      _typeof = function(obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function(obj) {\n        return obj &&\n          typeof Symbol === 'function' &&\n          obj.constructor === Symbol &&\n          obj !== Symbol.prototype\n          ? 'symbol'\n          : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  var REACT_ELEMENT_TYPE;\n\n  function _jsx(type, props, key, children) {\n    if (!REACT_ELEMENT_TYPE) {\n      REACT_ELEMENT_TYPE =\n        (typeof Symbol === 'function' &&\n          Symbol['for'] &&\n          Symbol['for']('react.element')) ||\n        0xeac7;\n    }\n\n    var defaultProps = type && type.defaultProps;\n    var childrenLength = arguments.length - 3;\n\n    if (!props && childrenLength !== 0) {\n      props = {\n        children: void 0\n      };\n    }\n\n    if (props && defaultProps) {\n      for (var propName in defaultProps) {\n        if (props[propName] === void 0) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    } else if (!props) {\n      props = defaultProps || {};\n    }\n\n    if (childrenLength === 1) {\n      props.children = children;\n    } else if (childrenLength > 1) {\n      var childArray = new Array(childrenLength);\n\n      for (var i = 0; i < childrenLength; i++) {\n        childArray[i] = arguments[i + 3];\n      }\n\n      props.children = childArray;\n    }\n\n    return {\n      $$typeof: REACT_ELEMENT_TYPE,\n      type: type,\n      key: key === undefined ? null : '' + key,\n      ref: null,\n      props: props,\n      _owner: null\n    };\n  }\n\n  function _asyncIterator(iterable) {\n    var method;\n\n    if (typeof Symbol !== 'undefined') {\n      if (Symbol.asyncIterator) {\n        method = iterable[Symbol.asyncIterator];\n        if (method != null) return method.call(iterable);\n      }\n\n      if (Symbol.iterator) {\n        method = iterable[Symbol.iterator];\n        if (method != null) return method.call(iterable);\n      }\n    }\n\n    throw new TypeError('Object is not async iterable');\n  }\n\n  function _AwaitValue(value) {\n    this.wrapped = value;\n  }\n\n  function _AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function(resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n        var wrappedAwait = value instanceof _AwaitValue;\n        Promise.resolve(wrappedAwait ? value.wrapped : value).then(\n          function(arg) {\n            if (wrappedAwait) {\n              resume('next', arg);\n              return;\n            }\n\n            settle(result.done ? 'return' : 'normal', arg);\n          },\n          function(err) {\n            resume('throw', err);\n          }\n        );\n      } catch (err) {\n        settle('throw', err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case 'return':\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case 'throw':\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== 'function') {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n    _AsyncGenerator.prototype[Symbol.asyncIterator] = function() {\n      return this;\n    };\n  }\n\n  _AsyncGenerator.prototype.next = function(arg) {\n    return this._invoke('next', arg);\n  };\n\n  _AsyncGenerator.prototype.throw = function(arg) {\n    return this._invoke('throw', arg);\n  };\n\n  _AsyncGenerator.prototype.return = function(arg) {\n    return this._invoke('return', arg);\n  };\n\n  function _wrapAsyncGenerator(fn) {\n    return function() {\n      return new _AsyncGenerator(fn.apply(this, arguments));\n    };\n  }\n\n  function _awaitAsyncGenerator(value) {\n    return new _AwaitValue(value);\n  }\n\n  function _asyncGeneratorDelegate(inner, awaitWrap) {\n    var iter = {},\n      waiting = false;\n\n    function pump(key, value) {\n      waiting = true;\n      value = new Promise(function(resolve) {\n        resolve(inner[key](value));\n      });\n      return {\n        done: false,\n        value: awaitWrap(value)\n      };\n    }\n\n    if (typeof Symbol === 'function' && Symbol.iterator) {\n      iter[Symbol.iterator] = function() {\n        return this;\n      };\n    }\n\n    iter.next = function(value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump('next', value);\n    };\n\n    if (typeof inner.throw === 'function') {\n      iter.throw = function(value) {\n        if (waiting) {\n          waiting = false;\n          throw value;\n        }\n\n        return pump('throw', value);\n      };\n    }\n\n    if (typeof inner.return === 'function') {\n      iter.return = function(value) {\n        return pump('return', value);\n      };\n    }\n\n    return iter;\n  }\n\n  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n      var info = gen[key](arg);\n      var value = info.value;\n    } catch (error) {\n      reject(error);\n      return;\n    }\n\n    if (info.done) {\n      resolve(value);\n    } else {\n      Promise.resolve(value).then(_next, _throw);\n    }\n  }\n\n  function _asyncToGenerator(fn) {\n    return function() {\n      var self = this,\n        args = arguments;\n      return new Promise(function(resolve, reject) {\n        var gen = fn.apply(self, args);\n\n        function _next(value) {\n          asyncGeneratorStep(\n            gen,\n            resolve,\n            reject,\n            _next,\n            _throw,\n            'next',\n            value\n          );\n        }\n\n        function _throw(err) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n        }\n\n        _next(undefined);\n      });\n    };\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if ('value' in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineEnumerableProperties(obj, descs) {\n    for (var key in descs) {\n      var desc = descs[key];\n      desc.configurable = desc.enumerable = true;\n      if ('value' in desc) desc.writable = true;\n      Object.defineProperty(obj, key, desc);\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n      for (var i = 0; i < objectSymbols.length; i++) {\n        var sym = objectSymbols[i];\n        var desc = descs[sym];\n        desc.configurable = desc.enumerable = true;\n        if ('value' in desc) desc.writable = true;\n        Object.defineProperty(obj, sym, desc);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defaults(obj, defaults) {\n    var keys = Object.getOwnPropertyNames(defaults);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n      if (value && value.configurable && obj[key] === undefined) {\n        Object.defineProperty(obj, key, value);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function _extends() {\n    _extends =\n      Object.assign ||\n      function(target) {\n        for (var i = 1; i < arguments.length; i++) {\n          var source = arguments[i];\n\n          for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n              target[key] = source[key];\n            }\n          }\n        }\n\n        return target;\n      };\n\n    return _extends.apply(this, arguments);\n  }\n\n  function _objectSpread(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n      var ownKeys = Object.keys(source);\n\n      if (typeof Object.getOwnPropertySymbols === 'function') {\n        ownKeys = ownKeys.concat(\n          Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n          })\n        );\n      }\n\n      ownKeys.forEach(function(key) {\n        _defineProperty(target, key, source[key]);\n      });\n    }\n\n    return target;\n  }\n\n  function ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n\n    if (Object.getOwnPropertySymbols) {\n      var symbols = Object.getOwnPropertySymbols(object);\n      if (enumerableOnly)\n        symbols = symbols.filter(function(sym) {\n          return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n      keys.push.apply(keys, symbols);\n    }\n\n    return keys;\n  }\n\n  function _objectSpread2(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n\n      if (i % 2) {\n        ownKeys(source, true).forEach(function(key) {\n          _defineProperty(target, key, source[key]);\n        });\n      } else if (Object.getOwnPropertyDescriptors) {\n        Object.defineProperties(\n          target,\n          Object.getOwnPropertyDescriptors(source)\n        );\n      } else {\n        ownKeys(source).forEach(function(key) {\n          Object.defineProperty(\n            target,\n            key,\n            Object.getOwnPropertyDescriptor(source, key)\n          );\n        });\n      }\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function');\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _inheritsLoose(subClass, superClass) {\n    subClass.prototype = Object.create(superClass.prototype);\n    subClass.prototype.constructor = subClass;\n    subClass.__proto__ = superClass;\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf\n      ? Object.getPrototypeOf\n      : function _getPrototypeOf(o) {\n          return o.__proto__ || Object.getPrototypeOf(o);\n        };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf =\n      Object.setPrototypeOf ||\n      function _setPrototypeOf(o, p) {\n        o.__proto__ = p;\n        return o;\n      };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === 'function') return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function() {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf('[native code]') !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== 'function') {\n        throw new TypeError(\n          'Super expression must either be null or a function'\n        );\n      }\n\n      if (typeof _cache !== 'undefined') {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _instanceof(left, right) {\n    if (\n      right != null &&\n      typeof Symbol !== 'undefined' &&\n      right[Symbol.hasInstance]\n    ) {\n      return !!right[Symbol.hasInstance](left);\n    } else {\n      return left instanceof right;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule\n      ? obj\n      : {\n          default: obj\n        };\n  }\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc =\n              Object.defineProperty && Object.getOwnPropertyDescriptor\n                ? Object.getOwnPropertyDescriptor(obj, key)\n                : {};\n\n            if (desc.get || desc.set) {\n              Object.defineProperty(newObj, key, desc);\n            } else {\n              newObj[key] = obj[key];\n            }\n          }\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _newArrowCheck(innerThis, boundThis) {\n    if (innerThis !== boundThis) {\n      throw new TypeError('Cannot instantiate an arrow function');\n    }\n  }\n\n  function _objectDestructuringEmpty(obj) {\n    if (obj == null) throw new TypeError('Cannot destructure undefined');\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\n        \"this hasn't been initialised - super() hasn't been called\"\n      );\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === 'object' || typeof call === 'function')) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _superPropBase(object, property) {\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\n      object = _getPrototypeOf(object);\n      if (object === null) break;\n    }\n\n    return object;\n  }\n\n  function _get(target, property, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.get) {\n      _get = Reflect.get;\n    } else {\n      _get = function _get(target, property, receiver) {\n        var base = _superPropBase(target, property);\n\n        if (!base) return;\n        var desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.get) {\n          return desc.get.call(receiver);\n        }\n\n        return desc.value;\n      };\n    }\n\n    return _get(target, property, receiver || target);\n  }\n\n  function set(target, property, value, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.set) {\n      set = Reflect.set;\n    } else {\n      set = function set(target, property, value, receiver) {\n        var base = _superPropBase(target, property);\n\n        var desc;\n\n        if (base) {\n          desc = Object.getOwnPropertyDescriptor(base, property);\n\n          if (desc.set) {\n            desc.set.call(receiver, value);\n            return true;\n          } else if (!desc.writable) {\n            return false;\n          }\n        }\n\n        desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n        if (desc) {\n          if (!desc.writable) {\n            return false;\n          }\n\n          desc.value = value;\n          Object.defineProperty(receiver, property, desc);\n        } else {\n          _defineProperty(receiver, property, value);\n        }\n\n        return true;\n      };\n    }\n\n    return set(target, property, value, receiver);\n  }\n\n  function _set(target, property, value, receiver, isStrict) {\n    var s = set(target, property, value, receiver || target);\n\n    if (!s && isStrict) {\n      throw new Error('failed to set property');\n    }\n\n    return value;\n  }\n\n  function _taggedTemplateLiteral(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    return Object.freeze(\n      Object.defineProperties(strings, {\n        raw: {\n          value: Object.freeze(raw)\n        }\n      })\n    );\n  }\n\n  function _taggedTemplateLiteralLoose(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    strings.raw = raw;\n    return strings;\n  }\n\n  function _temporalRef(val, name) {\n    if (val === _temporalUndefined) {\n      throw new ReferenceError(name + ' is not defined - temporal dead zone');\n    } else {\n      return val;\n    }\n  }\n\n  function _readOnlyError(name) {\n    throw new Error('\"' + name + '\" is read-only');\n  }\n\n  function _classNameTDZError(name) {\n    throw new Error(\n      'Class \"' + name + '\" cannot be referenced in computed property keys.'\n    );\n  }\n\n  var _temporalUndefined = {};\n\n  function _slicedToArray(arr, i) {\n    return (\n      _arrayWithHoles(arr) ||\n      _iterableToArrayLimit(arr, i) ||\n      _nonIterableRest()\n    );\n  }\n\n  function _slicedToArrayLoose(arr, i) {\n    return (\n      _arrayWithHoles(arr) ||\n      _iterableToArrayLimitLoose(arr, i) ||\n      _nonIterableRest()\n    );\n  }\n\n  function _toArray(arr) {\n    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n  }\n\n  function _toConsumableArray(arr) {\n    return (\n      _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\n    );\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++)\n        arr2[i] = arr[i];\n\n      return arr2;\n    }\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArray(iter) {\n    if (\n      Symbol.iterator in Object(iter) ||\n      Object.prototype.toString.call(iter) === '[object Arguments]'\n    )\n      return Array.from(iter);\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (\n        var _i = arr[Symbol.iterator](), _s;\n        !(_n = (_s = _i.next()).done);\n        _n = true\n      ) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i['return'] != null) _i['return']();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _iterableToArrayLimitLoose(arr, i) {\n    var _arr = [];\n\n    for (\n      var _iterator = arr[Symbol.iterator](), _step;\n      !(_step = _iterator.next()).done;\n\n    ) {\n      _arr.push(_step.value);\n\n      if (i && _arr.length === i) break;\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError('Invalid attempt to spread non-iterable instance');\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError('Invalid attempt to destructure non-iterable instance');\n  }\n\n  function _skipFirstGeneratorNext(fn) {\n    return function() {\n      var it = fn.apply(this, arguments);\n      it.next();\n      return it;\n    };\n  }\n\n  function _toPrimitive(input, hint) {\n    if (typeof input !== 'object' || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || 'default');\n      if (typeof res !== 'object') return res;\n      throw new TypeError('@@toPrimitive must return a primitive value.');\n    }\n\n    return (hint === 'string' ? String : Number)(input);\n  }\n\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, 'string');\n\n    return typeof key === 'symbol' ? key : String(key);\n  }\n\n  function _initializerWarningHelper(descriptor, context) {\n    throw new Error(\n      'Decorating class property failed. Please ensure that ' +\n        'proposal-class-properties is enabled and set to use loose mode. ' +\n        'To use proposal-class-properties in spec mode with decorators, wait for ' +\n        'the next major version of decorators in stage 2.'\n    );\n  }\n\n  function _initializerDefineProperty(target, property, descriptor, context) {\n    if (!descriptor) return;\n    Object.defineProperty(target, property, {\n      enumerable: descriptor.enumerable,\n      configurable: descriptor.configurable,\n      writable: descriptor.writable,\n      value: descriptor.initializer\n        ? descriptor.initializer.call(context)\n        : void 0\n    });\n  }\n\n  function _applyDecoratedDescriptor(\n    target,\n    property,\n    decorators,\n    descriptor,\n    context\n  ) {\n    var desc = {};\n    Object.keys(descriptor).forEach(function(key) {\n      desc[key] = descriptor[key];\n    });\n    desc.enumerable = !!desc.enumerable;\n    desc.configurable = !!desc.configurable;\n\n    if ('value' in desc || desc.initializer) {\n      desc.writable = true;\n    }\n\n    desc = decorators\n      .slice()\n      .reverse()\n      .reduce(function(desc, decorator) {\n        return decorator(target, property, desc) || desc;\n      }, desc);\n\n    if (context && desc.initializer !== void 0) {\n      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n      desc.initializer = undefined;\n    }\n\n    if (desc.initializer === void 0) {\n      Object.defineProperty(target, property, desc);\n      desc = null;\n    }\n\n    return desc;\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return '__private_' + id++ + '_' + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError('attempted to use private field on non-instance');\n    }\n\n    return receiver;\n  }\n\n  function _classPrivateFieldGet(receiver, privateMap) {\n    var descriptor = privateMap.get(receiver);\n\n    if (!descriptor) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    if (descriptor.get) {\n      return descriptor.get.call(receiver);\n    }\n\n    return descriptor.value;\n  }\n\n  function _classPrivateFieldSet(receiver, privateMap, value) {\n    var descriptor = privateMap.get(receiver);\n\n    if (!descriptor) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    if (descriptor.set) {\n      descriptor.set.call(receiver, value);\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      descriptor.value = value;\n    }\n\n    return value;\n  }\n\n  function _classPrivateFieldDestructureSet(receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.set) {\n      if (!('__destrObj' in descriptor)) {\n        descriptor.__destrObj = {\n          set value(v) {\n            descriptor.set.call(receiver, v);\n          }\n        };\n      }\n\n      return descriptor.__destrObj;\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      return descriptor;\n    }\n  }\n\n  function _classStaticPrivateFieldSpecGet(\n    receiver,\n    classConstructor,\n    descriptor\n  ) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return descriptor.value;\n  }\n\n  function _classStaticPrivateFieldSpecSet(\n    receiver,\n    classConstructor,\n    descriptor,\n    value\n  ) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    if (!descriptor.writable) {\n      throw new TypeError('attempted to set read only private field');\n    }\n\n    descriptor.value = value;\n    return value;\n  }\n\n  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return method;\n  }\n\n  function _classStaticPrivateMethodSet() {\n    throw new TypeError('attempted to set read only static private field');\n  }\n\n  function _decorate(decorators, factory, superClass, mixins) {\n    var api = _getDecoratorsApi();\n\n    if (mixins) {\n      for (var i = 0; i < mixins.length; i++) {\n        api = mixins[i](api);\n      }\n    }\n\n    var r = factory(function initialize(O) {\n      api.initializeInstanceElements(O, decorated.elements);\n    }, superClass);\n    var decorated = api.decorateClass(\n      _coalesceClassElements(r.d.map(_createElementDescriptor)),\n      decorators\n    );\n    api.initializeClassElements(r.F, decorated.elements);\n    return api.runClassFinishers(r.F, decorated.finishers);\n  }\n\n  function _getDecoratorsApi() {\n    _getDecoratorsApi = function() {\n      return api;\n    };\n\n    var api = {\n      elementsDefinitionOrder: [['method'], ['field']],\n      initializeInstanceElements: function(O, elements) {\n        ['method', 'field'].forEach(function(kind) {\n          elements.forEach(function(element) {\n            if (element.kind === kind && element.placement === 'own') {\n              this.defineClassElement(O, element);\n            }\n          }, this);\n        }, this);\n      },\n      initializeClassElements: function(F, elements) {\n        var proto = F.prototype;\n        ['method', 'field'].forEach(function(kind) {\n          elements.forEach(function(element) {\n            var placement = element.placement;\n\n            if (\n              element.kind === kind &&\n              (placement === 'static' || placement === 'prototype')\n            ) {\n              var receiver = placement === 'static' ? F : proto;\n              this.defineClassElement(receiver, element);\n            }\n          }, this);\n        }, this);\n      },\n      defineClassElement: function(receiver, element) {\n        var descriptor = element.descriptor;\n\n        if (element.kind === 'field') {\n          var initializer = element.initializer;\n          descriptor = {\n            enumerable: descriptor.enumerable,\n            writable: descriptor.writable,\n            configurable: descriptor.configurable,\n            value: initializer === void 0 ? void 0 : initializer.call(receiver)\n          };\n        }\n\n        Object.defineProperty(receiver, element.key, descriptor);\n      },\n      decorateClass: function(elements, decorators) {\n        var newElements = [];\n        var finishers = [];\n        var placements = {\n          static: [],\n          prototype: [],\n          own: []\n        };\n        elements.forEach(function(element) {\n          this.addElementPlacement(element, placements);\n        }, this);\n        elements.forEach(function(element) {\n          if (!_hasDecorators(element)) return newElements.push(element);\n          var elementFinishersExtras = this.decorateElement(\n            element,\n            placements\n          );\n          newElements.push(elementFinishersExtras.element);\n          newElements.push.apply(newElements, elementFinishersExtras.extras);\n          finishers.push.apply(finishers, elementFinishersExtras.finishers);\n        }, this);\n\n        if (!decorators) {\n          return {\n            elements: newElements,\n            finishers: finishers\n          };\n        }\n\n        var result = this.decorateConstructor(newElements, decorators);\n        finishers.push.apply(finishers, result.finishers);\n        result.finishers = finishers;\n        return result;\n      },\n      addElementPlacement: function(element, placements, silent) {\n        var keys = placements[element.placement];\n\n        if (!silent && keys.indexOf(element.key) !== -1) {\n          throw new TypeError('Duplicated element (' + element.key + ')');\n        }\n\n        keys.push(element.key);\n      },\n      decorateElement: function(element, placements) {\n        var extras = [];\n        var finishers = [];\n\n        for (\n          var decorators = element.decorators, i = decorators.length - 1;\n          i >= 0;\n          i--\n        ) {\n          var keys = placements[element.placement];\n          keys.splice(keys.indexOf(element.key), 1);\n          var elementObject = this.fromElementDescriptor(element);\n          var elementFinisherExtras = this.toElementFinisherExtras(\n            (0, decorators[i])(elementObject) || elementObject\n          );\n          element = elementFinisherExtras.element;\n          this.addElementPlacement(element, placements);\n\n          if (elementFinisherExtras.finisher) {\n            finishers.push(elementFinisherExtras.finisher);\n          }\n\n          var newExtras = elementFinisherExtras.extras;\n\n          if (newExtras) {\n            for (var j = 0; j < newExtras.length; j++) {\n              this.addElementPlacement(newExtras[j], placements);\n            }\n\n            extras.push.apply(extras, newExtras);\n          }\n        }\n\n        return {\n          element: element,\n          finishers: finishers,\n          extras: extras\n        };\n      },\n      decorateConstructor: function(elements, decorators) {\n        var finishers = [];\n\n        for (var i = decorators.length - 1; i >= 0; i--) {\n          var obj = this.fromClassDescriptor(elements);\n          var elementsAndFinisher = this.toClassDescriptor(\n            (0, decorators[i])(obj) || obj\n          );\n\n          if (elementsAndFinisher.finisher !== undefined) {\n            finishers.push(elementsAndFinisher.finisher);\n          }\n\n          if (elementsAndFinisher.elements !== undefined) {\n            elements = elementsAndFinisher.elements;\n\n            for (var j = 0; j < elements.length - 1; j++) {\n              for (var k = j + 1; k < elements.length; k++) {\n                if (\n                  elements[j].key === elements[k].key &&\n                  elements[j].placement === elements[k].placement\n                ) {\n                  throw new TypeError(\n                    'Duplicated element (' + elements[j].key + ')'\n                  );\n                }\n              }\n            }\n          }\n        }\n\n        return {\n          elements: elements,\n          finishers: finishers\n        };\n      },\n      fromElementDescriptor: function(element) {\n        var obj = {\n          kind: element.kind,\n          key: element.key,\n          placement: element.placement,\n          descriptor: element.descriptor\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        if (element.kind === 'field') obj.initializer = element.initializer;\n        return obj;\n      },\n      toElementDescriptors: function(elementObjects) {\n        if (elementObjects === undefined) return;\n        return _toArray(elementObjects).map(function(elementObject) {\n          var element = this.toElementDescriptor(elementObject);\n          this.disallowProperty(\n            elementObject,\n            'finisher',\n            'An element descriptor'\n          );\n          this.disallowProperty(\n            elementObject,\n            'extras',\n            'An element descriptor'\n          );\n          return element;\n        }, this);\n      },\n      toElementDescriptor: function(elementObject) {\n        var kind = String(elementObject.kind);\n\n        if (kind !== 'method' && kind !== 'field') {\n          throw new TypeError(\n            'An element descriptor\\'s .kind property must be either \"method\" or' +\n              ' \"field\", but a decorator created an element descriptor with' +\n              ' .kind \"' +\n              kind +\n              '\"'\n          );\n        }\n\n        var key = _toPropertyKey(elementObject.key);\n\n        var placement = String(elementObject.placement);\n\n        if (\n          placement !== 'static' &&\n          placement !== 'prototype' &&\n          placement !== 'own'\n        ) {\n          throw new TypeError(\n            'An element descriptor\\'s .placement property must be one of \"static\",' +\n              ' \"prototype\" or \"own\", but a decorator created an element descriptor' +\n              ' with .placement \"' +\n              placement +\n              '\"'\n          );\n        }\n\n        var descriptor = elementObject.descriptor;\n        this.disallowProperty(\n          elementObject,\n          'elements',\n          'An element descriptor'\n        );\n        var element = {\n          kind: kind,\n          key: key,\n          placement: placement,\n          descriptor: Object.assign({}, descriptor)\n        };\n\n        if (kind !== 'field') {\n          this.disallowProperty(\n            elementObject,\n            'initializer',\n            'A method descriptor'\n          );\n        } else {\n          this.disallowProperty(\n            descriptor,\n            'get',\n            'The property descriptor of a field descriptor'\n          );\n          this.disallowProperty(\n            descriptor,\n            'set',\n            'The property descriptor of a field descriptor'\n          );\n          this.disallowProperty(\n            descriptor,\n            'value',\n            'The property descriptor of a field descriptor'\n          );\n          element.initializer = elementObject.initializer;\n        }\n\n        return element;\n      },\n      toElementFinisherExtras: function(elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n\n        var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n        var extras = this.toElementDescriptors(elementObject.extras);\n        return {\n          element: element,\n          finisher: finisher,\n          extras: extras\n        };\n      },\n      fromClassDescriptor: function(elements) {\n        var obj = {\n          kind: 'class',\n          elements: elements.map(this.fromElementDescriptor, this)\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        return obj;\n      },\n      toClassDescriptor: function(obj) {\n        var kind = String(obj.kind);\n\n        if (kind !== 'class') {\n          throw new TypeError(\n            'A class descriptor\\'s .kind property must be \"class\", but a decorator' +\n              ' created a class descriptor with .kind \"' +\n              kind +\n              '\"'\n          );\n        }\n\n        this.disallowProperty(obj, 'key', 'A class descriptor');\n        this.disallowProperty(obj, 'placement', 'A class descriptor');\n        this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n        this.disallowProperty(obj, 'initializer', 'A class descriptor');\n        this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n        var finisher = _optionalCallableProperty(obj, 'finisher');\n\n        var elements = this.toElementDescriptors(obj.elements);\n        return {\n          elements: elements,\n          finisher: finisher\n        };\n      },\n      runClassFinishers: function(constructor, finishers) {\n        for (var i = 0; i < finishers.length; i++) {\n          var newConstructor = (0, finishers[i])(constructor);\n\n          if (newConstructor !== undefined) {\n            if (typeof newConstructor !== 'function') {\n              throw new TypeError('Finishers must return a constructor.');\n            }\n\n            constructor = newConstructor;\n          }\n        }\n\n        return constructor;\n      },\n      disallowProperty: function(obj, name, objectType) {\n        if (obj[name] !== undefined) {\n          throw new TypeError(\n            objectType + \" can't have a .\" + name + ' property.'\n          );\n        }\n      }\n    };\n    return api;\n  }\n\n  function _createElementDescriptor(def) {\n    var key = _toPropertyKey(def.key);\n\n    var descriptor;\n\n    if (def.kind === 'method') {\n      descriptor = {\n        value: def.value,\n        writable: true,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'get') {\n      descriptor = {\n        get: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'set') {\n      descriptor = {\n        set: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'field') {\n      descriptor = {\n        configurable: true,\n        writable: true,\n        enumerable: true\n      };\n    }\n\n    var element = {\n      kind: def.kind === 'field' ? 'field' : 'method',\n      key: key,\n      placement: def.static\n        ? 'static'\n        : def.kind === 'field'\n        ? 'own'\n        : 'prototype',\n      descriptor: descriptor\n    };\n    if (def.decorators) element.decorators = def.decorators;\n    if (def.kind === 'field') element.initializer = def.value;\n    return element;\n  }\n\n  function _coalesceGetterSetter(element, other) {\n    if (element.descriptor.get !== undefined) {\n      other.descriptor.get = element.descriptor.get;\n    } else {\n      other.descriptor.set = element.descriptor.set;\n    }\n  }\n\n  function _coalesceClassElements(elements) {\n    var newElements = [];\n\n    var isSameElement = function(other) {\n      return (\n        other.kind === 'method' &&\n        other.key === element.key &&\n        other.placement === element.placement\n      );\n    };\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n      var other;\n\n      if (\n        element.kind === 'method' &&\n        (other = newElements.find(isSameElement))\n      ) {\n        if (\n          _isDataDescriptor(element.descriptor) ||\n          _isDataDescriptor(other.descriptor)\n        ) {\n          if (_hasDecorators(element) || _hasDecorators(other)) {\n            throw new ReferenceError(\n              'Duplicated methods (' + element.key + \") can't be decorated.\"\n            );\n          }\n\n          other.descriptor = element.descriptor;\n        } else {\n          if (_hasDecorators(element)) {\n            if (_hasDecorators(other)) {\n              throw new ReferenceError(\n                \"Decorators can't be placed on different accessors with for \" +\n                  'the same property (' +\n                  element.key +\n                  ').'\n              );\n            }\n\n            other.decorators = element.decorators;\n          }\n\n          _coalesceGetterSetter(element, other);\n        }\n      } else {\n        newElements.push(element);\n      }\n    }\n\n    return newElements;\n  }\n\n  function _hasDecorators(element) {\n    return element.decorators && element.decorators.length;\n  }\n\n  function _isDataDescriptor(desc) {\n    return (\n      desc !== undefined &&\n      !(desc.value === undefined && desc.writable === undefined)\n    );\n  }\n\n  function _optionalCallableProperty(obj, name) {\n    var value = obj[name];\n\n    if (value !== undefined && typeof value !== 'function') {\n      throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n    }\n\n    return value;\n  }\n\n  function _classPrivateMethodGet(receiver, privateSet, fn) {\n    if (!privateSet.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    return fn;\n  }\n\n  function _classPrivateMethodSet() {\n    throw new TypeError('attempted to reassign private method');\n  }\n\n  function _wrapRegExp(re, groups) {\n    _wrapRegExp = function(re, groups) {\n      return new BabelRegExp(re, groups);\n    };\n\n    var _RegExp = _wrapNativeSuper(RegExp);\n\n    var _super = RegExp.prototype;\n\n    var _groups = new WeakMap();\n\n    function BabelRegExp(re, groups) {\n      var _this = _RegExp.call(this, re);\n\n      _groups.set(_this, groups);\n\n      return _this;\n    }\n\n    _inherits(BabelRegExp, _RegExp);\n\n    BabelRegExp.prototype.exec = function(str) {\n      var result = _super.exec.call(this, str);\n\n      if (result) result.groups = buildGroups(result, this);\n      return result;\n    };\n\n    BabelRegExp.prototype[Symbol.replace] = function(str, substitution) {\n      if (typeof substitution === 'string') {\n        var groups = _groups.get(this);\n\n        return _super[Symbol.replace].call(\n          this,\n          str,\n          substitution.replace(/\\$<([^>]+)>/g, function(_, name) {\n            return '$' + groups[name];\n          })\n        );\n      } else if (typeof substitution === 'function') {\n        var _this = this;\n\n        return _super[Symbol.replace].call(this, str, function() {\n          var args = [];\n          args.push.apply(args, arguments);\n\n          if (typeof args[args.length - 1] !== 'object') {\n            args.push(buildGroups(args, _this));\n          }\n\n          return substitution.apply(this, args);\n        });\n      } else {\n        return _super[Symbol.replace].call(this, str, substitution);\n      }\n    };\n\n    function buildGroups(result, re) {\n      var g = _groups.get(re);\n\n      return Object.keys(g).reduce(function(groups, name) {\n        groups[name] = result[g[name]];\n        return groups;\n      }, Object.create(null));\n    }\n\n    return _wrapRegExp.apply(this, arguments);\n  }\n\n  var arrayRemove = function arrayRemove(arr, index) {\n    return arr.splice(index, 1);\n  };\n\n  var run = function run(cb, sync) {\n    if (sync) {\n      cb();\n    } else if (document.hidden) {\n      Promise.resolve(1).then(cb);\n    } else {\n      setTimeout(cb, 0);\n    }\n  };\n\n  var on = function on() {\n    var listeners = [];\n    var off = function off(event, cb) {\n      arrayRemove(\n        listeners,\n        listeners.findIndex(function(listener) {\n          return listener.event === event && (listener.cb === cb || !cb);\n        })\n      );\n    };\n    var _fire = function fire(event, args, sync) {\n      listeners\n        .filter(function(listener) {\n          return listener.event === event;\n        })\n        .map(function(listener) {\n          return listener.cb;\n        })\n        .forEach(function(cb) {\n          return run(function() {\n            return cb.apply(void 0, _toConsumableArray(args));\n          }, sync);\n        });\n    };\n    return {\n      fireSync: function fireSync(event) {\n        for (\n          var _len = arguments.length,\n            args = new Array(_len > 1 ? _len - 1 : 0),\n            _key = 1;\n          _key < _len;\n          _key++\n        ) {\n          args[_key - 1] = arguments[_key];\n        }\n        _fire(event, args, true);\n      },\n      fire: function fire(event) {\n        for (\n          var _len2 = arguments.length,\n            args = new Array(_len2 > 1 ? _len2 - 1 : 0),\n            _key2 = 1;\n          _key2 < _len2;\n          _key2++\n        ) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n        _fire(event, args, false);\n      },\n      on: function on(event, cb) {\n        listeners.push({ event: event, cb: cb });\n      },\n      onOnce: function onOnce(event, _cb) {\n        listeners.push({\n          event: event,\n          cb: function cb() {\n            off(event, _cb);\n            _cb.apply(void 0, arguments);\n          }\n        });\n      },\n      off: off\n    };\n  };\n\n  var copyObjectPropertiesToObject = function copyObjectPropertiesToObject(\n    src,\n    target,\n    excluded\n  ) {\n    Object.getOwnPropertyNames(src)\n      .filter(function(property) {\n        return !excluded.includes(property);\n      })\n      .forEach(function(key) {\n        return Object.defineProperty(\n          target,\n          key,\n          Object.getOwnPropertyDescriptor(src, key)\n        );\n      });\n  };\n\n  var PRIVATE = [\n    'fire',\n    'process',\n    'revert',\n    'load',\n    'on',\n    'off',\n    'onOnce',\n    'retryLoad',\n    'extend',\n    'archive',\n    'archived',\n    'release',\n    'released',\n    'requestProcessing',\n    'freeze'\n  ];\n\n  var createItemAPI = function createItemAPI(item) {\n    var api = {};\n    copyObjectPropertiesToObject(item, api, PRIVATE);\n    return api;\n  };\n\n  var removeReleasedItems = function removeReleasedItems(items) {\n    items.forEach(function(item, index) {\n      if (item.released) {\n        arrayRemove(items, index);\n      }\n    });\n  };\n\n  var ItemStatus = {\n    INIT: 1,\n    IDLE: 2,\n    PROCESSING_QUEUED: 9,\n    PROCESSING: 3,\n    PROCESSING_COMPLETE: 5,\n    PROCESSING_ERROR: 6,\n    PROCESSING_REVERT_ERROR: 10,\n    LOADING: 7,\n    LOAD_ERROR: 8\n  };\n\n  var FileOrigin = {\n    INPUT: 1,\n    LIMBO: 2,\n    LOCAL: 3\n  };\n\n  var getNonNumeric = function getNonNumeric(str) {\n    return /[^0-9]+/.exec(str);\n  };\n\n  var getDecimalSeparator = function getDecimalSeparator() {\n    return getNonNumeric((1.1).toLocaleString())[0];\n  };\n\n  var getThousandsSeparator = function getThousandsSeparator() {\n    // Added for browsers that do not return the thousands separator (happend on native browser Android 4.4.4)\n    // We check against the normal toString output and if they're the same return a comma when decimal separator is a dot\n    var decimalSeparator = getDecimalSeparator();\n    var thousandsStringWithSeparator = (1000.0).toLocaleString();\n    var thousandsStringWithoutSeparator = (1000.0).toString();\n    if (thousandsStringWithSeparator !== thousandsStringWithoutSeparator) {\n      return getNonNumeric(thousandsStringWithSeparator)[0];\n    }\n    return decimalSeparator === '.' ? ',' : '.';\n  };\n\n  var Type = {\n    BOOLEAN: 'boolean',\n    INT: 'int',\n    NUMBER: 'number',\n    STRING: 'string',\n    ARRAY: 'array',\n    OBJECT: 'object',\n    FUNCTION: 'function',\n    ACTION: 'action',\n    SERVER_API: 'serverapi',\n    REGEX: 'regex'\n  };\n\n  // all registered filters\n  var filters = [];\n\n  // loops over matching filters and passes options to each filter, returning the mapped results\n  var applyFilterChain = function applyFilterChain(key, value, utils) {\n    return new Promise(function(resolve, reject) {\n      // find matching filters for this key\n      var matchingFilters = filters\n        .filter(function(f) {\n          return f.key === key;\n        })\n        .map(function(f) {\n          return f.cb;\n        });\n\n      // resolve now\n      if (matchingFilters.length === 0) {\n        resolve(value);\n        return;\n      }\n\n      // first filter to kick things of\n      var initialFilter = matchingFilters.shift();\n\n      // chain filters\n      matchingFilters\n        .reduce(\n          // loop over promises passing value to next promise\n          function(current, next) {\n            return current.then(function(value) {\n              return next(value, utils);\n            });\n          },\n\n          // call initial filter, will return a promise\n          initialFilter(value, utils)\n\n          // all executed\n        )\n        .then(function(value) {\n          return resolve(value);\n        })\n        .catch(function(error) {\n          return reject(error);\n        });\n    });\n  };\n\n  var applyFilters = function applyFilters(key, value, utils) {\n    return filters\n      .filter(function(f) {\n        return f.key === key;\n      })\n      .map(function(f) {\n        return f.cb(value, utils);\n      });\n  };\n\n  // adds a new filter to the list\n  var addFilter = function addFilter(key, cb) {\n    return filters.push({ key: key, cb: cb });\n  };\n\n  var extendDefaultOptions = function extendDefaultOptions(additionalOptions) {\n    return Object.assign(defaultOptions, additionalOptions);\n  };\n\n  var getOptions = function getOptions() {\n    return Object.assign({}, defaultOptions);\n  };\n\n  var setOptions = function setOptions(opts) {\n    forin(opts, function(key, value) {\n      // key does not exist, so this option cannot be set\n      if (!defaultOptions[key]) {\n        return;\n      }\n      defaultOptions[key][0] = getValueByType(\n        value,\n        defaultOptions[key][0],\n        defaultOptions[key][1]\n      );\n    });\n  };\n\n  // default options on app\n  var defaultOptions = {\n    // the id to add to the root element\n    id: [null, Type.STRING],\n\n    // input field name to use\n    name: ['filepond', Type.STRING],\n\n    // disable the field\n    disabled: [false, Type.BOOLEAN],\n\n    // classname to put on wrapper\n    className: [null, Type.STRING],\n\n    // is the field required\n    required: [false, Type.BOOLEAN],\n\n    // Allow media capture when value is set\n    captureMethod: [null, Type.STRING],\n    // - \"camera\", \"microphone\" or \"camcorder\",\n    // - Does not work with multiple on apple devices\n    // - If set, acceptedFileTypes must be made to match with media wildcard \"image/*\", \"audio/*\" or \"video/*\"\n\n    // sync `acceptedFileTypes` property with `accept` attribute\n    allowSyncAcceptAttribute: [true, Type.BOOLEAN],\n\n    // Feature toggles\n    allowDrop: [true, Type.BOOLEAN], // Allow dropping of files\n    allowBrowse: [true, Type.BOOLEAN], // Allow browsing the file system\n    allowPaste: [true, Type.BOOLEAN], // Allow pasting files\n    allowMultiple: [false, Type.BOOLEAN], // Allow multiple files (disabled by default, as multiple attribute is also required on input to allow multiple)\n    allowReplace: [true, Type.BOOLEAN], // Allow dropping a file on other file to replace it (only works when multiple is set to false)\n    allowRevert: [true, Type.BOOLEAN], // Allows user to revert file upload\n    allowProcess: [true, Type.BOOLEAN], // Allows user to process a file, when set to false, this removes the file upload button\n    allowReorder: [false, Type.BOOLEAN], // Allow reordering of files\n    allowDirectoriesOnly: [false, Type.BOOLEAN], // Allow only selecting directories with browse (no support for filtering dnd at this point)\n\n    // Revert mode\n    forceRevert: [false, Type.BOOLEAN], // Set to 'force' to require the file to be reverted before removal\n\n    // Input requirements\n    maxFiles: [null, Type.INT], // Max number of files\n    checkValidity: [false, Type.BOOLEAN], // Enables custom validity messages\n\n    // Where to put file\n    itemInsertLocationFreedom: [true, Type.BOOLEAN], // Set to false to always add items to begin or end of list\n    itemInsertLocation: ['before', Type.STRING], // Default index in list to add items that have been dropped at the top of the list\n    itemInsertInterval: [75, Type.INT],\n\n    // Drag 'n Drop related\n    dropOnPage: [false, Type.BOOLEAN], // Allow dropping of files anywhere on page (prevents browser from opening file if dropped outside of Up)\n    dropOnElement: [true, Type.BOOLEAN], // Drop needs to happen on element (set to false to also load drops outside of Up)\n    dropValidation: [false, Type.BOOLEAN], // Enable or disable validating files on drop\n    ignoredFiles: [['.ds_store', 'thumbs.db', 'desktop.ini'], Type.ARRAY],\n\n    // Upload related\n    instantUpload: [true, Type.BOOLEAN], // Should upload files immidiately on drop\n    maxParallelUploads: [2, Type.INT], // Maximum files to upload in parallel\n\n    // Chunks\n    chunkUploads: [false, Type.BOOLEAN], // Enable chunked uploads\n    chunkForce: [false, Type.BOOLEAN], // Force use of chunk uploads even for files smaller than chunk size\n    chunkSize: [5000000, Type.INT], // Size of chunks (5MB default)\n    chunkRetryDelays: [[500, 1000, 3000], Type.Array], // Amount of times to retry upload of a chunk when it fails\n\n    // The server api end points to use for uploading (see docs)\n    server: [null, Type.SERVER_API],\n\n    // Labels and status messages\n    labelDecimalSeparator: [getDecimalSeparator(), Type.STRING], // Default is locale separator\n    labelThousandsSeparator: [getThousandsSeparator(), Type.STRING], // Default is locale separator\n\n    labelIdle: [\n      'Drag & Drop your files or <span class=\"filepond--label-action\">Browse</span>',\n      Type.STRING\n    ],\n    labelInvalidField: ['Field contains invalid files', Type.STRING],\n    labelFileWaitingForSize: ['Waiting for size', Type.STRING],\n    labelFileSizeNotAvailable: ['Size not available', Type.STRING],\n    labelFileCountSingular: ['file in list', Type.STRING],\n    labelFileCountPlural: ['files in list', Type.STRING],\n    labelFileLoading: ['Loading', Type.STRING],\n    labelFileAdded: ['Added', Type.STRING], // assistive only\n    labelFileLoadError: ['Error during load', Type.STRING],\n    labelFileRemoved: ['Removed', Type.STRING], // assistive only\n    labelFileRemoveError: ['Error during remove', Type.STRING],\n    labelFileProcessing: ['Uploading', Type.STRING],\n    labelFileProcessingComplete: ['Upload complete', Type.STRING],\n    labelFileProcessingAborted: ['Upload cancelled', Type.STRING],\n    labelFileProcessingError: ['Error during upload', Type.STRING],\n    labelFileProcessingRevertError: ['Error during revert', Type.STRING],\n\n    labelTapToCancel: ['tap to cancel', Type.STRING],\n    labelTapToRetry: ['tap to retry', Type.STRING],\n    labelTapToUndo: ['tap to undo', Type.STRING],\n\n    labelButtonRemoveItem: ['Remove', Type.STRING],\n    labelButtonAbortItemLoad: ['Abort', Type.STRING],\n    labelButtonRetryItemLoad: ['Retry', Type.STRING],\n    labelButtonAbortItemProcessing: ['Cancel', Type.STRING],\n    labelButtonUndoItemProcessing: ['Undo', Type.STRING],\n    labelButtonRetryItemProcessing: ['Retry', Type.STRING],\n    labelButtonProcessItem: ['Upload', Type.STRING],\n\n    // make sure width and height plus viewpox are even numbers so icons are nicely centered\n    iconRemove: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M11.586 13l-2.293 2.293a1 1 0 0 0 1.414 1.414L13 14.414l2.293 2.293a1 1 0 0 0 1.414-1.414L14.414 13l2.293-2.293a1 1 0 0 0-1.414-1.414L13 11.586l-2.293-2.293a1 1 0 0 0-1.414 1.414L11.586 13z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>',\n      Type.STRING\n    ],\n\n    iconProcess: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 10.414v3.585a1 1 0 0 1-2 0v-3.585l-1.293 1.293a1 1 0 0 1-1.414-1.415l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.415L14 10.414zM9 18a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2H9z\" fill=\"currentColor\" fill-rule=\"evenodd\"/></svg>',\n      Type.STRING\n    ],\n\n    iconRetry: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10.81 9.185l-.038.02A4.997 4.997 0 0 0 8 13.683a5 5 0 0 0 5 5 5 5 0 0 0 5-5 1 1 0 0 1 2 0A7 7 0 1 1 9.722 7.496l-.842-.21a.999.999 0 1 1 .484-1.94l3.23.806c.535.133.86.675.73 1.21l-.804 3.233a.997.997 0 0 1-1.21.73.997.997 0 0 1-.73-1.21l.23-.928v-.002z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>',\n      Type.STRING\n    ],\n\n    iconUndo: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M9.185 10.81l.02-.038A4.997 4.997 0 0 1 13.683 8a5 5 0 0 1 5 5 5 5 0 0 1-5 5 1 1 0 0 0 0 2A7 7 0 1 0 7.496 9.722l-.21-.842a.999.999 0 1 0-1.94.484l.806 3.23c.133.535.675.86 1.21.73l3.233-.803a.997.997 0 0 0 .73-1.21.997.997 0 0 0-1.21-.73l-.928.23-.002-.001z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>',\n      Type.STRING\n    ],\n\n    iconDone: [\n      '<svg width=\"26\" height=\"26\" viewBox=\"0 0 26 26\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M18.293 9.293a1 1 0 0 1 1.414 1.414l-7.002 7a1 1 0 0 1-1.414 0l-3.998-4a1 1 0 1 1 1.414-1.414L12 15.586l6.294-6.293z\" fill=\"currentColor\" fill-rule=\"nonzero\"/></svg>',\n      Type.STRING\n    ],\n\n    // event handlers\n    oninit: [null, Type.FUNCTION],\n    onwarning: [null, Type.FUNCTION],\n    onerror: [null, Type.FUNCTION],\n    onactivatefile: [null, Type.FUNCTION],\n    oninitfile: [null, Type.FUNCTION],\n    onaddfilestart: [null, Type.FUNCTION],\n    onaddfileprogress: [null, Type.FUNCTION],\n    onaddfile: [null, Type.FUNCTION],\n    onprocessfilestart: [null, Type.FUNCTION],\n    onprocessfileprogress: [null, Type.FUNCTION],\n    onprocessfileabort: [null, Type.FUNCTION],\n    onprocessfilerevert: [null, Type.FUNCTION],\n    onprocessfile: [null, Type.FUNCTION],\n    onprocessfiles: [null, Type.FUNCTION],\n    onremovefile: [null, Type.FUNCTION],\n    onpreparefile: [null, Type.FUNCTION],\n    onupdatefiles: [null, Type.FUNCTION],\n    onreorderfiles: [null, Type.FUNCTION],\n\n    // hooks\n    beforeDropFile: [null, Type.FUNCTION],\n    beforeAddFile: [null, Type.FUNCTION],\n    beforeRemoveFile: [null, Type.FUNCTION],\n\n    // styles\n    stylePanelLayout: [null, Type.STRING], // null 'integrated', 'compact', 'circle'\n    stylePanelAspectRatio: [null, Type.STRING], // null or '3:2' or 1\n    styleItemPanelAspectRatio: [null, Type.STRING],\n    styleButtonRemoveItemPosition: ['left', Type.STRING],\n    styleButtonProcessItemPosition: ['right', Type.STRING],\n    styleLoadIndicatorPosition: ['right', Type.STRING],\n    styleProgressIndicatorPosition: ['right', Type.STRING],\n    styleButtonRemoveItemAlign: [false, Type.BOOLEAN],\n\n    // custom initial files array\n    files: [[], Type.ARRAY]\n  };\n\n  var getItemByQuery = function getItemByQuery(items, query) {\n    // just return first index\n    if (isEmpty(query)) {\n      return items[0] || null;\n    }\n\n    // query is index\n    if (isInt(query)) {\n      return items[query] || null;\n    }\n\n    // if query is item, get the id\n    if (typeof query === 'object') {\n      query = query.id;\n    }\n\n    // assume query is a string and return item by id\n    return (\n      items.find(function(item) {\n        return item.id === query;\n      }) || null\n    );\n  };\n\n  var getNumericAspectRatioFromString = function getNumericAspectRatioFromString(\n    aspectRatio\n  ) {\n    if (isEmpty(aspectRatio)) {\n      return aspectRatio;\n    }\n    if (/:/.test(aspectRatio)) {\n      var parts = aspectRatio.split(':');\n      return parts[1] / parts[0];\n    }\n    return parseFloat(aspectRatio);\n  };\n\n  var getActiveItems = function getActiveItems(items) {\n    return items.filter(function(item) {\n      return !item.archived;\n    });\n  };\n\n  var Status = {\n    EMPTY: 0,\n    IDLE: 1, // waiting\n    ERROR: 2, // a file is in error state\n    BUSY: 3, // busy processing or loading\n    READY: 4 // all files uploaded\n  };\n\n  var ITEM_ERROR = [\n    ItemStatus.LOAD_ERROR,\n    ItemStatus.PROCESSING_ERROR,\n    ItemStatus.PROCESSING_REVERT_ERROR\n  ];\n  var ITEM_BUSY = [\n    ItemStatus.LOADING,\n    ItemStatus.PROCESSING,\n    ItemStatus.PROCESSING_QUEUED,\n    ItemStatus.INIT\n  ];\n  var ITEM_READY = [ItemStatus.PROCESSING_COMPLETE];\n\n  var isItemInErrorState = function isItemInErrorState(item) {\n    return ITEM_ERROR.includes(item.status);\n  };\n  var isItemInBusyState = function isItemInBusyState(item) {\n    return ITEM_BUSY.includes(item.status);\n  };\n  var isItemInReadyState = function isItemInReadyState(item) {\n    return ITEM_READY.includes(item.status);\n  };\n\n  var queries = function queries(state) {\n    return {\n      GET_STATUS: function GET_STATUS() {\n        var items = getActiveItems(state.items);\n        var EMPTY = Status.EMPTY,\n          ERROR = Status.ERROR,\n          BUSY = Status.BUSY,\n          IDLE = Status.IDLE,\n          READY = Status.READY;\n\n        if (items.length === 0) return EMPTY;\n\n        if (items.some(isItemInErrorState)) return ERROR;\n\n        if (items.some(isItemInBusyState)) return BUSY;\n\n        if (items.some(isItemInReadyState)) return READY;\n\n        return IDLE;\n      },\n\n      GET_ITEM: function GET_ITEM(query) {\n        return getItemByQuery(state.items, query);\n      },\n\n      GET_ACTIVE_ITEM: function GET_ACTIVE_ITEM(query) {\n        return getItemByQuery(getActiveItems(state.items), query);\n      },\n\n      GET_ACTIVE_ITEMS: function GET_ACTIVE_ITEMS() {\n        return getActiveItems(state.items);\n      },\n\n      GET_ITEMS: function GET_ITEMS() {\n        return state.items;\n      },\n\n      GET_ITEM_NAME: function GET_ITEM_NAME(query) {\n        var item = getItemByQuery(state.items, query);\n        return item ? item.filename : null;\n      },\n\n      GET_ITEM_SIZE: function GET_ITEM_SIZE(query) {\n        var item = getItemByQuery(state.items, query);\n        return item ? item.fileSize : null;\n      },\n\n      GET_STYLES: function GET_STYLES() {\n        return Object.keys(state.options)\n          .filter(function(key) {\n            return /^style/.test(key);\n          })\n          .map(function(option) {\n            return {\n              name: option,\n              value: state.options[option]\n            };\n          });\n      },\n\n      GET_PANEL_ASPECT_RATIO: function GET_PANEL_ASPECT_RATIO() {\n        var isShapeCircle = /circle/.test(state.options.stylePanelLayout);\n        var aspectRatio = isShapeCircle\n          ? 1\n          : getNumericAspectRatioFromString(\n              state.options.stylePanelAspectRatio\n            );\n        return aspectRatio;\n      },\n\n      GET_ITEM_PANEL_ASPECT_RATIO: function GET_ITEM_PANEL_ASPECT_RATIO() {\n        return state.options.styleItemPanelAspectRatio;\n      },\n\n      GET_ITEMS_BY_STATUS: function GET_ITEMS_BY_STATUS(status) {\n        return getActiveItems(state.items).filter(function(item) {\n          return item.status === status;\n        });\n      },\n\n      GET_TOTAL_ITEMS: function GET_TOTAL_ITEMS() {\n        return getActiveItems(state.items).length;\n      },\n\n      IS_ASYNC: function IS_ASYNC() {\n        return (\n          isObject(state.options.server) &&\n          (isObject(state.options.server.process) ||\n            isFunction(state.options.server.process))\n        );\n      }\n    };\n  };\n\n  var hasRoomForItem = function hasRoomForItem(state) {\n    var count = getActiveItems(state.items).length;\n\n    // if cannot have multiple items, to add one item it should currently not contain items\n    if (!state.options.allowMultiple) {\n      return count === 0;\n    }\n\n    // if allows multiple items, we check if a max item count has been set, if not, there's no limit\n    var maxFileCount = state.options.maxFiles;\n    if (maxFileCount === null) {\n      return true;\n    }\n\n    // we check if the current count is smaller than the max count, if so, another file can still be added\n    if (count < maxFileCount) {\n      return true;\n    }\n\n    // no more room for another file\n    return false;\n  };\n\n  var limit = function limit(value, min, max) {\n    return Math.max(Math.min(max, value), min);\n  };\n\n  var arrayInsert = function arrayInsert(arr, index, item) {\n    return arr.splice(index, 0, item);\n  };\n\n  var insertItem = function insertItem(items, item, index) {\n    if (isEmpty(item)) {\n      return null;\n    }\n\n    // if index is undefined, append\n    if (typeof index === 'undefined') {\n      items.push(item);\n      return item;\n    }\n\n    // limit the index to the size of the items array\n    index = limit(index, 0, items.length);\n\n    // add item to array\n    arrayInsert(items, index, item);\n\n    // expose\n    return item;\n  };\n\n  var isBase64DataURI = function isBase64DataURI(str) {\n    return /^\\s*data:([a-z]+\\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\\-._~:@\\/?%\\s]*)\\s*$/i.test(\n      str\n    );\n  };\n\n  var getFilenameFromURL = function getFilenameFromURL(url) {\n    return url\n      .split('/')\n      .pop()\n      .split('?')\n      .shift();\n  };\n\n  var getExtensionFromFilename = function getExtensionFromFilename(name) {\n    return name.split('.').pop();\n  };\n\n  var guesstimateExtension = function guesstimateExtension(type) {\n    // if no extension supplied, exit here\n    if (typeof type !== 'string') {\n      return '';\n    }\n\n    // get subtype\n    var subtype = type.split('/').pop();\n\n    // is svg subtype\n    if (/svg/.test(subtype)) {\n      return 'svg';\n    }\n\n    if (/zip|compressed/.test(subtype)) {\n      return 'zip';\n    }\n\n    if (/plain/.test(subtype)) {\n      return 'txt';\n    }\n\n    if (/msword/.test(subtype)) {\n      return 'doc';\n    }\n\n    // if is valid subtype\n    if (/[a-z]+/.test(subtype)) {\n      // always use jpg extension\n      if (subtype === 'jpeg') {\n        return 'jpg';\n      }\n\n      // return subtype\n      return subtype;\n    }\n\n    return '';\n  };\n\n  var leftPad = function leftPad(value) {\n    var padding =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    return (padding + value).slice(-padding.length);\n  };\n\n  var getDateString = function getDateString() {\n    var date =\n      arguments.length > 0 && arguments[0] !== undefined\n        ? arguments[0]\n        : new Date();\n    return (\n      date.getFullYear() +\n      '-' +\n      leftPad(date.getMonth() + 1, '00') +\n      '-' +\n      leftPad(date.getDate(), '00') +\n      '_' +\n      leftPad(date.getHours(), '00') +\n      '-' +\n      leftPad(date.getMinutes(), '00') +\n      '-' +\n      leftPad(date.getSeconds(), '00')\n    );\n  };\n\n  var getFileFromBlob = function getFileFromBlob(blob, filename) {\n    var type =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    var extension =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n    var file =\n      typeof type === 'string'\n        ? blob.slice(0, blob.size, type)\n        : blob.slice(0, blob.size, blob.type);\n    file.lastModifiedDate = new Date();\n\n    // copy relative path\n    if (blob._relativePath) file._relativePath = blob._relativePath;\n\n    // if blob has name property, use as filename if no filename supplied\n    if (!isString(filename)) {\n      filename = getDateString();\n    }\n\n    // if filename supplied but no extension and filename has extension\n    if (filename && extension === null && getExtensionFromFilename(filename)) {\n      file.name = filename;\n    } else {\n      extension = extension || guesstimateExtension(file.type);\n      file.name = filename + (extension ? '.' + extension : '');\n    }\n\n    return file;\n  };\n\n  var getBlobBuilder = function getBlobBuilder() {\n    return (window.BlobBuilder =\n      window.BlobBuilder ||\n      window.WebKitBlobBuilder ||\n      window.MozBlobBuilder ||\n      window.MSBlobBuilder);\n  };\n\n  var createBlob = function createBlob(arrayBuffer, mimeType) {\n    var BB = getBlobBuilder();\n\n    if (BB) {\n      var bb = new BB();\n      bb.append(arrayBuffer);\n      return bb.getBlob(mimeType);\n    }\n\n    return new Blob([arrayBuffer], {\n      type: mimeType\n    });\n  };\n\n  var getBlobFromByteStringWithMimeType = function getBlobFromByteStringWithMimeType(\n    byteString,\n    mimeType\n  ) {\n    var ab = new ArrayBuffer(byteString.length);\n    var ia = new Uint8Array(ab);\n\n    for (var i = 0; i < byteString.length; i++) {\n      ia[i] = byteString.charCodeAt(i);\n    }\n\n    return createBlob(ab, mimeType);\n  };\n\n  var getMimeTypeFromBase64DataURI = function getMimeTypeFromBase64DataURI(\n    dataURI\n  ) {\n    return (/^data:(.+);/.exec(dataURI) || [])[1] || null;\n  };\n\n  var getBase64DataFromBase64DataURI = function getBase64DataFromBase64DataURI(\n    dataURI\n  ) {\n    // get data part of string (remove data:image/jpeg...,)\n    var data = dataURI.split(',')[1];\n\n    // remove any whitespace as that causes InvalidCharacterError in IE\n    return data.replace(/\\s/g, '');\n  };\n\n  var getByteStringFromBase64DataURI = function getByteStringFromBase64DataURI(\n    dataURI\n  ) {\n    return atob(getBase64DataFromBase64DataURI(dataURI));\n  };\n\n  var getBlobFromBase64DataURI = function getBlobFromBase64DataURI(dataURI) {\n    var mimeType = getMimeTypeFromBase64DataURI(dataURI);\n    var byteString = getByteStringFromBase64DataURI(dataURI);\n\n    return getBlobFromByteStringWithMimeType(byteString, mimeType);\n  };\n\n  var getFileFromBase64DataURI = function getFileFromBase64DataURI(\n    dataURI,\n    filename,\n    extension\n  ) {\n    return getFileFromBlob(\n      getBlobFromBase64DataURI(dataURI),\n      filename,\n      null,\n      extension\n    );\n  };\n\n  var getFileNameFromHeader = function getFileNameFromHeader(header) {\n    // test if is content disposition header, if not exit\n    if (!/^content-disposition:/i.test(header)) return null;\n\n    // get filename parts\n    var matches = header\n      .split(/filename=|filename\\*=.+''/)\n      .splice(1)\n      .map(function(name) {\n        return name.trim().replace(/^[\"']|[;\"']{0,2}$/g, '');\n      })\n      .filter(function(name) {\n        return name.length;\n      });\n\n    return matches.length ? decodeURI(matches[matches.length - 1]) : null;\n  };\n\n  var getFileSizeFromHeader = function getFileSizeFromHeader(header) {\n    if (/content-length:/i.test(header)) {\n      var size = header.match(/[0-9]+/)[0];\n      return size ? parseInt(size, 10) : null;\n    }\n    return null;\n  };\n\n  var getTranfserIdFromHeader = function getTranfserIdFromHeader(header) {\n    if (/x-content-transfer-id:/i.test(header)) {\n      var id = (header.split(':')[1] || '').trim();\n      return id || null;\n    }\n    return null;\n  };\n\n  var getFileInfoFromHeaders = function getFileInfoFromHeaders(headers) {\n    var info = {\n      source: null,\n      name: null,\n      size: null\n    };\n\n    var rows = headers.split('\\n');\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n    try {\n      for (\n        var _iterator = rows[Symbol.iterator](), _step;\n        !(_iteratorNormalCompletion = (_step = _iterator.next()).done);\n        _iteratorNormalCompletion = true\n      ) {\n        var header = _step.value;\n\n        var name = getFileNameFromHeader(header);\n        if (name) {\n          info.name = name;\n          continue;\n        }\n\n        var size = getFileSizeFromHeader(header);\n        if (size) {\n          info.size = size;\n          continue;\n        }\n\n        var source = getTranfserIdFromHeader(header);\n        if (source) {\n          info.source = source;\n          continue;\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator.return != null) {\n          _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n\n    return info;\n  };\n\n  var createFileLoader = function createFileLoader(fetchFn) {\n    var state = {\n      source: null,\n      complete: false,\n      progress: 0,\n      size: null,\n      timestamp: null,\n      duration: 0,\n      request: null\n    };\n\n    var getProgress = function getProgress() {\n      return state.progress;\n    };\n    var abort = function abort() {\n      if (state.request && state.request.abort) {\n        state.request.abort();\n      }\n    };\n\n    // load source\n    var load = function load() {\n      // get quick reference\n      var source = state.source;\n\n      api.fire('init', source);\n\n      // Load Files\n      if (source instanceof File) {\n        api.fire('load', source);\n      } else if (source instanceof Blob) {\n        // Load blobs, set default name to current date\n        api.fire('load', getFileFromBlob(source, source.name));\n      } else if (isBase64DataURI(source)) {\n        // Load base 64, set default name to current date\n        api.fire('load', getFileFromBase64DataURI(source));\n      } else {\n        // Deal as if is external URL, let's load it!\n        loadURL(source);\n      }\n    };\n\n    // loads a url\n    var loadURL = function loadURL(url) {\n      // is remote url and no fetch method supplied\n      if (!fetchFn) {\n        api.fire('error', {\n          type: 'error',\n          body: \"Can't load URL\",\n          code: 400\n        });\n\n        return;\n      }\n\n      // set request start\n      state.timestamp = Date.now();\n\n      // load file\n      state.request = fetchFn(\n        url,\n        function(response) {\n          // update duration\n          state.duration = Date.now() - state.timestamp;\n\n          // done!\n          state.complete = true;\n\n          // turn blob response into a file\n          if (response instanceof Blob) {\n            response = getFileFromBlob(\n              response,\n              response.name || getFilenameFromURL(url)\n            );\n          }\n\n          api.fire(\n            'load',\n            // if has received blob, we go with blob, if no response, we return null\n            response instanceof Blob\n              ? response\n              : response\n              ? response.body\n              : null\n          );\n        },\n        function(error) {\n          api.fire(\n            'error',\n            typeof error === 'string'\n              ? {\n                  type: 'error',\n                  code: 0,\n                  body: error\n                }\n              : error\n          );\n        },\n        function(computable, current, total) {\n          // collected some meta data already\n          if (total) {\n            state.size = total;\n          }\n\n          // update duration\n          state.duration = Date.now() - state.timestamp;\n\n          // if we can't compute progress, we're not going to fire progress events\n          if (!computable) {\n            state.progress = null;\n            return;\n          }\n\n          // update progress percentage\n          state.progress = current / total;\n\n          // expose\n          api.fire('progress', state.progress);\n        },\n        function() {\n          api.fire('abort');\n        },\n        function(response) {\n          var fileinfo = getFileInfoFromHeaders(\n            typeof response === 'string' ? response : response.headers\n          );\n          api.fire('meta', {\n            size: state.size || fileinfo.size,\n            filename: fileinfo.name,\n            source: fileinfo.source\n          });\n        }\n      );\n    };\n\n    var api = Object.assign({}, on(), {\n      setSource: function setSource(source) {\n        return (state.source = source);\n      },\n      getProgress: getProgress, // file load progress\n      abort: abort, // abort file load\n      load: load // start load\n    });\n\n    return api;\n  };\n\n  var isGet = function isGet(method) {\n    return /GET|HEAD/.test(method);\n  };\n\n  var sendRequest = function sendRequest(data, url, options) {\n    var api = {\n      onheaders: function onheaders() {},\n      onprogress: function onprogress() {},\n      onload: function onload() {},\n      ontimeout: function ontimeout() {},\n      onerror: function onerror() {},\n      onabort: function onabort() {},\n      abort: function abort() {\n        aborted = true;\n        xhr.abort();\n      }\n    };\n\n    // timeout identifier, only used when timeout is defined\n    var aborted = false;\n    var headersReceived = false;\n\n    // set default options\n    options = Object.assign(\n      {\n        method: 'POST',\n        headers: {},\n        withCredentials: false\n      },\n      options\n    );\n\n    // encode url\n    url = encodeURI(url);\n\n    // if method is GET, add any received data to url\n\n    if (isGet(options.method) && data) {\n      url =\n        '' +\n        url +\n        encodeURIComponent(\n          typeof data === 'string' ? data : JSON.stringify(data)\n        );\n    }\n\n    // create request\n    var xhr = new XMLHttpRequest();\n\n    // progress of load\n    var process = isGet(options.method) ? xhr : xhr.upload;\n    process.onprogress = function(e) {\n      // no progress event when aborted ( onprogress is called once after abort() )\n      if (aborted) {\n        return;\n      }\n\n      api.onprogress(e.lengthComputable, e.loaded, e.total);\n    };\n\n    // tries to get header info to the app as fast as possible\n    xhr.onreadystatechange = function() {\n      // not interesting in these states ('unsent' and 'openend' as they don't give us any additional info)\n      if (xhr.readyState < 2) {\n        return;\n      }\n\n      // no server response\n      if (xhr.readyState === 4 && xhr.status === 0) {\n        return;\n      }\n\n      if (headersReceived) {\n        return;\n      }\n\n      headersReceived = true;\n\n      // we've probably received some useful data in response headers\n      api.onheaders(xhr);\n    };\n\n    // load successful\n    xhr.onload = function() {\n      // is classified as valid response\n      if (xhr.status >= 200 && xhr.status < 300) {\n        api.onload(xhr);\n      } else {\n        api.onerror(xhr);\n      }\n    };\n\n    // error during load\n    xhr.onerror = function() {\n      return api.onerror(xhr);\n    };\n\n    // request aborted\n    xhr.onabort = function() {\n      aborted = true;\n      api.onabort();\n    };\n\n    // request timeout\n    xhr.ontimeout = function() {\n      return api.ontimeout(xhr);\n    };\n\n    // open up open up!\n    xhr.open(options.method, url, true);\n\n    // set timeout if defined (do it after open so IE11 plays ball)\n    if (isInt(options.timeout)) {\n      xhr.timeout = options.timeout;\n    }\n\n    // add headers\n    Object.keys(options.headers).forEach(function(key) {\n      var value = unescape(encodeURIComponent(options.headers[key]));\n      xhr.setRequestHeader(key, value);\n    });\n\n    // set type of response\n    if (options.responseType) {\n      xhr.responseType = options.responseType;\n    }\n\n    // set credentials\n    if (options.withCredentials) {\n      xhr.withCredentials = true;\n    }\n\n    // let's send our data\n    xhr.send(data);\n\n    return api;\n  };\n\n  var createResponse = function createResponse(type, code, body, headers) {\n    return {\n      type: type,\n      code: code,\n      body: body,\n      headers: headers\n    };\n  };\n\n  var createTimeoutResponse = function createTimeoutResponse(cb) {\n    return function(xhr) {\n      cb(createResponse('error', 0, 'Timeout', xhr.getAllResponseHeaders()));\n    };\n  };\n\n  var hasQS = function hasQS(str) {\n    return /\\?/.test(str);\n  };\n  var buildURL = function buildURL() {\n    var url = '';\n    for (\n      var _len = arguments.length, parts = new Array(_len), _key = 0;\n      _key < _len;\n      _key++\n    ) {\n      parts[_key] = arguments[_key];\n    }\n    parts.forEach(function(part) {\n      url += hasQS(url) && hasQS(part) ? part.replace(/\\?/, '&') : part;\n    });\n    return url;\n  };\n\n  var createFetchFunction = function createFetchFunction() {\n    var apiUrl =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n    // custom handler (should also handle file, load, error, progress and abort)\n    if (typeof action === 'function') {\n      return action;\n    }\n\n    // no action supplied\n    if (!action || !isString(action.url)) {\n      return null;\n    }\n\n    // set onload hanlder\n    var onload =\n      action.onload ||\n      function(res) {\n        return res;\n      };\n    var onerror =\n      action.onerror ||\n      function(res) {\n        return null;\n      };\n\n    // internal handler\n    return function(url, load, error, progress, abort, headers) {\n      // do local or remote request based on if the url is external\n      var request = sendRequest(\n        url,\n        buildURL(apiUrl, action.url),\n        Object.assign({}, action, {\n          responseType: 'blob'\n        })\n      );\n\n      request.onload = function(xhr) {\n        // get headers\n        var headers = xhr.getAllResponseHeaders();\n\n        // get filename\n        var filename =\n          getFileInfoFromHeaders(headers).name || getFilenameFromURL(url);\n\n        // create response\n        load(\n          createResponse(\n            'load',\n            xhr.status,\n            action.method === 'HEAD'\n              ? null\n              : getFileFromBlob(onload(xhr.response), filename),\n            headers\n          )\n        );\n      };\n\n      request.onerror = function(xhr) {\n        error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.onheaders = function(xhr) {\n        headers(\n          createResponse(\n            'headers',\n            xhr.status,\n            null,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      request.onprogress = progress;\n      request.onabort = abort;\n\n      // should return request\n      return request;\n    };\n  };\n\n  var ChunkStatus = {\n    QUEUED: 0,\n    COMPLETE: 1,\n    PROCESSING: 2,\n    ERROR: 3,\n    WAITING: 4\n  };\n\n  /*\n                                                       function signature:\n                                                         (file, metadata, load, error, progress, abort, transfer, options) => {\n                                                           return {\n                                                           abort:() => {}\n                                                         }\n                                                       }\n                                                       */\n\n  // apiUrl, action, name, file, metadata, load, error, progress, abort, transfer, options\n  var processFileChunked = function processFileChunked(\n    apiUrl,\n    action,\n    name,\n    file,\n    metadata,\n    load,\n    error,\n    progress,\n    abort,\n    transfer,\n    options\n  ) {\n    // all chunks\n    var chunks = [];\n    var chunkTransferId = options.chunkTransferId,\n      chunkServer = options.chunkServer,\n      chunkSize = options.chunkSize,\n      chunkRetryDelays = options.chunkRetryDelays;\n\n    // default state\n    var state = {\n      serverId: chunkTransferId,\n      aborted: false\n    };\n\n    // set onload handlers\n    var ondata =\n      action.ondata ||\n      function(fd) {\n        return fd;\n      };\n    var onload =\n      action.onload ||\n      function(xhr, method) {\n        return method === 'HEAD'\n          ? xhr.getResponseHeader('Upload-Offset')\n          : xhr.response;\n      };\n    var onerror =\n      action.onerror ||\n      function(res) {\n        return null;\n      };\n\n    // create server hook\n    var requestTransferId = function requestTransferId(cb) {\n      var formData = new FormData();\n\n      // add metadata under same name\n      if (isObject(metadata)) formData.append(name, JSON.stringify(metadata));\n\n      var headers =\n        typeof action.headers === 'function'\n          ? action.headers(file, metadata)\n          : Object.assign({}, action.headers, {\n              'Upload-Length': file.size\n            });\n\n      var requestParams = Object.assign({}, action, {\n        headers: headers\n      });\n\n      // send request object\n      var request = sendRequest(\n        ondata(formData),\n        buildURL(apiUrl, action.url),\n        requestParams\n      );\n\n      request.onload = function(xhr) {\n        return cb(onload(xhr, requestParams.method));\n      };\n\n      request.onerror = function(xhr) {\n        return error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n    };\n\n    var requestTransferOffset = function requestTransferOffset(cb) {\n      var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);\n\n      var headers =\n        typeof action.headers === 'function'\n          ? action.headers(state.serverId)\n          : Object.assign({}, action.headers);\n\n      var requestParams = {\n        headers: headers,\n        method: 'HEAD'\n      };\n\n      var request = sendRequest(null, requestUrl, requestParams);\n\n      request.onload = function(xhr) {\n        return cb(onload(xhr, requestParams.method));\n      };\n\n      request.onerror = function(xhr) {\n        return error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n    };\n\n    // create chunks\n    var lastChunkIndex = Math.floor(file.size / chunkSize);\n    for (var i = 0; i <= lastChunkIndex; i++) {\n      var offset = i * chunkSize;\n      var data = file.slice(\n        offset,\n        offset + chunkSize,\n        'application/offset+octet-stream'\n      );\n      chunks[i] = {\n        index: i,\n        size: data.size,\n        offset: offset,\n        data: data,\n        file: file,\n        progress: 0,\n        retries: _toConsumableArray(chunkRetryDelays),\n        status: ChunkStatus.QUEUED,\n        error: null,\n        request: null,\n        timeout: null\n      };\n    }\n\n    var completeProcessingChunks = function completeProcessingChunks() {\n      return load(state.serverId);\n    };\n\n    var canProcessChunk = function canProcessChunk(chunk) {\n      return (\n        chunk.status === ChunkStatus.QUEUED ||\n        chunk.status === ChunkStatus.ERROR\n      );\n    };\n\n    var processChunk = function processChunk(chunk) {\n      // processing is paused, wait here\n      if (state.aborted) return;\n\n      // get next chunk to process\n      chunk = chunk || chunks.find(canProcessChunk);\n\n      // no more chunks to process\n      if (!chunk) {\n        // all done?\n        if (\n          chunks.every(function(chunk) {\n            return chunk.status === ChunkStatus.COMPLETE;\n          })\n        ) {\n          completeProcessingChunks();\n        }\n\n        // no chunk to handle\n        return;\n      }\n\n      // now processing this chunk\n      chunk.status = ChunkStatus.PROCESSING;\n      chunk.progress = null;\n\n      // allow parsing of formdata\n      var ondata =\n        chunkServer.ondata ||\n        function(fd) {\n          return fd;\n        };\n      var onerror =\n        chunkServer.onerror ||\n        function(res) {\n          return null;\n        };\n\n      // send request object\n      var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);\n\n      var headers =\n        typeof chunkServer.headers === 'function'\n          ? chunkServer.headers(chunk)\n          : Object.assign({}, chunkServer.headers, {\n              'Content-Type': 'application/offset+octet-stream',\n              'Upload-Offset': chunk.offset,\n              'Upload-Length': file.size,\n              'Upload-Name': file.name\n            });\n\n      var request = (chunk.request = sendRequest(\n        ondata(chunk.data),\n        requestUrl,\n        Object.assign({}, chunkServer, {\n          headers: headers\n        })\n      ));\n\n      request.onload = function() {\n        // done!\n        chunk.status = ChunkStatus.COMPLETE;\n\n        // remove request reference\n        chunk.request = null;\n\n        // start processing more chunks\n        processChunks();\n      };\n\n      request.onprogress = function(lengthComputable, loaded, total) {\n        chunk.progress = lengthComputable ? loaded : null;\n        updateTotalProgress();\n      };\n\n      request.onerror = function(xhr) {\n        chunk.status = ChunkStatus.ERROR;\n        chunk.request = null;\n        chunk.error = onerror(xhr.response) || xhr.statusText;\n        if (!retryProcessChunk(chunk)) {\n          error(\n            createResponse(\n              'error',\n              xhr.status,\n              onerror(xhr.response) || xhr.statusText,\n              xhr.getAllResponseHeaders()\n            )\n          );\n        }\n      };\n\n      request.ontimeout = function(xhr) {\n        chunk.status = ChunkStatus.ERROR;\n        chunk.request = null;\n        if (!retryProcessChunk(chunk)) {\n          createTimeoutResponse(error)(xhr);\n        }\n      };\n\n      request.onabort = function() {\n        chunk.status = ChunkStatus.QUEUED;\n        chunk.request = null;\n        abort();\n      };\n    };\n\n    var retryProcessChunk = function retryProcessChunk(chunk) {\n      // no more retries left\n      if (chunk.retries.length === 0) return false;\n\n      // new retry\n      chunk.status = ChunkStatus.WAITING;\n      clearTimeout(chunk.timeout);\n      chunk.timeout = setTimeout(function() {\n        processChunk(chunk);\n      }, chunk.retries.shift());\n\n      // we're going to retry\n      return true;\n    };\n\n    var updateTotalProgress = function updateTotalProgress() {\n      // calculate total progress fraction\n      var totalBytesTransfered = chunks.reduce(function(p, chunk) {\n        if (p === null || chunk.progress === null) return null;\n        return p + chunk.progress;\n      }, 0);\n\n      // can't compute progress\n      if (totalBytesTransfered === null) return progress(false, 0, 0);\n\n      // calculate progress values\n      var totalSize = chunks.reduce(function(total, chunk) {\n        return total + chunk.size;\n      }, 0);\n\n      // can update progress indicator\n      progress(true, totalBytesTransfered, totalSize);\n    };\n\n    // process new chunks\n    var processChunks = function processChunks() {\n      var totalProcessing = chunks.filter(function(chunk) {\n        return chunk.status === ChunkStatus.PROCESSING;\n      }).length;\n      if (totalProcessing >= 1) return;\n      processChunk();\n    };\n\n    var abortChunks = function abortChunks() {\n      chunks.forEach(function(chunk) {\n        clearTimeout(chunk.timeout);\n        if (chunk.request) {\n          chunk.request.abort();\n        }\n      });\n    };\n\n    // let's go!\n    if (!state.serverId) {\n      requestTransferId(function(serverId) {\n        // stop here if aborted, might have happened in between request and callback\n        if (state.aborted) return;\n\n        // pass back to item so we can use it if something goes wrong\n        transfer(serverId);\n\n        // store internally\n        state.serverId = serverId;\n        processChunks();\n      });\n    } else {\n      requestTransferOffset(function(offset) {\n        // stop here if aborted, might have happened in between request and callback\n        if (state.aborted) return;\n\n        // mark chunks with lower offset as complete\n        chunks\n          .filter(function(chunk) {\n            return chunk.offset < offset;\n          })\n          .forEach(function(chunk) {\n            chunk.status = ChunkStatus.COMPLETE;\n            chunk.progress = chunk.size;\n          });\n\n        // continue processing\n        processChunks();\n      });\n    }\n\n    return {\n      abort: function abort() {\n        state.aborted = true;\n        abortChunks();\n      }\n    };\n  };\n\n  /*\n                                                               function signature:\n                                                                 (file, metadata, load, error, progress, abort) => {\n                                                                   return {\n                                                                   abort:() => {}\n                                                                 }\n                                                               }\n                                                               */\n  var createFileProcessorFunction = function createFileProcessorFunction(\n    apiUrl,\n    action,\n    name,\n    options\n  ) {\n    return function(file, metadata, load, error, progress, abort, transfer) {\n      // no file received\n      if (!file) return;\n\n      // if was passed a file, and we can chunk it, exit here\n      var canChunkUpload = options.chunkUploads;\n      var shouldChunkUpload = canChunkUpload && file.size > options.chunkSize;\n      var willChunkUpload =\n        canChunkUpload && (shouldChunkUpload || options.chunkForce);\n      if (file instanceof Blob && willChunkUpload)\n        return processFileChunked(\n          apiUrl,\n          action,\n          name,\n          file,\n          metadata,\n          load,\n          error,\n          progress,\n          abort,\n          transfer,\n          options\n        );\n\n      // set handlers\n      var ondata =\n        action.ondata ||\n        function(fd) {\n          return fd;\n        };\n      var onload =\n        action.onload ||\n        function(res) {\n          return res;\n        };\n      var onerror =\n        action.onerror ||\n        function(res) {\n          return null;\n        };\n\n      // create formdata object\n      var formData = new FormData();\n\n      // add metadata under same name\n      if (isObject(metadata)) {\n        formData.append(name, JSON.stringify(metadata));\n      }\n\n      // Turn into an array of objects so no matter what the input, we can handle it the same way\n      (file instanceof Blob ? [{ name: null, file: file }] : file).forEach(\n        function(item) {\n          formData.append(\n            name,\n            item.file,\n            item.name === null\n              ? item.file.name\n              : '' + item.name + item.file.name\n          );\n        }\n      );\n\n      // send request object\n      var request = sendRequest(\n        ondata(formData),\n        buildURL(apiUrl, action.url),\n        action\n      );\n      request.onload = function(xhr) {\n        load(\n          createResponse(\n            'load',\n            xhr.status,\n            onload(xhr.response),\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.onerror = function(xhr) {\n        error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n      request.onprogress = progress;\n      request.onabort = abort;\n\n      // should return request\n      return request;\n    };\n  };\n\n  var createProcessorFunction = function createProcessorFunction() {\n    var apiUrl =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n    var name = arguments.length > 2 ? arguments[2] : undefined;\n    var options = arguments.length > 3 ? arguments[3] : undefined;\n\n    // custom handler (should also handle file, load, error, progress and abort)\n    if (typeof action === 'function')\n      return function() {\n        for (\n          var _len = arguments.length, params = new Array(_len), _key = 0;\n          _key < _len;\n          _key++\n        ) {\n          params[_key] = arguments[_key];\n        }\n        return action.apply(void 0, [name].concat(params, [options]));\n      };\n\n    // no action supplied\n    if (!action || !isString(action.url)) return null;\n\n    // internal handler\n    return createFileProcessorFunction(apiUrl, action, name, options);\n  };\n\n  /*\n                                                      function signature:\n                                                      (uniqueFileId, load, error) => { }\n                                                      */\n  var createRevertFunction = function createRevertFunction() {\n    var apiUrl =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n    // is custom implementation\n    if (typeof action === 'function') {\n      return action;\n    }\n\n    // no action supplied, return stub function, interface will work, but file won't be removed\n    if (!action || !isString(action.url)) {\n      return function(uniqueFileId, load) {\n        return load();\n      };\n    }\n\n    // set onload hanlder\n    var onload =\n      action.onload ||\n      function(res) {\n        return res;\n      };\n    var onerror =\n      action.onerror ||\n      function(res) {\n        return null;\n      };\n\n    // internal implementation\n    return function(uniqueFileId, load, error) {\n      var request = sendRequest(\n        uniqueFileId,\n        apiUrl + action.url,\n        action // contains method, headers and withCredentials properties\n      );\n      request.onload = function(xhr) {\n        load(\n          createResponse(\n            'load',\n            xhr.status,\n            onload(xhr.response),\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.onerror = function(xhr) {\n        error(\n          createResponse(\n            'error',\n            xhr.status,\n            onerror(xhr.response) || xhr.statusText,\n            xhr.getAllResponseHeaders()\n          )\n        );\n      };\n\n      request.ontimeout = createTimeoutResponse(error);\n\n      return request;\n    };\n  };\n\n  var getRandomNumber = function getRandomNumber() {\n    var min =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var max =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return min + Math.random() * (max - min);\n  };\n\n  var createPerceivedPerformanceUpdater = function createPerceivedPerformanceUpdater(\n    cb\n  ) {\n    var duration =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1000;\n    var offset =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var tickMin =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 25;\n    var tickMax =\n      arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 250;\n    var timeout = null;\n    var start = Date.now();\n\n    var tick = function tick() {\n      var runtime = Date.now() - start;\n      var delay = getRandomNumber(tickMin, tickMax);\n\n      if (runtime + delay > duration) {\n        delay = runtime + delay - duration;\n      }\n\n      var progress = runtime / duration;\n      if (progress >= 1 || document.hidden) {\n        cb(1);\n        return;\n      }\n\n      cb(progress);\n\n      timeout = setTimeout(tick, delay);\n    };\n\n    tick();\n\n    return {\n      clear: function clear() {\n        clearTimeout(timeout);\n      }\n    };\n  };\n\n  var createFileProcessor = function createFileProcessor(processFn) {\n    var state = {\n      complete: false,\n      perceivedProgress: 0,\n      perceivedPerformanceUpdater: null,\n      progress: null,\n      timestamp: null,\n      perceivedDuration: 0,\n      duration: 0,\n      request: null,\n      response: null\n    };\n\n    var process = function process(file, metadata) {\n      var progressFn = function progressFn() {\n        // we've not yet started the real download, stop here\n        // the request might not go through, for instance, there might be some server trouble\n        // if state.progress is null, the server does not allow computing progress and we show the spinner instead\n        if (state.duration === 0 || state.progress === null) return;\n\n        // as we're now processing, fire the progress event\n        api.fire('progress', api.getProgress());\n      };\n\n      var completeFn = function completeFn() {\n        state.complete = true;\n        api.fire('load-perceived', state.response.body);\n      };\n\n      // let's start processing\n      api.fire('start');\n\n      // set request start\n      state.timestamp = Date.now();\n\n      // create perceived performance progress indicator\n      state.perceivedPerformanceUpdater = createPerceivedPerformanceUpdater(\n        function(progress) {\n          state.perceivedProgress = progress;\n          state.perceivedDuration = Date.now() - state.timestamp;\n\n          progressFn();\n\n          // if fake progress is done, and a response has been received,\n          // and we've not yet called the complete method\n          if (\n            state.response &&\n            state.perceivedProgress === 1 &&\n            !state.complete\n          ) {\n            // we done!\n            completeFn();\n          }\n        },\n        // random delay as in a list of files you start noticing\n        // files uploading at the exact same speed\n        getRandomNumber(750, 1500)\n      );\n\n      // remember request so we can abort it later\n      state.request = processFn(\n        // the file to process\n        file,\n\n        // the metadata to send along\n        metadata,\n\n        // callbacks (load, error, progress, abort, transfer)\n        // load expects the body to be a server id if\n        // you want to make use of revert\n        function(response) {\n          // we put the response in state so we can access\n          // it outside of this method\n          state.response = isObject(response)\n            ? response\n            : {\n                type: 'load',\n                code: 200,\n                body: '' + response,\n                headers: {}\n              };\n\n          // update duration\n          state.duration = Date.now() - state.timestamp;\n\n          // force progress to 1 as we're now done\n          state.progress = 1;\n\n          // actual load is done let's share results\n          api.fire('load', state.response.body);\n\n          // we are really done\n          // if perceived progress is 1 ( wait for perceived progress to complete )\n          // or if server does not support progress ( null )\n          if (state.perceivedProgress === 1) {\n            completeFn();\n          }\n        },\n\n        // error is expected to be an object with type, code, body\n        function(error) {\n          // cancel updater\n          state.perceivedPerformanceUpdater.clear();\n\n          // update others about this error\n          api.fire(\n            'error',\n            isObject(error)\n              ? error\n              : {\n                  type: 'error',\n                  code: 0,\n                  body: '' + error\n                }\n          );\n        },\n\n        // actual processing progress\n        function(computable, current, total) {\n          // update actual duration\n          state.duration = Date.now() - state.timestamp;\n\n          // update actual progress\n          state.progress = computable ? current / total : null;\n\n          progressFn();\n        },\n\n        // abort does not expect a value\n        function() {\n          // stop updater\n          state.perceivedPerformanceUpdater.clear();\n\n          // fire the abort event so we can switch visuals\n          api.fire('abort', state.response ? state.response.body : null);\n        },\n\n        // register the id for this transfer\n        function(transferId) {\n          api.fire('transfer', transferId);\n        }\n      );\n    };\n\n    var abort = function abort() {\n      // no request running, can't abort\n      if (!state.request) return;\n\n      // stop updater\n      state.perceivedPerformanceUpdater.clear();\n\n      // abort actual request\n      if (state.request.abort) state.request.abort();\n\n      // if has response object, we've completed the request\n      state.complete = true;\n    };\n\n    var reset = function reset() {\n      abort();\n      state.complete = false;\n      state.perceivedProgress = 0;\n      state.progress = 0;\n      state.timestamp = null;\n      state.perceivedDuration = 0;\n      state.duration = 0;\n      state.request = null;\n      state.response = null;\n    };\n\n    var getProgress = function getProgress() {\n      return state.progress\n        ? Math.min(state.progress, state.perceivedProgress)\n        : null;\n    };\n    var getDuration = function getDuration() {\n      return Math.min(state.duration, state.perceivedDuration);\n    };\n\n    var api = Object.assign({}, on(), {\n      process: process, // start processing file\n      abort: abort, // abort active process request\n      getProgress: getProgress,\n      getDuration: getDuration,\n      reset: reset\n    });\n\n    return api;\n  };\n\n  var getFilenameWithoutExtension = function getFilenameWithoutExtension(name) {\n    return name.substr(0, name.lastIndexOf('.')) || name;\n  };\n\n  var createFileStub = function createFileStub(source) {\n    var data = [source.name, source.size, source.type];\n\n    // is blob or base64, then we need to set the name\n    if (source instanceof Blob || isBase64DataURI(source)) {\n      data[0] = source.name || getDateString();\n    } else if (isBase64DataURI(source)) {\n      // if is base64 data uri we need to determine the average size and type\n      data[1] = source.length;\n      data[2] = getMimeTypeFromBase64DataURI(source);\n    } else if (isString(source)) {\n      // url\n      data[0] = getFilenameFromURL(source);\n      data[1] = 0;\n      data[2] = 'application/octet-stream';\n    }\n\n    return {\n      name: data[0],\n      size: data[1],\n      type: data[2]\n    };\n  };\n\n  var isFile = function isFile(value) {\n    return !!(value instanceof File || (value instanceof Blob && value.name));\n  };\n\n  var deepCloneObject = function deepCloneObject(src) {\n    if (!isObject(src)) return src;\n    var target = isArray(src) ? [] : {};\n    for (var key in src) {\n      if (!src.hasOwnProperty(key)) continue;\n      var v = src[key];\n      target[key] = v && isObject(v) ? deepCloneObject(v) : v;\n    }\n    return target;\n  };\n\n  var createItem = function createItem() {\n    var origin =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    var serverFileReference =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    var file =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    // unique id for this item, is used to identify the item across views\n    var id = getUniqueId();\n\n    /**\n     * Internal item state\n     */\n    var state = {\n      // is archived\n      archived: false,\n\n      // if is frozen, no longer fires events\n      frozen: false,\n\n      // removed from view\n      released: false,\n\n      // original source\n      source: null,\n\n      // file model reference\n      file: file,\n\n      // id of file on server\n      serverFileReference: serverFileReference,\n\n      // id of file transfer on server\n      transferId: null,\n\n      // is aborted\n      processingAborted: false,\n\n      // current item status\n      status: serverFileReference\n        ? ItemStatus.PROCESSING_COMPLETE\n        : ItemStatus.INIT,\n\n      // active processes\n      activeLoader: null,\n      activeProcessor: null\n    };\n\n    // callback used when abort processing is called to link back to the resolve method\n    var abortProcessingRequestComplete = null;\n\n    /**\n     * Externally added item metadata\n     */\n    var metadata = {};\n\n    // item data\n    var setStatus = function setStatus(status) {\n      return (state.status = status);\n    };\n\n    // fire event unless the item has been archived\n    var fire = function fire(event) {\n      if (state.released || state.frozen) return;\n      for (\n        var _len = arguments.length,\n          params = new Array(_len > 1 ? _len - 1 : 0),\n          _key = 1;\n        _key < _len;\n        _key++\n      ) {\n        params[_key - 1] = arguments[_key];\n      }\n      api.fire.apply(api, [event].concat(params));\n    };\n\n    // file data\n    var getFileExtension = function getFileExtension() {\n      return getExtensionFromFilename(state.file.name);\n    };\n    var getFileType = function getFileType() {\n      return state.file.type;\n    };\n    var getFileSize = function getFileSize() {\n      return state.file.size;\n    };\n    var getFile = function getFile() {\n      return state.file;\n    };\n\n    //\n    // logic to load a file\n    //\n    var load = function load(source, loader, onload) {\n      // remember the original item source\n      state.source = source;\n\n      // source is known\n      api.fireSync('init');\n\n      // file stub is already there\n      if (state.file) {\n        api.fireSync('load-skip');\n        return;\n      }\n\n      // set a stub file object while loading the actual data\n      state.file = createFileStub(source);\n\n      // starts loading\n      loader.on('init', function() {\n        fire('load-init');\n      });\n\n      // we'eve received a size indication, let's update the stub\n      loader.on('meta', function(meta) {\n        // set size of file stub\n        state.file.size = meta.size;\n\n        // set name of file stub\n        state.file.filename = meta.filename;\n\n        // if has received source, we done\n        if (meta.source) {\n          origin = FileOrigin.LIMBO;\n          state.serverFileReference = meta.source;\n          state.status = ItemStatus.PROCESSING_COMPLETE;\n        }\n\n        // size has been updated\n        fire('load-meta');\n      });\n\n      // the file is now loading we need to update the progress indicators\n      loader.on('progress', function(progress) {\n        setStatus(ItemStatus.LOADING);\n\n        fire('load-progress', progress);\n      });\n\n      // an error was thrown while loading the file, we need to switch to error state\n      loader.on('error', function(error) {\n        setStatus(ItemStatus.LOAD_ERROR);\n\n        fire('load-request-error', error);\n      });\n\n      // user or another process aborted the file load (cannot retry)\n      loader.on('abort', function() {\n        setStatus(ItemStatus.INIT);\n        fire('load-abort');\n      });\n\n      // done loading\n      loader.on('load', function(file) {\n        // as we've now loaded the file the loader is no longer required\n        state.activeLoader = null;\n\n        // called when file has loaded succesfully\n        var success = function success(result) {\n          // set (possibly) transformed file\n          state.file = isFile(result) ? result : state.file;\n\n          // file received\n          if (origin === FileOrigin.LIMBO && state.serverFileReference) {\n            setStatus(ItemStatus.PROCESSING_COMPLETE);\n          } else {\n            setStatus(ItemStatus.IDLE);\n          }\n\n          fire('load');\n        };\n\n        var error = function error(result) {\n          // set original file\n          state.file = file;\n          fire('load-meta');\n\n          setStatus(ItemStatus.LOAD_ERROR);\n          fire('load-file-error', result);\n        };\n\n        // if we already have a server file reference, we don't need to call the onload method\n        if (state.serverFileReference) {\n          success(file);\n          return;\n        }\n\n        // no server id, let's give this file the full treatment\n        onload(file, success, error);\n      });\n\n      // set loader source data\n      loader.setSource(source);\n\n      // set as active loader\n      state.activeLoader = loader;\n\n      // load the source data\n      loader.load();\n    };\n\n    var retryLoad = function retryLoad() {\n      if (!state.activeLoader) {\n        return;\n      }\n      state.activeLoader.load();\n    };\n\n    var abortLoad = function abortLoad() {\n      if (state.activeLoader) {\n        state.activeLoader.abort();\n        return;\n      }\n      setStatus(ItemStatus.INIT);\n      fire('load-abort');\n    };\n\n    //\n    // logic to process a file\n    //\n    var process = function process(processor, onprocess) {\n      // processing was aborted\n      if (state.processingAborted) {\n        state.processingAborted = false;\n        return;\n      }\n\n      // now processing\n      setStatus(ItemStatus.PROCESSING);\n\n      // reset abort callback\n      abortProcessingRequestComplete = null;\n\n      // if no file loaded we'll wait for the load event\n      if (!(state.file instanceof Blob)) {\n        api.on('load', function() {\n          process(processor, onprocess);\n        });\n        return;\n      }\n\n      // setup processor\n      processor.on('load', function(serverFileReference) {\n        // need this id to be able to revert the upload\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n      });\n\n      // register transfer id\n      processor.on('transfer', function(transferId) {\n        // need this id to be able to revert the upload\n        state.transferId = transferId;\n      });\n\n      processor.on('load-perceived', function(serverFileReference) {\n        // no longer required\n        state.activeProcessor = null;\n\n        // need this id to be able to rever the upload\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n\n        setStatus(ItemStatus.PROCESSING_COMPLETE);\n        fire('process-complete', serverFileReference);\n      });\n\n      processor.on('start', function() {\n        fire('process-start');\n      });\n\n      processor.on('error', function(error) {\n        state.activeProcessor = null;\n        setStatus(ItemStatus.PROCESSING_ERROR);\n        fire('process-error', error);\n      });\n\n      processor.on('abort', function(serverFileReference) {\n        state.activeProcessor = null;\n\n        // if file was uploaded but processing was cancelled during perceived processor time store file reference\n        state.transferId = null;\n        state.serverFileReference = serverFileReference;\n\n        setStatus(ItemStatus.IDLE);\n        fire('process-abort');\n\n        // has timeout so doesn't interfere with remove action\n        if (abortProcessingRequestComplete) {\n          abortProcessingRequestComplete();\n        }\n      });\n\n      processor.on('progress', function(progress) {\n        fire('process-progress', progress);\n      });\n\n      // when successfully transformed\n      var success = function success(file) {\n        // if was archived in the mean time, don't process\n        if (state.archived) return;\n\n        // process file!\n        processor.process(file, Object.assign({}, metadata));\n      };\n\n      // something went wrong during transform phase\n      var error = console.error;\n\n      // start processing the file\n      onprocess(state.file, success, error);\n\n      // set as active processor\n      state.activeProcessor = processor;\n    };\n\n    var requestProcessing = function requestProcessing() {\n      state.processingAborted = false;\n      setStatus(ItemStatus.PROCESSING_QUEUED);\n    };\n\n    var abortProcessing = function abortProcessing() {\n      return new Promise(function(resolve) {\n        if (!state.activeProcessor) {\n          state.processingAborted = true;\n\n          setStatus(ItemStatus.IDLE);\n          fire('process-abort');\n\n          resolve();\n          return;\n        }\n\n        abortProcessingRequestComplete = function abortProcessingRequestComplete() {\n          resolve();\n        };\n\n        state.activeProcessor.abort();\n      });\n    };\n\n    //\n    // logic to revert a processed file\n    //\n    var revert = function revert(revertFileUpload, forceRevert) {\n      return new Promise(function(resolve, reject) {\n        // cannot revert without a server id for this process\n        if (state.serverFileReference === null) {\n          resolve();\n          return;\n        }\n\n        // revert the upload (fire and forget)\n        revertFileUpload(\n          state.serverFileReference,\n          function() {\n            // reset file server id as now it's no available on the server\n            state.serverFileReference = null;\n            resolve();\n          },\n          function(error) {\n            // don't set error state when reverting is optional, it will always resolve\n            if (!forceRevert) {\n              resolve();\n              return;\n            }\n\n            // oh no errors\n            setStatus(ItemStatus.PROCESSING_REVERT_ERROR);\n            fire('process-revert-error');\n            reject(error);\n          }\n        );\n\n        // fire event\n        setStatus(ItemStatus.IDLE);\n        fire('process-revert');\n      });\n    };\n\n    // exposed methods\n    var _setMetadata = function setMetadata(key, value, silent) {\n      var keys = key.split('.');\n      var root = keys[0];\n      var last = keys.pop();\n      var data = metadata;\n      keys.forEach(function(key) {\n        return (data = data[key]);\n      });\n\n      // compare old value against new value, if they're the same, we're not updating\n      if (JSON.stringify(data[last]) === JSON.stringify(value)) return;\n\n      // update value\n      data[last] = value;\n\n      // don't fire update\n      if (silent) return;\n\n      // fire update\n      fire('metadata-update', {\n        key: root,\n        value: metadata[root]\n      });\n    };\n\n    var getMetadata = function getMetadata(key) {\n      return deepCloneObject(key ? metadata[key] : metadata);\n    };\n\n    var api = Object.assign(\n      {\n        id: {\n          get: function get() {\n            return id;\n          }\n        },\n        origin: {\n          get: function get() {\n            return origin;\n          }\n        },\n        serverId: {\n          get: function get() {\n            return state.serverFileReference;\n          }\n        },\n        transferId: {\n          get: function get() {\n            return state.transferId;\n          }\n        },\n        status: {\n          get: function get() {\n            return state.status;\n          }\n        },\n        filename: {\n          get: function get() {\n            return state.file.name;\n          }\n        },\n        filenameWithoutExtension: {\n          get: function get() {\n            return getFilenameWithoutExtension(state.file.name);\n          }\n        },\n        fileExtension: { get: getFileExtension },\n        fileType: { get: getFileType },\n        fileSize: { get: getFileSize },\n        file: { get: getFile },\n        relativePath: {\n          get: function get() {\n            return state.file._relativePath;\n          }\n        },\n\n        source: {\n          get: function get() {\n            return state.source;\n          }\n        },\n\n        getMetadata: getMetadata,\n        setMetadata: function setMetadata(key, value, silent) {\n          if (isObject(key)) {\n            var data = key;\n            Object.keys(data).forEach(function(key) {\n              _setMetadata(key, data[key], value);\n            });\n            return key;\n          }\n          _setMetadata(key, value, silent);\n          return value;\n        },\n\n        extend: function extend(name, handler) {\n          return (itemAPI[name] = handler);\n        },\n\n        abortLoad: abortLoad,\n        retryLoad: retryLoad,\n        requestProcessing: requestProcessing,\n        abortProcessing: abortProcessing,\n\n        load: load,\n        process: process,\n        revert: revert\n      },\n\n      on(),\n      {\n        freeze: function freeze() {\n          return (state.frozen = true);\n        },\n\n        release: function release() {\n          return (state.released = true);\n        },\n        released: {\n          get: function get() {\n            return state.released;\n          }\n        },\n\n        archive: function archive() {\n          return (state.archived = true);\n        },\n        archived: {\n          get: function get() {\n            return state.archived;\n          }\n        }\n      }\n    );\n\n    // create it here instead of returning it instantly so we can extend it later\n    var itemAPI = createObject(api);\n\n    return itemAPI;\n  };\n\n  var getItemIndexByQuery = function getItemIndexByQuery(items, query) {\n    // just return first index\n    if (isEmpty(query)) {\n      return 0;\n    }\n\n    // invalid queries\n    if (!isString(query)) {\n      return -1;\n    }\n\n    // return item by id (or -1 if not found)\n    return items.findIndex(function(item) {\n      return item.id === query;\n    });\n  };\n\n  var getItemById = function getItemById(items, itemId) {\n    var index = getItemIndexByQuery(items, itemId);\n    if (index < 0) {\n      return;\n    }\n    return items[index] || null;\n  };\n\n  var fetchBlob = function fetchBlob(\n    url,\n    load,\n    error,\n    progress,\n    abort,\n    headers\n  ) {\n    var request = sendRequest(null, url, {\n      method: 'GET',\n      responseType: 'blob'\n    });\n\n    request.onload = function(xhr) {\n      // get headers\n      var headers = xhr.getAllResponseHeaders();\n\n      // get filename\n      var filename =\n        getFileInfoFromHeaders(headers).name || getFilenameFromURL(url);\n\n      // create response\n      load(\n        createResponse(\n          'load',\n          xhr.status,\n          getFileFromBlob(xhr.response, filename),\n          headers\n        )\n      );\n    };\n\n    request.onerror = function(xhr) {\n      error(\n        createResponse(\n          'error',\n          xhr.status,\n          xhr.statusText,\n          xhr.getAllResponseHeaders()\n        )\n      );\n    };\n\n    request.onheaders = function(xhr) {\n      headers(\n        createResponse('headers', xhr.status, null, xhr.getAllResponseHeaders())\n      );\n    };\n\n    request.ontimeout = createTimeoutResponse(error);\n    request.onprogress = progress;\n    request.onabort = abort;\n\n    // should return request\n    return request;\n  };\n\n  var getDomainFromURL = function getDomainFromURL(url) {\n    if (url.indexOf('//') === 0) {\n      url = location.protocol + url;\n    }\n    return url\n      .toLowerCase()\n      .replace('blob:', '')\n      .replace(/([a-z])?:\\/\\//, '$1')\n      .split('/')[0];\n  };\n\n  var isExternalURL = function isExternalURL(url) {\n    return (\n      (url.indexOf(':') > -1 || url.indexOf('//') > -1) &&\n      getDomainFromURL(location.href) !== getDomainFromURL(url)\n    );\n  };\n\n  var dynamicLabel = function dynamicLabel(label) {\n    return function() {\n      return isFunction(label) ? label.apply(void 0, arguments) : label;\n    };\n  };\n\n  var isMockItem = function isMockItem(item) {\n    return !isFile(item.file);\n  };\n\n  var listUpdated = function listUpdated(dispatch, state) {\n    clearTimeout(state.listUpdateTimeout);\n    state.listUpdateTimeout = setTimeout(function() {\n      dispatch('DID_UPDATE_ITEMS', { items: getActiveItems(state.items) });\n    }, 0);\n  };\n\n  var optionalPromise = function optionalPromise(fn) {\n    for (\n      var _len = arguments.length,\n        params = new Array(_len > 1 ? _len - 1 : 0),\n        _key = 1;\n      _key < _len;\n      _key++\n    ) {\n      params[_key - 1] = arguments[_key];\n    }\n    return new Promise(function(resolve) {\n      if (!fn) {\n        return resolve(true);\n      }\n\n      var result = fn.apply(void 0, params);\n\n      if (result == null) {\n        return resolve(true);\n      }\n\n      if (typeof result === 'boolean') {\n        return resolve(result);\n      }\n\n      if (typeof result.then === 'function') {\n        result.then(resolve);\n      }\n    });\n  };\n\n  var sortItems = function sortItems(state, compare) {\n    state.items.sort(function(a, b) {\n      return compare(createItemAPI(a), createItemAPI(b));\n    });\n  };\n\n  // returns item based on state\n  var getItemByQueryFromState = function getItemByQueryFromState(\n    state,\n    itemHandler\n  ) {\n    return function() {\n      var _ref =\n        arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var query = _ref.query,\n        _ref$success = _ref.success,\n        success = _ref$success === void 0 ? function() {} : _ref$success,\n        _ref$failure = _ref.failure,\n        failure = _ref$failure === void 0 ? function() {} : _ref$failure,\n        options = _objectWithoutProperties(_ref, [\n          'query',\n          'success',\n          'failure'\n        ]);\n      var item = getItemByQuery(state.items, query);\n      if (!item) {\n        failure({\n          error: createResponse('error', 0, 'Item not found'),\n\n          file: null\n        });\n\n        return;\n      }\n      itemHandler(item, success, failure, options || {});\n    };\n  };\n\n  var actions = function actions(dispatch, query, state) {\n    return {\n      /**\n       * Aborts all ongoing processes\n       */\n      ABORT_ALL: function ABORT_ALL() {\n        getActiveItems(state.items).forEach(function(item) {\n          item.freeze();\n          item.abortLoad();\n          item.abortProcessing();\n        });\n      },\n\n      /**\n       * Sets initial files\n       */\n      DID_SET_FILES: function DID_SET_FILES(_ref2) {\n        var _ref2$value = _ref2.value,\n          value = _ref2$value === void 0 ? [] : _ref2$value;\n\n        // map values to file objects\n        var files = value.map(function(file) {\n          return {\n            source: file.source ? file.source : file,\n            options: file.options\n          };\n        });\n\n        // loop over files, if file is in list, leave it be, if not, remove\n        // test if items should be moved\n        var activeItems = getActiveItems(state.items);\n\n        activeItems.forEach(function(item) {\n          // if item not is in new value, remove\n          if (\n            !files.find(function(file) {\n              return file.source === item.source || file.source === item.file;\n            })\n          ) {\n            dispatch('REMOVE_ITEM', { query: item, remove: false });\n          }\n        });\n\n        // add new files\n        activeItems = getActiveItems(state.items);\n        files.forEach(function(file, index) {\n          // if file is already in list\n          if (\n            activeItems.find(function(item) {\n              return item.source === file.source || item.file === file.source;\n            })\n          )\n            return;\n\n          // not in list, add\n          dispatch(\n            'ADD_ITEM',\n            Object.assign({}, file, {\n              interactionMethod: InteractionMethod.NONE,\n              index: index\n            })\n          );\n        });\n      },\n\n      DID_UPDATE_ITEM_METADATA: function DID_UPDATE_ITEM_METADATA(_ref3) {\n        var id = _ref3.id;\n\n        // if is called multiple times in close succession we combined all calls together to save resources\n        clearTimeout(state.itemUpdateTimeout);\n        state.itemUpdateTimeout = setTimeout(function() {\n          var item = getItemById(state.items, id);\n\n          // only revert and attempt to upload when we're uploading to a server\n          if (!query('IS_ASYNC')) {\n            // should we update the output data\n            applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {\n              item: item,\n              query: query\n            }).then(function(shouldPrepareOutput) {\n              if (!shouldPrepareOutput) {\n                return;\n              }\n              dispatch(\n                'REQUEST_PREPARE_OUTPUT',\n                {\n                  query: id,\n                  item: item,\n                  success: function success(file) {\n                    dispatch('DID_PREPARE_OUTPUT', { id: id, file: file });\n                  }\n                },\n                true\n              );\n            });\n\n            return;\n          }\n\n          // for async scenarios\n          var upload = function upload() {\n            // we push this forward a bit so the interface is updated correctly\n            setTimeout(function() {\n              dispatch('REQUEST_ITEM_PROCESSING', { query: id });\n            }, 32);\n          };\n\n          var revert = function revert(doUpload) {\n            item\n              .revert(\n                createRevertFunction(\n                  state.options.server.url,\n                  state.options.server.revert\n                ),\n                query('GET_FORCE_REVERT')\n              )\n              .then(doUpload ? upload : function() {})\n              .catch(function() {});\n          };\n\n          var abort = function abort(doUpload) {\n            item.abortProcessing().then(doUpload ? upload : function() {});\n          };\n\n          // if we should re-upload the file immidiately\n          if (item.status === ItemStatus.PROCESSING_COMPLETE) {\n            return revert(state.options.instantUpload);\n          }\n\n          // if currently uploading, cancel upload\n          if (item.status === ItemStatus.PROCESSING) {\n            return abort(state.options.instantUpload);\n          }\n\n          if (state.options.instantUpload) {\n            upload();\n          }\n        }, 0);\n      },\n\n      MOVE_ITEM: function MOVE_ITEM(_ref4) {\n        var query = _ref4.query,\n          index = _ref4.index;\n        var item = getItemByQuery(state.items, query);\n        if (!item) return;\n        var currentIndex = state.items.indexOf(item);\n        index = limit(index, 0, state.items.length - 1);\n        if (currentIndex === index) return;\n        state.items.splice(index, 0, state.items.splice(currentIndex, 1)[0]);\n      },\n\n      SORT: function SORT(_ref5) {\n        var compare = _ref5.compare;\n        sortItems(state, compare);\n        dispatch('DID_SORT_ITEMS', {\n          items: query('GET_ACTIVE_ITEMS')\n        });\n      },\n\n      ADD_ITEMS: function ADD_ITEMS(_ref6) {\n        var items = _ref6.items,\n          index = _ref6.index,\n          interactionMethod = _ref6.interactionMethod,\n          _ref6$success = _ref6.success,\n          success = _ref6$success === void 0 ? function() {} : _ref6$success,\n          _ref6$failure = _ref6.failure,\n          failure = _ref6$failure === void 0 ? function() {} : _ref6$failure;\n\n        var currentIndex = index;\n\n        if (index === -1 || typeof index === 'undefined') {\n          var insertLocation = query('GET_ITEM_INSERT_LOCATION');\n          var totalItems = query('GET_TOTAL_ITEMS');\n          currentIndex = insertLocation === 'before' ? 0 : totalItems;\n        }\n\n        var ignoredFiles = query('GET_IGNORED_FILES');\n        var isValidFile = function isValidFile(source) {\n          return isFile(source)\n            ? !ignoredFiles.includes(source.name.toLowerCase())\n            : !isEmpty(source);\n        };\n        var validItems = items.filter(isValidFile);\n\n        var promises = validItems.map(function(source) {\n          return new Promise(function(resolve, reject) {\n            dispatch('ADD_ITEM', {\n              interactionMethod: interactionMethod,\n              source: source.source || source,\n              success: resolve,\n              failure: reject,\n              index: currentIndex++,\n              options: source.options || {}\n            });\n          });\n        });\n\n        Promise.all(promises)\n          .then(success)\n          .catch(failure);\n      },\n\n      /**\n       * @param source\n       * @param index\n       * @param interactionMethod\n       */\n      ADD_ITEM: function ADD_ITEM(_ref7) {\n        var source = _ref7.source,\n          _ref7$index = _ref7.index,\n          index = _ref7$index === void 0 ? -1 : _ref7$index,\n          interactionMethod = _ref7.interactionMethod,\n          _ref7$success = _ref7.success,\n          success = _ref7$success === void 0 ? function() {} : _ref7$success,\n          _ref7$failure = _ref7.failure,\n          failure = _ref7$failure === void 0 ? function() {} : _ref7$failure,\n          _ref7$options = _ref7.options,\n          options = _ref7$options === void 0 ? {} : _ref7$options;\n\n        // if no source supplied\n        if (isEmpty(source)) {\n          failure({\n            error: createResponse('error', 0, 'No source'),\n\n            file: null\n          });\n\n          return;\n        }\n\n        // filter out invalid file items, used to filter dropped directory contents\n        if (\n          isFile(source) &&\n          state.options.ignoredFiles.includes(source.name.toLowerCase())\n        ) {\n          // fail silently\n          return;\n        }\n\n        // test if there's still room in the list of files\n        if (!hasRoomForItem(state)) {\n          // if multiple allowed, we can't replace\n          // or if only a single item is allowed but we're not allowed to replace it we exit\n          if (\n            state.options.allowMultiple ||\n            (!state.options.allowMultiple && !state.options.allowReplace)\n          ) {\n            var error = createResponse('warning', 0, 'Max files');\n\n            dispatch('DID_THROW_MAX_FILES', {\n              source: source,\n              error: error\n            });\n\n            failure({ error: error, file: null });\n\n            return;\n          }\n\n          // let's replace the item\n          // id of first item we're about to remove\n          var _item = getActiveItems(state.items)[0];\n\n          // if has been processed remove it from the server as well\n          if (\n            _item.status === ItemStatus.PROCESSING_COMPLETE ||\n            _item.status === ItemStatus.PROCESSING_REVERT_ERROR\n          ) {\n            var forceRevert = query('GET_FORCE_REVERT');\n            _item\n              .revert(\n                createRevertFunction(\n                  state.options.server.url,\n                  state.options.server.revert\n                ),\n                forceRevert\n              )\n              .then(function() {\n                if (!forceRevert) return;\n\n                // try to add now\n                dispatch('ADD_ITEM', {\n                  source: source,\n                  index: index,\n                  interactionMethod: interactionMethod,\n                  success: success,\n                  failure: failure,\n                  options: options\n                });\n              })\n              .catch(function() {}); // no need to handle this catch state for now\n\n            if (forceRevert) return;\n          }\n\n          // remove first item as it will be replaced by this item\n          dispatch('REMOVE_ITEM', { query: _item.id });\n        }\n\n        // where did the file originate\n        var origin =\n          options.type === 'local'\n            ? FileOrigin.LOCAL\n            : options.type === 'limbo'\n            ? FileOrigin.LIMBO\n            : FileOrigin.INPUT;\n\n        // create a new blank item\n        var item = createItem(\n          // where did this file come from\n          origin,\n\n          // an input file never has a server file reference\n          origin === FileOrigin.INPUT ? null : source,\n\n          // file mock data, if defined\n          options.file\n        );\n\n        // set initial meta data\n        Object.keys(options.metadata || {}).forEach(function(key) {\n          item.setMetadata(key, options.metadata[key]);\n        });\n\n        // created the item, let plugins add methods\n        applyFilters('DID_CREATE_ITEM', item, {\n          query: query,\n          dispatch: dispatch\n        });\n\n        // where to insert new items\n        var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION');\n\n        // adjust index if is not allowed to pick location\n        if (!state.options.itemInsertLocationFreedom) {\n          index = itemInsertLocation === 'before' ? -1 : state.items.length;\n        }\n\n        // add item to list\n        insertItem(state.items, item, index);\n\n        // sort items in list\n        if (isFunction(itemInsertLocation) && source) {\n          sortItems(state, itemInsertLocation);\n        }\n\n        // get a quick reference to the item id\n        var id = item.id;\n\n        // observe item events\n        item.on('init', function() {\n          dispatch('DID_INIT_ITEM', { id: id });\n        });\n\n        item.on('load-init', function() {\n          dispatch('DID_START_ITEM_LOAD', { id: id });\n        });\n\n        item.on('load-meta', function() {\n          dispatch('DID_UPDATE_ITEM_META', { id: id });\n        });\n\n        item.on('load-progress', function(progress) {\n          dispatch('DID_UPDATE_ITEM_LOAD_PROGRESS', {\n            id: id,\n            progress: progress\n          });\n        });\n\n        item.on('load-request-error', function(error) {\n          var mainStatus = dynamicLabel(state.options.labelFileLoadError)(\n            error\n          );\n\n          // is client error, no way to recover\n          if (error.code >= 400 && error.code < 500) {\n            dispatch('DID_THROW_ITEM_INVALID', {\n              id: id,\n              error: error,\n              status: {\n                main: mainStatus,\n                sub: error.code + ' (' + error.body + ')'\n              }\n            });\n\n            // reject the file so can be dealt with through API\n            failure({ error: error, file: createItemAPI(item) });\n            return;\n          }\n\n          // is possible server error, so might be possible to retry\n          dispatch('DID_THROW_ITEM_LOAD_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: mainStatus,\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n\n        item.on('load-file-error', function(error) {\n          dispatch('DID_THROW_ITEM_INVALID', {\n            id: id,\n            error: error.status,\n            status: error.status\n          });\n\n          failure({ error: error.status, file: createItemAPI(item) });\n        });\n\n        item.on('load-abort', function() {\n          dispatch('REMOVE_ITEM', { query: id });\n        });\n\n        item.on('load-skip', function() {\n          dispatch('COMPLETE_LOAD_ITEM', {\n            query: id,\n            item: item,\n            data: {\n              source: source,\n              success: success\n            }\n          });\n        });\n\n        item.on('load', function() {\n          var handleAdd = function handleAdd(shouldAdd) {\n            // no should not add this file\n            if (!shouldAdd) {\n              dispatch('REMOVE_ITEM', {\n                query: id\n              });\n\n              return;\n            }\n\n            // now interested in metadata updates\n            item.on('metadata-update', function(change) {\n              dispatch('DID_UPDATE_ITEM_METADATA', { id: id, change: change });\n            });\n\n            // let plugins decide if the output data should be prepared at this point\n            // means we'll do this and wait for idle state\n            applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {\n              item: item,\n              query: query\n            }).then(function(shouldPrepareOutput) {\n              var loadComplete = function loadComplete() {\n                dispatch('COMPLETE_LOAD_ITEM', {\n                  query: id,\n                  item: item,\n                  data: {\n                    source: source,\n                    success: success\n                  }\n                });\n\n                listUpdated(dispatch, state);\n              };\n\n              // exit\n              if (shouldPrepareOutput) {\n                // wait for idle state and then run PREPARE_OUTPUT\n                dispatch(\n                  'REQUEST_PREPARE_OUTPUT',\n                  {\n                    query: id,\n                    item: item,\n                    success: function success(file) {\n                      dispatch('DID_PREPARE_OUTPUT', { id: id, file: file });\n                      loadComplete();\n                    }\n                  },\n                  true\n                );\n\n                return;\n              }\n\n              loadComplete();\n            });\n          };\n\n          // item loaded, allow plugins to\n          // - read data (quickly)\n          // - add metadata\n          applyFilterChain('DID_LOAD_ITEM', item, {\n            query: query,\n            dispatch: dispatch\n          })\n            .then(function() {\n              optionalPromise(\n                query('GET_BEFORE_ADD_FILE'),\n                createItemAPI(item)\n              ).then(handleAdd);\n            })\n            .catch(function() {\n              handleAdd(false);\n            });\n        });\n\n        item.on('process-start', function() {\n          dispatch('DID_START_ITEM_PROCESSING', { id: id });\n        });\n\n        item.on('process-progress', function(progress) {\n          dispatch('DID_UPDATE_ITEM_PROCESS_PROGRESS', {\n            id: id,\n            progress: progress\n          });\n        });\n\n        item.on('process-error', function(error) {\n          dispatch('DID_THROW_ITEM_PROCESSING_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: dynamicLabel(state.options.labelFileProcessingError)(error),\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n\n        item.on('process-revert-error', function(error) {\n          dispatch('DID_THROW_ITEM_PROCESSING_REVERT_ERROR', {\n            id: id,\n            error: error,\n            status: {\n              main: dynamicLabel(state.options.labelFileProcessingRevertError)(\n                error\n              ),\n              sub: state.options.labelTapToRetry\n            }\n          });\n        });\n\n        item.on('process-complete', function(serverFileReference) {\n          dispatch('DID_COMPLETE_ITEM_PROCESSING', {\n            id: id,\n            error: null,\n            serverFileReference: serverFileReference\n          });\n\n          dispatch('DID_DEFINE_VALUE', { id: id, value: serverFileReference });\n        });\n\n        item.on('process-abort', function() {\n          dispatch('DID_ABORT_ITEM_PROCESSING', { id: id });\n        });\n\n        item.on('process-revert', function() {\n          dispatch('DID_REVERT_ITEM_PROCESSING', { id: id });\n          dispatch('DID_DEFINE_VALUE', { id: id, value: null });\n        });\n\n        // let view know the item has been inserted\n        dispatch('DID_ADD_ITEM', {\n          id: id,\n          index: index,\n          interactionMethod: interactionMethod\n        });\n\n        listUpdated(dispatch, state);\n\n        // start loading the source\n        var _ref8 = state.options.server || {},\n          url = _ref8.url,\n          load = _ref8.load,\n          restore = _ref8.restore,\n          fetch = _ref8.fetch;\n\n        item.load(\n          source,\n\n          // this creates a function that loads the file based on the type of file (string, base64, blob, file) and location of file (local, remote, limbo)\n          createFileLoader(\n            origin === FileOrigin.INPUT\n              ? // input, if is remote, see if should use custom fetch, else use default fetchBlob\n                isString(source) && isExternalURL(source)\n                ? fetch\n                  ? createFetchFunction(url, fetch)\n                  : fetchBlob // remote url\n                : fetchBlob // try to fetch url\n              : // limbo or local\n              origin === FileOrigin.LIMBO\n              ? createFetchFunction(url, restore) // limbo\n              : createFetchFunction(url, load) // local\n          ),\n\n          // called when the file is loaded so it can be piped through the filters\n          function(file, success, error) {\n            // let's process the file\n            applyFilterChain('LOAD_FILE', file, { query: query })\n              .then(success)\n              .catch(error);\n          }\n        );\n      },\n\n      REQUEST_PREPARE_OUTPUT: function REQUEST_PREPARE_OUTPUT(_ref9) {\n        var item = _ref9.item,\n          success = _ref9.success,\n          _ref9$failure = _ref9.failure,\n          failure = _ref9$failure === void 0 ? function() {} : _ref9$failure;\n\n        // error response if item archived\n        var err = {\n          error: createResponse('error', 0, 'Item not found'),\n\n          file: null\n        };\n\n        // don't handle archived items, an item could have been archived (load aborted) while waiting to be prepared\n        if (item.archived) return failure(err);\n\n        // allow plugins to alter the file data\n        applyFilterChain('PREPARE_OUTPUT', item.file, {\n          query: query,\n          item: item\n        }).then(function(result) {\n          applyFilterChain('COMPLETE_PREPARE_OUTPUT', result, {\n            query: query,\n            item: item\n          }).then(function(result) {\n            // don't handle archived items, an item could have been archived (load aborted) while being prepared\n            if (item.archived) return failure(err);\n\n            // we done!\n            success(result);\n          });\n        });\n      },\n\n      COMPLETE_LOAD_ITEM: function COMPLETE_LOAD_ITEM(_ref10) {\n        var item = _ref10.item,\n          data = _ref10.data;\n        var success = data.success,\n          source = data.source;\n\n        // sort items in list\n        var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION');\n        if (isFunction(itemInsertLocation) && source) {\n          sortItems(state, itemInsertLocation);\n        }\n\n        // let interface know the item has loaded\n        dispatch('DID_LOAD_ITEM', {\n          id: item.id,\n          error: null,\n          serverFileReference: item.origin === FileOrigin.INPUT ? null : source\n        });\n\n        // item has been successfully loaded and added to the\n        // list of items so can now be safely returned for use\n        success(createItemAPI(item));\n\n        // if this is a local server file we need to show a different state\n        if (item.origin === FileOrigin.LOCAL) {\n          dispatch('DID_LOAD_LOCAL_ITEM', { id: item.id });\n          return;\n        }\n\n        // if is a temp server file we prevent async upload call here (as the file is already on the server)\n        if (item.origin === FileOrigin.LIMBO) {\n          dispatch('DID_COMPLETE_ITEM_PROCESSING', {\n            id: item.id,\n            error: null,\n            serverFileReference: source\n          });\n\n          dispatch('DID_DEFINE_VALUE', {\n            id: item.id,\n            value: source\n          });\n\n          return;\n        }\n\n        // id we are allowed to upload the file immidiately, lets do it\n        if (query('IS_ASYNC') && state.options.instantUpload) {\n          dispatch('REQUEST_ITEM_PROCESSING', { query: item.id });\n        }\n      },\n\n      RETRY_ITEM_LOAD: getItemByQueryFromState(state, function(item) {\n        // try loading the source one more time\n        item.retryLoad();\n      }),\n\n      REQUEST_ITEM_PREPARE: getItemByQueryFromState(state, function(\n        item,\n        _success,\n        failure\n      ) {\n        dispatch(\n          'REQUEST_PREPARE_OUTPUT',\n          {\n            query: item.id,\n            item: item,\n            success: function success(file) {\n              dispatch('DID_PREPARE_OUTPUT', { id: item.id, file: file });\n              _success({\n                file: item,\n                output: file\n              });\n            },\n            failure: failure\n          },\n          true\n        );\n      }),\n\n      REQUEST_ITEM_PROCESSING: getItemByQueryFromState(state, function(\n        item,\n        success,\n        failure\n      ) {\n        // cannot be queued (or is already queued)\n        var itemCanBeQueuedForProcessing =\n          // waiting for something\n          item.status === ItemStatus.IDLE ||\n          // processing went wrong earlier\n          item.status === ItemStatus.PROCESSING_ERROR;\n\n        // not ready to be processed\n        if (!itemCanBeQueuedForProcessing) {\n          var processNow = function processNow() {\n            return dispatch('REQUEST_ITEM_PROCESSING', {\n              query: item,\n              success: success,\n              failure: failure\n            });\n          };\n\n          var process = function process() {\n            return document.hidden ? processNow() : setTimeout(processNow, 32);\n          };\n\n          // if already done processing or tried to revert but didn't work, try again\n          if (\n            item.status === ItemStatus.PROCESSING_COMPLETE ||\n            item.status === ItemStatus.PROCESSING_REVERT_ERROR\n          ) {\n            item\n              .revert(\n                createRevertFunction(\n                  state.options.server.url,\n                  state.options.server.revert\n                ),\n                query('GET_FORCE_REVERT')\n              )\n              .then(process)\n              .catch(function() {}); // don't continue with processing if something went wrong\n          } else if (item.status === ItemStatus.PROCESSING) {\n            item.abortProcessing().then(process);\n          }\n\n          return;\n        }\n\n        // already queued for processing\n        if (item.status === ItemStatus.PROCESSING_QUEUED) return;\n\n        item.requestProcessing();\n\n        dispatch('DID_REQUEST_ITEM_PROCESSING', { id: item.id });\n\n        dispatch(\n          'PROCESS_ITEM',\n          { query: item, success: success, failure: failure },\n          true\n        );\n      }),\n\n      PROCESS_ITEM: getItemByQueryFromState(state, function(\n        item,\n        success,\n        failure\n      ) {\n        var maxParallelUploads = query('GET_MAX_PARALLEL_UPLOADS');\n        var totalCurrentUploads = query(\n          'GET_ITEMS_BY_STATUS',\n          ItemStatus.PROCESSING\n        ).length;\n\n        // queue and wait till queue is freed up\n        if (totalCurrentUploads === maxParallelUploads) {\n          // queue for later processing\n          state.processingQueue.push({\n            id: item.id,\n            success: success,\n            failure: failure\n          });\n\n          // stop it!\n          return;\n        }\n\n        // if was not queued or is already processing exit here\n        if (item.status === ItemStatus.PROCESSING) return;\n\n        var processNext = function processNext() {\n          // process queueud items\n          var queueEntry = state.processingQueue.shift();\n\n          // no items left\n          if (!queueEntry) return;\n\n          // get item reference\n          var id = queueEntry.id,\n            success = queueEntry.success,\n            failure = queueEntry.failure;\n          var itemReference = getItemByQuery(state.items, id);\n\n          // if item was archived while in queue, jump to next\n          if (!itemReference || itemReference.archived) {\n            processNext();\n            return;\n          }\n\n          // process queued item\n          dispatch(\n            'PROCESS_ITEM',\n            { query: id, success: success, failure: failure },\n            true\n          );\n        };\n\n        // we done function\n        item.onOnce('process-complete', function() {\n          success(createItemAPI(item));\n          processNext();\n\n          // All items processed? No errors?\n          var allItemsProcessed =\n            query('GET_ITEMS_BY_STATUS', ItemStatus.PROCESSING_COMPLETE)\n              .length === state.items.length;\n          if (allItemsProcessed) {\n            dispatch('DID_COMPLETE_ITEM_PROCESSING_ALL');\n          }\n        });\n\n        // we error function\n        item.onOnce('process-error', function(error) {\n          failure({ error: error, file: createItemAPI(item) });\n          processNext();\n        });\n\n        // start file processing\n        var options = state.options;\n        item.process(\n          createFileProcessor(\n            createProcessorFunction(\n              options.server.url,\n              options.server.process,\n              options.name,\n              {\n                chunkTransferId: item.transferId,\n                chunkServer: options.server.patch,\n                chunkUploads: options.chunkUploads,\n                chunkForce: options.chunkForce,\n                chunkSize: options.chunkSize,\n                chunkRetryDelays: options.chunkRetryDelays\n              }\n            )\n          ),\n\n          // called when the file is about to be processed so it can be piped through the transform filters\n          function(file, success, error) {\n            // allow plugins to alter the file data\n            applyFilterChain('PREPARE_OUTPUT', file, {\n              query: query,\n              item: item\n            })\n              .then(function(file) {\n                dispatch('DID_PREPARE_OUTPUT', { id: item.id, file: file });\n\n                success(file);\n              })\n              .catch(error);\n          }\n        );\n      }),\n\n      RETRY_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {\n        dispatch('REQUEST_ITEM_PROCESSING', { query: item });\n      }),\n\n      REQUEST_REMOVE_ITEM: getItemByQueryFromState(state, function(item) {\n        optionalPromise(\n          query('GET_BEFORE_REMOVE_FILE'),\n          createItemAPI(item)\n        ).then(function(shouldRemove) {\n          if (!shouldRemove) {\n            return;\n          }\n          dispatch('REMOVE_ITEM', { query: item });\n        });\n      }),\n\n      RELEASE_ITEM: getItemByQueryFromState(state, function(item) {\n        item.release();\n      }),\n\n      REMOVE_ITEM: getItemByQueryFromState(state, function(\n        item,\n        success,\n        failure,\n        options\n      ) {\n        var removeFromView = function removeFromView() {\n          // get id reference\n          var id = item.id;\n\n          // archive the item, this does not remove it from the list\n          getItemById(state.items, id).archive();\n\n          // tell the view the item has been removed\n          dispatch('DID_REMOVE_ITEM', { error: null, id: id, item: item });\n\n          // now the list has been modified\n          listUpdated(dispatch, state);\n\n          // correctly removed\n          success(createItemAPI(item));\n        };\n\n        // if this is a local file and the server.remove function has been configured, send source there so dev can remove file from server\n        var server = state.options.server;\n        if (\n          item.origin === FileOrigin.LOCAL &&\n          server &&\n          isFunction(server.remove) &&\n          options.remove !== false\n        ) {\n          dispatch('DID_START_ITEM_REMOVE', { id: item.id });\n\n          server.remove(\n            item.source,\n            function() {\n              return removeFromView();\n            },\n            function(status) {\n              dispatch('DID_THROW_ITEM_REMOVE_ERROR', {\n                id: item.id,\n                error: createResponse('error', 0, status, null),\n                status: {\n                  main: dynamicLabel(state.options.labelFileRemoveError)(\n                    status\n                  ),\n                  sub: state.options.labelTapToRetry\n                }\n              });\n            }\n          );\n        } else {\n          // if is requesting revert and can revert need to call revert handler (not calling request_ because that would also trigger beforeRemoveHook)\n          if (\n            options.revert &&\n            item.origin !== FileOrigin.LOCAL &&\n            item.serverId !== null\n          ) {\n            item.revert(\n              createRevertFunction(\n                state.options.server.url,\n                state.options.server.revert\n              ),\n              query('GET_FORCE_REVERT')\n            );\n          }\n\n          // can now safely remove from view\n          removeFromView();\n        }\n      }),\n\n      ABORT_ITEM_LOAD: getItemByQueryFromState(state, function(item) {\n        item.abortLoad();\n      }),\n\n      ABORT_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {\n        // test if is already processed\n        if (item.serverId) {\n          dispatch('REVERT_ITEM_PROCESSING', { id: item.id });\n          return;\n        }\n\n        // abort\n        item.abortProcessing().then(function() {\n          var shouldRemove = state.options.instantUpload;\n          if (shouldRemove) {\n            dispatch('REMOVE_ITEM', { query: item.id });\n          }\n        });\n      }),\n\n      REQUEST_REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function(\n        item\n      ) {\n        // not instant uploading, revert immidiately\n        if (!state.options.instantUpload) {\n          dispatch('REVERT_ITEM_PROCESSING', { query: item });\n          return;\n        }\n\n        // if we're instant uploading the file will also be removed if we revert,\n        // so if a before remove file hook is defined we need to run it now\n        var handleRevert = function handleRevert(shouldRevert) {\n          if (!shouldRevert) return;\n          dispatch('REVERT_ITEM_PROCESSING', { query: item });\n        };\n\n        var fn = query('GET_BEFORE_REMOVE_FILE');\n        if (!fn) {\n          return handleRevert(true);\n        }\n\n        var requestRemoveResult = fn(createItemAPI(item));\n        if (requestRemoveResult == null) {\n          // undefined or null\n          return handleRevert(true);\n        }\n\n        if (typeof requestRemoveResult === 'boolean') {\n          return handleRevert(requestRemoveResult);\n        }\n\n        if (typeof requestRemoveResult.then === 'function') {\n          requestRemoveResult.then(handleRevert);\n        }\n      }),\n\n      REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {\n        item\n          .revert(\n            createRevertFunction(\n              state.options.server.url,\n              state.options.server.revert\n            ),\n            query('GET_FORCE_REVERT')\n          )\n          .then(function() {\n            var shouldRemove = state.options.instantUpload || isMockItem(item);\n            if (shouldRemove) {\n              dispatch('REMOVE_ITEM', { query: item.id });\n            }\n          })\n          .catch(function() {});\n      }),\n\n      SET_OPTIONS: function SET_OPTIONS(_ref11) {\n        var options = _ref11.options;\n        forin(options, function(key, value) {\n          dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {\n            value: value\n          });\n        });\n      }\n    };\n  };\n\n  var formatFilename = function formatFilename(name) {\n    return name;\n  };\n\n  var createElement$1 = function createElement(tagName) {\n    return document.createElement(tagName);\n  };\n\n  var text = function text(node, value) {\n    var textNode = node.childNodes[0];\n    if (!textNode) {\n      textNode = document.createTextNode(value);\n      node.appendChild(textNode);\n    } else if (value !== textNode.nodeValue) {\n      textNode.nodeValue = value;\n    }\n  };\n\n  var polarToCartesian = function polarToCartesian(\n    centerX,\n    centerY,\n    radius,\n    angleInDegrees\n  ) {\n    var angleInRadians = (((angleInDegrees % 360) - 90) * Math.PI) / 180.0;\n    return {\n      x: centerX + radius * Math.cos(angleInRadians),\n      y: centerY + radius * Math.sin(angleInRadians)\n    };\n  };\n\n  var describeArc = function describeArc(\n    x,\n    y,\n    radius,\n    startAngle,\n    endAngle,\n    arcSweep\n  ) {\n    var start = polarToCartesian(x, y, radius, endAngle);\n    var end = polarToCartesian(x, y, radius, startAngle);\n    return [\n      'M',\n      start.x,\n      start.y,\n      'A',\n      radius,\n      radius,\n      0,\n      arcSweep,\n      0,\n      end.x,\n      end.y\n    ].join(' ');\n  };\n\n  var percentageArc = function percentageArc(x, y, radius, from, to) {\n    var arcSweep = 1;\n    if (to > from && to - from <= 0.5) {\n      arcSweep = 0;\n    }\n    if (from > to && from - to >= 0.5) {\n      arcSweep = 0;\n    }\n    return describeArc(\n      x,\n      y,\n      radius,\n      Math.min(0.9999, from) * 360,\n      Math.min(0.9999, to) * 360,\n      arcSweep\n    );\n  };\n\n  var create = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    // start at 0\n    props.spin = false;\n    props.progress = 0;\n    props.opacity = 0;\n\n    // svg\n    var svg = createElement('svg');\n    root.ref.path = createElement('path', {\n      'stroke-width': 2,\n      'stroke-linecap': 'round'\n    });\n\n    svg.appendChild(root.ref.path);\n\n    root.ref.svg = svg;\n\n    root.appendChild(svg);\n  };\n\n  var write = function write(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n\n    if (props.opacity === 0) {\n      return;\n    }\n\n    if (props.align) {\n      root.element.dataset.align = props.align;\n    }\n\n    // get width of stroke\n    var ringStrokeWidth = parseInt(attr(root.ref.path, 'stroke-width'), 10);\n\n    // calculate size of ring\n    var size = root.rect.element.width * 0.5;\n\n    // ring state\n    var ringFrom = 0;\n    var ringTo = 0;\n\n    // now in busy mode\n    if (props.spin) {\n      ringFrom = 0;\n      ringTo = 0.5;\n    } else {\n      ringFrom = 0;\n      ringTo = props.progress;\n    }\n\n    // get arc path\n    var coordinates = percentageArc(\n      size,\n      size,\n      size - ringStrokeWidth,\n      ringFrom,\n      ringTo\n    );\n\n    // update progress bar\n    attr(root.ref.path, 'd', coordinates);\n\n    // hide while contains 0 value\n    attr(\n      root.ref.path,\n      'stroke-opacity',\n      props.spin || props.progress > 0 ? 1 : 0\n    );\n  };\n\n  var progressIndicator = createView({\n    tag: 'div',\n    name: 'progress-indicator',\n    ignoreRectUpdate: true,\n    ignoreRect: true,\n    create: create,\n    write: write,\n    mixins: {\n      apis: ['progress', 'spin', 'align'],\n      styles: ['opacity'],\n      animations: {\n        opacity: { type: 'tween', duration: 500 },\n        progress: {\n          type: 'spring',\n          stiffness: 0.95,\n          damping: 0.65,\n          mass: 10\n        }\n      }\n    }\n  });\n\n  var create$1 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    root.element.innerHTML =\n      (props.icon || '') + ('<span>' + props.label + '</span>');\n\n    props.isDisabled = false;\n  };\n\n  var write$1 = function write(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n    var isDisabled = props.isDisabled;\n    var shouldDisable = root.query('GET_DISABLED') || props.opacity === 0;\n\n    if (shouldDisable && !isDisabled) {\n      props.isDisabled = true;\n      attr(root.element, 'disabled', 'disabled');\n    } else if (!shouldDisable && isDisabled) {\n      props.isDisabled = false;\n      root.element.removeAttribute('disabled');\n    }\n  };\n\n  var fileActionButton = createView({\n    tag: 'button',\n    attributes: {\n      type: 'button'\n    },\n\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    name: 'file-action-button',\n    mixins: {\n      apis: ['label'],\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        translateX: 'spring',\n        translateY: 'spring',\n        opacity: { type: 'tween', duration: 250 }\n      },\n\n      listeners: true\n    },\n\n    create: create$1,\n    write: write$1\n  });\n\n  var toNaturalFileSize = function toNaturalFileSize(bytes) {\n    var decimalSeparator =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.';\n    // nope, no negative byte sizes\n    bytes = Math.round(Math.abs(bytes));\n\n    // just bytes\n    if (bytes < 1000) {\n      return bytes + ' bytes';\n    }\n\n    // kilobytes\n    if (bytes < MB) {\n      return Math.floor(bytes / KB) + ' KB';\n    }\n\n    // megabytes\n    if (bytes < GB) {\n      return removeDecimalsWhenZero(bytes / MB, 1, decimalSeparator) + ' MB';\n    }\n\n    // gigabytes\n    return removeDecimalsWhenZero(bytes / GB, 2, decimalSeparator) + ' GB';\n  };\n\n  var KB = 1000;\n  var MB = 1000000;\n  var GB = 1000000000;\n\n  var removeDecimalsWhenZero = function removeDecimalsWhenZero(\n    value,\n    decimalCount,\n    separator\n  ) {\n    return value\n      .toFixed(decimalCount)\n      .split('.')\n      .filter(function(part) {\n        return part !== '0';\n      })\n      .join(separator);\n  };\n\n  var create$2 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    // filename\n    var fileName = createElement$1('span');\n    fileName.className = 'filepond--file-info-main';\n    // hide for screenreaders\n    // the file is contained in a fieldset with legend that contains the filename\n    // no need to read it twice\n    attr(fileName, 'aria-hidden', 'true');\n    root.appendChild(fileName);\n    root.ref.fileName = fileName;\n\n    // filesize\n    var fileSize = createElement$1('span');\n    fileSize.className = 'filepond--file-info-sub';\n    root.appendChild(fileSize);\n    root.ref.fileSize = fileSize;\n\n    // set initial values\n    text(fileSize, root.query('GET_LABEL_FILE_WAITING_FOR_SIZE'));\n    text(fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));\n  };\n\n  var updateFile = function updateFile(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n    text(\n      root.ref.fileSize,\n      toNaturalFileSize(root.query('GET_ITEM_SIZE', props.id))\n    );\n\n    text(\n      root.ref.fileName,\n      formatFilename(root.query('GET_ITEM_NAME', props.id))\n    );\n  };\n\n  var updateFileSizeOnError = function updateFileSizeOnError(_ref3) {\n    var root = _ref3.root,\n      props = _ref3.props;\n    // if size is available don't fallback to unknown size message\n    if (isInt(root.query('GET_ITEM_SIZE', props.id))) {\n      return;\n    }\n\n    text(root.ref.fileSize, root.query('GET_LABEL_FILE_SIZE_NOT_AVAILABLE'));\n  };\n\n  var fileInfo = createView({\n    name: 'file-info',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: updateFile,\n      DID_UPDATE_ITEM_META: updateFile,\n      DID_THROW_ITEM_LOAD_ERROR: updateFileSizeOnError,\n      DID_THROW_ITEM_INVALID: updateFileSizeOnError\n    }),\n\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));\n    },\n    create: create$2,\n    mixins: {\n      styles: ['translateX', 'translateY'],\n      animations: {\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var toPercentage = function toPercentage(value) {\n    return Math.round(value * 100);\n  };\n\n  var create$3 = function create(_ref) {\n    var root = _ref.root;\n\n    // main status\n    var main = createElement$1('span');\n    main.className = 'filepond--file-status-main';\n    root.appendChild(main);\n    root.ref.main = main;\n\n    // sub status\n    var sub = createElement$1('span');\n    sub.className = 'filepond--file-status-sub';\n    root.appendChild(sub);\n    root.ref.sub = sub;\n\n    didSetItemLoadProgress({ root: root, action: { progress: null } });\n  };\n\n  var didSetItemLoadProgress = function didSetItemLoadProgress(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    var title =\n      action.progress === null\n        ? root.query('GET_LABEL_FILE_LOADING')\n        : root.query('GET_LABEL_FILE_LOADING') +\n          ' ' +\n          toPercentage(action.progress) +\n          '%';\n\n    text(root.ref.main, title);\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didSetItemProcessProgress = function didSetItemProcessProgress(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    var title =\n      action.progress === null\n        ? root.query('GET_LABEL_FILE_PROCESSING')\n        : root.query('GET_LABEL_FILE_PROCESSING') +\n          ' ' +\n          toPercentage(action.progress) +\n          '%';\n\n    text(root.ref.main, title);\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didRequestItemProcessing = function didRequestItemProcessing(_ref4) {\n    var root = _ref4.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));\n  };\n\n  var didAbortItemProcessing = function didAbortItemProcessing(_ref5) {\n    var root = _ref5.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_ABORTED'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_RETRY'));\n  };\n\n  var didCompleteItemProcessing = function didCompleteItemProcessing(_ref6) {\n    var root = _ref6.root;\n    text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_COMPLETE'));\n    text(root.ref.sub, root.query('GET_LABEL_TAP_TO_UNDO'));\n  };\n\n  var clear = function clear(_ref7) {\n    var root = _ref7.root;\n    text(root.ref.main, '');\n    text(root.ref.sub, '');\n  };\n\n  var error = function error(_ref8) {\n    var root = _ref8.root,\n      action = _ref8.action;\n    text(root.ref.main, action.status.main);\n    text(root.ref.sub, action.status.sub);\n  };\n\n  var fileStatus = createView({\n    name: 'file-status',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: clear,\n      DID_REVERT_ITEM_PROCESSING: clear,\n      DID_REQUEST_ITEM_PROCESSING: didRequestItemProcessing,\n      DID_ABORT_ITEM_PROCESSING: didAbortItemProcessing,\n      DID_COMPLETE_ITEM_PROCESSING: didCompleteItemProcessing,\n      DID_UPDATE_ITEM_PROCESS_PROGRESS: didSetItemProcessProgress,\n      DID_UPDATE_ITEM_LOAD_PROGRESS: didSetItemLoadProgress,\n      DID_THROW_ITEM_LOAD_ERROR: error,\n      DID_THROW_ITEM_INVALID: error,\n      DID_THROW_ITEM_PROCESSING_ERROR: error,\n      DID_THROW_ITEM_PROCESSING_REVERT_ERROR: error,\n      DID_THROW_ITEM_REMOVE_ERROR: error\n    }),\n\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));\n    },\n    create: create$3,\n    mixins: {\n      styles: ['translateX', 'translateY', 'opacity'],\n      animations: {\n        opacity: { type: 'tween', duration: 250 },\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n\n  /**\n   * Button definitions for the file view\n   */\n\n  var Buttons = {\n    AbortItemLoad: {\n      label: 'GET_LABEL_BUTTON_ABORT_ITEM_LOAD',\n      action: 'ABORT_ITEM_LOAD',\n      className: 'filepond--action-abort-item-load',\n      align: 'LOAD_INDICATOR_POSITION' // right\n    },\n    RetryItemLoad: {\n      label: 'GET_LABEL_BUTTON_RETRY_ITEM_LOAD',\n      action: 'RETRY_ITEM_LOAD',\n      icon: 'GET_ICON_RETRY',\n      className: 'filepond--action-retry-item-load',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    },\n    RemoveItem: {\n      label: 'GET_LABEL_BUTTON_REMOVE_ITEM',\n      action: 'REQUEST_REMOVE_ITEM',\n      icon: 'GET_ICON_REMOVE',\n      className: 'filepond--action-remove-item',\n      align: 'BUTTON_REMOVE_ITEM_POSITION' // left\n    },\n    ProcessItem: {\n      label: 'GET_LABEL_BUTTON_PROCESS_ITEM',\n      action: 'REQUEST_ITEM_PROCESSING',\n      icon: 'GET_ICON_PROCESS',\n      className: 'filepond--action-process-item',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    },\n    AbortItemProcessing: {\n      label: 'GET_LABEL_BUTTON_ABORT_ITEM_PROCESSING',\n      action: 'ABORT_ITEM_PROCESSING',\n      className: 'filepond--action-abort-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    },\n    RetryItemProcessing: {\n      label: 'GET_LABEL_BUTTON_RETRY_ITEM_PROCESSING',\n      action: 'RETRY_ITEM_PROCESSING',\n      icon: 'GET_ICON_RETRY',\n      className: 'filepond--action-retry-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    },\n    RevertItemProcessing: {\n      label: 'GET_LABEL_BUTTON_UNDO_ITEM_PROCESSING',\n      action: 'REQUEST_REVERT_ITEM_PROCESSING',\n      icon: 'GET_ICON_UNDO',\n      className: 'filepond--action-revert-item-processing',\n      align: 'BUTTON_PROCESS_ITEM_POSITION' // right\n    }\n  };\n\n  // make a list of buttons, we can then remove buttons from this list if they're disabled\n  var ButtonKeys = [];\n  forin(Buttons, function(key) {\n    ButtonKeys.push(key);\n  });\n\n  var calculateFileInfoOffset = function calculateFileInfoOffset(root) {\n    var buttonRect = root.ref.buttonRemoveItem.rect.element;\n    return buttonRect.hidden ? null : buttonRect.width + buttonRect.left;\n  };\n\n  var calculateButtonWidth = function calculateButtonWidth(root) {\n    var buttonRect = root.ref.buttonAbortItemLoad.rect.element;\n    return buttonRect.width;\n  };\n\n  // Force on full pixels so text stays crips\n  var calculateFileVerticalCenterOffset = function calculateFileVerticalCenterOffset(\n    root\n  ) {\n    return Math.floor(root.ref.buttonRemoveItem.rect.element.height / 4);\n  };\n  var calculateFileHorizontalCenterOffset = function calculateFileHorizontalCenterOffset(\n    root\n  ) {\n    return Math.floor(root.ref.buttonRemoveItem.rect.element.left / 2);\n  };\n\n  var getLoadIndicatorAlignment = function getLoadIndicatorAlignment(root) {\n    return root.query('GET_STYLE_LOAD_INDICATOR_POSITION');\n  };\n  var getProcessIndicatorAlignment = function getProcessIndicatorAlignment(\n    root\n  ) {\n    return root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION');\n  };\n  var getRemoveIndicatorAligment = function getRemoveIndicatorAligment(root) {\n    return root.query('GET_STYLE_BUTTON_REMOVE_ITEM_POSITION');\n  };\n\n  var DefaultStyle = {\n    buttonAbortItemLoad: { opacity: 0 },\n    buttonRetryItemLoad: { opacity: 0 },\n    buttonRemoveItem: { opacity: 0 },\n    buttonProcessItem: { opacity: 0 },\n    buttonAbortItemProcessing: { opacity: 0 },\n    buttonRetryItemProcessing: { opacity: 0 },\n    buttonRevertItemProcessing: { opacity: 0 },\n    loadProgressIndicator: { opacity: 0, align: getLoadIndicatorAlignment },\n    processProgressIndicator: {\n      opacity: 0,\n      align: getProcessIndicatorAlignment\n    },\n    processingCompleteIndicator: { opacity: 0, scaleX: 0.75, scaleY: 0.75 },\n    info: { translateX: 0, translateY: 0, opacity: 0 },\n    status: { translateX: 0, translateY: 0, opacity: 0 }\n  };\n\n  var IdleStyle = {\n    buttonRemoveItem: { opacity: 1 },\n    buttonProcessItem: { opacity: 1 },\n    info: { translateX: calculateFileInfoOffset },\n    status: { translateX: calculateFileInfoOffset }\n  };\n\n  var ProcessingStyle = {\n    buttonAbortItemProcessing: { opacity: 1 },\n    processProgressIndicator: { opacity: 1 },\n    status: { opacity: 1 }\n  };\n\n  var StyleMap = {\n    DID_THROW_ITEM_INVALID: {\n      buttonRemoveItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { translateX: calculateFileInfoOffset, opacity: 1 }\n    },\n\n    DID_START_ITEM_LOAD: {\n      buttonAbortItemLoad: { opacity: 1 },\n      loadProgressIndicator: { opacity: 1 },\n      status: { opacity: 1 }\n    },\n\n    DID_THROW_ITEM_LOAD_ERROR: {\n      buttonRetryItemLoad: { opacity: 1 },\n      buttonRemoveItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { opacity: 1 }\n    },\n\n    DID_START_ITEM_REMOVE: {\n      processProgressIndicator: {\n        opacity: 1,\n        align: getRemoveIndicatorAligment\n      },\n      info: { translateX: calculateFileInfoOffset },\n      status: { opacity: 0 }\n    },\n\n    DID_THROW_ITEM_REMOVE_ERROR: {\n      processProgressIndicator: {\n        opacity: 0,\n        align: getRemoveIndicatorAligment\n      },\n      buttonRemoveItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { opacity: 1, translateX: calculateFileInfoOffset }\n    },\n\n    DID_LOAD_ITEM: IdleStyle,\n    DID_LOAD_LOCAL_ITEM: {\n      buttonRemoveItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { translateX: calculateFileInfoOffset }\n    },\n\n    DID_START_ITEM_PROCESSING: ProcessingStyle,\n    DID_REQUEST_ITEM_PROCESSING: ProcessingStyle,\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: ProcessingStyle,\n    DID_COMPLETE_ITEM_PROCESSING: {\n      buttonRevertItemProcessing: { opacity: 1 },\n      info: { opacity: 1 },\n      status: { opacity: 1 }\n    },\n\n    DID_THROW_ITEM_PROCESSING_ERROR: {\n      buttonRemoveItem: { opacity: 1 },\n      buttonRetryItemProcessing: { opacity: 1 },\n      status: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset }\n    },\n\n    DID_THROW_ITEM_PROCESSING_REVERT_ERROR: {\n      buttonRevertItemProcessing: { opacity: 1 },\n      status: { opacity: 1 },\n      info: { opacity: 1 }\n    },\n\n    DID_ABORT_ITEM_PROCESSING: {\n      buttonRemoveItem: { opacity: 1 },\n      buttonProcessItem: { opacity: 1 },\n      info: { translateX: calculateFileInfoOffset },\n      status: { opacity: 1 }\n    },\n\n    DID_REVERT_ITEM_PROCESSING: IdleStyle\n  };\n\n  // complete indicator view\n  var processingCompleteIndicatorView = createView({\n    create: function create(_ref) {\n      var root = _ref.root;\n      root.element.innerHTML = root.query('GET_ICON_DONE');\n    },\n    name: 'processing-complete-indicator',\n    ignoreRect: true,\n    mixins: {\n      styles: ['scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        opacity: { type: 'tween', duration: 250 }\n      }\n    }\n  });\n\n  /**\n   * Creates the file view\n   */\n  var create$4 = function create(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n    var id = props.id;\n\n    // allow reverting upload\n    var allowRevert = root.query('GET_ALLOW_REVERT');\n\n    // allow processing upload\n    var allowProcess = root.query('GET_ALLOW_PROCESS');\n\n    // is instant uploading, need this to determine the icon of the undo button\n    var instantUpload = root.query('GET_INSTANT_UPLOAD');\n\n    // is async set up\n    var isAsync = root.query('IS_ASYNC');\n\n    // should align remove item buttons\n    var alignRemoveItemButton = root.query(\n      'GET_STYLE_BUTTON_REMOVE_ITEM_ALIGN'\n    );\n\n    // enabled buttons array\n    var buttonFilter;\n    if (isAsync) {\n      if (allowProcess && !allowRevert) {\n        // only remove revert button\n        buttonFilter = function buttonFilter(key) {\n          return !/RevertItemProcessing/.test(key);\n        };\n      } else if (!allowProcess && allowRevert) {\n        // only remove process button\n        buttonFilter = function buttonFilter(key) {\n          return !/ProcessItem|RetryItemProcessing|AbortItemProcessing/.test(\n            key\n          );\n        };\n      } else if (!allowProcess && !allowRevert) {\n        // remove all process buttons\n        buttonFilter = function buttonFilter(key) {\n          return !/Process/.test(key);\n        };\n      }\n    } else {\n      // no process controls available\n      buttonFilter = function buttonFilter(key) {\n        return !/Process/.test(key);\n      };\n    }\n\n    var enabledButtons = buttonFilter\n      ? ButtonKeys.filter(buttonFilter)\n      : ButtonKeys.concat();\n\n    // update icon and label for revert button when instant uploading\n    if (instantUpload && allowRevert) {\n      Buttons['RevertItemProcessing'].label = 'GET_LABEL_BUTTON_REMOVE_ITEM';\n      Buttons['RevertItemProcessing'].icon = 'GET_ICON_REMOVE';\n    }\n\n    // remove last button (revert) if not allowed\n    if (isAsync && !allowRevert) {\n      var map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];\n      map.info.translateX = calculateFileHorizontalCenterOffset;\n      map.info.translateY = calculateFileVerticalCenterOffset;\n      map.status.translateY = calculateFileVerticalCenterOffset;\n      map.processingCompleteIndicator = { opacity: 1, scaleX: 1, scaleY: 1 };\n    }\n\n    // should align center\n    if (isAsync && !allowProcess) {\n      [\n        'DID_START_ITEM_PROCESSING',\n        'DID_REQUEST_ITEM_PROCESSING',\n        'DID_UPDATE_ITEM_PROCESS_PROGRESS',\n        'DID_THROW_ITEM_PROCESSING_ERROR'\n      ].forEach(function(key) {\n        StyleMap[key].status.translateY = calculateFileVerticalCenterOffset;\n      });\n      StyleMap[\n        'DID_THROW_ITEM_PROCESSING_ERROR'\n      ].status.translateX = calculateButtonWidth;\n    }\n\n    // move remove button to right\n    if (alignRemoveItemButton && allowRevert) {\n      Buttons['RevertItemProcessing'].align = 'BUTTON_REMOVE_ITEM_POSITION';\n      var _map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];\n      _map.info.translateX = calculateFileInfoOffset;\n      _map.status.translateY = calculateFileVerticalCenterOffset;\n      _map.processingCompleteIndicator = { opacity: 1, scaleX: 1, scaleY: 1 };\n    }\n\n    // create the button views\n    forin(Buttons, function(key, definition) {\n      // create button\n      var buttonView = root.createChildView(fileActionButton, {\n        label: root.query(definition.label),\n        icon: root.query(definition.icon),\n        opacity: 0\n      });\n\n      // should be appended?\n      if (enabledButtons.includes(key)) {\n        root.appendChildView(buttonView);\n      }\n\n      // add position attribute\n      buttonView.element.dataset.align = root.query(\n        'GET_STYLE_' + definition.align\n      );\n\n      // add class\n      buttonView.element.classList.add(definition.className);\n\n      // handle interactions\n      buttonView.on('click', function(e) {\n        e.stopPropagation();\n        root.dispatch(definition.action, { query: id });\n      });\n\n      // set reference\n      root.ref['button' + key] = buttonView;\n    });\n\n    // checkmark\n    root.ref.processingCompleteIndicator = root.appendChildView(\n      root.createChildView(processingCompleteIndicatorView)\n    );\n    root.ref.processingCompleteIndicator.element.dataset.align = root.query(\n      'GET_STYLE_BUTTON_PROCESS_ITEM_POSITION'\n    );\n\n    // create file info view\n    root.ref.info = root.appendChildView(\n      root.createChildView(fileInfo, { id: id })\n    );\n\n    // create file status view\n    root.ref.status = root.appendChildView(\n      root.createChildView(fileStatus, { id: id })\n    );\n\n    // add progress indicators\n    var loadIndicatorView = root.appendChildView(\n      root.createChildView(progressIndicator, {\n        opacity: 0,\n        align: root.query('GET_STYLE_LOAD_INDICATOR_POSITION')\n      })\n    );\n\n    loadIndicatorView.element.classList.add('filepond--load-indicator');\n    root.ref.loadProgressIndicator = loadIndicatorView;\n\n    var progressIndicatorView = root.appendChildView(\n      root.createChildView(progressIndicator, {\n        opacity: 0,\n        align: root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION')\n      })\n    );\n\n    progressIndicatorView.element.classList.add('filepond--process-indicator');\n    root.ref.processProgressIndicator = progressIndicatorView;\n\n    // current active styles\n    root.ref.activeStyles = [];\n  };\n\n  var write$2 = function write(_ref3) {\n    var root = _ref3.root,\n      actions = _ref3.actions,\n      props = _ref3.props;\n\n    // route actions\n    route({ root: root, actions: actions, props: props });\n\n    // select last state change action\n    var action = actions\n      .concat()\n      .filter(function(action) {\n        return /^DID_/.test(action.type);\n      })\n      .reverse()\n      .find(function(action) {\n        return StyleMap[action.type];\n      });\n\n    // a new action happened, let's get the matching styles\n    if (action) {\n      // define new active styles\n      root.ref.activeStyles = [];\n\n      var stylesToApply = StyleMap[action.type];\n      forin(DefaultStyle, function(name, defaultStyles) {\n        // get reference to control\n        var control = root.ref[name];\n\n        // loop over all styles for this control\n        forin(defaultStyles, function(key, defaultValue) {\n          var value =\n            stylesToApply[name] &&\n            typeof stylesToApply[name][key] !== 'undefined'\n              ? stylesToApply[name][key]\n              : defaultValue;\n          root.ref.activeStyles.push({\n            control: control,\n            key: key,\n            value: value\n          });\n        });\n      });\n    }\n\n    // apply active styles to element\n    root.ref.activeStyles.forEach(function(_ref4) {\n      var control = _ref4.control,\n        key = _ref4.key,\n        value = _ref4.value;\n      control[key] = typeof value === 'function' ? value(root) : value;\n    });\n  };\n\n  var route = createRoute({\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING: function DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING(\n      _ref5\n    ) {\n      var root = _ref5.root,\n        action = _ref5.action;\n      root.ref.buttonAbortItemProcessing.label = action.value;\n    },\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD: function DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD(\n      _ref6\n    ) {\n      var root = _ref6.root,\n        action = _ref6.action;\n      root.ref.buttonAbortItemLoad.label = action.value;\n    },\n    DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL: function DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL(\n      _ref7\n    ) {\n      var root = _ref7.root,\n        action = _ref7.action;\n      root.ref.buttonAbortItemRemoval.label = action.value;\n    },\n    DID_REQUEST_ITEM_PROCESSING: function DID_REQUEST_ITEM_PROCESSING(_ref8) {\n      var root = _ref8.root;\n      root.ref.processProgressIndicator.spin = true;\n      root.ref.processProgressIndicator.progress = 0;\n    },\n    DID_START_ITEM_LOAD: function DID_START_ITEM_LOAD(_ref9) {\n      var root = _ref9.root;\n      root.ref.loadProgressIndicator.spin = true;\n      root.ref.loadProgressIndicator.progress = 0;\n    },\n    DID_START_ITEM_REMOVE: function DID_START_ITEM_REMOVE(_ref10) {\n      var root = _ref10.root;\n      root.ref.processProgressIndicator.spin = true;\n      root.ref.processProgressIndicator.progress = 0;\n    },\n    DID_UPDATE_ITEM_LOAD_PROGRESS: function DID_UPDATE_ITEM_LOAD_PROGRESS(\n      _ref11\n    ) {\n      var root = _ref11.root,\n        action = _ref11.action;\n      root.ref.loadProgressIndicator.spin = false;\n      root.ref.loadProgressIndicator.progress = action.progress;\n    },\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: function DID_UPDATE_ITEM_PROCESS_PROGRESS(\n      _ref12\n    ) {\n      var root = _ref12.root,\n        action = _ref12.action;\n      root.ref.processProgressIndicator.spin = false;\n      root.ref.processProgressIndicator.progress = action.progress;\n    }\n  });\n\n  var file = createView({\n    create: create$4,\n    write: write$2,\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));\n    },\n    name: 'file'\n  });\n\n  /**\n   * Creates the file view\n   */\n  var create$5 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // filename\n    root.ref.fileName = createElement$1('legend');\n    root.appendChild(root.ref.fileName);\n\n    // file appended\n    root.ref.file = root.appendChildView(\n      root.createChildView(file, { id: props.id })\n    );\n\n    // data has moved to data.js\n    root.ref.data = false;\n  };\n\n  /**\n   * Data storage\n   */\n  var didLoadItem = function didLoadItem(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n    // updates the legend of the fieldset so screenreaders can better group buttons\n    text(\n      root.ref.fileName,\n      formatFilename(root.query('GET_ITEM_NAME', props.id))\n    );\n  };\n\n  var fileWrapper = createView({\n    create: create$5,\n    ignoreRect: true,\n    write: createRoute({\n      DID_LOAD_ITEM: didLoadItem\n    }),\n\n    didCreateView: function didCreateView(root) {\n      applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));\n    },\n    tag: 'fieldset',\n    name: 'file-wrapper'\n  });\n\n  var PANEL_SPRING_PROPS = { type: 'spring', damping: 0.6, mass: 7 };\n\n  var create$6 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    [\n      {\n        name: 'top'\n      },\n\n      {\n        name: 'center',\n        props: {\n          translateY: null,\n          scaleY: null\n        },\n\n        mixins: {\n          animations: {\n            scaleY: PANEL_SPRING_PROPS\n          },\n\n          styles: ['translateY', 'scaleY']\n        }\n      },\n\n      {\n        name: 'bottom',\n        props: {\n          translateY: null\n        },\n\n        mixins: {\n          animations: {\n            translateY: PANEL_SPRING_PROPS\n          },\n\n          styles: ['translateY']\n        }\n      }\n    ].forEach(function(section) {\n      createSection(root, section, props.name);\n    });\n\n    root.element.classList.add('filepond--' + props.name);\n\n    root.ref.scalable = null;\n  };\n\n  var createSection = function createSection(root, section, className) {\n    var viewConstructor = createView({\n      name: 'panel-' + section.name + ' filepond--' + className,\n      mixins: section.mixins,\n      ignoreRectUpdate: true\n    });\n\n    var view = root.createChildView(viewConstructor, section.props);\n\n    root.ref[section.name] = root.appendChildView(view);\n  };\n\n  var write$3 = function write(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props;\n\n    // update scalable state\n    if (root.ref.scalable === null || props.scalable !== root.ref.scalable) {\n      root.ref.scalable = isBoolean(props.scalable) ? props.scalable : true;\n      root.element.dataset.scalable = root.ref.scalable;\n    }\n\n    // no height, can't set\n    if (!props.height) return;\n\n    // get child rects\n    var topRect = root.ref.top.rect.element;\n    var bottomRect = root.ref.bottom.rect.element;\n\n    // make sure height never is smaller than bottom and top seciton heights combined (will probably never happen, but who knows)\n    var height = Math.max(topRect.height + bottomRect.height, props.height);\n\n    // offset center part\n    root.ref.center.translateY = topRect.height;\n\n    // scale center part\n    // use math ceil to prevent transparent lines because of rounding errors\n    root.ref.center.scaleY =\n      (height - topRect.height - bottomRect.height) / 100;\n\n    // offset bottom part\n    root.ref.bottom.translateY = height - bottomRect.height;\n  };\n\n  var panel = createView({\n    name: 'panel',\n    write: write$3,\n    create: create$6,\n    ignoreRect: true,\n    mixins: {\n      apis: ['height', 'scalable']\n    }\n  });\n\n  var createDragHelper = function createDragHelper(items) {\n    var itemIds = items.map(function(item) {\n      return item.id;\n    });\n    var prevIndex = undefined;\n    return {\n      setIndex: function setIndex(index) {\n        prevIndex = index;\n      },\n      getIndex: function getIndex() {\n        return prevIndex;\n      },\n      getItemIndex: function getItemIndex(item) {\n        return itemIds.indexOf(item.id);\n      }\n    };\n  };\n\n  var ITEM_TRANSLATE_SPRING = {\n    type: 'spring',\n    stiffness: 0.75,\n    damping: 0.45,\n    mass: 10\n  };\n\n  var ITEM_SCALE_SPRING = 'spring';\n\n  var StateMap = {\n    DID_START_ITEM_LOAD: 'busy',\n    DID_UPDATE_ITEM_LOAD_PROGRESS: 'loading',\n    DID_THROW_ITEM_INVALID: 'load-invalid',\n    DID_THROW_ITEM_LOAD_ERROR: 'load-error',\n    DID_LOAD_ITEM: 'idle',\n    DID_THROW_ITEM_REMOVE_ERROR: 'remove-error',\n    DID_START_ITEM_REMOVE: 'busy',\n    DID_START_ITEM_PROCESSING: 'busy processing',\n    DID_REQUEST_ITEM_PROCESSING: 'busy processing',\n    DID_UPDATE_ITEM_PROCESS_PROGRESS: 'processing',\n    DID_COMPLETE_ITEM_PROCESSING: 'processing-complete',\n    DID_THROW_ITEM_PROCESSING_ERROR: 'processing-error',\n    DID_THROW_ITEM_PROCESSING_REVERT_ERROR: 'processing-revert-error',\n    DID_ABORT_ITEM_PROCESSING: 'cancelled',\n    DID_REVERT_ITEM_PROCESSING: 'idle'\n  };\n\n  /**\n   * Creates the file view\n   */\n  var create$7 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // select\n    root.ref.handleClick = function(e) {\n      return root.dispatch('DID_ACTIVATE_ITEM', { id: props.id });\n    };\n\n    // set id\n    root.element.id = 'filepond--item-' + props.id;\n    root.element.addEventListener('click', root.ref.handleClick);\n\n    // file view\n    root.ref.container = root.appendChildView(\n      root.createChildView(fileWrapper, { id: props.id })\n    );\n\n    // file panel\n    root.ref.panel = root.appendChildView(\n      root.createChildView(panel, { name: 'item-panel' })\n    );\n\n    // default start height\n    root.ref.panel.height = null;\n\n    // by default not marked for removal\n    props.markedForRemoval = false;\n\n    // if not allowed to reorder file items, exit here\n    if (!root.query('GET_ALLOW_REORDER')) return;\n\n    // set to idle so shows grab cursor\n    root.element.dataset.dragState = 'idle';\n\n    var grab = function grab(e) {\n      if (!e.isPrimary) return;\n\n      var removedActivateListener = false;\n\n      var origin = {\n        x: e.pageX,\n        y: e.pageY\n      };\n\n      props.dragOrigin = {\n        x: root.translateX,\n        y: root.translateY\n      };\n\n      props.dragCenter = {\n        x: e.offsetX,\n        y: e.offsetY\n      };\n\n      var dragState = createDragHelper(root.query('GET_ACTIVE_ITEMS'));\n\n      root.dispatch('DID_GRAB_ITEM', { id: props.id, dragState: dragState });\n\n      var drag = function drag(e) {\n        if (!e.isPrimary) return;\n\n        e.stopPropagation();\n        e.preventDefault();\n\n        props.dragOffset = {\n          x: e.pageX - origin.x,\n          y: e.pageY - origin.y\n        };\n\n        // if dragged stop listening to clicks, will re-add when done dragging\n        var dist =\n          props.dragOffset.x * props.dragOffset.x +\n          props.dragOffset.y * props.dragOffset.y;\n        if (dist > 16 && !removedActivateListener) {\n          removedActivateListener = true;\n          root.element.removeEventListener('click', root.ref.handleClick);\n        }\n\n        root.dispatch('DID_DRAG_ITEM', { id: props.id, dragState: dragState });\n      };\n\n      var drop = function drop(e) {\n        if (!e.isPrimary) return;\n\n        document.removeEventListener('pointermove', drag);\n        document.removeEventListener('pointerup', drop);\n\n        props.dragOffset = {\n          x: e.pageX - origin.x,\n          y: e.pageY - origin.y\n        };\n\n        root.dispatch('DID_DROP_ITEM', { id: props.id, dragState: dragState });\n\n        // start listening to clicks again\n        if (removedActivateListener) {\n          setTimeout(function() {\n            return root.element.addEventListener('click', root.ref.handleClick);\n          }, 0);\n        }\n      };\n\n      document.addEventListener('pointermove', drag);\n      document.addEventListener('pointerup', drop);\n    };\n\n    root.element.addEventListener('pointerdown', grab);\n  };\n\n  var route$1 = createRoute({\n    DID_UPDATE_PANEL_HEIGHT: function DID_UPDATE_PANEL_HEIGHT(_ref2) {\n      var root = _ref2.root,\n        action = _ref2.action;\n      root.height = action.height;\n    }\n  });\n\n  var write$4 = createRoute(\n    {\n      DID_GRAB_ITEM: function DID_GRAB_ITEM(_ref3) {\n        var root = _ref3.root,\n          props = _ref3.props;\n        props.dragOrigin = {\n          x: root.translateX,\n          y: root.translateY\n        };\n      },\n      DID_DRAG_ITEM: function DID_DRAG_ITEM(_ref4) {\n        var root = _ref4.root;\n        root.element.dataset.dragState = 'drag';\n      },\n      DID_DROP_ITEM: function DID_DROP_ITEM(_ref5) {\n        var root = _ref5.root,\n          props = _ref5.props;\n        props.dragOffset = null;\n        props.dragOrigin = null;\n        root.element.dataset.dragState = 'drop';\n      }\n    },\n    function(_ref6) {\n      var root = _ref6.root,\n        actions = _ref6.actions,\n        props = _ref6.props,\n        shouldOptimize = _ref6.shouldOptimize;\n\n      if (root.element.dataset.dragState === 'drop') {\n        if (root.scaleX <= 1) {\n          root.element.dataset.dragState = 'idle';\n        }\n      }\n\n      // select last state change action\n      var action = actions\n        .concat()\n        .filter(function(action) {\n          return /^DID_/.test(action.type);\n        })\n        .reverse()\n        .find(function(action) {\n          return StateMap[action.type];\n        });\n\n      // no need to set same state twice\n      if (action && action.type !== props.currentState) {\n        // set current state\n        props.currentState = action.type;\n\n        // set state\n        root.element.dataset.filepondItemState =\n          StateMap[props.currentState] || '';\n      }\n\n      // route actions\n      var aspectRatio =\n        root.query('GET_ITEM_PANEL_ASPECT_RATIO') ||\n        root.query('GET_PANEL_ASPECT_RATIO');\n      if (!aspectRatio) {\n        route$1({ root: root, actions: actions, props: props });\n        if (!root.height && root.ref.container.rect.element.height > 0) {\n          root.height = root.ref.container.rect.element.height;\n        }\n      } else if (!shouldOptimize) {\n        root.height = root.rect.element.width * aspectRatio;\n      }\n\n      // sync panel height with item height\n      if (shouldOptimize) {\n        root.ref.panel.height = null;\n      }\n\n      root.ref.panel.height = root.height;\n    }\n  );\n\n  var item = createView({\n    create: create$7,\n    write: write$4,\n    destroy: function destroy(_ref7) {\n      var root = _ref7.root,\n        props = _ref7.props;\n      root.element.removeEventListener('click', root.ref.handleClick);\n      root.dispatch('RELEASE_ITEM', { query: props.id });\n    },\n    tag: 'li',\n    name: 'item',\n    mixins: {\n      apis: [\n        'id',\n        'interactionMethod',\n        'markedForRemoval',\n        'spawnDate',\n        'dragCenter',\n        'dragOrigin',\n        'dragOffset'\n      ],\n      styles: [\n        'translateX',\n        'translateY',\n        'scaleX',\n        'scaleY',\n        'opacity',\n        'height'\n      ],\n\n      animations: {\n        scaleX: ITEM_SCALE_SPRING,\n        scaleY: ITEM_SCALE_SPRING,\n        translateX: ITEM_TRANSLATE_SPRING,\n        translateY: ITEM_TRANSLATE_SPRING,\n        opacity: { type: 'tween', duration: 150 }\n      }\n    }\n  });\n\n  var getItemIndexByPosition = function getItemIndexByPosition(\n    view,\n    children,\n    positionInView\n  ) {\n    if (!positionInView) return;\n\n    var horizontalSpace = view.rect.element.width;\n    // const children = view.childViews;\n    var l = children.length;\n    var last = null;\n\n    // -1, don't move items to accomodate (either add to top or bottom)\n    if (l === 0 || positionInView.top < children[0].rect.element.top) return -1;\n\n    // let's get the item width\n    var item = children[0];\n    var itemRect = item.rect.element;\n    var itemHorizontalMargin = itemRect.marginLeft + itemRect.marginRight;\n    var itemWidth = itemRect.width + itemHorizontalMargin;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth);\n\n    // stack\n    if (itemsPerRow === 1) {\n      for (var index = 0; index < l; index++) {\n        var child = children[index];\n        var childMid = child.rect.outer.top + child.rect.element.height * 0.5;\n        if (positionInView.top < childMid) {\n          return index;\n        }\n      }\n      return l;\n    }\n\n    // grid\n    var itemVerticalMargin = itemRect.marginTop + itemRect.marginBottom;\n    var itemHeight = itemRect.height + itemVerticalMargin;\n    for (var _index = 0; _index < l; _index++) {\n      var indexX = _index % itemsPerRow;\n      var indexY = Math.floor(_index / itemsPerRow);\n\n      var offsetX = indexX * itemWidth;\n      var offsetY = indexY * itemHeight;\n\n      var itemTop = offsetY - itemRect.marginTop;\n      var itemRight = offsetX + itemWidth;\n      var itemBottom = offsetY + itemHeight + itemRect.marginBottom;\n\n      if (positionInView.top < itemBottom && positionInView.top > itemTop) {\n        if (positionInView.left < itemRight) {\n          return _index;\n        } else if (_index !== l - 1) {\n          last = _index;\n        } else {\n          last = null;\n        }\n      }\n    }\n\n    if (last !== null) {\n      return last;\n    }\n\n    return l;\n  };\n\n  var dropAreaDimensions = {\n    height: 0,\n    width: 0,\n    get getHeight() {\n      return this.height;\n    },\n    set setHeight(val) {\n      if (this.height === 0 || val === 0) this.height = val;\n    },\n    get getWidth() {\n      return this.width;\n    },\n    set setWidth(val) {\n      if (this.width === 0 || val === 0) this.width = val;\n    },\n    setDimensions: function setDimensions(height, width) {\n      if (this.height === 0 || height === 0) this.height = height;\n      if (this.width === 0 || width === 0) this.width = width;\n    }\n  };\n\n  var create$8 = function create(_ref) {\n    var root = _ref.root;\n    // need to set role to list as otherwise it won't be read as a list by VoiceOver\n    attr(root.element, 'role', 'list');\n\n    root.ref.lastItemSpanwDate = Date.now();\n  };\n\n  /**\n   * Inserts a new item\n   * @param root\n   * @param action\n   */\n  var addItemView = function addItemView(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    var id = action.id,\n      index = action.index,\n      interactionMethod = action.interactionMethod;\n\n    root.ref.addIndex = index;\n\n    var now = Date.now();\n    var spawnDate = now;\n    var opacity = 1;\n\n    if (interactionMethod !== InteractionMethod.NONE) {\n      opacity = 0;\n      var cooldown = root.query('GET_ITEM_INSERT_INTERVAL');\n      var dist = now - root.ref.lastItemSpanwDate;\n      spawnDate = dist < cooldown ? now + (cooldown - dist) : now;\n    }\n\n    root.ref.lastItemSpanwDate = spawnDate;\n\n    root.appendChildView(\n      root.createChildView(\n        // view type\n        item,\n\n        // props\n        {\n          spawnDate: spawnDate,\n          id: id,\n          opacity: opacity,\n          interactionMethod: interactionMethod\n        }\n      ),\n\n      index\n    );\n  };\n\n  var moveItem = function moveItem(item, x, y) {\n    var vx =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n    var vy =\n      arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1;\n\n    // set to null to remove animation while dragging\n    if (item.dragOffset) {\n      item.translateX = null;\n      item.translateY = null;\n      item.translateX = item.dragOrigin.x + item.dragOffset.x;\n      item.translateY = item.dragOrigin.y + item.dragOffset.y;\n      item.scaleX = 1.025;\n      item.scaleY = 1.025;\n    } else {\n      item.translateX = x;\n      item.translateY = y;\n\n      if (Date.now() > item.spawnDate) {\n        // reveal element\n        if (item.opacity === 0) {\n          introItemView(item, x, y, vx, vy);\n        }\n\n        // make sure is default scale every frame\n        item.scaleX = 1;\n        item.scaleY = 1;\n        item.opacity = 1;\n      }\n    }\n  };\n\n  var introItemView = function introItemView(item, x, y, vx, vy) {\n    if (item.interactionMethod === InteractionMethod.NONE) {\n      item.translateX = null;\n      item.translateX = x;\n      item.translateY = null;\n      item.translateY = y;\n    } else if (item.interactionMethod === InteractionMethod.DROP) {\n      item.translateX = null;\n      item.translateX = x - vx * 20;\n\n      item.translateY = null;\n      item.translateY = y - vy * 10;\n\n      item.scaleX = 0.8;\n      item.scaleY = 0.8;\n    } else if (item.interactionMethod === InteractionMethod.BROWSE) {\n      item.translateY = null;\n      item.translateY = y - 30;\n    } else if (item.interactionMethod === InteractionMethod.API) {\n      item.translateX = null;\n      item.translateX = x - 30;\n      item.translateY = null;\n    }\n  };\n\n  /**\n   * Removes an existing item\n   * @param root\n   * @param action\n   */\n  var removeItemView = function removeItemView(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    var id = action.id;\n\n    // get the view matching the given id\n    var view = root.childViews.find(function(child) {\n      return child.id === id;\n    });\n\n    // if no view found, exit\n    if (!view) {\n      return;\n    }\n\n    // animate view out of view\n    view.scaleX = 0.9;\n    view.scaleY = 0.9;\n    view.opacity = 0;\n\n    // mark for removal\n    view.markedForRemoval = true;\n  };\n\n  var getItemHeight = function getItemHeight(child) {\n    return (\n      child.rect.element.height +\n      child.rect.element.marginBottom * 0.5 +\n      child.rect.element.marginTop * 0.5\n    );\n  };\n  var getItemWidth = function getItemWidth(child) {\n    return (\n      child.rect.element.width +\n      child.rect.element.marginLeft * 0.5 +\n      child.rect.element.marginRight * 0.5\n    );\n  };\n\n  var dragItem = function dragItem(_ref4) {\n    var root = _ref4.root,\n      action = _ref4.action;\n    var id = action.id,\n      dragState = action.dragState;\n\n    // reference to item\n    var item = root.query('GET_ITEM', { id: id });\n\n    // get the view matching the given id\n    var view = root.childViews.find(function(child) {\n      return child.id === id;\n    });\n\n    var numItems = root.childViews.length;\n    var oldIndex = dragState.getItemIndex(item);\n\n    // if no view found, exit\n    if (!view) return;\n\n    var dragPosition = {\n      x: view.dragOrigin.x + view.dragOffset.x + view.dragCenter.x,\n      y: view.dragOrigin.y + view.dragOffset.y + view.dragCenter.y\n\n      // get drag area dimensions\n    };\n    var dragHeight = getItemHeight(view);\n    var dragWidth = getItemWidth(view);\n\n    // get rows and columns (There will always be at least one row and one column if a file is present)\n    var cols = Math.floor(root.rect.outer.width / dragWidth);\n    if (cols > numItems) cols = numItems;\n\n    // rows are used to find when we have left the preview area bounding box\n    var rows = Math.floor(numItems / cols + 1);\n\n    dropAreaDimensions.setHeight = dragHeight * rows;\n    dropAreaDimensions.setWidth = dragWidth * cols;\n\n    // get new index of dragged item\n    var location = {\n      y: Math.floor(dragPosition.y / dragHeight),\n      x: Math.floor(dragPosition.x / dragWidth),\n      getGridIndex: function getGridIndex() {\n        if (\n          dragPosition.y > dropAreaDimensions.getHeight ||\n          dragPosition.y < 0 ||\n          dragPosition.x > dropAreaDimensions.getWidth ||\n          dragPosition.x < 0\n        )\n          return oldIndex;\n        return this.y * cols + this.x;\n      },\n      getColIndex: function getColIndex() {\n        var items = root.query('GET_ACTIVE_ITEMS');\n        var visibleChildren = root.childViews.filter(function(child) {\n          return child.rect.element.height;\n        });\n        var children = items.map(function(item) {\n          return visibleChildren.find(function(childView) {\n            return childView.id === item.id;\n          });\n        });\n        var currentIndex = children.findIndex(function(child) {\n          return child === view;\n        });\n        var dragHeight = getItemHeight(view);\n        var l = children.length;\n        var idx = l;\n        var childHeight = 0;\n        var childBottom = 0;\n        var childTop = 0;\n        for (var i = 0; i < l; i++) {\n          childHeight = getItemHeight(children[i]);\n          childTop = childBottom;\n          childBottom = childTop + childHeight;\n          if (dragPosition.y < childBottom) {\n            if (currentIndex > i) {\n              if (dragPosition.y < childTop + dragHeight) {\n                idx = i;\n                break;\n              }\n              continue;\n            }\n            idx = i;\n            break;\n          }\n        }\n        return idx;\n      }\n\n      // get new index\n    };\n    var index = cols > 1 ? location.getGridIndex() : location.getColIndex();\n    root.dispatch('MOVE_ITEM', { query: view, index: index });\n\n    // if the index of the item changed, dispatch reorder action\n    var currentIndex = dragState.getIndex();\n\n    if (currentIndex === undefined || currentIndex !== index) {\n      dragState.setIndex(index);\n\n      if (currentIndex === undefined) return;\n\n      root.dispatch('DID_REORDER_ITEMS', {\n        items: root.query('GET_ACTIVE_ITEMS'),\n        origin: oldIndex,\n        target: index\n      });\n    }\n  };\n\n  /**\n   * Setup action routes\n   */\n  var route$2 = createRoute({\n    DID_ADD_ITEM: addItemView,\n    DID_REMOVE_ITEM: removeItemView,\n    DID_DRAG_ITEM: dragItem\n  });\n\n  /**\n   * Write to view\n   * @param root\n   * @param actions\n   * @param props\n   */\n  var write$5 = function write(_ref5) {\n    var root = _ref5.root,\n      props = _ref5.props,\n      actions = _ref5.actions,\n      shouldOptimize = _ref5.shouldOptimize;\n\n    // route actions\n    route$2({ root: root, props: props, actions: actions });\n    var dragCoordinates = props.dragCoordinates;\n\n    // available space on horizontal axis\n    var horizontalSpace = root.rect.element.width;\n\n    // only draw children that have dimensions\n    var visibleChildren = root.childViews.filter(function(child) {\n      return child.rect.element.height;\n    });\n\n    // sort based on current active items\n    var children = root\n      .query('GET_ACTIVE_ITEMS')\n      .map(function(item) {\n        return visibleChildren.find(function(child) {\n          return child.id === item.id;\n        });\n      })\n      .filter(function(item) {\n        return item;\n      });\n\n    // get index\n    var dragIndex = dragCoordinates\n      ? getItemIndexByPosition(root, children, dragCoordinates)\n      : null;\n\n    // add index is used to reserve the dropped/added item index till the actual item is rendered\n    var addIndex = root.ref.addIndex || null;\n\n    // add index no longer needed till possibly next draw\n    root.ref.addIndex = null;\n\n    var dragIndexOffset = 0;\n    var removeIndexOffset = 0;\n    var addIndexOffset = 0;\n\n    if (children.length === 0) return;\n\n    var childRect = children[0].rect.element;\n    var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;\n    var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;\n    var itemWidth = childRect.width + itemHorizontalMargin;\n    var itemHeight = childRect.height + itemVerticalMargin;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth);\n\n    // stack\n    if (itemsPerRow === 1) {\n      var offsetY = 0;\n      var dragOffset = 0;\n\n      children.forEach(function(child, index) {\n        if (dragIndex) {\n          var dist = index - dragIndex;\n          if (dist === -2) {\n            dragOffset = -itemVerticalMargin * 0.25;\n          } else if (dist === -1) {\n            dragOffset = -itemVerticalMargin * 0.75;\n          } else if (dist === 0) {\n            dragOffset = itemVerticalMargin * 0.75;\n          } else if (dist === 1) {\n            dragOffset = itemVerticalMargin * 0.25;\n          } else {\n            dragOffset = 0;\n          }\n        }\n\n        if (shouldOptimize) {\n          child.translateX = null;\n          child.translateY = null;\n        }\n\n        if (!child.markedForRemoval) {\n          moveItem(child, 0, offsetY + dragOffset);\n        }\n\n        var itemHeight = child.rect.element.height + itemVerticalMargin;\n\n        var visualHeight =\n          itemHeight * (child.markedForRemoval ? child.opacity : 1);\n\n        offsetY += visualHeight;\n      });\n    }\n    // grid\n    else {\n      var prevX = 0;\n      var prevY = 0;\n\n      children.forEach(function(child, index) {\n        if (index === dragIndex) {\n          dragIndexOffset = 1;\n        }\n\n        if (index === addIndex) {\n          addIndexOffset += 1;\n        }\n\n        if (child.markedForRemoval && child.opacity < 0.5) {\n          removeIndexOffset -= 1;\n        }\n\n        var visualIndex =\n          index + addIndexOffset + dragIndexOffset + removeIndexOffset;\n\n        var indexX = visualIndex % itemsPerRow;\n        var indexY = Math.floor(visualIndex / itemsPerRow);\n\n        var offsetX = indexX * itemWidth;\n        var offsetY = indexY * itemHeight;\n\n        var vectorX = Math.sign(offsetX - prevX);\n        var vectorY = Math.sign(offsetY - prevY);\n\n        prevX = offsetX;\n        prevY = offsetY;\n\n        if (child.markedForRemoval) return;\n\n        if (shouldOptimize) {\n          child.translateX = null;\n          child.translateY = null;\n        }\n\n        moveItem(child, offsetX, offsetY, vectorX, vectorY);\n      });\n    }\n  };\n\n  /**\n   * Filters actions that are meant specifically for a certain child of the list\n   * @param child\n   * @param actions\n   */\n  var filterSetItemActions = function filterSetItemActions(child, actions) {\n    return actions.filter(function(action) {\n      // if action has an id, filter out actions that don't have this child id\n      if (action.data && action.data.id) {\n        return child.id === action.data.id;\n      }\n\n      // allow all other actions\n      return true;\n    });\n  };\n\n  var list = createView({\n    create: create$8,\n    write: write$5,\n    tag: 'ul',\n    name: 'list',\n    didWriteView: function didWriteView(_ref6) {\n      var root = _ref6.root;\n      root.childViews\n        .filter(function(view) {\n          return view.markedForRemoval && view.opacity === 0 && view.resting;\n        })\n        .forEach(function(view) {\n          view._destroy();\n          root.removeChildView(view);\n        });\n    },\n    filterFrameActionsForChild: filterSetItemActions,\n    mixins: {\n      apis: ['dragCoordinates']\n    }\n  });\n\n  var create$9 = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    root.ref.list = root.appendChildView(root.createChildView(list));\n    props.dragCoordinates = null;\n    props.overflowing = false;\n  };\n\n  var storeDragCoordinates = function storeDragCoordinates(_ref2) {\n    var root = _ref2.root,\n      props = _ref2.props,\n      action = _ref2.action;\n    if (!root.query('GET_ITEM_INSERT_LOCATION_FREEDOM')) return;\n    props.dragCoordinates = {\n      left: action.position.scopeLeft - root.ref.list.rect.element.left,\n      top:\n        action.position.scopeTop -\n        (root.rect.outer.top +\n          root.rect.element.marginTop +\n          root.rect.element.scrollTop)\n    };\n  };\n\n  var clearDragCoordinates = function clearDragCoordinates(_ref3) {\n    var props = _ref3.props;\n    props.dragCoordinates = null;\n  };\n\n  var route$3 = createRoute({\n    DID_DRAG: storeDragCoordinates,\n    DID_END_DRAG: clearDragCoordinates\n  });\n\n  var write$6 = function write(_ref4) {\n    var root = _ref4.root,\n      props = _ref4.props,\n      actions = _ref4.actions;\n\n    // route actions\n    route$3({ root: root, props: props, actions: actions });\n\n    // current drag position\n    root.ref.list.dragCoordinates = props.dragCoordinates;\n\n    // if currently overflowing but no longer received overflow\n    if (props.overflowing && !props.overflow) {\n      props.overflowing = false;\n\n      // reset overflow state\n      root.element.dataset.state = '';\n      root.height = null;\n    }\n\n    // if is not overflowing currently but does receive overflow value\n    if (props.overflow) {\n      var newHeight = Math.round(props.overflow);\n      if (newHeight !== root.height) {\n        props.overflowing = true;\n        root.element.dataset.state = 'overflow';\n        root.height = newHeight;\n      }\n    }\n  };\n\n  var listScroller = createView({\n    create: create$9,\n    write: write$6,\n    name: 'list-scroller',\n    mixins: {\n      apis: ['overflow', 'dragCoordinates'],\n      styles: ['height', 'translateY'],\n      animations: {\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var attrToggle = function attrToggle(element, name, state) {\n    var enabledValue =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n    if (state) {\n      attr(element, name, enabledValue);\n    } else {\n      element.removeAttribute(name);\n    }\n  };\n\n  var resetFileInput = function resetFileInput(input) {\n    // no value, no need to reset\n    if (!input || input.value === '') {\n      return;\n    }\n\n    try {\n      // for modern browsers\n      input.value = '';\n    } catch (err) {}\n\n    // for IE10\n    if (input.value) {\n      // quickly append input to temp form and reset form\n      var form = createElement$1('form');\n      var parentNode = input.parentNode;\n      var ref = input.nextSibling;\n      form.appendChild(input);\n      form.reset();\n\n      // re-inject input where it originally was\n      if (ref) {\n        parentNode.insertBefore(input, ref);\n      } else {\n        parentNode.appendChild(input);\n      }\n    }\n  };\n\n  var create$a = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // set id so can be referenced from outside labels\n    root.element.id = 'filepond--browser-' + props.id;\n\n    // set name of element (is removed when a value is set)\n    attr(root.element, 'name', root.query('GET_NAME'));\n\n    // we have to link this element to the status element\n    attr(root.element, 'aria-controls', 'filepond--assistant-' + props.id);\n\n    // set label, we use labelled by as otherwise the screenreader does not read the \"browse\" text in the label (as it has tabindex: 0)\n    attr(root.element, 'aria-labelledby', 'filepond--drop-label-' + props.id);\n\n    // set configurable props\n    setAcceptedFileTypes({\n      root: root,\n      action: { value: root.query('GET_ACCEPTED_FILE_TYPES') }\n    });\n    toggleAllowMultiple({\n      root: root,\n      action: { value: root.query('GET_ALLOW_MULTIPLE') }\n    });\n    toggleDirectoryFilter({\n      root: root,\n      action: { value: root.query('GET_ALLOW_DIRECTORIES_ONLY') }\n    });\n    toggleDisabled({ root: root });\n    toggleRequired({\n      root: root,\n      action: { value: root.query('GET_REQUIRED') }\n    });\n    setCaptureMethod({\n      root: root,\n      action: { value: root.query('GET_CAPTURE_METHOD') }\n    });\n\n    // handle changes to the input field\n    root.ref.handleChange = function(e) {\n      if (!root.element.value) {\n        return;\n      }\n\n      // extract files and move value of webkitRelativePath path to _relativePath\n      var files = Array.from(root.element.files).map(function(file) {\n        file._relativePath = file.webkitRelativePath;\n        return file;\n      });\n\n      // we add a little delay so the OS file select window can move out of the way before we add our file\n      setTimeout(function() {\n        // load files\n        props.onload(files);\n\n        // reset input, it's just for exposing a method to drop files, should not retain any state\n        resetFileInput(root.element);\n      }, 250);\n    };\n\n    root.element.addEventListener('change', root.ref.handleChange);\n  };\n\n  var setAcceptedFileTypes = function setAcceptedFileTypes(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    if (!root.query('GET_ALLOW_SYNC_ACCEPT_ATTRIBUTE')) return;\n    attrToggle(\n      root.element,\n      'accept',\n      !!action.value,\n      action.value ? action.value.join(',') : ''\n    );\n  };\n\n  var toggleAllowMultiple = function toggleAllowMultiple(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    attrToggle(root.element, 'multiple', action.value);\n  };\n\n  var toggleDirectoryFilter = function toggleDirectoryFilter(_ref4) {\n    var root = _ref4.root,\n      action = _ref4.action;\n    attrToggle(root.element, 'webkitdirectory', action.value);\n  };\n\n  var toggleDisabled = function toggleDisabled(_ref5) {\n    var root = _ref5.root;\n    var isDisabled = root.query('GET_DISABLED');\n    var doesAllowBrowse = root.query('GET_ALLOW_BROWSE');\n    var disableField = isDisabled || !doesAllowBrowse;\n    attrToggle(root.element, 'disabled', disableField);\n  };\n\n  var toggleRequired = function toggleRequired(_ref6) {\n    var root = _ref6.root,\n      action = _ref6.action;\n    // want to remove required, always possible\n    if (!action.value) {\n      attrToggle(root.element, 'required', false);\n    }\n    // if want to make required, only possible when zero items\n    else if (root.query('GET_TOTAL_ITEMS') === 0) {\n      attrToggle(root.element, 'required', true);\n    }\n  };\n\n  var setCaptureMethod = function setCaptureMethod(_ref7) {\n    var root = _ref7.root,\n      action = _ref7.action;\n    attrToggle(\n      root.element,\n      'capture',\n      !!action.value,\n      action.value === true ? '' : action.value\n    );\n  };\n\n  var updateRequiredStatus = function updateRequiredStatus(_ref8) {\n    var root = _ref8.root;\n    var element = root.element;\n    // always remove the required attribute when more than zero items\n    if (root.query('GET_TOTAL_ITEMS') > 0) {\n      attrToggle(element, 'required', false);\n      attrToggle(element, 'name', false);\n    } else {\n      // add name attribute\n      attrToggle(element, 'name', true, root.query('GET_NAME'));\n\n      // remove any validation messages\n      var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');\n      if (shouldCheckValidity) {\n        element.setCustomValidity('');\n      }\n\n      // we only add required if the field has been deemed required\n      if (root.query('GET_REQUIRED')) {\n        attrToggle(element, 'required', true);\n      }\n    }\n  };\n\n  var updateFieldValidityStatus = function updateFieldValidityStatus(_ref9) {\n    var root = _ref9.root;\n    var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');\n    if (!shouldCheckValidity) return;\n    root.element.setCustomValidity(root.query('GET_LABEL_INVALID_FIELD'));\n  };\n\n  var browser = createView({\n    tag: 'input',\n    name: 'browser',\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    attributes: {\n      type: 'file'\n    },\n\n    create: create$a,\n    destroy: function destroy(_ref10) {\n      var root = _ref10.root;\n      root.element.removeEventListener('change', root.ref.handleChange);\n    },\n    write: createRoute({\n      DID_LOAD_ITEM: updateRequiredStatus,\n      DID_REMOVE_ITEM: updateRequiredStatus,\n      DID_THROW_ITEM_INVALID: updateFieldValidityStatus,\n\n      DID_SET_DISABLED: toggleDisabled,\n      DID_SET_ALLOW_BROWSE: toggleDisabled,\n      DID_SET_ALLOW_DIRECTORIES_ONLY: toggleDirectoryFilter,\n      DID_SET_ALLOW_MULTIPLE: toggleAllowMultiple,\n      DID_SET_ACCEPTED_FILE_TYPES: setAcceptedFileTypes,\n      DID_SET_CAPTURE_METHOD: setCaptureMethod,\n      DID_SET_REQUIRED: toggleRequired\n    })\n  });\n\n  var Key = {\n    ENTER: 13,\n    SPACE: 32\n  };\n\n  var create$b = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // create the label and link it to the file browser\n    var label = createElement$1('label');\n    attr(label, 'for', 'filepond--browser-' + props.id);\n\n    // use for labeling file input (aria-labelledby on file input)\n    attr(label, 'id', 'filepond--drop-label-' + props.id);\n\n    // hide the label for screenreaders, the input element will read the contents of the label when it's focussed. If we don't set aria-hidden the screenreader will also navigate the contents of the label separately from the input.\n    attr(label, 'aria-hidden', 'true');\n\n    // handle keys\n    root.ref.handleKeyDown = function(e) {\n      var isActivationKey = e.keyCode === Key.ENTER || e.keyCode === Key.SPACE;\n      if (!isActivationKey) return;\n      // stops from triggering the element a second time\n      e.preventDefault();\n\n      // click link (will then in turn activate file input)\n      root.ref.label.click();\n    };\n\n    root.ref.handleClick = function(e) {\n      var isLabelClick = e.target === label || label.contains(e.target);\n\n      // don't want to click twice\n      if (isLabelClick) return;\n\n      // click link (will then in turn activate file input)\n      root.ref.label.click();\n    };\n\n    // attach events\n    label.addEventListener('keydown', root.ref.handleKeyDown);\n    root.element.addEventListener('click', root.ref.handleClick);\n\n    // update\n    updateLabelValue(label, props.caption);\n\n    // add!\n    root.appendChild(label);\n    root.ref.label = label;\n  };\n\n  var updateLabelValue = function updateLabelValue(label, value) {\n    label.innerHTML = value;\n    var clickable = label.querySelector('.filepond--label-action');\n    if (clickable) {\n      attr(clickable, 'tabindex', '0');\n    }\n    return value;\n  };\n\n  var dropLabel = createView({\n    name: 'drop-label',\n    ignoreRect: true,\n    create: create$b,\n    destroy: function destroy(_ref2) {\n      var root = _ref2.root;\n      root.ref.label.addEventListener('keydown', root.ref.handleKeyDown);\n      root.element.removeEventListener('click', root.ref.handleClick);\n    },\n    write: createRoute({\n      DID_SET_LABEL_IDLE: function DID_SET_LABEL_IDLE(_ref3) {\n        var root = _ref3.root,\n          action = _ref3.action;\n        updateLabelValue(root.ref.label, action.value);\n      }\n    }),\n\n    mixins: {\n      styles: ['opacity', 'translateX', 'translateY'],\n      animations: {\n        opacity: { type: 'tween', duration: 150 },\n        translateX: 'spring',\n        translateY: 'spring'\n      }\n    }\n  });\n\n  var blob = createView({\n    name: 'drip-blob',\n    ignoreRect: true,\n    mixins: {\n      styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],\n      animations: {\n        scaleX: 'spring',\n        scaleY: 'spring',\n        translateX: 'spring',\n        translateY: 'spring',\n        opacity: { type: 'tween', duration: 250 }\n      }\n    }\n  });\n\n  var addBlob = function addBlob(_ref) {\n    var root = _ref.root;\n    var centerX = root.rect.element.width * 0.5;\n    var centerY = root.rect.element.height * 0.5;\n\n    root.ref.blob = root.appendChildView(\n      root.createChildView(blob, {\n        opacity: 0,\n        scaleX: 2.5,\n        scaleY: 2.5,\n        translateX: centerX,\n        translateY: centerY\n      })\n    );\n  };\n\n  var moveBlob = function moveBlob(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    if (!root.ref.blob) {\n      addBlob({ root: root });\n      return;\n    }\n\n    root.ref.blob.translateX = action.position.scopeLeft;\n    root.ref.blob.translateY = action.position.scopeTop;\n    root.ref.blob.scaleX = 1;\n    root.ref.blob.scaleY = 1;\n    root.ref.blob.opacity = 1;\n  };\n\n  var hideBlob = function hideBlob(_ref3) {\n    var root = _ref3.root;\n    if (!root.ref.blob) {\n      return;\n    }\n    root.ref.blob.opacity = 0;\n  };\n\n  var explodeBlob = function explodeBlob(_ref4) {\n    var root = _ref4.root;\n    if (!root.ref.blob) {\n      return;\n    }\n    root.ref.blob.scaleX = 2.5;\n    root.ref.blob.scaleY = 2.5;\n    root.ref.blob.opacity = 0;\n  };\n\n  var write$7 = function write(_ref5) {\n    var root = _ref5.root,\n      props = _ref5.props,\n      actions = _ref5.actions;\n    route$4({ root: root, props: props, actions: actions });\n    var blob = root.ref.blob;\n\n    if (actions.length === 0 && blob && blob.opacity === 0) {\n      root.removeChildView(blob);\n      root.ref.blob = null;\n    }\n  };\n\n  var route$4 = createRoute({\n    DID_DRAG: moveBlob,\n    DID_DROP: explodeBlob,\n    DID_END_DRAG: hideBlob\n  });\n\n  var drip = createView({\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    name: 'drip',\n    write: write$7\n  });\n\n  var create$c = function create(_ref) {\n    var root = _ref.root;\n    return (root.ref.fields = {});\n  };\n\n  var getField = function getField(root, id) {\n    return root.ref.fields[id];\n  };\n\n  var syncFieldPositionsWithItems = function syncFieldPositionsWithItems(root) {\n    root.query('GET_ACTIVE_ITEMS').forEach(function(item) {\n      if (!root.ref.fields[item.id]) return;\n      root.element.appendChild(root.ref.fields[item.id]);\n    });\n  };\n\n  var didReorderItems = function didReorderItems(_ref2) {\n    var root = _ref2.root;\n    return syncFieldPositionsWithItems(root);\n  };\n\n  var didAddItem = function didAddItem(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    var dataContainer = createElement$1('input');\n    dataContainer.type = 'hidden';\n    dataContainer.name = root.query('GET_NAME');\n    dataContainer.disabled = root.query('GET_DISABLED');\n    root.ref.fields[action.id] = dataContainer;\n    syncFieldPositionsWithItems(root);\n  };\n\n  var didLoadItem$1 = function didLoadItem(_ref4) {\n    var root = _ref4.root,\n      action = _ref4.action;\n    var field = getField(root, action.id);\n    if (!field || action.serverFileReference === null) return;\n    field.value = action.serverFileReference;\n  };\n\n  var didSetDisabled = function didSetDisabled(_ref5) {\n    var root = _ref5.root;\n    root.element.disabled = root.query('GET_DISABLED');\n  };\n\n  var didRemoveItem = function didRemoveItem(_ref6) {\n    var root = _ref6.root,\n      action = _ref6.action;\n    var field = getField(root, action.id);\n    if (!field) return;\n    field.parentNode.removeChild(field);\n    delete root.ref.fields[action.id];\n  };\n\n  var didDefineValue = function didDefineValue(_ref7) {\n    var root = _ref7.root,\n      action = _ref7.action;\n    var field = getField(root, action.id);\n    if (!field) return;\n    if (action.value === null) {\n      field.removeAttribute('value');\n    } else {\n      field.value = action.value;\n    }\n    syncFieldPositionsWithItems(root);\n  };\n\n  var write$8 = createRoute({\n    DID_SET_DISABLED: didSetDisabled,\n    DID_ADD_ITEM: didAddItem,\n    DID_LOAD_ITEM: didLoadItem$1,\n    DID_REMOVE_ITEM: didRemoveItem,\n    DID_DEFINE_VALUE: didDefineValue,\n    DID_REORDER_ITEMS: didReorderItems,\n    DID_SORT_ITEMS: didReorderItems\n  });\n\n  var data = createView({\n    tag: 'fieldset',\n    name: 'data',\n    create: create$c,\n    write: write$8,\n    ignoreRect: true\n  });\n\n  var getRootNode = function getRootNode(element) {\n    return 'getRootNode' in element ? element.getRootNode() : document;\n  };\n\n  var images = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'tiff'];\n  var text$1 = ['css', 'csv', 'html', 'txt'];\n  var map = {\n    zip: 'zip|compressed',\n    epub: 'application/epub+zip'\n  };\n\n  var guesstimateMimeType = function guesstimateMimeType() {\n    var extension =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    extension = extension.toLowerCase();\n    if (images.includes(extension)) {\n      return (\n        'image/' +\n        (extension === 'jpg'\n          ? 'jpeg'\n          : extension === 'svg'\n          ? 'svg+xml'\n          : extension)\n      );\n    }\n    if (text$1.includes(extension)) {\n      return 'text/' + extension;\n    }\n\n    return map[extension] || '';\n  };\n\n  var requestDataTransferItems = function requestDataTransferItems(\n    dataTransfer\n  ) {\n    return new Promise(function(resolve, reject) {\n      // try to get links from transfer, if found we'll exit immidiately (unless a file is in the dataTransfer as well, this is because Firefox could represent the file as a URL and a file object at the same time)\n      var links = getLinks(dataTransfer);\n      if (links.length && !hasFiles(dataTransfer)) {\n        return resolve(links);\n      }\n      // try to get files from the transfer\n      getFiles(dataTransfer).then(resolve);\n    });\n  };\n\n  /**\n   * Test if datatransfer has files\n   */\n  var hasFiles = function hasFiles(dataTransfer) {\n    if (dataTransfer.files) return dataTransfer.files.length > 0;\n    return false;\n  };\n\n  /**\n   * Extracts files from a DataTransfer object\n   */\n  var getFiles = function getFiles(dataTransfer) {\n    return new Promise(function(resolve, reject) {\n      // get the transfer items as promises\n      var promisedFiles = (dataTransfer.items\n        ? Array.from(dataTransfer.items)\n        : []\n      )\n        // only keep file system items (files and directories)\n        .filter(function(item) {\n          return isFileSystemItem(item);\n        })\n\n        // map each item to promise\n        .map(function(item) {\n          return getFilesFromItem(item);\n        });\n\n      // if is empty, see if we can extract some info from the files property as a fallback\n      if (!promisedFiles.length) {\n        // TODO: test for directories (should not be allowed)\n        // Use FileReader, problem is that the files property gets lost in the process\n        resolve(dataTransfer.files ? Array.from(dataTransfer.files) : []);\n        return;\n      }\n\n      // done!\n      Promise.all(promisedFiles)\n        .then(function(returnedFileGroups) {\n          // flatten groups\n          var files = [];\n          returnedFileGroups.forEach(function(group) {\n            files.push.apply(files, group);\n          });\n\n          // done (filter out empty files)!\n          resolve(\n            files\n              .filter(function(file) {\n                return file;\n              })\n              .map(function(file) {\n                if (!file._relativePath)\n                  file._relativePath = file.webkitRelativePath;\n                return file;\n              })\n          );\n        })\n        .catch(console.error);\n    });\n  };\n\n  var isFileSystemItem = function isFileSystemItem(item) {\n    if (isEntry(item)) {\n      var entry = getAsEntry(item);\n      if (entry) {\n        return entry.isFile || entry.isDirectory;\n      }\n    }\n    return item.kind === 'file';\n  };\n\n  var getFilesFromItem = function getFilesFromItem(item) {\n    return new Promise(function(resolve, reject) {\n      if (isDirectoryEntry(item)) {\n        getFilesInDirectory(getAsEntry(item))\n          .then(resolve)\n          .catch(reject);\n        return;\n      }\n\n      resolve([item.getAsFile()]);\n    });\n  };\n\n  var getFilesInDirectory = function getFilesInDirectory(entry) {\n    return new Promise(function(resolve, reject) {\n      var files = [];\n\n      // the total entries to read\n      var dirCounter = 0;\n      var fileCounter = 0;\n\n      var resolveIfDone = function resolveIfDone() {\n        if (fileCounter === 0 && dirCounter === 0) {\n          resolve(files);\n        }\n      };\n\n      // the recursive function\n      var readEntries = function readEntries(dirEntry) {\n        dirCounter++;\n\n        var directoryReader = dirEntry.createReader();\n\n        // directories are returned in batches, we need to process all batches before we're done\n        var readBatch = function readBatch() {\n          directoryReader.readEntries(function(entries) {\n            if (entries.length === 0) {\n              dirCounter--;\n              resolveIfDone();\n              return;\n            }\n\n            entries.forEach(function(entry) {\n              // recursively read more directories\n              if (entry.isDirectory) {\n                readEntries(entry);\n              } else {\n                // read as file\n                fileCounter++;\n\n                entry.file(function(file) {\n                  var correctedFile = correctMissingFileType(file);\n                  if (entry.fullPath)\n                    correctedFile._relativePath = entry.fullPath;\n                  files.push(correctedFile);\n                  fileCounter--;\n                  resolveIfDone();\n                });\n              }\n            });\n\n            // try to get next batch of files\n            readBatch();\n          }, reject);\n        };\n\n        // read first batch of files\n        readBatch();\n      };\n\n      // go!\n      readEntries(entry);\n    });\n  };\n\n  var correctMissingFileType = function correctMissingFileType(file) {\n    if (file.type.length) return file;\n    var date = file.lastModifiedDate;\n    var name = file.name;\n    file = file.slice(\n      0,\n      file.size,\n      guesstimateMimeType(getExtensionFromFilename(file.name))\n    );\n    file.name = name;\n    file.lastModifiedDate = date;\n    return file;\n  };\n\n  var isDirectoryEntry = function isDirectoryEntry(item) {\n    return isEntry(item) && (getAsEntry(item) || {}).isDirectory;\n  };\n\n  var isEntry = function isEntry(item) {\n    return 'webkitGetAsEntry' in item;\n  };\n\n  var getAsEntry = function getAsEntry(item) {\n    return item.webkitGetAsEntry();\n  };\n\n  /**\n   * Extracts links from a DataTransfer object\n   */\n  var getLinks = function getLinks(dataTransfer) {\n    var links = [];\n    try {\n      // look in meta data property\n      links = getLinksFromTransferMetaData(dataTransfer);\n      if (links.length) {\n        return links;\n      }\n      links = getLinksFromTransferURLData(dataTransfer);\n    } catch (e) {\n      // nope nope nope (probably IE trouble)\n    }\n    return links;\n  };\n\n  var getLinksFromTransferURLData = function getLinksFromTransferURLData(\n    dataTransfer\n  ) {\n    var data = dataTransfer.getData('url');\n    if (typeof data === 'string' && data.length) {\n      return [data];\n    }\n    return [];\n  };\n\n  var getLinksFromTransferMetaData = function getLinksFromTransferMetaData(\n    dataTransfer\n  ) {\n    var data = dataTransfer.getData('text/html');\n    if (typeof data === 'string' && data.length) {\n      var matches = data.match(/src\\s*=\\s*\"(.+?)\"/);\n      if (matches) {\n        return [matches[1]];\n      }\n    }\n    return [];\n  };\n\n  var dragNDropObservers = [];\n\n  var eventPosition = function eventPosition(e) {\n    return {\n      pageLeft: e.pageX,\n      pageTop: e.pageY,\n      scopeLeft: e.offsetX || e.layerX,\n      scopeTop: e.offsetY || e.layerY\n    };\n  };\n\n  var createDragNDropClient = function createDragNDropClient(\n    element,\n    scopeToObserve,\n    filterElement\n  ) {\n    var observer = getDragNDropObserver(scopeToObserve);\n\n    var client = {\n      element: element,\n      filterElement: filterElement,\n      state: null,\n      ondrop: function ondrop() {},\n      onenter: function onenter() {},\n      ondrag: function ondrag() {},\n      onexit: function onexit() {},\n      onload: function onload() {},\n      allowdrop: function allowdrop() {}\n    };\n\n    client.destroy = observer.addListener(client);\n\n    return client;\n  };\n\n  var getDragNDropObserver = function getDragNDropObserver(element) {\n    // see if already exists, if so, return\n    var observer = dragNDropObservers.find(function(item) {\n      return item.element === element;\n    });\n    if (observer) {\n      return observer;\n    }\n\n    // create new observer, does not yet exist for this element\n    var newObserver = createDragNDropObserver(element);\n    dragNDropObservers.push(newObserver);\n    return newObserver;\n  };\n\n  var createDragNDropObserver = function createDragNDropObserver(element) {\n    var clients = [];\n\n    var routes = {\n      dragenter: dragenter,\n      dragover: dragover,\n      dragleave: dragleave,\n      drop: drop\n    };\n\n    var handlers = {};\n\n    forin(routes, function(event, createHandler) {\n      handlers[event] = createHandler(element, clients);\n      element.addEventListener(event, handlers[event], false);\n    });\n\n    var observer = {\n      element: element,\n      addListener: function addListener(client) {\n        // add as client\n        clients.push(client);\n\n        // return removeListener function\n        return function() {\n          // remove client\n          clients.splice(clients.indexOf(client), 1);\n\n          // if no more clients, clean up observer\n          if (clients.length === 0) {\n            dragNDropObservers.splice(dragNDropObservers.indexOf(observer), 1);\n\n            forin(routes, function(event) {\n              element.removeEventListener(event, handlers[event], false);\n            });\n          }\n        };\n      }\n    };\n\n    return observer;\n  };\n\n  var elementFromPoint = function elementFromPoint(root, point) {\n    if (!('elementFromPoint' in root)) {\n      root = document;\n    }\n    return root.elementFromPoint(point.x, point.y);\n  };\n\n  var isEventTarget = function isEventTarget(e, target) {\n    // get root\n    var root = getRootNode(target);\n\n    // get element at position\n    // if root is not actual shadow DOM and does not have elementFromPoint method, use the one on document\n    var elementAtPosition = elementFromPoint(root, {\n      x: e.pageX - window.pageXOffset,\n      y: e.pageY - window.pageYOffset\n    });\n\n    // test if target is the element or if one of its children is\n    return elementAtPosition === target || target.contains(elementAtPosition);\n  };\n\n  var initialTarget = null;\n\n  var setDropEffect = function setDropEffect(dataTransfer, effect) {\n    // is in try catch as IE11 will throw error if not\n    try {\n      dataTransfer.dropEffect = effect;\n    } catch (e) {}\n  };\n\n  var dragenter = function dragenter(root, clients) {\n    return function(e) {\n      e.preventDefault();\n\n      initialTarget = e.target;\n\n      clients.forEach(function(client) {\n        var element = client.element,\n          onenter = client.onenter;\n\n        if (isEventTarget(e, element)) {\n          client.state = 'enter';\n\n          // fire enter event\n          onenter(eventPosition(e));\n        }\n      });\n    };\n  };\n\n  var dragover = function dragover(root, clients) {\n    return function(e) {\n      e.preventDefault();\n\n      var dataTransfer = e.dataTransfer;\n\n      requestDataTransferItems(dataTransfer).then(function(items) {\n        var overDropTarget = false;\n\n        clients.some(function(client) {\n          var filterElement = client.filterElement,\n            element = client.element,\n            onenter = client.onenter,\n            onexit = client.onexit,\n            ondrag = client.ondrag,\n            allowdrop = client.allowdrop;\n\n          // by default we can drop\n          setDropEffect(dataTransfer, 'copy');\n\n          // allow transfer of these items\n          var allowsTransfer = allowdrop(items);\n\n          // only used when can be dropped on page\n          if (!allowsTransfer) {\n            setDropEffect(dataTransfer, 'none');\n            return;\n          }\n\n          // targetting this client\n          if (isEventTarget(e, element)) {\n            overDropTarget = true;\n\n            // had no previous state, means we are entering this client\n            if (client.state === null) {\n              client.state = 'enter';\n              onenter(eventPosition(e));\n              return;\n            }\n\n            // now over element (no matter if it allows the drop or not)\n            client.state = 'over';\n\n            // needs to allow transfer\n            if (filterElement && !allowsTransfer) {\n              setDropEffect(dataTransfer, 'none');\n              return;\n            }\n\n            // dragging\n            ondrag(eventPosition(e));\n          } else {\n            // should be over an element to drop\n            if (filterElement && !overDropTarget) {\n              setDropEffect(dataTransfer, 'none');\n            }\n\n            // might have just left this client?\n            if (client.state) {\n              client.state = null;\n              onexit(eventPosition(e));\n            }\n          }\n        });\n      });\n    };\n  };\n\n  var drop = function drop(root, clients) {\n    return function(e) {\n      e.preventDefault();\n\n      var dataTransfer = e.dataTransfer;\n\n      requestDataTransferItems(dataTransfer).then(function(items) {\n        clients.forEach(function(client) {\n          var filterElement = client.filterElement,\n            element = client.element,\n            ondrop = client.ondrop,\n            onexit = client.onexit,\n            allowdrop = client.allowdrop;\n\n          client.state = null;\n\n          // if we're filtering on element we need to be over the element to drop\n          if (filterElement && !isEventTarget(e, element)) return;\n\n          // no transfer for this client\n          if (!allowdrop(items)) return onexit(eventPosition(e));\n\n          // we can drop these items on this client\n          ondrop(eventPosition(e), items);\n        });\n      });\n    };\n  };\n\n  var dragleave = function dragleave(root, clients) {\n    return function(e) {\n      if (initialTarget !== e.target) {\n        return;\n      }\n\n      clients.forEach(function(client) {\n        var onexit = client.onexit;\n\n        client.state = null;\n\n        onexit(eventPosition(e));\n      });\n    };\n  };\n\n  var createHopper = function createHopper(scope, validateItems, options) {\n    // is now hopper scope\n    scope.classList.add('filepond--hopper');\n\n    // shortcuts\n    var catchesDropsOnPage = options.catchesDropsOnPage,\n      requiresDropOnElement = options.requiresDropOnElement,\n      _options$filterItems = options.filterItems,\n      filterItems =\n        _options$filterItems === void 0\n          ? function(items) {\n              return items;\n            }\n          : _options$filterItems;\n\n    // create a dnd client\n    var client = createDragNDropClient(\n      scope,\n      catchesDropsOnPage ? document.documentElement : scope,\n      requiresDropOnElement\n    );\n\n    // current client state\n    var lastState = '';\n    var currentState = '';\n\n    // determines if a file may be dropped\n    client.allowdrop = function(items) {\n      // TODO: if we can, throw error to indicate the items cannot by dropped\n\n      return validateItems(filterItems(items));\n    };\n\n    client.ondrop = function(position, items) {\n      var filteredItems = filterItems(items);\n\n      if (!validateItems(filteredItems)) {\n        api.ondragend(position);\n        return;\n      }\n\n      currentState = 'drag-drop';\n\n      api.onload(filteredItems, position);\n    };\n\n    client.ondrag = function(position) {\n      api.ondrag(position);\n    };\n\n    client.onenter = function(position) {\n      currentState = 'drag-over';\n\n      api.ondragstart(position);\n    };\n\n    client.onexit = function(position) {\n      currentState = 'drag-exit';\n\n      api.ondragend(position);\n    };\n\n    var api = {\n      updateHopperState: function updateHopperState() {\n        if (lastState !== currentState) {\n          scope.dataset.hopperState = currentState;\n          lastState = currentState;\n        }\n      },\n      onload: function onload() {},\n      ondragstart: function ondragstart() {},\n      ondrag: function ondrag() {},\n      ondragend: function ondragend() {},\n      destroy: function destroy() {\n        // destroy client\n        client.destroy();\n      }\n    };\n\n    return api;\n  };\n\n  var listening = false;\n  var listeners$1 = [];\n\n  var handlePaste = function handlePaste(e) {\n    // if is pasting in input or textarea and the target is outside of a filepond scope, ignore\n    var activeEl = document.activeElement;\n    if (activeEl && /textarea|input/i.test(activeEl.nodeName)) {\n      // test textarea or input is contained in filepond root\n      var inScope = false;\n      var element = activeEl;\n      while (element !== document.body) {\n        if (element.classList.contains('filepond--root')) {\n          inScope = true;\n          break;\n        }\n        element = element.parentNode;\n      }\n\n      if (!inScope) return;\n    }\n\n    requestDataTransferItems(e.clipboardData).then(function(files) {\n      // no files received\n      if (!files.length) {\n        return;\n      }\n\n      // notify listeners of received files\n      listeners$1.forEach(function(listener) {\n        return listener(files);\n      });\n    });\n  };\n\n  var listen = function listen(cb) {\n    // can't add twice\n    if (listeners$1.includes(cb)) {\n      return;\n    }\n\n    // add initial listener\n    listeners$1.push(cb);\n\n    // setup paste listener for entire page\n    if (listening) {\n      return;\n    }\n\n    listening = true;\n    document.addEventListener('paste', handlePaste);\n  };\n\n  var unlisten = function unlisten(listener) {\n    arrayRemove(listeners$1, listeners$1.indexOf(listener));\n\n    // clean up\n    if (listeners$1.length === 0) {\n      document.removeEventListener('paste', handlePaste);\n      listening = false;\n    }\n  };\n\n  var createPaster = function createPaster() {\n    var cb = function cb(files) {\n      api.onload(files);\n    };\n\n    var api = {\n      destroy: function destroy() {\n        unlisten(cb);\n      },\n      onload: function onload() {}\n    };\n\n    listen(cb);\n\n    return api;\n  };\n\n  /**\n   * Creates the file view\n   */\n  var create$d = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n    root.element.id = 'filepond--assistant-' + props.id;\n    attr(root.element, 'role', 'status');\n    attr(root.element, 'aria-live', 'polite');\n    attr(root.element, 'aria-relevant', 'additions');\n  };\n\n  var addFilesNotificationTimeout = null;\n  var notificationClearTimeout = null;\n\n  var filenames = [];\n\n  var assist = function assist(root, message) {\n    root.element.textContent = message;\n  };\n\n  var clear$1 = function clear(root) {\n    root.element.textContent = '';\n  };\n\n  var listModified = function listModified(root, filename, label) {\n    var total = root.query('GET_TOTAL_ITEMS');\n    assist(\n      root,\n      label +\n        ' ' +\n        filename +\n        ', ' +\n        total +\n        ' ' +\n        (total === 1\n          ? root.query('GET_LABEL_FILE_COUNT_SINGULAR')\n          : root.query('GET_LABEL_FILE_COUNT_PLURAL'))\n    );\n\n    // clear group after set amount of time so the status is not read twice\n    clearTimeout(notificationClearTimeout);\n    notificationClearTimeout = setTimeout(function() {\n      clear$1(root);\n    }, 1500);\n  };\n\n  var isUsingFilePond = function isUsingFilePond(root) {\n    return root.element.parentNode.contains(document.activeElement);\n  };\n\n  var itemAdded = function itemAdded(_ref2) {\n    var root = _ref2.root,\n      action = _ref2.action;\n    if (!isUsingFilePond(root)) {\n      return;\n    }\n\n    root.element.textContent = '';\n    var item = root.query('GET_ITEM', action.id);\n    filenames.push(item.filename);\n\n    clearTimeout(addFilesNotificationTimeout);\n    addFilesNotificationTimeout = setTimeout(function() {\n      listModified(\n        root,\n        filenames.join(', '),\n        root.query('GET_LABEL_FILE_ADDED')\n      );\n\n      filenames.length = 0;\n    }, 750);\n  };\n\n  var itemRemoved = function itemRemoved(_ref3) {\n    var root = _ref3.root,\n      action = _ref3.action;\n    if (!isUsingFilePond(root)) {\n      return;\n    }\n\n    var item = action.item;\n    listModified(root, item.filename, root.query('GET_LABEL_FILE_REMOVED'));\n  };\n\n  var itemProcessed = function itemProcessed(_ref4) {\n    var root = _ref4.root,\n      action = _ref4.action;\n    // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file\n\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n    var label = root.query('GET_LABEL_FILE_PROCESSING_COMPLETE');\n\n    assist(root, filename + ' ' + label);\n  };\n\n  var itemProcessedUndo = function itemProcessedUndo(_ref5) {\n    var root = _ref5.root,\n      action = _ref5.action;\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n    var label = root.query('GET_LABEL_FILE_PROCESSING_ABORTED');\n\n    assist(root, filename + ' ' + label);\n  };\n\n  var itemError = function itemError(_ref6) {\n    var root = _ref6.root,\n      action = _ref6.action;\n    var item = root.query('GET_ITEM', action.id);\n    var filename = item.filename;\n\n    // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file\n\n    assist(root, action.status.main + ' ' + filename + ' ' + action.status.sub);\n  };\n\n  var assistant = createView({\n    create: create$d,\n    ignoreRect: true,\n    ignoreRectUpdate: true,\n    write: createRoute({\n      DID_LOAD_ITEM: itemAdded,\n      DID_REMOVE_ITEM: itemRemoved,\n      DID_COMPLETE_ITEM_PROCESSING: itemProcessed,\n\n      DID_ABORT_ITEM_PROCESSING: itemProcessedUndo,\n      DID_REVERT_ITEM_PROCESSING: itemProcessedUndo,\n\n      DID_THROW_ITEM_REMOVE_ERROR: itemError,\n      DID_THROW_ITEM_LOAD_ERROR: itemError,\n      DID_THROW_ITEM_INVALID: itemError,\n      DID_THROW_ITEM_PROCESSING_ERROR: itemError\n    }),\n\n    tag: 'span',\n    name: 'assistant'\n  });\n\n  var toCamels = function toCamels(string) {\n    var separator =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';\n    return string.replace(new RegExp(separator + '.', 'g'), function(sub) {\n      return sub.charAt(1).toUpperCase();\n    });\n  };\n\n  var debounce = function debounce(func) {\n    var interval =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 16;\n    var immidiateOnly =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    var last = Date.now();\n    var timeout = null;\n\n    return function() {\n      for (\n        var _len = arguments.length, args = new Array(_len), _key = 0;\n        _key < _len;\n        _key++\n      ) {\n        args[_key] = arguments[_key];\n      }\n      clearTimeout(timeout);\n\n      var dist = Date.now() - last;\n\n      var fn = function fn() {\n        last = Date.now();\n        func.apply(void 0, args);\n      };\n\n      if (dist < interval) {\n        // we need to delay by the difference between interval and dist\n        // for example: if distance is 10 ms and interval is 16 ms,\n        // we need to wait an additional 6ms before calling the function)\n        if (!immidiateOnly) {\n          timeout = setTimeout(fn, interval - dist);\n        }\n      } else {\n        // go!\n        fn();\n      }\n    };\n  };\n\n  var MAX_FILES_LIMIT = 1000000;\n\n  var prevent = function prevent(e) {\n    return e.preventDefault();\n  };\n\n  var create$e = function create(_ref) {\n    var root = _ref.root,\n      props = _ref.props;\n\n    // Add id\n    var id = root.query('GET_ID');\n    if (id) {\n      root.element.id = id;\n    }\n\n    // Add className\n    var className = root.query('GET_CLASS_NAME');\n    if (className) {\n      className\n        .split(' ')\n        .filter(function(name) {\n          return name.length;\n        })\n        .forEach(function(name) {\n          root.element.classList.add(name);\n        });\n    }\n\n    // Field label\n    root.ref.label = root.appendChildView(\n      root.createChildView(\n        dropLabel,\n        Object.assign({}, props, {\n          translateY: null,\n          caption: root.query('GET_LABEL_IDLE')\n        })\n      )\n    );\n\n    // List of items\n    root.ref.list = root.appendChildView(\n      root.createChildView(listScroller, { translateY: null })\n    );\n\n    // Background panel\n    root.ref.panel = root.appendChildView(\n      root.createChildView(panel, { name: 'panel-root' })\n    );\n\n    // Assistant notifies assistive tech when content changes\n    root.ref.assistant = root.appendChildView(\n      root.createChildView(assistant, Object.assign({}, props))\n    );\n\n    // Data\n    root.ref.data = root.appendChildView(\n      root.createChildView(data, Object.assign({}, props))\n    );\n\n    // Measure (tests if fixed height was set)\n    // DOCTYPE needs to be set for this to work\n    root.ref.measure = createElement$1('div');\n    root.ref.measure.style.height = '100%';\n    root.element.appendChild(root.ref.measure);\n\n    // information on the root height or fixed height status\n    root.ref.bounds = null;\n\n    // apply initial style properties\n    root\n      .query('GET_STYLES')\n      .filter(function(style) {\n        return !isEmpty(style.value);\n      })\n      .map(function(_ref2) {\n        var name = _ref2.name,\n          value = _ref2.value;\n        root.element.dataset[name] = value;\n      });\n\n    // determine if width changed\n    root.ref.widthPrevious = null;\n    root.ref.widthUpdated = debounce(function() {\n      root.ref.updateHistory = [];\n      root.dispatch('DID_RESIZE_ROOT');\n    }, 250);\n\n    // history of updates\n    root.ref.previousAspectRatio = null;\n    root.ref.updateHistory = [];\n\n    // prevent scrolling and zooming on iOS (only if supports pointer events, for then we can enable reorder)\n    var canHover = window.matchMedia('(pointer: fine) and (hover: hover)')\n      .matches;\n    var hasPointerEvents = 'PointerEvent' in window;\n    if (root.query('GET_ALLOW_REORDER') && hasPointerEvents && !canHover) {\n      root.element.addEventListener('touchmove', prevent, { passive: false });\n      root.element.addEventListener('gesturestart', prevent);\n    }\n  };\n\n  var write$9 = function write(_ref3) {\n    var root = _ref3.root,\n      props = _ref3.props,\n      actions = _ref3.actions;\n\n    // route actions\n    route$5({ root: root, props: props, actions: actions });\n\n    // apply style properties\n    actions\n      .filter(function(action) {\n        return /^DID_SET_STYLE_/.test(action.type);\n      })\n      .filter(function(action) {\n        return !isEmpty(action.data.value);\n      })\n      .map(function(_ref4) {\n        var type = _ref4.type,\n          data = _ref4.data;\n        var name = toCamels(type.substr(8).toLowerCase(), '_');\n        root.element.dataset[name] = data.value;\n        root.invalidateLayout();\n      });\n\n    if (root.rect.element.hidden) return;\n\n    if (root.rect.element.width !== root.ref.widthPrevious) {\n      root.ref.widthPrevious = root.rect.element.width;\n      root.ref.widthUpdated();\n    }\n\n    // get box bounds, we do this only once\n    var bounds = root.ref.bounds;\n    if (!bounds) {\n      bounds = root.ref.bounds = calculateRootBoundingBoxHeight(root);\n\n      // destroy measure element\n      root.element.removeChild(root.ref.measure);\n      root.ref.measure = null;\n    }\n\n    // get quick references to various high level parts of the upload tool\n    var _root$ref = root.ref,\n      hopper = _root$ref.hopper,\n      label = _root$ref.label,\n      list = _root$ref.list,\n      panel = _root$ref.panel;\n\n    // sets correct state to hopper scope\n    if (hopper) {\n      hopper.updateHopperState();\n    }\n\n    // bool to indicate if we're full or not\n    var aspectRatio = root.query('GET_PANEL_ASPECT_RATIO');\n    var isMultiItem = root.query('GET_ALLOW_MULTIPLE');\n    var totalItems = root.query('GET_TOTAL_ITEMS');\n    var maxItems = isMultiItem\n      ? root.query('GET_MAX_FILES') || MAX_FILES_LIMIT\n      : 1;\n    var atMaxCapacity = totalItems === maxItems;\n\n    // action used to add item\n    var addAction = actions.find(function(action) {\n      return action.type === 'DID_ADD_ITEM';\n    });\n\n    // if reached max capacity and we've just reached it\n    if (atMaxCapacity && addAction) {\n      // get interaction type\n      var interactionMethod = addAction.data.interactionMethod;\n\n      // hide label\n      label.opacity = 0;\n\n      if (isMultiItem) {\n        label.translateY = -40;\n      } else {\n        if (interactionMethod === InteractionMethod.API) {\n          label.translateX = 40;\n        } else if (interactionMethod === InteractionMethod.BROWSE) {\n          label.translateY = 40;\n        } else {\n          label.translateY = 30;\n        }\n      }\n    } else if (!atMaxCapacity) {\n      label.opacity = 1;\n      label.translateX = 0;\n      label.translateY = 0;\n    }\n\n    var listItemMargin = calculateListItemMargin(root);\n\n    var listHeight = calculateListHeight(root);\n\n    var labelHeight = label.rect.element.height;\n    var currentLabelHeight = !isMultiItem || atMaxCapacity ? 0 : labelHeight;\n\n    var listMarginTop = atMaxCapacity ? list.rect.element.marginTop : 0;\n    var listMarginBottom =\n      totalItems === 0 ? 0 : list.rect.element.marginBottom;\n\n    var visualHeight =\n      currentLabelHeight + listMarginTop + listHeight.visual + listMarginBottom;\n    var boundsHeight =\n      currentLabelHeight + listMarginTop + listHeight.bounds + listMarginBottom;\n\n    // link list to label bottom position\n    list.translateY =\n      Math.max(0, currentLabelHeight - list.rect.element.marginTop) -\n      listItemMargin.top;\n\n    if (aspectRatio) {\n      // fixed aspect ratio\n\n      // calculate height based on width\n      var width = root.rect.element.width;\n      var height = width * aspectRatio;\n\n      // clear history if aspect ratio has changed\n      if (aspectRatio !== root.ref.previousAspectRatio) {\n        root.ref.previousAspectRatio = aspectRatio;\n        root.ref.updateHistory = [];\n      }\n\n      // remember this width\n      var history = root.ref.updateHistory;\n      history.push(width);\n\n      var MAX_BOUNCES = 2;\n      if (history.length > MAX_BOUNCES * 2) {\n        var l = history.length;\n        var bottom = l - 10;\n        var bounces = 0;\n        for (var i = l; i >= bottom; i--) {\n          if (history[i] === history[i - 2]) {\n            bounces++;\n          }\n\n          if (bounces >= MAX_BOUNCES) {\n            // dont adjust height\n            return;\n          }\n        }\n      }\n\n      // fix height of panel so it adheres to aspect ratio\n      panel.scalable = false;\n      panel.height = height;\n\n      // available height for list\n      var listAvailableHeight =\n        // the height of the panel minus the label height\n        height -\n        currentLabelHeight -\n        // the room we leave open between the end of the list and the panel bottom\n        (listMarginBottom - listItemMargin.bottom) -\n        // if we're full we need to leave some room between the top of the panel and the list\n        (atMaxCapacity ? listMarginTop : 0);\n\n      if (listHeight.visual > listAvailableHeight) {\n        list.overflow = listAvailableHeight;\n      } else {\n        list.overflow = null;\n      }\n\n      // set container bounds (so pushes siblings downwards)\n      root.height = height;\n    } else if (bounds.fixedHeight) {\n      // fixed height\n\n      // fix height of panel\n      panel.scalable = false;\n\n      // available height for list\n      var _listAvailableHeight =\n        // the height of the panel minus the label height\n        bounds.fixedHeight -\n        currentLabelHeight -\n        // the room we leave open between the end of the list and the panel bottom\n        (listMarginBottom - listItemMargin.bottom) -\n        // if we're full we need to leave some room between the top of the panel and the list\n        (atMaxCapacity ? listMarginTop : 0);\n\n      // set list height\n      if (listHeight.visual > _listAvailableHeight) {\n        list.overflow = _listAvailableHeight;\n      } else {\n        list.overflow = null;\n      }\n\n      // no need to set container bounds as these are handles by CSS fixed height\n    } else if (bounds.cappedHeight) {\n      // max-height\n\n      // not a fixed height panel\n      var isCappedHeight = visualHeight >= bounds.cappedHeight;\n      var panelHeight = Math.min(bounds.cappedHeight, visualHeight);\n      panel.scalable = true;\n      panel.height = isCappedHeight\n        ? panelHeight\n        : panelHeight - listItemMargin.top - listItemMargin.bottom;\n\n      // available height for list\n      var _listAvailableHeight2 =\n        // the height of the panel minus the label height\n        panelHeight -\n        currentLabelHeight -\n        // the room we leave open between the end of the list and the panel bottom\n        (listMarginBottom - listItemMargin.bottom) -\n        // if we're full we need to leave some room between the top of the panel and the list\n        (atMaxCapacity ? listMarginTop : 0);\n\n      // set list height (if is overflowing)\n      if (\n        visualHeight > bounds.cappedHeight &&\n        listHeight.visual > _listAvailableHeight2\n      ) {\n        list.overflow = _listAvailableHeight2;\n      } else {\n        list.overflow = null;\n      }\n\n      // set container bounds (so pushes siblings downwards)\n      root.height = Math.min(\n        bounds.cappedHeight,\n        boundsHeight - listItemMargin.top - listItemMargin.bottom\n      );\n    } else {\n      // flexible height\n\n      // not a fixed height panel\n      var itemMargin =\n        totalItems > 0 ? listItemMargin.top + listItemMargin.bottom : 0;\n      panel.scalable = true;\n      panel.height = Math.max(labelHeight, visualHeight - itemMargin);\n\n      // set container bounds (so pushes siblings downwards)\n      root.height = Math.max(labelHeight, boundsHeight - itemMargin);\n    }\n  };\n\n  var calculateListItemMargin = function calculateListItemMargin(root) {\n    var item = root.ref.list.childViews[0].childViews[0];\n    return item\n      ? {\n          top: item.rect.element.marginTop,\n          bottom: item.rect.element.marginBottom\n        }\n      : {\n          top: 0,\n          bottom: 0\n        };\n  };\n\n  var calculateListHeight = function calculateListHeight(root) {\n    var visual = 0;\n    var bounds = 0;\n\n    // get file list reference\n    var scrollList = root.ref.list;\n    var itemList = scrollList.childViews[0];\n    var visibleChildren = itemList.childViews.filter(function(child) {\n      return child.rect.element.height;\n    });\n    var children = root\n      .query('GET_ACTIVE_ITEMS')\n      .map(function(item) {\n        return visibleChildren.find(function(child) {\n          return child.id === item.id;\n        });\n      })\n      .filter(function(item) {\n        return item;\n      });\n\n    // no children, done!\n    if (children.length === 0) return { visual: visual, bounds: bounds };\n\n    var horizontalSpace = itemList.rect.element.width;\n    var dragIndex = getItemIndexByPosition(\n      itemList,\n      children,\n      scrollList.dragCoordinates\n    );\n\n    var childRect = children[0].rect.element;\n\n    var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;\n    var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;\n\n    var itemWidth = childRect.width + itemHorizontalMargin;\n    var itemHeight = childRect.height + itemVerticalMargin;\n\n    var newItem = typeof dragIndex !== 'undefined' && dragIndex >= 0 ? 1 : 0;\n    var removedItem = children.find(function(child) {\n      return child.markedForRemoval && child.opacity < 0.45;\n    })\n      ? -1\n      : 0;\n    var verticalItemCount = children.length + newItem + removedItem;\n    var itemsPerRow = Math.round(horizontalSpace / itemWidth);\n\n    // stack\n    if (itemsPerRow === 1) {\n      children.forEach(function(item) {\n        var height = item.rect.element.height + itemVerticalMargin;\n        bounds += height;\n        visual += height * item.opacity;\n      });\n    }\n    // grid\n    else {\n      bounds = Math.ceil(verticalItemCount / itemsPerRow) * itemHeight;\n      visual = bounds;\n    }\n\n    return { visual: visual, bounds: bounds };\n  };\n\n  var calculateRootBoundingBoxHeight = function calculateRootBoundingBoxHeight(\n    root\n  ) {\n    var height = root.ref.measureHeight || null;\n    var cappedHeight = parseInt(root.style.maxHeight, 10) || null;\n    var fixedHeight = height === 0 ? null : height;\n\n    return {\n      cappedHeight: cappedHeight,\n      fixedHeight: fixedHeight\n    };\n  };\n\n  var exceedsMaxFiles = function exceedsMaxFiles(root, items) {\n    var allowReplace = root.query('GET_ALLOW_REPLACE');\n    var allowMultiple = root.query('GET_ALLOW_MULTIPLE');\n    var totalItems = root.query('GET_TOTAL_ITEMS');\n    var maxItems = root.query('GET_MAX_FILES');\n\n    // total amount of items being dragged\n    var totalBrowseItems = items.length;\n\n    // if does not allow multiple items and dragging more than one item\n    if (!allowMultiple && totalBrowseItems > 1) {\n      return true;\n    }\n\n    // limit max items to one if not allowed to drop multiple items\n    maxItems = allowMultiple ? maxItems : allowReplace ? maxItems : 1;\n\n    // no more room?\n    var hasMaxItems = isInt(maxItems);\n    if (hasMaxItems && totalItems + totalBrowseItems > maxItems) {\n      root.dispatch('DID_THROW_MAX_FILES', {\n        source: items,\n        error: createResponse('warning', 0, 'Max files')\n      });\n\n      return true;\n    }\n\n    return false;\n  };\n\n  var getDragIndex = function getDragIndex(list, children, position) {\n    var itemList = list.childViews[0];\n    return getItemIndexByPosition(itemList, children, {\n      left: position.scopeLeft - itemList.rect.element.left,\n      top:\n        position.scopeTop -\n        (list.rect.outer.top +\n          list.rect.element.marginTop +\n          list.rect.element.scrollTop)\n    });\n  };\n\n  /**\n   * Enable or disable file drop functionality\n   */\n  var toggleDrop = function toggleDrop(root) {\n    var isAllowed = root.query('GET_ALLOW_DROP');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n    if (enabled && !root.ref.hopper) {\n      var hopper = createHopper(\n        root.element,\n        function(items) {\n          // these files don't fit so stop here\n          if (exceedsMaxFiles(root, items)) return false;\n\n          // allow quick validation of dropped items\n          var beforeDropFile =\n            root.query('GET_BEFORE_DROP_FILE') ||\n            function() {\n              return true;\n            };\n\n          // all items should be validated by all filters as valid\n          var dropValidation = root.query('GET_DROP_VALIDATION');\n          return dropValidation\n            ? items.every(function(item) {\n                return (\n                  applyFilters('ALLOW_HOPPER_ITEM', item, {\n                    query: root.query\n                  }).every(function(result) {\n                    return result === true;\n                  }) && beforeDropFile(item)\n                );\n              })\n            : true;\n        },\n        {\n          filterItems: function filterItems(items) {\n            var ignoredFiles = root.query('GET_IGNORED_FILES');\n            return items.filter(function(item) {\n              if (isFile(item)) {\n                return !ignoredFiles.includes(item.name.toLowerCase());\n              }\n              return true;\n            });\n          },\n          catchesDropsOnPage: root.query('GET_DROP_ON_PAGE'),\n          requiresDropOnElement: root.query('GET_DROP_ON_ELEMENT')\n        }\n      );\n\n      hopper.onload = function(items, position) {\n        // get item children elements and sort based on list sort\n        var list = root.ref.list.childViews[0];\n        var visibleChildren = list.childViews.filter(function(child) {\n          return child.rect.element.height;\n        });\n        var children = root\n          .query('GET_ACTIVE_ITEMS')\n          .map(function(item) {\n            return visibleChildren.find(function(child) {\n              return child.id === item.id;\n            });\n          })\n          .filter(function(item) {\n            return item;\n          });\n\n        // go\n        root.dispatch('ADD_ITEMS', {\n          items: items,\n          index: getDragIndex(root.ref.list, children, position),\n          interactionMethod: InteractionMethod.DROP\n        });\n\n        root.dispatch('DID_DROP', { position: position });\n\n        root.dispatch('DID_END_DRAG', { position: position });\n      };\n\n      hopper.ondragstart = function(position) {\n        root.dispatch('DID_START_DRAG', { position: position });\n      };\n\n      hopper.ondrag = debounce(function(position) {\n        root.dispatch('DID_DRAG', { position: position });\n      });\n\n      hopper.ondragend = function(position) {\n        root.dispatch('DID_END_DRAG', { position: position });\n      };\n\n      root.ref.hopper = hopper;\n\n      root.ref.drip = root.appendChildView(root.createChildView(drip));\n    } else if (!enabled && root.ref.hopper) {\n      root.ref.hopper.destroy();\n      root.ref.hopper = null;\n      root.removeChildView(root.ref.drip);\n    }\n  };\n\n  /**\n   * Enable or disable browse functionality\n   */\n  var toggleBrowse = function toggleBrowse(root, props) {\n    var isAllowed = root.query('GET_ALLOW_BROWSE');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n    if (enabled && !root.ref.browser) {\n      root.ref.browser = root.appendChildView(\n        root.createChildView(\n          browser,\n          Object.assign({}, props, {\n            onload: function onload(items) {\n              // these files don't fit so stop here\n              if (exceedsMaxFiles(root, items)) return false;\n\n              // add items!\n              root.dispatch('ADD_ITEMS', {\n                items: items,\n                index: -1,\n                interactionMethod: InteractionMethod.BROWSE\n              });\n            }\n          })\n        ),\n\n        0\n      );\n    } else if (!enabled && root.ref.browser) {\n      root.removeChildView(root.ref.browser);\n      root.ref.browser = null;\n    }\n  };\n\n  /**\n   * Enable or disable paste functionality\n   */\n  var togglePaste = function togglePaste(root) {\n    var isAllowed = root.query('GET_ALLOW_PASTE');\n    var isDisabled = root.query('GET_DISABLED');\n    var enabled = isAllowed && !isDisabled;\n    if (enabled && !root.ref.paster) {\n      root.ref.paster = createPaster();\n      root.ref.paster.onload = function(items) {\n        root.dispatch('ADD_ITEMS', {\n          items: items,\n          index: -1,\n          interactionMethod: InteractionMethod.PASTE\n        });\n      };\n    } else if (!enabled && root.ref.paster) {\n      root.ref.paster.destroy();\n      root.ref.paster = null;\n    }\n  };\n\n  /**\n   * Route actions\n   */\n  var route$5 = createRoute({\n    DID_SET_ALLOW_BROWSE: function DID_SET_ALLOW_BROWSE(_ref5) {\n      var root = _ref5.root,\n        props = _ref5.props;\n      toggleBrowse(root, props);\n    },\n    DID_SET_ALLOW_DROP: function DID_SET_ALLOW_DROP(_ref6) {\n      var root = _ref6.root;\n      toggleDrop(root);\n    },\n    DID_SET_ALLOW_PASTE: function DID_SET_ALLOW_PASTE(_ref7) {\n      var root = _ref7.root;\n      togglePaste(root);\n    },\n    DID_SET_DISABLED: function DID_SET_DISABLED(_ref8) {\n      var root = _ref8.root,\n        props = _ref8.props;\n      toggleDrop(root);\n      togglePaste(root);\n      toggleBrowse(root, props);\n      var isDisabled = root.query('GET_DISABLED');\n      if (isDisabled) {\n        root.element.dataset.disabled = 'disabled';\n      } else {\n        // delete root.element.dataset.disabled; <= this does not work on iOS 10\n        root.element.removeAttribute('data-disabled');\n      }\n    }\n  });\n\n  var root = createView({\n    name: 'root',\n    read: function read(_ref9) {\n      var root = _ref9.root;\n      if (root.ref.measure) {\n        root.ref.measureHeight = root.ref.measure.offsetHeight;\n      }\n    },\n    create: create$e,\n    write: write$9,\n    destroy: function destroy(_ref10) {\n      var root = _ref10.root;\n      if (root.ref.paster) {\n        root.ref.paster.destroy();\n      }\n      if (root.ref.hopper) {\n        root.ref.hopper.destroy();\n      }\n      root.element.removeEventListener('touchmove', prevent);\n      root.element.removeEventListener('gesturestart', prevent);\n    },\n    mixins: {\n      styles: ['height']\n    }\n  });\n\n  // creates the app\n  var createApp = function createApp() {\n    var initialOptions =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    // let element\n    var originalElement = null;\n\n    // get default options\n    var defaultOptions = getOptions();\n\n    // create the data store, this will contain all our app info\n    var store = createStore(\n      // initial state (should be serializable)\n      createInitialState(defaultOptions),\n\n      // queries\n      [queries, createOptionQueries(defaultOptions)],\n\n      // action handlers\n      [actions, createOptionActions(defaultOptions)]\n    );\n\n    // set initial options\n    store.dispatch('SET_OPTIONS', { options: initialOptions });\n\n    // kick thread if visibility changes\n    var visibilityHandler = function visibilityHandler() {\n      if (document.hidden) return;\n      store.dispatch('KICK');\n    };\n    document.addEventListener('visibilitychange', visibilityHandler);\n\n    // re-render on window resize start and finish\n    var resizeDoneTimer = null;\n    var isResizing = false;\n    var isResizingHorizontally = false;\n    var initialWindowWidth = null;\n    var currentWindowWidth = null;\n    var resizeHandler = function resizeHandler() {\n      if (!isResizing) {\n        isResizing = true;\n      }\n      clearTimeout(resizeDoneTimer);\n      resizeDoneTimer = setTimeout(function() {\n        isResizing = false;\n        initialWindowWidth = null;\n        currentWindowWidth = null;\n        if (isResizingHorizontally) {\n          isResizingHorizontally = false;\n          store.dispatch('DID_STOP_RESIZE');\n        }\n      }, 500);\n    };\n    window.addEventListener('resize', resizeHandler);\n\n    // render initial view\n    var view = root(store, { id: getUniqueId() });\n\n    //\n    // PRIVATE API -------------------------------------------------------------------------------------\n    //\n    var isResting = false;\n    var isHidden = false;\n\n    var readWriteApi = {\n      // necessary for update loop\n\n      /**\n       * Reads from dom (never call manually)\n       * @private\n       */\n      _read: function _read() {\n        // test if we're resizing horizontally\n        // TODO: see if we can optimize this by measuring root rect\n        if (isResizing) {\n          currentWindowWidth = window.innerWidth;\n          if (!initialWindowWidth) {\n            initialWindowWidth = currentWindowWidth;\n          }\n\n          if (\n            !isResizingHorizontally &&\n            currentWindowWidth !== initialWindowWidth\n          ) {\n            store.dispatch('DID_START_RESIZE');\n            isResizingHorizontally = true;\n          }\n        }\n\n        if (isHidden && isResting) {\n          // test if is no longer hidden\n          isResting = view.element.offsetParent === null;\n        }\n\n        // if resting, no need to read as numbers will still all be correct\n        if (isResting) return;\n\n        // read view data\n        view._read();\n\n        // if is hidden we need to know so we exit rest mode when revealed\n        isHidden = view.rect.element.hidden;\n      },\n\n      /**\n       * Writes to dom (never call manually)\n       * @private\n       */\n      _write: function _write(ts) {\n        // get all actions from store\n        var actions = store\n          .processActionQueue()\n\n          // filter out set actions (these will automatically trigger DID_SET)\n          .filter(function(action) {\n            return !/^SET_/.test(action.type);\n          });\n\n        // if was idling and no actions stop here\n        if (isResting && !actions.length) return;\n\n        // some actions might trigger events\n        routeActionsToEvents(actions);\n\n        // update the view\n        isResting = view._write(ts, actions, isResizingHorizontally);\n\n        // will clean up all archived items\n        removeReleasedItems(store.query('GET_ITEMS'));\n\n        // now idling\n        if (isResting) {\n          store.processDispatchQueue();\n        }\n      }\n    };\n\n    //\n    // EXPOSE EVENTS -------------------------------------------------------------------------------------\n    //\n    var createEvent = function createEvent(name) {\n      return function(data) {\n        // create default event\n        var event = {\n          type: name\n        };\n\n        // no data to add\n        if (!data) {\n          return event;\n        }\n\n        // copy relevant props\n        if (data.hasOwnProperty('error')) {\n          event.error = data.error ? Object.assign({}, data.error) : null;\n        }\n\n        if (data.status) {\n          event.status = Object.assign({}, data.status);\n        }\n\n        if (data.file) {\n          event.output = data.file;\n        }\n\n        // only source is available, else add item if possible\n        if (data.source) {\n          event.file = data.source;\n        } else if (data.item || data.id) {\n          var item = data.item ? data.item : store.query('GET_ITEM', data.id);\n          event.file = item ? createItemAPI(item) : null;\n        }\n\n        // map all items in a possible items array\n        if (data.items) {\n          event.items = data.items.map(createItemAPI);\n        }\n\n        // if this is a progress event add the progress amount\n        if (/progress/.test(name)) {\n          event.progress = data.progress;\n        }\n\n        // copy relevant props\n        if (data.hasOwnProperty('origin') && data.hasOwnProperty('target')) {\n          event.origin = data.origin;\n          event.target = data.target;\n        }\n\n        return event;\n      };\n    };\n\n    var eventRoutes = {\n      DID_DESTROY: createEvent('destroy'),\n\n      DID_INIT: createEvent('init'),\n\n      DID_THROW_MAX_FILES: createEvent('warning'),\n\n      DID_INIT_ITEM: createEvent('initfile'),\n      DID_START_ITEM_LOAD: createEvent('addfilestart'),\n      DID_UPDATE_ITEM_LOAD_PROGRESS: createEvent('addfileprogress'),\n      DID_LOAD_ITEM: createEvent('addfile'),\n\n      DID_THROW_ITEM_INVALID: [createEvent('error'), createEvent('addfile')],\n\n      DID_THROW_ITEM_LOAD_ERROR: [createEvent('error'), createEvent('addfile')],\n\n      DID_THROW_ITEM_REMOVE_ERROR: [\n        createEvent('error'),\n        createEvent('removefile')\n      ],\n\n      DID_PREPARE_OUTPUT: createEvent('preparefile'),\n\n      DID_START_ITEM_PROCESSING: createEvent('processfilestart'),\n      DID_UPDATE_ITEM_PROCESS_PROGRESS: createEvent('processfileprogress'),\n      DID_ABORT_ITEM_PROCESSING: createEvent('processfileabort'),\n      DID_COMPLETE_ITEM_PROCESSING: createEvent('processfile'),\n      DID_COMPLETE_ITEM_PROCESSING_ALL: createEvent('processfiles'),\n      DID_REVERT_ITEM_PROCESSING: createEvent('processfilerevert'),\n\n      DID_THROW_ITEM_PROCESSING_ERROR: [\n        createEvent('error'),\n        createEvent('processfile')\n      ],\n\n      DID_REMOVE_ITEM: createEvent('removefile'),\n\n      DID_UPDATE_ITEMS: createEvent('updatefiles'),\n\n      DID_ACTIVATE_ITEM: createEvent('activatefile'),\n\n      DID_REORDER_ITEMS: createEvent('reorderfiles')\n    };\n\n    var exposeEvent = function exposeEvent(event) {\n      // create event object to be dispatched\n      var detail = Object.assign({ pond: exports }, event);\n      delete detail.type;\n      view.element.dispatchEvent(\n        new CustomEvent('FilePond:' + event.type, {\n          // event info\n          detail: detail,\n\n          // event behaviour\n          bubbles: true,\n          cancelable: true,\n          composed: true // triggers listeners outside of shadow root\n        })\n      );\n\n      // event object to params used for `on()` event handlers and callbacks `oninit()`\n      var params = [];\n\n      // if is possible error event, make it the first param\n      if (event.hasOwnProperty('error')) {\n        params.push(event.error);\n      }\n\n      // file is always section\n      if (event.hasOwnProperty('file')) {\n        params.push(event.file);\n      }\n\n      // append other props\n      var filtered = ['type', 'error', 'file'];\n      Object.keys(event)\n        .filter(function(key) {\n          return !filtered.includes(key);\n        })\n        .forEach(function(key) {\n          return params.push(event[key]);\n        });\n\n      // on(type, () => { })\n      exports.fire.apply(exports, [event.type].concat(params));\n\n      // oninit = () => {}\n      var handler = store.query('GET_ON' + event.type.toUpperCase());\n      if (handler) {\n        handler.apply(void 0, params);\n      }\n    };\n\n    var routeActionsToEvents = function routeActionsToEvents(actions) {\n      if (!actions.length) return;\n      actions\n        .filter(function(action) {\n          return eventRoutes[action.type];\n        })\n        .forEach(function(action) {\n          var routes = eventRoutes[action.type];\n          (Array.isArray(routes) ? routes : [routes]).forEach(function(route) {\n            // this isn't fantastic, but because of the stacking of settimeouts plugins can handle the did_load before the did_init\n            if (action.type === 'DID_INIT_ITEM') {\n              exposeEvent(route(action.data));\n            } else {\n              setTimeout(function() {\n                exposeEvent(route(action.data));\n              }, 0);\n            }\n          });\n        });\n    };\n\n    //\n    // PUBLIC API -------------------------------------------------------------------------------------\n    //\n    var setOptions = function setOptions(options) {\n      return store.dispatch('SET_OPTIONS', { options: options });\n    };\n\n    var getFile = function getFile(query) {\n      return store.query('GET_ACTIVE_ITEM', query);\n    };\n\n    var prepareFile = function prepareFile(query) {\n      return new Promise(function(resolve, reject) {\n        store.dispatch('REQUEST_ITEM_PREPARE', {\n          query: query,\n          success: function success(item) {\n            resolve(item);\n          },\n          failure: function failure(error) {\n            reject(error);\n          }\n        });\n      });\n    };\n\n    var addFile = function addFile(source) {\n      var options =\n        arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return new Promise(function(resolve, reject) {\n        addFiles([{ source: source, options: options }], {\n          index: options.index\n        })\n          .then(function(items) {\n            return resolve(items && items[0]);\n          })\n          .catch(reject);\n      });\n    };\n\n    var removeFile = function removeFile(query, options) {\n      // if only passed options\n      if (typeof query === 'object' && !options) {\n        options = query;\n        query = undefined;\n      }\n\n      // request item removal\n      store.dispatch(\n        'REMOVE_ITEM',\n        Object.assign({}, options, { query: query })\n      );\n\n      // see if item has been removed\n      return store.query('GET_ACTIVE_ITEM', query) === null;\n    };\n\n    var addFiles = function addFiles() {\n      for (\n        var _len = arguments.length, args = new Array(_len), _key = 0;\n        _key < _len;\n        _key++\n      ) {\n        args[_key] = arguments[_key];\n      }\n      return new Promise(function(resolve, reject) {\n        var sources = [];\n        var options = {};\n\n        // user passed a sources array\n        if (isArray(args[0])) {\n          sources.push.apply(sources, args[0]);\n          Object.assign(options, args[1] || {});\n        } else {\n          // user passed sources as arguments, last one might be options object\n          var lastArgument = args[args.length - 1];\n          if (\n            typeof lastArgument === 'object' &&\n            !(lastArgument instanceof Blob)\n          ) {\n            Object.assign(options, args.pop());\n          }\n\n          // add rest to sources\n          sources.push.apply(sources, args);\n        }\n\n        store.dispatch('ADD_ITEMS', {\n          items: sources,\n          index: options.index,\n          interactionMethod: InteractionMethod.API,\n          success: resolve,\n          failure: reject\n        });\n      });\n    };\n\n    var getFiles = function getFiles() {\n      return store.query('GET_ACTIVE_ITEMS');\n    };\n\n    var processFile = function processFile(query) {\n      return new Promise(function(resolve, reject) {\n        store.dispatch('REQUEST_ITEM_PROCESSING', {\n          query: query,\n          success: function success(item) {\n            resolve(item);\n          },\n          failure: function failure(error) {\n            reject(error);\n          }\n        });\n      });\n    };\n\n    var prepareFiles = function prepareFiles() {\n      for (\n        var _len2 = arguments.length, args = new Array(_len2), _key2 = 0;\n        _key2 < _len2;\n        _key2++\n      ) {\n        args[_key2] = arguments[_key2];\n      }\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n      var items = queries.length ? queries : getFiles();\n      return Promise.all(items.map(prepareFile));\n    };\n\n    var processFiles = function processFiles() {\n      for (\n        var _len3 = arguments.length, args = new Array(_len3), _key3 = 0;\n        _key3 < _len3;\n        _key3++\n      ) {\n        args[_key3] = arguments[_key3];\n      }\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n      if (!queries.length) {\n        var files = getFiles().filter(function(item) {\n          return (\n            !(\n              item.status === ItemStatus.IDLE &&\n              item.origin === FileOrigin.LOCAL\n            ) &&\n            item.status !== ItemStatus.PROCESSING &&\n            item.status !== ItemStatus.PROCESSING_COMPLETE &&\n            item.status !== ItemStatus.PROCESSING_REVERT_ERROR\n          );\n        });\n\n        return Promise.all(files.map(processFile));\n      }\n      return Promise.all(queries.map(processFile));\n    };\n\n    var removeFiles = function removeFiles() {\n      for (\n        var _len4 = arguments.length, args = new Array(_len4), _key4 = 0;\n        _key4 < _len4;\n        _key4++\n      ) {\n        args[_key4] = arguments[_key4];\n      }\n\n      var queries = Array.isArray(args[0]) ? args[0] : args;\n\n      var options;\n      if (typeof queries[queries.length - 1] === 'object') {\n        options = queries.pop();\n      } else if (Array.isArray(args[0])) {\n        options = args[1];\n      }\n\n      var files = getFiles();\n\n      if (!queries.length)\n        return Promise.all(\n          files.map(function(file) {\n            return removeFile(file, options);\n          })\n        );\n\n      // when removing by index the indexes shift after each file removal so we need to convert indexes to ids\n      var mappedQueries = queries\n        .map(function(query) {\n          return isNumber(query)\n            ? files[query]\n              ? files[query].id\n              : null\n            : query;\n        })\n        .filter(function(query) {\n          return query;\n        });\n\n      return mappedQueries.map(function(q) {\n        return removeFile(q, options);\n      });\n    };\n\n    var exports = Object.assign(\n      {},\n\n      on(),\n      {},\n\n      readWriteApi,\n      {},\n\n      createOptionAPI(store, defaultOptions),\n      {\n        /**\n         * Override options defined in options object\n         * @param options\n         */\n        setOptions: setOptions,\n\n        /**\n         * Load the given file\n         * @param source - the source of the file (either a File, base64 data uri or url)\n         * @param options - object, { index: 0 }\n         */\n        addFile: addFile,\n\n        /**\n         * Load the given files\n         * @param sources - the sources of the files to load\n         * @param options - object, { index: 0 }\n         */\n        addFiles: addFiles,\n\n        /**\n         * Returns the file objects matching the given query\n         * @param query { string, number, null }\n         */\n        getFile: getFile,\n\n        /**\n         * Upload file with given name\n         * @param query { string, number, null  }\n         */\n        processFile: processFile,\n\n        /**\n         * Request prepare output for file with given name\n         * @param query { string, number, null  }\n         */\n        prepareFile: prepareFile,\n\n        /**\n         * Removes a file by its name\n         * @param query { string, number, null  }\n         */\n        removeFile: removeFile,\n\n        /**\n         * Moves a file to a new location in the files list\n         */\n        moveFile: function moveFile(query, index) {\n          return store.dispatch('MOVE_ITEM', { query: query, index: index });\n        },\n\n        /**\n         * Returns all files (wrapped in public api)\n         */\n        getFiles: getFiles,\n\n        /**\n         * Starts uploading all files\n         */\n        processFiles: processFiles,\n\n        /**\n         * Clears all files from the files list\n         */\n        removeFiles: removeFiles,\n\n        /**\n         * Starts preparing output of all files\n         */\n        prepareFiles: prepareFiles,\n\n        /**\n         * Sort list of files\n         */\n        sort: function sort(compare) {\n          return store.dispatch('SORT', { compare: compare });\n        },\n\n        /**\n         * Browse the file system for a file\n         */\n        browse: function browse() {\n          // needs to be trigger directly as user action needs to be traceable (is not traceable in requestAnimationFrame)\n          var input = view.element.querySelector('input[type=file]');\n          if (input) {\n            input.click();\n          }\n        },\n\n        /**\n         * Destroys the app\n         */\n        destroy: function destroy() {\n          // request destruction\n          exports.fire('destroy', view.element);\n\n          // stop active processes (file uploads, fetches, stuff like that)\n          // loop over items and depending on states call abort for ongoing processes\n          store.dispatch('ABORT_ALL');\n\n          // destroy view\n          view._destroy();\n\n          // stop listening to resize\n          window.removeEventListener('resize', resizeHandler);\n\n          // stop listening to the visiblitychange event\n          document.removeEventListener('visibilitychange', visibilityHandler);\n\n          // dispatch destroy\n          store.dispatch('DID_DESTROY');\n        },\n\n        /**\n         * Inserts the plugin before the target element\n         */\n        insertBefore: function insertBefore$1(element) {\n          return insertBefore(view.element, element);\n        },\n\n        /**\n         * Inserts the plugin after the target element\n         */\n        insertAfter: function insertAfter$1(element) {\n          return insertAfter(view.element, element);\n        },\n\n        /**\n         * Appends the plugin to the target element\n         */\n        appendTo: function appendTo(element) {\n          return element.appendChild(view.element);\n        },\n\n        /**\n         * Replaces an element with the app\n         */\n        replaceElement: function replaceElement(element) {\n          // insert the app before the element\n          insertBefore(view.element, element);\n\n          // remove the original element\n          element.parentNode.removeChild(element);\n\n          // remember original element\n          originalElement = element;\n        },\n\n        /**\n         * Restores the original element\n         */\n        restoreElement: function restoreElement() {\n          if (!originalElement) {\n            return; // no element to restore\n          }\n\n          // restore original element\n          insertAfter(originalElement, view.element);\n\n          // remove our element\n          view.element.parentNode.removeChild(view.element);\n\n          // remove reference\n          originalElement = null;\n        },\n\n        /**\n         * Returns true if the app root is attached to given element\n         * @param element\n         */\n        isAttachedTo: function isAttachedTo(element) {\n          return view.element === element || originalElement === element;\n        },\n\n        /**\n         * Returns the root element\n         */\n        element: {\n          get: function get() {\n            return view.element;\n          }\n        },\n\n        /**\n         * Returns the current pond status\n         */\n        status: {\n          get: function get() {\n            return store.query('GET_STATUS');\n          }\n        }\n      }\n    );\n\n    // Done!\n    store.dispatch('DID_INIT');\n\n    // create actual api object\n    return createObject(exports);\n  };\n\n  var createAppObject = function createAppObject() {\n    var customOptions =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    // default options\n    var defaultOptions = {};\n    forin(getOptions(), function(key, value) {\n      defaultOptions[key] = value[0];\n    });\n\n    // set app options\n    var app = createApp(\n      Object.assign(\n        {},\n\n        defaultOptions,\n        {},\n\n        customOptions\n      )\n    );\n\n    // return the plugin instance\n    return app;\n  };\n\n  var lowerCaseFirstLetter = function lowerCaseFirstLetter(string) {\n    return string.charAt(0).toLowerCase() + string.slice(1);\n  };\n\n  var attributeNameToPropertyName = function attributeNameToPropertyName(\n    attributeName\n  ) {\n    return toCamels(attributeName.replace(/^data-/, ''));\n  };\n\n  var mapObject = function mapObject(object, propertyMap) {\n    // remove unwanted\n    forin(propertyMap, function(selector, mapping) {\n      forin(object, function(property, value) {\n        // create regexp shortcut\n        var selectorRegExp = new RegExp(selector);\n\n        // tests if\n        var matches = selectorRegExp.test(property);\n\n        // no match, skip\n        if (!matches) {\n          return;\n        }\n\n        // if there's a mapping, the original property is always removed\n        delete object[property];\n\n        // should only remove, we done!\n        if (mapping === false) {\n          return;\n        }\n\n        // move value to new property\n        if (isString(mapping)) {\n          object[mapping] = value;\n          return;\n        }\n\n        // move to group\n        var group = mapping.group;\n        if (isObject(mapping) && !object[group]) {\n          object[group] = {};\n        }\n\n        object[group][\n          lowerCaseFirstLetter(property.replace(selectorRegExp, ''))\n        ] = value;\n      });\n\n      // do submapping\n      if (mapping.mapping) {\n        mapObject(object[mapping.group], mapping.mapping);\n      }\n    });\n  };\n\n  var getAttributesAsObject = function getAttributesAsObject(node) {\n    var attributeMapping =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    // turn attributes into object\n    var attributes = [];\n    forin(node.attributes, function(index) {\n      attributes.push(node.attributes[index]);\n    });\n\n    var output = attributes\n      .filter(function(attribute) {\n        return attribute.name;\n      })\n      .reduce(function(obj, attribute) {\n        var value = attr(node, attribute.name);\n\n        obj[attributeNameToPropertyName(attribute.name)] =\n          value === attribute.name ? true : value;\n        return obj;\n      }, {});\n\n    // do mapping of object properties\n    mapObject(output, attributeMapping);\n\n    return output;\n  };\n\n  var createAppAtElement = function createAppAtElement(element) {\n    var options =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    // how attributes of the input element are mapped to the options for the plugin\n    var attributeMapping = {\n      // translate to other name\n      '^class$': 'className',\n      '^multiple$': 'allowMultiple',\n      '^capture$': 'captureMethod',\n      '^webkitdirectory$': 'allowDirectoriesOnly',\n\n      // group under single property\n      '^server': {\n        group: 'server',\n        mapping: {\n          '^process': {\n            group: 'process'\n          },\n\n          '^revert': {\n            group: 'revert'\n          },\n\n          '^fetch': {\n            group: 'fetch'\n          },\n\n          '^restore': {\n            group: 'restore'\n          },\n\n          '^load': {\n            group: 'load'\n          }\n        }\n      },\n\n      // don't include in object\n      '^type$': false,\n      '^files$': false\n    };\n\n    // add additional option translators\n    applyFilters('SET_ATTRIBUTE_TO_OPTION_MAP', attributeMapping);\n\n    // create final options object by setting options object and then overriding options supplied on element\n    var mergedOptions = Object.assign({}, options);\n\n    var attributeOptions = getAttributesAsObject(\n      element.nodeName === 'FIELDSET'\n        ? element.querySelector('input[type=file]')\n        : element,\n      attributeMapping\n    );\n\n    // merge with options object\n    Object.keys(attributeOptions).forEach(function(key) {\n      if (isObject(attributeOptions[key])) {\n        if (!isObject(mergedOptions[key])) {\n          mergedOptions[key] = {};\n        }\n        Object.assign(mergedOptions[key], attributeOptions[key]);\n      } else {\n        mergedOptions[key] = attributeOptions[key];\n      }\n    });\n\n    // if parent is a fieldset, get files from parent by selecting all input fields that are not file upload fields\n    // these will then be automatically set to the initial files\n    mergedOptions.files = (options.files || []).concat(\n      Array.from(element.querySelectorAll('input:not([type=file])')).map(\n        function(input) {\n          return {\n            source: input.value,\n            options: {\n              type: input.dataset.type\n            }\n          };\n        }\n      )\n    );\n\n    // build plugin\n    var app = createAppObject(mergedOptions);\n\n    // add already selected files\n    if (element.files) {\n      Array.from(element.files).forEach(function(file) {\n        app.addFile(file);\n      });\n    }\n\n    // replace the target element\n    app.replaceElement(element);\n\n    // expose\n    return app;\n  };\n\n  // if an element is passed, we create the instance at that element, if not, we just create an up object\n  var createApp$1 = function createApp() {\n    return isNode(arguments.length <= 0 ? undefined : arguments[0])\n      ? createAppAtElement.apply(void 0, arguments)\n      : createAppObject.apply(void 0, arguments);\n  };\n\n  var PRIVATE_METHODS = ['fire', '_read', '_write'];\n\n  var createAppAPI = function createAppAPI(app) {\n    var api = {};\n\n    copyObjectPropertiesToObject(app, api, PRIVATE_METHODS);\n\n    return api;\n  };\n\n  /**\n   * Replaces placeholders in given string with replacements\n   * @param string - \"Foo {bar}\"\"\n   * @param replacements - { \"bar\": 10 }\n   */\n  var replaceInString = function replaceInString(string, replacements) {\n    return string.replace(/(?:{([a-zA-Z]+)})/g, function(match, group) {\n      return replacements[group];\n    });\n  };\n\n  var createWorker = function createWorker(fn) {\n    var workerBlob = new Blob(['(', fn.toString(), ')()'], {\n      type: 'application/javascript'\n    });\n\n    var workerURL = URL.createObjectURL(workerBlob);\n    var worker = new Worker(workerURL);\n\n    return {\n      transfer: function transfer(message, cb) {},\n      post: function post(message, cb, transferList) {\n        var id = getUniqueId();\n\n        worker.onmessage = function(e) {\n          if (e.data.id === id) {\n            cb(e.data.message);\n          }\n        };\n\n        worker.postMessage(\n          {\n            id: id,\n            message: message\n          },\n\n          transferList\n        );\n      },\n      terminate: function terminate() {\n        worker.terminate();\n        URL.revokeObjectURL(workerURL);\n      }\n    };\n  };\n\n  var loadImage = function loadImage(url) {\n    return new Promise(function(resolve, reject) {\n      var img = new Image();\n      img.onload = function() {\n        resolve(img);\n      };\n      img.onerror = function(e) {\n        reject(e);\n      };\n      img.src = url;\n    });\n  };\n\n  var renameFile = function renameFile(file, name) {\n    var renamedFile = file.slice(0, file.size, file.type);\n    renamedFile.lastModifiedDate = file.lastModifiedDate;\n    renamedFile.name = name;\n    return renamedFile;\n  };\n\n  var copyFile = function copyFile(file) {\n    return renameFile(file, file.name);\n  };\n\n  // already registered plugins (can't register twice)\n  var registeredPlugins = [];\n\n  // pass utils to plugin\n  var createAppPlugin = function createAppPlugin(plugin) {\n    // already registered\n    if (registeredPlugins.includes(plugin)) {\n      return;\n    }\n\n    // remember this plugin\n    registeredPlugins.push(plugin);\n\n    // setup!\n    var pluginOutline = plugin({\n      addFilter: addFilter,\n      utils: {\n        Type: Type,\n        forin: forin,\n        isString: isString,\n        isFile: isFile,\n        toNaturalFileSize: toNaturalFileSize,\n        replaceInString: replaceInString,\n        getExtensionFromFilename: getExtensionFromFilename,\n        getFilenameWithoutExtension: getFilenameWithoutExtension,\n        guesstimateMimeType: guesstimateMimeType,\n        getFileFromBlob: getFileFromBlob,\n        getFilenameFromURL: getFilenameFromURL,\n        createRoute: createRoute,\n        createWorker: createWorker,\n        createView: createView,\n        createItemAPI: createItemAPI,\n        loadImage: loadImage,\n        copyFile: copyFile,\n        renameFile: renameFile,\n        createBlob: createBlob,\n        applyFilterChain: applyFilterChain,\n        text: text,\n        getNumericAspectRatioFromString: getNumericAspectRatioFromString\n      },\n\n      views: {\n        fileActionButton: fileActionButton\n      }\n    });\n\n    // add plugin options to default options\n    extendDefaultOptions(pluginOutline.options);\n  };\n\n  // feature detection used by supported() method\n  var isOperaMini = function isOperaMini() {\n    return (\n      Object.prototype.toString.call(window.operamini) === '[object OperaMini]'\n    );\n  };\n  var hasPromises = function hasPromises() {\n    return 'Promise' in window;\n  };\n  var hasBlobSlice = function hasBlobSlice() {\n    return 'slice' in Blob.prototype;\n  };\n  var hasCreateObjectURL = function hasCreateObjectURL() {\n    return 'URL' in window && 'createObjectURL' in window.URL;\n  };\n  var hasVisibility = function hasVisibility() {\n    return 'visibilityState' in document;\n  };\n  var hasTiming = function hasTiming() {\n    return 'performance' in window;\n  }; // iOS 8.x\n  var hasCSSSupports = function hasCSSSupports() {\n    return 'supports' in (window.CSS || {});\n  }; // use to detect Safari 9+\n  var isIE11 = function isIE11() {\n    return /MSIE|Trident/.test(window.navigator.userAgent);\n  };\n\n  var supported = (function() {\n    // Runs immidiately and then remembers result for subsequent calls\n    var isSupported =\n      // Has to be a browser\n      isBrowser() &&\n      // Can't run on Opera Mini due to lack of everything\n      !isOperaMini() &&\n      // Require these APIs to feature detect a modern browser\n      hasVisibility() &&\n      hasPromises() &&\n      hasBlobSlice() &&\n      hasCreateObjectURL() &&\n      hasTiming() &&\n      // doesn't need CSSSupports but is a good way to detect Safari 9+ (we do want to support IE11 though)\n      (hasCSSSupports() || isIE11());\n\n    return function() {\n      return isSupported;\n    };\n  })();\n\n  /**\n   * Plugin internal state (over all instances)\n   */\n  var state = {\n    // active app instances, used to redraw the apps and to find the later\n    apps: []\n  };\n\n  // plugin name\n  var name = 'filepond';\n\n  /**\n   * Public Plugin methods\n   */\n  var fn = function fn() {};\n  exports.Status = {};\n  exports.FileStatus = {};\n  exports.FileOrigin = {};\n  exports.OptionTypes = {};\n  exports.create = fn;\n  exports.destroy = fn;\n  exports.parse = fn;\n  exports.find = fn;\n  exports.registerPlugin = fn;\n  exports.getOptions = fn;\n  exports.setOptions = fn;\n\n  // if not supported, no API\n  if (supported()) {\n    // start painter and fire load event\n    createPainter(\n      function() {\n        state.apps.forEach(function(app) {\n          return app._read();\n        });\n      },\n      function(ts) {\n        state.apps.forEach(function(app) {\n          return app._write(ts);\n        });\n      }\n    );\n\n    // fire loaded event so we know when FilePond is available\n    var dispatch = function dispatch() {\n      // let others know we have area ready\n      document.dispatchEvent(\n        new CustomEvent('FilePond:loaded', {\n          detail: {\n            supported: supported,\n            create: exports.create,\n            destroy: exports.destroy,\n            parse: exports.parse,\n            find: exports.find,\n            registerPlugin: exports.registerPlugin,\n            setOptions: exports.setOptions\n          }\n        })\n      );\n\n      // clean up event\n      document.removeEventListener('DOMContentLoaded', dispatch);\n    };\n\n    if (document.readyState !== 'loading') {\n      // move to back of execution queue, FilePond should have been exported by then\n      setTimeout(function() {\n        return dispatch();\n      }, 0);\n    } else {\n      document.addEventListener('DOMContentLoaded', dispatch);\n    }\n\n    // updates the OptionTypes object based on the current options\n    var updateOptionTypes = function updateOptionTypes() {\n      return forin(getOptions(), function(key, value) {\n        exports.OptionTypes[key] = value[1];\n      });\n    };\n\n    exports.Status = Object.assign({}, Status);\n    exports.FileOrigin = Object.assign({}, FileOrigin);\n    exports.FileStatus = Object.assign({}, ItemStatus);\n\n    exports.OptionTypes = {};\n    updateOptionTypes();\n\n    // create method, creates apps and adds them to the app array\n    exports.create = function create() {\n      var app = createApp$1.apply(void 0, arguments);\n      app.on('destroy', exports.destroy);\n      state.apps.push(app);\n      return createAppAPI(app);\n    };\n\n    // destroys apps and removes them from the app array\n    exports.destroy = function destroy(hook) {\n      // returns true if the app was destroyed successfully\n      var indexToRemove = state.apps.findIndex(function(app) {\n        return app.isAttachedTo(hook);\n      });\n      if (indexToRemove >= 0) {\n        // remove from apps\n        var app = state.apps.splice(indexToRemove, 1)[0];\n\n        // restore original dom element\n        app.restoreElement();\n\n        return true;\n      }\n\n      return false;\n    };\n\n    // parses the given context for plugins (does not include the context element itself)\n    exports.parse = function parse(context) {\n      // get all possible hooks\n      var matchedHooks = Array.from(context.querySelectorAll('.' + name));\n\n      // filter out already active hooks\n      var newHooks = matchedHooks.filter(function(newHook) {\n        return !state.apps.find(function(app) {\n          return app.isAttachedTo(newHook);\n        });\n      });\n\n      // create new instance for each hook\n      return newHooks.map(function(hook) {\n        return exports.create(hook);\n      });\n    };\n\n    // returns an app based on the given element hook\n    exports.find = function find(hook) {\n      var app = state.apps.find(function(app) {\n        return app.isAttachedTo(hook);\n      });\n      if (!app) {\n        return null;\n      }\n      return createAppAPI(app);\n    };\n\n    // adds a plugin extension\n    exports.registerPlugin = function registerPlugin() {\n      for (\n        var _len = arguments.length, plugins = new Array(_len), _key = 0;\n        _key < _len;\n        _key++\n      ) {\n        plugins[_key] = arguments[_key];\n      }\n\n      // register plugins\n      plugins.forEach(createAppPlugin);\n\n      // update OptionTypes, each plugin might have extended the default options\n      updateOptionTypes();\n    };\n\n    exports.getOptions = function getOptions$1() {\n      var opts = {};\n      forin(getOptions(), function(key, value) {\n        opts[key] = value[0];\n      });\n      return opts;\n    };\n\n    exports.setOptions = function setOptions$1(opts) {\n      if (isObject(opts)) {\n        // update existing plugins\n        state.apps.forEach(function(app) {\n          app.setOptions(opts);\n        });\n\n        // override defaults\n        setOptions(opts);\n      }\n\n      // return new options\n      return exports.getOptions();\n    };\n  }\n\n  exports.supported = supported;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n});\n"]},"metadata":{},"sourceType":"script"}